#!/bin/bash

source /etc/profile
echo "getting environment information"
echo $ENV_TYPE

echo "repackaging wars"
cd /tmp/le-job-tc-rpm/war

mkdir ROOT
pushd ROOT
jar xvf ../ROOT.war
popd
rm -rf ROOT.war

if [ -f "/tmp/le-job-tc-rpm/env/${ENV_TYPE}/log4j.properties" ]
then
    echo "replacing log4j.properties for ROOT.war"
    cp -f /tmp/le-job-tc-rpm/env/${ENV_TYPE}/log4j.properties ROOT/WEB-INF/classes/log4j.properties
fi

jar cvf ROOT.war -C ROOT/ .

rm -rf /usr/share/tomcat/work/JobEngine
mkdir -p /usr/share/tomcat/webapps/job
cp -f ROOT.war /usr/share/tomcat/webapps/job

chown -R tomcat:tomcat /usr/share/tomcat/webapps/job
chmod -R 775 /usr/share/tomcat/webapps/job

rm -rf /tmp/le-job-tc-rpm

echo "finishing"
ll /usr/share/tomcat/webapps/job/*.war
