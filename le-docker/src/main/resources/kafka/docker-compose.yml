version: '2'
services:
  zk:
    image: latticeengines/zookeeper
    hostname: kafka-zk
    ports:
      - "2080:2181"
    environment:
      ZK_CLUSTER_SIZE: 1
  bkr:
    image: latticeengines/kafka
    hostname: kafka-bkr
    ports:
      - "${BK_PORT}:9092"
    environment:
      ADVERTISE_IP: "kafka_bkr_1"
      ZK_HOSTS: "${CLUSTER}_zk_1:2181"
      SINGLE_NODE: "true"
    depends_on:
      - "zk"
    labels:
      kafka.group: ${CLUSTER}
      cluster: ${CLUSTER}
  sr:
    image: latticeengines/schema-registry
    hostname: schema-registry
    ports:
          - "${SR_PORT}:9022"
    environment:
      ADVERTISE_IP: "kafka_sr_1"
      ZK_HOSTS: "${CLUSTER}_zk_1:2181"
    restart: unless-stopped
    depends_on:
      - "bkr"
    labels:
      kafka.group: ${CLUSTER}
      cluster: ${CLUSTER}
  conn:
    image: latticeengines/kafka-connect
    hostname: kafka-connect
    ports:
          - "${KC_PORT}:9024"
    environment:
      BOOTSTRAP_SERVERS: "${GATEWAY}:9092"
      SR_ADDRESS: "http://kafka_sr_1:9022"
      GROUP_ID: "kc"
    restart: unless-stopped
    depends_on:
      - "sr"
    labels:
      kafka.group: ${CLUSTER}
      cluster: ${CLUSTER}
networks:
  default:
    external:
      name: ${NETWORK}