version: '2'
services:
  zk1:
    image: latticeengines/zookeeper
    ports:
      - "2181:2181"
    environment:
      ZK_CLUSTER_SIZE: 3
      ZK_HOST_PATTERN: kafka_zk{}_1
      MY_ID: 1
  zk2:
    image: latticeengines/zookeeper
    environment:
      ZK_CLUSTER_SIZE: 3
      ZK_HOST_PATTERN: kafka_zk{}_1
      MY_ID: 2
  zk3:
    image: latticeengines/zookeeper
    environment:
      ZK_CLUSTER_SIZE: 3
      ZK_HOST_PATTERN: kafka_zk{}_1
      MY_ID: 3
  mgr:
    image: latticeengines/kafka-manager
    ports:
      - "9001:9000"
    environment:
      ZK_HOSTS: "kafka_zk1_1:2181,kafka_zk2_1:2181,kafka_zk3_1:2181"
    depends_on:
      - "zk1"
      - "zk2"
      - "zk3"
  bkr1:
    image: latticeengines/kafka
    ports:
      - "9092:9092"
    environment:
      ADVERTISE_IP: "kafka_bkr1_1"
      ZK_HOSTS: "kafka_zk1_1:2181,kafka_zk2_1:2181,kafka_zk3_1:2181"
    depends_on:
      - "zk1"
      - "zk2"
      - "zk3"
  bkr2:
    image: latticeengines/kafka
    environment:
      ADVERTISE_IP: "kafka_bkr2_1"
      ZK_HOSTS: "kafka_zk1_1:2181,kafka_zk2_1:2181,kafka_zk3_1:2181"
    depends_on:
      - "zk1"
      - "zk2"
      - "zk3"
  sr1:
    image: latticeengines/schema-registry
    environment:
      ADVERTISE_IP: "kafka_sr1_1"
      ZK_HOSTS: "kafka_zk1_1:2181,kafka_zk2_1:2181,kafka_zk3_1:2181"
    depends_on:
      - "bkr1"
      - "bkr2"
  sr2:
    image: latticeengines/schema-registry
    environment:
      ADVERTISE_IP: "kafka_sr2_1"
      ZK_HOSTS: "kafka_zk1_1:2181,kafka_zk2_1:2181,kafka_zk3_1:2181"
    depends_on:
      - "bkr1"
      - "bkr2"
  rest1:
    image: latticeengines/kafka-rest
    environment:
      SR_ADDRESS: "http://kafka_ha_1:9022"
      ZK_HOSTS: "kafka_zk1_1:2181,kafka_zk2_1:2181,kafka_zk3_1:2181"
    depends_on:
      - "sr1"
      - "sr2"
  rest2:
    image: latticeengines/kafka-rest
    environment:
      SR_ADDRESS: "http://kafka_ha_1:9022"
      ZK_HOSTS: "kafka_zk1_1:2181,kafka_zk2_1:2181,kafka_zk3_1:2181"
    depends_on:
      - "sr1"
      - "sr2"
  conn1:
    image: latticeengines/kafka-connect
    environment:
      BOOTSTRAP_SERVERS: "kafka_bkr1_1:9092,kafka_bkr2_1:9092"
      ZK_HOSTS: "kafka_zk1_1:2181,kafka_zk2_1:2181,kafka_zk3_1:2181"
    depends_on:
      - "sr1"
      - "sr2"
  conn2:
    image: latticeengines/kafka-connect
    environment:
      BOOTSTRAP_SERVERS: "kafka_bkr1_1:9092,kafka_bkr2_1:9092"
      ZK_HOSTS: "kafka_zk1_1:2181,kafka_zk2_1:2181,kafka_zk3_1:2181"
    depends_on:
      - "sr1"
      - "sr2"
  ha:
    image: latticeengines/kafka-haproxy
    ports:
      - "9025:80"
      - "9022:9022"
      - "9023:9023"
      - "9024:9024"
    environment:
      HOSTS: "kafka_sr1_1 kafka_sr2_1 kafka_rest1_1 kafka_rest2_1 kafka_conn1_1 kafka_conn2_1"
    depends_on:
      - "rest1"
      - "rest2"
      - "conn"