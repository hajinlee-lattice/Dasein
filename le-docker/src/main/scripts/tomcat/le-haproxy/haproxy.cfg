global
  log 127.0.0.1 local0
  log 127.0.0.1 local1 notice
  daemon

  tune.ssl.default-dh-param 4096

defaults
  log   global
  mode   http

  # logs which servers requests go to, plus current connections and a whole lot of other stuff 
  option   httplog
  option   dontlognull
  retries   3
  option    redispatch
  maxconn   2000
  timeout connect 5000
  timeout client  600000
  timeout server  600000

  balance roundrobin
  option forwardfor
  option http-server-close

  default-server inter 3s fall 3 rise 2

listen stats 
  bind *:81
  stats enable
  stats scope lpi
  stats scope adminconsole
  stats scope swagger
  stats scope pls
  stats scope admin
  stats scope scoringapi
  stats scope matchapi
  stats scope saml
  stats scope oauth2
  stats scope playmaker
  stats scope eai
  stats scope metadata
  stats scope dataflowapi
  stats scope workflowapi
  stats scope objectapi
  stats scope scoring
  stats scope modeling
  stats scope quartz
  stats scope modelquality
  stats scope datacloudapi
  stats scope dellebi
  stats scope cdl
  stats scope lp
  stats scope dante
  stats realm Haproxy\ Statistics
  stats uri /

frontend lpifront
  bind *:82 ssl crt /etc/ssl/private/server.pem

  http-request set-header X-Forwarded-Port %[dst_port]
  http-request add-header X-Forwarded-Proto https if { ssl_fc }
  http-response set-header Strict-Transport-Security "max-age=2629746;includeSubDomains"

  default_backend lpi

frontend adminconsolefront
  bind *:83 ssl crt /etc/ssl/private/server.pem

  http-request set-header X-Forwarded-Port %[dst_port]
  http-request add-header X-Forwarded-Proto https if { ssl_fc }
  http-response set-header Strict-Transport-Security "max-age=2629746;includeSubDomains"

  default_backend adminconsole

frontend http
  bind *:80
  bind *:443 ssl crt /etc/ssl/private/server.pem

  http-request set-header X-Forwarded-Port %[dst_port]
  http-request add-header X-Forwarded-Proto https if { ssl_fc }
  http-response set-header Strict-Transport-Security "max-age=2629746;includeSubDomains"

  acl pls_path path_beg /pls
  acl admin_path path_beg /admin
  acl scoringapi_path path_beg /score
  acl scoringapiinternal_path path_beg /scoreinternal
  acl matchapi_path path_beg /match
  acl saml_path path_beg /saml
  acl oauth2_path path_beg /oauth2
  acl playmaker_path path_beg /playmaker

  acl eai_path path_beg /eai
  acl metadata_path path_beg /metadata
  acl scoring_path path_beg /scoring
  acl modeling_path path_beg /modeling
  acl dataflowapi_path path_beg /dataflowapi
  acl workflowapi_path path_beg /workflowapi
  acl objectapi_path path_beg /objectapi
  acl quartz_path path_beg /quartz
  acl modelquality_path path_beg /modelquality
  acl datacloudapi_path path_beg /datacloudapi
  acl dellebi_path path_beg /dellebi
  acl cdl_path path_beg /cdl
  acl lp_path path_beg /lp
  acl dante_path path_beg /dante

  use_backend pls if pls_path
  use_backend admin if admin_path
  use_backend scoringapi if scoringapi_path
  use_backend scoringapi if scoringapiinternal_path
  use_backend matchapi if matchapi_path
  use_backend saml if saml_path
  use_backend oauth2 if oauth2_path
  use_backend playmaker if playmaker_path

  use_backend eai if eai_path
  use_backend metadata if metadata_path
  use_backend scoring if scoring_path
  use_backend modeling if modeling_path
  use_backend dataflowapi if dataflowapi_path
  use_backend workflowapi if workflowapi_path
  use_backend objectapi if objectapi_path
  use_backend quartz if quartz_path
  use_backend modelquality if modelquality_path
  use_backend datacloudapi if datacloudapi_path
  use_backend dellebi if dellebi_path
  use_backend cdl if cdl_path
  use_backend lp if lp_path
  use_backend dante if dante_path

  default_backend swagger

backend lpi
  option httpchk GET /
#{{lpi}}

backend adminconsole
  option httpchk GET /
#{{adminconsole}}

backend swagger
  option httpchk HEAD /
#{{swagger}}

backend pls
  option httpchk GET /pls/health
#{{pls}}

backend admin
  option httpchk GET /admin/health
#{{admin}}

backend scoringapi
  option httpchk GET /score/health
#{{scoringapi}}

backend matchapi
  option httpchk GET /match/health
#{{matchapi}}

backend saml
  option httpchk GET /saml/health
#{{saml}}

backend oauth2
  option httpchk GET /oauth/health
#{{oauth2}}

backend playmaker
  option httpchk GET /playmaker/health
#{{playmaker}}

backend eai
  option httpchk GET /eai/v2/api-docs
#{{eai}}

backend metadata
  option httpchk GET /metadata/v2/api-docs
#{{metadata}}

backend dataflowapi
  option httpchk GET /dataflowapi/v2/api-docs
#{{dataflowapi}}

backend workflowapi
  option httpchk GET /workflowapi/v2/api-docs
#{{workflowapi}}

backend objectapi
  option httpchk GET /objectapi/health
#{{objectapi}}

backend scoring
  option httpchk GET /scoring/v2/api-docs
#{{scoring}}

backend modeling
  option httpchk GET /modeling/v2/api-docs
#{{modeling}}

backend quartz
  option httpchk GET /quartz/v2/api-docs
#{{quartz}}

backend modelquality
  option httpchk GET /modelquality/v2/api-docs
#{{modelquality}}

backend datacloudapi
  option httpchk GET /datacloudapi/v2/api-docs
#{{datacloudapi}}

backend dellebi
  option httpchk GET /dellebi/v2/api-docs
#{{dellebi}}

backend cdl
  option httpchk GET /cdl/health
#{{cdl}}

backend lp
  option httpchk GET /lp/health
#{{lp}}

backend dante
  option httpchk GET /dante/health
#{{dante}}






