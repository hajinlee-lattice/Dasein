<section ng-controller="BuilderSidebarCtrl" class="pd-sidebar-menu" ng-click="handleSidebarToggle($event)">
    <ul class="menu progress-menu">
        <li role="presentation" ui-sref-active-eq="active">
            <a ui-sref="markets.list">
                <span class="ico-container"><span class="ico ico-back no-svg"></span></span><span class="label">{{ TargetMarketName }}</span>
            </a>
        </li>
        <li role="presentation" ui-sref-active-eq="active">
            <a class="pd-sidebar-header" ui-sref="builder.category">
                <span class="fa fa-circle-thin"></span>
                <span class="pd-sidebar-header-label">Select Attributes</span>
                <span class="badge badge-blue pull-right" ng-init="attrCount = 0;">
                    {{ (MasterList | filter: { selected: true, visible: true }).length || "0" }}
                </span>
            </a>
            <ul class="pd-sidebar-category">
                <li 
                    ng-repeat="item in MasterList | filter: { selected: true, ParentKey: '_OBJECT_' } | orderBy: '-modified' "
                >
                    <a href="javascript:void(0);">
                        <span ng-click="item.expanded = !item.expanded">
                            <em class="pd-sidebar-category-icon">
                                <span class="ico ico-industry ico-saphire" ng-if="item.AttrKey == 'Industry'"></span>
                                <span class="ico ico-locations ico-jade" ng-if="item.AttrKey == 'Region'"></span>
                                <span class="ico ico-tmb-user ico-gold" ng-if="item.AttrKey == 'EmployeesRange'"></span>
                                <span class="ico ico-tmb-chart ico-amber" ng-if="item.AttrKey == 'RevenueRange'"></span>
                            </em>
                            <input 
                                id="{{ item.AttrValue }}" 
                                type="checkbox" 
                                ng-change="handleRootCategoryRemoval(item, SelectedChildren)"
                                ng-model="item.selected" />
                            <em class="pd-sidebar-category-label">
                                {{ item.AttrValue }}
                            </em>
                            <span class="badge badge-blue pull-right pd-sidebar-category-total" ng-if="SelectedChildren.length > 0">
                                {{ SelectedChildren.length }}
                            </span>
                            <!--
                            <span class="pd-sidebar-category-total" ng-if="item.total > 0">
                                [<span class="blue-text">{{ SelectedChildren.length }}</span>]
                            </span>
                            -->
                        </span>
                        <ul class="pd-sidebar-subcategory" ng-show="item.expanded">
                            <li ng-repeat="SubCategory in MasterList | filter: { selected: true, ParentKey: item.AttrKey, ParentValue: item.AttrValue } as SelectedChildren">
                                    <input 
                                        id="{{ SubCategory.AttrValue }}" 
                                        type="checkbox" 
                                        ng-change="handleSubCategoryRemoval(SubCategory, SelectedChildren)"
                                        ng-model="SubCategory.selected" />
                                    <label 
                                        ng-click="$event.stopPropagation()">{{ SubCategory.AttrValue }}</label>
                            </li>
                        </ul>
                    </a>
                </li>
            </ul>
        </li>
        <li role="presentation" ui-sref-active="active">
            <a class="pd-sidebar-header" ui-sref="builder.intent({AttrKey: 'Industry'})">
                <span class="fa fa-circle-thin"></span>
                <span class="pd-sidebar-header-label">Select Intent Topics</span>
                <span class="badge badge-blue pull-right">0</span>
            </a>
            <ul>
            </ul>
        </li>
        <li role="presentation" ui-sref-active="active">
            <a class="pd-sidebar-header" ui-sref="builder.filtercontacts">
                <span class="fa fa-circle-thin"></span>
                <span class="pd-sidebar-header-label">Filter Contacts</span>
            </a>
            <ul>
            </ul>
        </li>
        <li role="presentation" ui-sref-active="active">
            <a class="pd-sidebar-header" ui-sref="builder.fitmodel">
                <span class="fa fa-circle-thin"></span>
                <span class="pd-sidebar-header-label">Set Fit Criteria</span>
            </a>
            <ul>
            </ul>
        </li>
        <li role="presentation" ui-sref-active="active">
            <a class="pd-sidebar-header" ui-sref="builder.intentmodel">
                <span class="fa fa-circle-thin"></span>
                <span class="pd-sidebar-header-label">Set Intent Criteria</span>
            </a>
            <ul>
            </ul>
        </li>
        <li role="presentation" ui-sref-active="active">
            <a class="pd-sidebar-header" ui-sref="builder.setup">
                <span class="fa fa-circle-thin"></span>
                <span class="pd-sidebar-header-label">Setup Prospecting</span>
            </a>
            <ul>
            </ul>
        </li>
    </ul>

    <button class="open-button open">
        <span class="ico ico-arrow-open"></span>
    </button>
</section>