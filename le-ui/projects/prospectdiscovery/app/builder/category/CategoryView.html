<div class="container pd-builder-attributes" ng-controller="AttributesCtrl as vm">
    <div class="row page-header">
        <h4 class="columns five">
            <span ng-if="!vm.ParentValue"><span class="subcategory-header">{{ vm.AttrKey }}</span></span> 
            <span ng-if="vm.ParentValue">
                <button type="button" 
                        class="button icon-button white-button"
                        ui-sref="builder.category({AttrKey: '{{ vm.ParentKey == 'Region' ? 'Locations' : vm.ParentKey }}', ParentKey: '', ParentValue: ''})">
                    <span class="fa fa-arrow-left"></span>
                </button>
                <span class="subcategory-header">{{ vm.ParentValue }}</span>
            </span>
            <span class="smaller" ng-if="vm.total">({{ vm.total }})</span>
        </h4>
        <span class="columns seven subcategory-header-controls">
            
            <div class="search">
                <button class="button icon-button white-button" ng-click="vm.ShowSearch = !vm.ShowSearch">
                    <span class="ico ico-search"></span>
                </button>
                <input type="text" class="form-control" ng-model="vm.SearchValue.AttrValue"ng-show="vm.ShowSearch" />
            </div>

            <button type="button" class="button icon-button white-button" ng-click="vm.FilterChecked = !vm.FilterChecked">
                <span class="fa fa-check-square{{ vm.FilterChecked ? '' : '-o' }}"></span>
            </button>
            <select 
                    class="custom-select" 
                    ng-model="vm.SortProperty"
                >
                <option value="AttrValue">Name</option>
                <option value="lift">Lift</option>
                <option value="revenue">Revenue</option>
                <option value="customer_percent_of_theirs">Potential</option>
            </select>
            <button 
                    type="button" 
                    class="button icon-button white-button" 
                    ng-click="vm.SortDirection = (vm.SortDirection == '' ? '-' : '')" 
                >
                <span class="fa 
                        fa-sort-{{ 
                            vm.SortProperty == 'AttrValue' 
                                ? 'alpha' 
                                : (vm.SortProperty == 'customer_percent_of_theirs' 
                                    ? 'amount' 
                                    : 'numeric') 
                        }}-{{ 
                            vm.SortDirection == '' 
                                ? 'asc' 
                                : 'desc' 
                        }}"
                    >
                </span>
            </button>
            <a ui-sref="jobs.import.credentials"><button class="button orange-button">Save Attributes</button></a>
        </span>
    </div>

    <div class="row category-results">
        <div class="twelve columns tile-list">
            <div 
                    class="list-item
                            {{ vm.SubCategory ? ' has-sub' : '' }}
                            {{ item.selected ? ' selected' : '' }}
                            {{ vm.FilterChecked ? ' filter-checked' : '' }}"
                    ng-repeat="
                            (col, item) in filtered = vm.list | 
                            filter: vm.SearchValue | 
                            orderBy: vm.SortDirection + vm.SortProperty |
                            startFrom: (current - 1) * pagesize |
                            limitTo: pagesize"
                    ng-click="vm.handleTileClick($event, item)"
                >                
                <div class="tile">
                    <div class="tile-head">
                        <div class="pull-left" ng-click="$event.stopPropagation()">
                            <input 
                                type="checkbox" 
                                id="attr-checkbox_{{ col }}" 
                                class="attr-checkbox custom"
                                ng-model="item.selected"
                                ng-change="vm.handleTileSelect(item)"
                            />
                            <label for="attr-checkbox_{{ col }}" class="attr-label">
                                {{ item.AttrValue | limitTo: vm.TruncateLimit }}{{item.AttrValue.length > vm.TruncateLimit ? '&hellip;' : ''}}
                                <span class="attr-label-subcategory-total" ng-if="item.total > 0 && vm.SubCategory">
                                    ( <span class="blue-text">{{ item.total }}</span> )
                                </span>
                            </label>
                        </div>
                        <div class="text-right pull-right">
                            <h3 class="lift">{{ item.lift | number:1 || "1.0x" }}x</h3>
                            <span class="success-text">${{ item.revenue | number:0 }}</span>
                        </div>
                    </div><!-- End .tile-head ; $event.stopPropagation();-->
                    <div class="tile-meta">
                        <div class="stats-container pull-left">
                            <dl class="stats">
                                <dt>Available from Lattice</dt>
                                <dd class="in-database">{{ item.lattice_companies | number:0 }}</dd>
                            </dl>
                            <dl class="stats">
                                <dt>All in your database</dt>
                                <dd class="blue-text">
                                    {{ item.their_companies | number:0 }}&nbsp;
                                <span class="smaller">
                                    ({{ item.companies_percent | number:1 }}%)
                                </span></dd>
                            </dl>
                            <dl class="stats">
                                <dt>Your customers</dt>
                                <dd class="your-customers">
                                    {{ item.customers | number:0 }}&nbsp;
                                <span class="smaller">
                                    ({{ item.customer_percent_of_theirs | number:1 }}%)
                                </span></dd>
                            </dl>
                        </div>
                        <div class="circle-container pull-right">
                            <div 
                                class="medium-circle saphire-bkg"
                                style="width:100%;height:100%;">
                            </div>
                            <div 
                                class="small-circle jet-bkg"
                                style="width:{{ item.customer_percent_of_theirs | number:3 }}%;height:{{ item.customer_percent_of_theirs | number:3 }}%;">
                            </div>
                        </div>
                    </div><!-- End .tile-meta -->
                </div><!-- End .tile -->
            </div><!-- End .list-item -->

        </div><!-- End .twelve.columns -->
    </div><!-- End .row -->
    
    <div class="row" ng-init="pagesize = 9; current = 1" ng-show="max > 1">
        <div class="twelve columns">
            <pd-pagination-controls current="current" max="max = vm.list.length / pagesize">
            </pd-pagination-controls>
        </div>
    </div>

</div> <!-- End of line. -->