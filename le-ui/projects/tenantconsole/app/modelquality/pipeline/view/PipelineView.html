<section class="row create-pipeline-main">
  <div ng-class="vm_pipeline.stepMetadata ? 'col-xs-3' : 'col-xs-4'">
    <h4>{{::vm_pipeline.labels.PIPELINES}}</h4>
    <ul class="pipeline-list">
      <li ng-repeat="pipeline in vm_pipeline.analyticPipelines"
        ng-class="{selected: vm_pipeline.selectedPipeline === pipeline}"
        ng-click="vm_pipeline.selectPipeline(pipeline)">
        {{::pipeline.name}}
      </li>
    </ul>
  </div>
  <div ng-class="vm_pipeline.stepMetadata ? 'col-xs-5' : 'col-xs-8'">
    <div ng-if="vm_pipeline.loading">
        <div class="loader"> </div>
        <h2 class="text-center">{{::vm_pipeline.spinnerMsg}}</h2>
    </div>
    <div ng-if="vm_pipeline.message" class="row">
      <p class="alert" ng-class="vm_pipeline.error ? 'alert-danger' : 'alert-success'">
        {{vm_pipeline.message}}
      </p>
    </div>
    <div ng-if="!vm_pipeline.loading && vm_pipeline.selectedPipeline">
      <div class="row">
        <h4>{{::vm_pipeline.labels.STEPS}}</h4>
        <form class="form-group">
          <label> {{::vm_pipeline.labels.PIPELINE_NAME}}:
            <input type="text" class="form-control" placeholder="Pipeline Name" ng-model="vm_pipeline.pipelineName"/>
          </label>
        </form>
        <ul class="pipeline-step-list">
          <li ng-if="!vm_pipeline.pipelineSteps.length">
            {{::vm_pipeline.labels.EMPTY_STEPS}}
          </li>
          <li ng-repeat="step in vm_pipeline.pipelineSteps track by $index">
            <span class="list-bullet">{{$index + 1}}:</span>{{step.Name}}
            <span class="align-right">
              <table class="align-right pipeline-editor">
                <td>
                  <i class="fa fa-trash"
                    ng-click="vm_pipeline.deleteStep($index)"></i>
                </td>
                <td>
                  <i class="fa fa-eye"
                    ng-click="vm_pipeline.inspectMetadata($index)"></i>
                </td>
                <td>
                  <i class="fa fa-arrow-up"
                    ng-if="!$first"
                    ng-click="vm_pipeline.swapSteps($index, $index-1)"></i>
                </td>
                <td>
                  <i class="fa fa-arrow-down"
                    ng-if="!$last"
                    ng-click="vm_pipeline.swapSteps($index, $index+1)"></i>
                </td>
              </table>
            </span>
          </li>
        </ul>
      </div>
      <div class="row">
        <button class="btn btn-default"
          ng-if="!vm_pipeline.isCreatingStep"
          ng-click="vm_pipeline.createStep()">{{::vm_pipeline.labels.ADD_STEP}}</button>
        <div ng-if="vm_pipeline.isCreatingStep" ui-view="createPipelineStep"></div>
      </div>
      <div class="row">
        <hr>
      </div>
      <div class="row">
        <form class="form-group">
          <label>{{::vm_pipeline.labels.PROP_DATA_CONFIG}}: <label>
          <select class="form-control"
            ng-model="vm_pipeline.analyticPipeline.prop_data_name"
            ng-options="config.name as config.name for config in vm_pipeline.propDataConfigs">
          </select>
        </form>
      </div>
      <div class="row">
        <form class="form-group">
          <label>{{::vm_pipeline.labels.PIPELINE_DESCRIPTION}}:</label>
          <textarea class="form-control" placeholder="{{::vm_pipeline.labels.PIPELINE_DESCRIPTION}}" ng-model="vm_pipeline.pipelineDescription"/>
        </form>
      </div>
      <div class="row">
        <hr>
      </div>
      <div class="row" ng-if="!vm_pipeline.loading">
        <div class="pull-right">
          <button class="btn btn-default"
            ng-click="vm_pipeline.save()">{{::vm_pipeline.labels.SAVE}}</button>
          <button class="btn" ng-click="vm_pipeline.cancelPipeline()">{{::vm_pipeline.labels.CANCEL}}</button>
        </div>
      </div>
    </div>
  </div>
  <div ng-if="vm_pipeline.stepMetadata" class="json-panel col-xs-4">
    <i class="fa fa-times" ng-click="vm_pipeline.clearStepMetadata()"></i>
    <pre>{{vm_pipeline.stepMetadata | json:2 }}</pre>
  </div>
</section>
