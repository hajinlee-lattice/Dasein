<div class="metadata-component">
    <ul class="filters" ng-show="!vm.loading">
        <li>
            <button ng-click="vm.editAll()" ng-class="{'active': vm.edit}"><i class="fa fa-pencil" aria-hidden="true"></i> edit all</button>
        </li>
        <li>
            <input type="checkbox" id="enrichment" name="enrichment" ng-model="vm.show.enrichment" ng-change="vm.current = 1;" ng-checked="vm.show.enrichment" />
            <label for="enrichment">enabled only</label>
        </li>
        <li>
            <input type="checkbox" id="premium" name="premium" ng-model="vm.show.premium" ng-change="vm.current = 1;" ng-checked="vm.show.premium" />
            <label for="premium">premium only</label>
        </li>
        <li>
            <div class="ng-search">
                <a class="button icon-button white-button" ng-click="vm.query.length ? vm.query = null : ''">
                    <span class="fa fa-search" ng-show="!vm.query.length"></span>
                    <span class="fa fa-times" ng-show="vm.query.length"></span>
                </a>
                <input type="text" class="form-control" placeholder="Search" ng-model="vm.query" ng-change="vm.current = 1" />
            </div>
        </li>
    </ul>
    <ul class="filters" ng-show="!vm.loading">
        <li>
            <button ng-click="vm.save()">save</button>
        </li>
        <li>
            <label for="versions">version</label>
            <select name="versions" id="versions" ng-model="vm.select_version"  ng-change="vm.versionChange()" >
                <option ng-repeat="version in vm.versions" value="{{version.Version}}" ng-selected="version.Version == vm.version" ng-disabled="version.Version == vm.version">{{version.Version}}</option>
            </select>
        </li>
    </ul>
    <form ng-model="vm.metadata_form" ng-class="{loading: vm.loading}">
        <div class="loading-icon" ng-if="vm.loading"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i></div>
        <div class="row required-fields-pagination" ng-init="vm.current = 1" ng-show="vm.max > 1">
            <div class="twelve columns">
                <pd-pagination-controls 
                    current="vm.current" 
                    max="vm.max = filteredList.length / vm.pagesize">
                </pd-pagination-controls>
            </div>
        </div>
        <table class="metadata" ng-show="!vm.loading">
            <tr>
                <th class="edit-button">&nbsp;</th>
                <th ng-repeat="(key, column) in vm.columns" ng-click="vm.order = (vm.order == key ? '-'+key : key); vm.current = 1;" ng-class="{'sorted':vm.order == key || vm.order == '-'+key}" class="{{key}}">
                    {{column.label}}
                    <span ng-if="vm.order != key && vm.order != '-'+key" class="fa fa-sort"></span>
                    <span ng-if="vm.order == key || vm.order == '-'+key" class="fa fa-sort-{{ vm.order == key ? 'up' : 'down' }}"></span>
                </th>
            </tr>
            <tr ng-repeat="(row, data) in (filteredList = (vm.metadata 
                    | filter: {
                        CanEnrich: (!vm.show.enrichment ? '' : true),
                        IsPremium: (!vm.show.premium ? '' : true)
                    })) 
                    | orderBy: vm.order
                    | filter: (vm.query.length ? vm.query : '') : false
                    | startFrom: (vm.current - 1) * vm.pagesize 
                    | limitTo: vm.pagesize">
                <td class="edit-button"><button ng-click="vm.edit_all = false; vm.edit[data.ColumnId] = !vm.edit[data.ColumnId]" ng-class="{'active': vm.edit}"><i class="fa fa-pencil" aria-hidden="true"></i></button></td>
                <td ng-repeat="(key, column) in vm.columns" class="type-{{vm.type(key)}} {{key}}" title="{{vm.get(data[key])}}">
                    <span ng-if="column.editable" ng-init="vm.model[row]['ColumnId'] = data.ColumnId">
                        <input ng-if="(vm.edit_all || vm.edit[data.ColumnId]) && vm.type(key) == 'default'" type="hidden" ng-model="vm.model[row]['mykey']" ng-value="data.ColumnId" />
                        <input ng-if="(vm.edit_all || vm.edit[data.ColumnId]) && vm.type(key) == 'default'" type="text" id="input-{{row}}-{{key}}" name="input-{{row}}-{{key}}" placeholder="{{key}}" ng-model="vm.model[row][key]" value="{{vm.get(data[key])}}" />
                        <input ng-if="(vm.edit_all || vm.edit[data.ColumnId]) && vm.type(key) == 'checkbox'" type="checkbox" id="input-{{row}}-{{key}}" name="input-{{row}}-{{key}}" ng-checked="{{data[key]}}" ng-model="vm.model[row][key]" />
                        <textarea ng-if="(vm.edit_all || vm.edit[data.ColumnId]) && vm.type(key) == 'textarea'" type="textarea" id="input-{{row}}-{{key}}" name="input-{{row}}-{{key}}" ng-model="vm.model[row][key]">{{vm.get(data[key])}}</textarea>
                    </span>
                    <label ng-class="{hide: column.editable && (vm.edit_all || vm.edit[data.ColumnId]) && vm.type(key) != 'checkbox'}" for="input-{{row}}-{{key}}">{{vm.get(data[key])}}</label>
                </td>
            </tr>
        </table>
        <div class="row required-fields-pagination" ng-init="vm.current = 1" ng-show="vm.max > 1">
            <div class="twelve columns">
                <pd-pagination-controls 
                    current="vm.current" 
                    max="vm.max = filteredList.length / vm.pagesize">
                </pd-pagination-controls>
            </div>
        </div>
    </form>
</div>