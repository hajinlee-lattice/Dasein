<div class="container query-results">

    <h2 ng-if="vm.section === 'dashboard.targets'">
        Targets
    </h2>
    <h2 ng-if="vm.section === 'wizard.targets'">
        Suppressions
    </h2>
    <ul class="recommendationCounts" 
        ng-if="vm.recommendationCounts && vm.section === 'wizard.targets'" 
        ng-init="vm.makeRecommendationCounts()">
        <li class="selected">
            <h3>Total recommendations</h3>
            <strong>{{vm.recommendationCounts.total}}</strong>
        </li>
        <li class="suppressed">
            <h3>Suppressed</h3>
            <strong>{{vm.recommendationCounts.suppressed}}</strong>
        </li>
        <li class="launching">
            <h3>Recommendations to be launched</h3>
            <strong>{{vm.recommendationCounts.launched}}</strong>
        </li>
        <li class="contacts">
            <h3>Contacts within recommendation</h3>
            <strong>{{vm.recommendationCounts.contacts}}</strong>
        </li>
    </ul>

    <div 
        class="targets-filters"
        ng-if="vm.section === 'wizard.targets'">

        <!-- <label ng-if="vm.noSFCount != 0">
            <input 
                type="checkbox" 
                class=""
                ng-model="excludeAccounts"
                ng-change="vm.excludeNonSalesForceCheckbox(!excludeAccounts)" />
            Exclude accounts without SalesForceID (<span class="orange-text">{{ vm.noSFCount | number }}</span>)
        </label> -->

        <div 
            class="checkbox-input">
            <input 
                type="checkbox"
                ng-model="vm.topNClicked"
                id="topNCount"
                ng-change="vm.updateTopNCount(); vm.makeRecommendationCounts(); " />
            <label for="topNCount">Limit to only </label>
            <input 
                type="number" 
                ng-model="vm.topNCount"
                ng-model-options="{ debounce: 500 }"
                ng-focus="vm.topNInputClick($event)"

                
                ng-change="vm.updateTopNCount(); vm.makeRecommendationCounts()"
                class="form-control" />
            <span> {{vm.section === 'wizard.targets' ? 'recommendations' : 'targets'}}</span>
            <!-- <p class="error-text" ng-if="vm.showError == true">Value must be between 1 and {{ vm.maxTargetValue }}</p> -->
            <p class="error-text" ng-if="vm.showError == true">Value must be greater than 0</p>
        </div>
        
        <div class="s3-folder" ng-if="vm.section === 'wizard.targets' && vm.exportFolder">
            {{vm.exportFolder}}
        </div>
        <div class="buckets-container">
            <div class="buckets-about">
                Select the <strong>accounts</strong> based on their ratings from the tiles below.
            </div>
            <ul class="bucket-checkboxes" ng-if="vm.accountsCoverage.bucketCoverageCounts.length">
                <li 
                    ng-class="vm.selectedBuckets.indexOf(bucket.bucket) !== -1 ? '' : 'unselected'"
                    ng-repeat="bucket in vm.accountsCoverage.bucketCoverageCounts"
                    ng-click="vm.bucketClick(bucket); selectedBucket = !selectedBucket">
                    <h3>{{bucket.bucket}}</h3>
                    <h4>Accounts</h4>
                    <p>{{bucket.count | number}} ({{ ::bucket.percentage | percentage: 1 }})</p>
                </li>
                <!--
                <li
                    class="unscored"
                    ng-class="vm.launchUnscored ? '' : 'unselected'"
                    ng-click="vm.launchUnscored = !vm.launchUnscored; vm.launchUnscoredClick();">
                    <h3>Unscored</h3>
                    <p>{{vm.unscoredAccounts.total | number}} ({{vm.unscoredAccounts.percentage}})</p>
                </li>
                -->
            </ul>
            <ul class="bucket-checkboxes" ng-if="!vm.accountsCoverage.bucketCoverageCounts.length">
                <li 
                    ng-class="buckets-null"
                    ng-repeat="bucket in vm.noBuckets"
                    ng-disabled="true">
                    <h3>{{bucket.bucket}}</h3>
                    <h4>Accounts</h4>
                    <p>{{bucket.count | number}} ({{ ::bucket.percentage | percentage: 1 }})</p>
                </li>
            </ul>
            <div class="unscored-accounts" ng-if="vm.unscoredAccounts.total">
                <input type="checkbox" ng-model="vm.launchUnscored" ng-click="vm.launchUnscoredClick(); vm.makeRecommendationCounts();" /> Include the <strong>{{vm.unscoredAccounts.total | number}} ({{vm.unscoredAccounts.percentage}})</strong> Unscored Accounts?
            </div>
        </div>
    </div><!-- End .targets-filters -->

    <div class="success-message" ng-if="vm.saved === true">
        <h3>Your segment was saved successfully!</h3>
        <i class="fa fa-times fa-inverse" data-ng-click="vm.hideMessage()"></i>
    </div>
    <div class="error-message" ng-if="vm.showErrorApi === true">
            <i class="fa fa-exclamation-triangle" aria-hidden="true">
            </i>
            <h4>This time the Campaign can not be launched. Please try again or contact Lattice support.</h4>
        <!-- <i class="fa fa-times fa-inverse" data-ng-click="vm.hideMessage()"></i> -->
    </div>

    <ul class="filters" ng-if="vm.section !== 'wizard.targets'">
        <li class="query">
            <div class="ng-search">
                <a class="button icon-button white-button" ng-click="vm.clearSearch()">
                    <span 
                        class="fa fa-search" 
                        ng-show="!vm.search.length"></span>
                    <span 
                        class="fa fa-times" 
                        ng-show="vm.search.length"></span>
                </a>
                <input 
                    type="text" 
                    name="SegmentResultSearch" 
                    class="form-control" 
                    placeholder="Search {{vm.resourceType=='contacts' ? vm.counts.contacts.value : vm.counts.accounts.value | number}} {{vm.resourceType=='contacts' ? 'Contacts' : 'Accounts'}}"
                    ng-model="vm.search"
                    ng-model-options='{ debounce: 500 }'
                    ng-change='vm.submitQuery()'
                    ng-model-options="vm.searchOptions"
                />
            </div>
        </li>
        <li class="buttons" ng-if="vm.section !== 'dashboard.targets' && vm.section !== 'wizard.targets'">
            <div>
                <!-- <a href="/files/latticeinsights/segments/downloadcsv?Authorization={{vm.authToken}}"><button class="button icon-button white-button"><i class="fa fa-download"></i></button></a> -->
                <!-- <button ng-if="!vm.inModel" class="button white-button" ui-sref="home.import.entry">Import Data</button> -->
                <!--button class="button icon-button white-button" ui-sref="{{ vm.refineQuery() }}" ng-disabled="vm.saving">Refine Query</button>

                <button 
                    class="save button blue-button" 
                    ng-if="vm.saveSegmentEnabled" 
                    ng-click="vm.saveSegment()">Save Segment</button>
                <button 
                    class="save button blue-button" 
                    ng-if="!vm.saveSegmentEnabled" 
                    disabled>Save Segment</button-->

            </div>
        </li>
    </ul>

    
    <!--
    The way of rendering these tables needs to be consolidated and refactored.
    - Hadden
    -->

    <table ng-if="vm.page === 'Accounts'" ng-if="vm.section !== 'wizard.targets'">
        <thead ng-class="{'sort-asc': !vm.sortDesc, 'sort-dsc': vm.sortDesc}">
            <tr>
                <!-- <th class="sortable" ng-click="sortType = 'CompanyName'; sortReverse = !sortReverse"> -->
                <th>
                    Company Name
                    <span ng-show="sortType == 'CompanyName' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'CompanyName' && sortReverse" class="fa fa-caret-up"></span>
                </th>
                <th>Website</th>
                <!-- <th class="sortable" ng-click="sortType = 'LDC_City'; sortReverse = !sortReverse"> -->
                <th>
                    City
                    <span ng-show="sortType == 'City' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'City' && sortReverse" class="fa fa-caret-up"></span>
                </th>
                <!-- <th class="sortable" ng-click="sortType = 'LDC_State'; sortReverse = !sortReverse"> -->
                <th>
                    State
                    <span ng-show="sortType == 'State' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'State' && sortReverse" class="fa fa-caret-up"></span>
                </th>
                <!-- <th class="sortable" ng-click="vm.disableSort ? sortType : sortType = 'LDC_Country'; vm.disableSort ? sortReverse : sortReverse = !sortReverse"> -->
                <th>
                    Country
                    <span ng-show="sortType == 'Country' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'Country' && sortReverse" class="fa fa-caret-up"></span>
                </th>
                <th>Account ID</th>
            </tr>
        </thead>
        <tbody ng-if="!vm.loading">
            <tr 
                ng-repeat="account in (vm.tmpAccounts = (vm.accounts | 
                            orderBy:sortType:sortReverse))">
                <td ng-class="{'gray-text': account.CompanyName === null}">{{account.CompanyName || 'None'}}</td>
                <td ng-class="{'gray-text': account.Website === null}">{{account.Website || 'None'}}</td>
                <td ng-class="{'gray-text': account.City === null}">{{account.City || 'None'}}</td>
                <td ng-class="{'gray-text': account.State === null}">{{account.State || 'None'}}</td>
                <td ng-class="{'gray-text': account.Country === null}">{{account.Country || 'None'}}</td>
                <td ng-class="{'gray-text': account.AccountId === null}">{{account.AccountId || 'None'}}</td>
            </tr>
        </tbody>
    </table>

    <table ng-if="vm.section === 'dashboard.targets' && vm.section !== 'wizard.targets'">
        <thead ng-class="{'sort-asc': !vm.sortDesc, 'sort-dsc': vm.sortDesc}">
            <tr>
                <!-- <th class="sortable" ng-click="sortType = 'CompanyName'; sortReverse = !sortReverse"> -->
                <th class="sortable" ng-click="vm.sort('CompanyName')">
                    Company Name
                    <span ng-show="vm.sortType == 'CompanyName' && !vm.sortDesc" class="fa fa-caret-down"></span>
                    <span ng-show="vm.sortType == 'CompanyName' && vm.sortDesc" class="fa fa-caret-up"></span>
                </th>
                <th>Website</th>
                <th class="sortable" ng-click="vm.sort('ScoreBucket')">
                    Rating
                    <span ng-show="vm.sortType == 'ScoreBucket' && !vm.sortDesc" class="fa fa-caret-down"></span>
                    <span ng-show="vm.sortType == 'ScoreBucket' && vm.sortDesc" class="fa fa-caret-up"></span>
                </th>
            </tr>
        </thead>
        <tbody ng-if="!vm.loading && (vm.selectedBuckets.length != 0 || vm.bypassBuckets)">
            <tr 
                ng-repeat="account in (vm.tmpAccounts = vm.accounts)">
                <td ng-class="{'gray-text': account.CompanyName === null}">{{account.CompanyName || 'None'}}</td>
                <td>
                    <span ng-class="{'gray-text': account.Website === null}" ng-if="account.Website">{{account.Website || 'None'}}</span>
                    <span ng-if="!account.Website" class="gray-text">N/A</span>
                </td>
                <td>{{account.ScoreBucket||'Not&nbsp;Rated'}}</td>
            </tr>
        </tbody>
    </table>

    <table ng-if="vm.page === 'Contacts'" ng-if="vm.section !== 'wizard.targets'">
        <thead ng-class="{'sort-asc': !vm.sortDesc, 'sort-dsc': vm.sortDesc}">
            <tr>
                <!-- <th class="sortable" ng-click="sortType = 'ContactName'; sortReverse = !sortReverse"> -->
                <th>
                    Contact Name
                    <span ng-show="sortType == 'ContactName' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'ContactName' && sortReverse" class="fa fa-caret-up"></span>
                </th>
                <!-- <th class="sortable" ng-click="sortType = 'CompanyName'; sortReverse = !sortReverse"> -->
                <th>
                    Company Name
                    <span ng-show="sortType == 'CompanyName' && !sortReverse" class="fa fa-caret-down"></span>
                    <span ng-show="sortType == 'CompanyName' && sortReverse" class="fa fa-caret-up"></span>
                </th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody ng-if="!vm.loading">
            <tr 
                ng-repeat="contact in (vm.tmpContacts = (vm.contacts | 
                            orderBy:sortType:sortReverse))">

                <td ng-class="{'gray-text': contact.ContactName === null}">{{contact.ContactName || 'None'}}</td>
                <td ng-class="{'gray-text': contact.CompanyName === null}">{{contact.CompanyName || 'None'}}</td>
                <td ng-class="{'gray-text': contact.Email === null}">{{contact.Email || 'None'}}</td>
            </tr>
        </tbody>
    </table>

    <div class="loading" ng-if="vm.loading">
         Loading {{vm.page}}...
    </div>
    <div ng-if="vm.section !== 'wizard.targets' && vm.showNoResultsText(vm.tmpAccounts, vm.tmpContacts)">
        <p>No {{vm.page != 'Playbook' && vm.page != 'Campaign Overview' ? vm.page : 'Targets'}} Found<p>
    </div>

    <ul class="filters pull-right" ng-if="vm.section !== 'wizard.targets' && (vm.showAccountPagination || vm.bypassBuckets)">
        <li>
            <pd-pagination-controls
                current="vm.current"
                max="vm.counts.accounts.value / vm.pagesize">
            </pd-pagination-controls>
        </li>
    </ul>
    <ul class="filters pull-right" ng-if="vm.section !== 'wizard.targets' && vm.showContactPagination">
        <li>
            <pd-pagination-controls
                current="vm.current"
                max="vm.counts.contacts.value / vm.pagesize">
            </pd-pagination-controls>
        </li>
    </ul>


</div>
