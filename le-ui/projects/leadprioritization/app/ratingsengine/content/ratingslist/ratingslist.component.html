<section id="main-content" class="container rating-list">

    <div class="row">
        
        <div class="list-header">
            <div class="pull-left number-of-items" ng-if="vm.current.ratings.length > 0">
                <menu-filter-by config="vm.header.filter"></menu-filter-by>
                <menu-sort-by config="vm.header.sort"></menu-sort-by>
                <search-filter query="vm.query" current="vm.currentPage"></search-filter>
            </div>
            <div class="pull-right">
                <a
                    class="button blue-button"
                    ui-sref="{{vm.createRatingState}}">
                    Create Model
                </a>
            </div>
        </div>

    </div>
    <div class="row">

        <div class="twelve columns">
            <ul class="tiles">
                <li ng-if="vm.isRatingsSet == false" class="loading-tile">
                    <div class="tile-header">
                        <h2><span></span></h2>
                        <div class="edit">
                            <button type="button">
                                <span class="fa fa-ellipsis-v"></span>
                            </button>
                        </div>
                    </div>
                    <div class="tile-metadata">
                        <ul>
                            <li>Created By: <span></span></li>
                            <li>Created On: <span></span></li>
                            <li>Segment: <span></span></li>
                            <li>Last Data Refresh: <span></span></li>
                        </ul>
                    </div>
                    
                    <div class="tile-body">
                        <div>
                            <i class="fa fa-spinner fa-pulse fw"></i>
                        </div>
                    </div>
                    
                    <div class="tile-footer">
                        <span class="pull-right">Loading ...</span>
                    </div>

                </li>

                <li
                    ng-repeat="
                        rating in vm.current.ratings |
                        filter: vm.query | 
                        filter: vm.header.filter.value : true | 
                        orderBy: vm.header.sort.order + vm.header.sort.property |
                        startFrom: (vm.currentPage - 1) * pagesize |
                        limitTo: pagesize"
                    data="rating"
                    ng-click="vm.tileClick($event, rating)"
                    ng-mouseleave="vm.current.tileStates[rating.id].showCustomMenu ? vm.customMenuClick($event, rating) : null"
                    ng-if="vm.current.ratings.length > 0"
                    class="{{ rating.tileClass }}"
                    ng-class="{editing: vm.current.tileStates[rating.id].editRating, noRatings: (!rating.newBucketMetadata || rating.newBucketMetadata[0].dummy)}">

                    <div class="tile-header" ng-if="!vm.current.tileStates[rating.id].editRating">
                        <h2 title="{{rating.displayName}}">{{rating.displayName | limitTo: 27 }}{{rating.displayName.length > 27 ? '&hellip;' : ''}}</h2>
                        <div class="edit">
                            <button
                                    type="button"
                                    ng-click="vm.customMenuClick($event, rating)"
                                    ng-class="{ 'open': vm.current.tileStates[rating.id].showCustomMenu }">
                                <span class="fa fa-ellipsis-v" ng-class="{ 'fa-rotate-180': vm.current.tileStates[rating.id].showCustomMenu }"></span>
                            </button>
                            <ul class="model-menu" ng-show="vm.current.tileStates[rating.id].showCustomMenu">
                                <li 
                                    ng-if="rating.bucketMetadata.length > 0 && rating.status === 'INACTIVE' && (vm.hasRules(rating) || vm.isAIRating(rating))"
                                    data-ng-click="vm.editStatusClick($event, rating, !vm.hasRules(rating))">
                                    <a href="javascript:void(0)">
                                        <span>Activate</span>
                                        <!-- <span ng-if="rating.status === 'INACTIVE' && !vm.hasRules(rating)" title="Apply bucket rules to Activate ratings">Activate</span> -->
                                        <!-- <span ng-if="rating.status === 'ACTIVE'">Deactivate</span> -->
                                    </a>
                                    <i class="fa fa-power-off"></i>
                                </li>
                                <li data-ng-click="vm.editRatingClick($event, rating)">
                                    <a href="javascript:void(0)">Rename</a>
                                    <i class="fa fa-edit"></i>
                                </li>
                                <li 
                                    data-ng-click="vm.showDeleteRatingModalClick($event, rating)"
                                    ng-if="rating.status === 'INACTIVE'">
                                    <a href="javascript:void(0)">Delete</a>
                                    <i class="fa fa-trash"></i>
                                </li>
                            </ul>
                        </div>

                    </div><!-- End .tile-header -->
                    <div 
                        class="tile-metadata"
                        ng-if="!vm.current.tileStates[rating.id].editRating">
                        
                        <ul>
                            <li>Created By: <span class="blue-text">{{rating.createdBy}}</span></li>
                            <li>Created On: <span class="blue-text">{{rating.created | date}}</span></li>
                            <li class="text-ellipsis">
                                Segment: 
                                <span ng-if="rating.segmentDisplayName != null" class="blue-text" title="{{rating.segmentDisplayName}}">{{rating.segmentDisplayName}}</span>
                                <span ng-if="rating.segmentDisplayName == null" class="gray-text">Segment not selected</span>
                            </li>
                            <li>
                                Last Data Refresh: 
                                <span>
                                    <span class="blue-text">{{rating.lastRefreshedDate | date}}</span>
                                </span>
                            </li>
                        </ul>
                    </div><!-- End .tile-metadata -->
                    <div class="tile-body" ng-if="!vm.current.tileStates[rating.id].editRating">
                        <div 
                            class="no-ratings"
                            ng-if="rating.newBucketMetadata[0].dummy">
                            <h4>No Ratings Available</h4>
                        </div>
                        <bar-chart
                            config="rating.chartConfig" 
                            bktlist="rating.newBucketMetadata">
                        </bar-chart>
                    </div><!-- End .tile-body -->
                    <div class="tile-footer">
                        <span 
                            ng-if="rating.status === 'ACTIVE'"
                            class="active-icon pull-right">
                            Model is active
                            <svg 
                                width="14px" 
                                height="11px" 
                                viewBox="0 0 10 7" 
                                version="1.1" 
                                xmlns="http://www.w3.org/2000/svg"
                                xmlns:xlink="http://www.w3.org/1999/xlink">
                                <g id="data-management" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" transform="translate(-635.000000, -556.000000)">
                                <polygon 
                                    points='643.604 555.9997 638.713 560.8907 636.569 558.7457 635 560.3157 637.144 562.4597 638.713 564.0287 640.283 562.4597 645.174 557.5697'></polygon>
                                </g>
                            </svg>
                        </span>
                        <span 
                            ng-if="rating.status === 'INACTIVE'"
                            class="inactive pull-right">
                            Model is inactive
                        </span>
                        <button 
                            class="launch button blue-button pull-right" 
                            ng-click="vm.launchPlay()"
                            ng-if="play.launchHistory.playLaunch == null && play.segment != null"
                            ng-disabled="
                                vm.showLaunchSpinner || 
                                vm.invalid.length || 
                                vm.launchButton.state == 'Launching'">
                            <span ng-if="vm.showLaunchSpinner">
                                <i class="fa fa-spinner fa-spin fa-fw"></i>
                            </span>
                            <span>{{vm.launchButton.label}}</span>
                        </button>


                    </div><!-- End .tile-footer -->
                    <form
                        class="edit-form"
                        name="editRatingForm"
                        ng-if="vm.current.tileStates[rating.id].editRating"
                        ng-click="$event.stopPropagation()">
                        <div class="form-group">
                            
                            <label for="ratingDisplayName">Name
                            <input
                                autofocus
                                type="text"
                                id="display_name"
                                name="display_name"
                                data-ng-model="rating.displayName"
                                ng-change="vm.nameChanged(rating)"
                                maxlength="50"
                                ng-trim="false"
                                class="form-control" 
                                ng-disabled="vm.saveInProgress"/>
                            </label>
                            <span>{{50 - rating.displayName.length}} characters remaining</span>

                        </div>
                        <div class="actions">

                            <button
                                type="button"
                                class="button white-button pull-left"
                                ng-click="vm.cancelEditRatingClicked($event, rating)"
                                ng-disabled="vm.saveInProgress  ">
                                Cancel</button>
                            <button
                                type="button"
                                class="button blue-button pull-right"
                                ng-disabled="vm.current.tileStates[rating.id].saveEnabled === false"
                                ng-click="vm.saveRatingClicked($event, rating)"
                                ng-if="!vm.saveInProgress">
                                Save</button>
                            <button
                                type="button"
                                class="button gray-button pull-right"
                                ng-disabled="vm.saveInProgress"
                                ng-if="vm.saveInProgress">
                                Saving...</button>

                        </div>
                    </form>

                </li>
                <li class="create-tile" ng-if="vm.current.ratings.length < 12">
                    <a
                        class="button new-tile-button"
                        ui-sref="{{vm.createRatingState}}">
                        <span>&#43;</span>
                        Create Model
                    </a>
                </li>

            </ul>
        </div>
    </div><!-- End .row -->
    <div 
        class="row pull-right" 
        ng-init="pagesize = 12" 
        ng-show="max > 1">
        <div class="twelve columns">
            <pd-pagination-controls 
                current="vm.currentPage" 
                max="max = (vm.header.filter.unfiltered | filter: vm.query).length / pagesize">
            </pd-pagination-controls>
        </div>
    </div>

</section>