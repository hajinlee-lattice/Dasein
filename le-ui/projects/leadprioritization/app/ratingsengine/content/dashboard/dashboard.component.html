<le-modal-window config="vm.config" callback-function="vm.modalCallback(args)">
    <div ng-include="vm.viewUrl()"></div>
</le-modal-window>

<section class="ratingsengine dashboard-layout dashboard container">
    <div class="container-body">
        <div class="dashboard-column">
            <div class="dashboard-section ratingengine">
                <div class="dashboard-section-container">
                    <div class="dashboard-section-header">
                        <h2>
                            <div class="contenteditable title" ng-class="{editing: focus.title}" ng-focus="focus = {}; focus.title = true; vm.autofocus($event);" tabindex="-1">
                                <span ng-show="!focus.title">{{ vm.rating.summary.displayName || 'Rating Name' }}</span>
                                <div class="editor" ng-show="focus.title">
                                    <input autofocus maxlength="50" ng-blur="vm.edited('displayName'); focus = {};" name="displayName" ng-model="vm.editing.displayName" ng-value="vm.rating.summary.displayName" />
                                </div>
                            </div>
                        </h2>
                    </div>
                    <div class="dashboard-section-content">
                        <p>
                            {{vm.rating.summary.createdBy}} on {{vm.rating.summary.created|date}}
                        </p>
                        <p>
                            Last Data Refresh: {{vm.TimestampIntervalUtility.timeAgo(vm.rating.summary.lastRefreshedDate)}}
                        </p>
                    </div>
                    <div class="dashboard-section-content account-ratings" ng-if="vm.rating.coverageInfo.bucketCoverageCounts">

                        <barchart 
                            header="Account Ratings"
                            ratings="true" 
                            data="vm.rating.coverageInfo.bucketCoverageCounts">
                        </barchart>

                    </div>
                    <div class="dashboard-section-footer">
                        <div class="dashboard-section-footer-columns">
                            <div class="status-toggle dashboard-section-footer-column" ng-disabled="!vm.hasRules">
                                <label for="statusToggle">Ratings are Active:</label>
                                <span class="toggle-switch">
                                    <input type="checkbox" id="statusToggle" ng-model="vm.status_toggle" />
                                    <span class="toggle-face" ng-click="vm.toggleActive()"></span>
                                </span>
                            </div>
                            <div class="dashboard-section-footer-column">
                                <button class="button blue-button" ng-disabled="vm.StateHistory.isTo('home.ratingsengine.wizard.segment.attributes.rules')" ui-sref="home.ratingsengine.wizard.segment.attributes.rules({rating_id: vm.rating.summary.id, wizard_steps: 'rules'})">
                                    <span ng-if="!vm.StateHistory.isTo('home.ratingsengine.wizard.segment.attributes.rules')" >Edit</span>
                                    <span ng-if="vm.StateHistory.isTo('home.ratingsengine.wizard.segment.attributes.rules')">
                                        <i class="fa fa-spinner fa-pulse fa-fw"></i>
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dashboard-section plays">
                <div class="dashboard-section-container">
                    <div class="dashboard-section-header">
                        <h2>
                            Plays Using this Rating
                        </h2>
                    </div>
                    <div class="dashboard-section-content">
                        <ul class="plays" ng-if="vm.rating.plays && vm.rating.plays.length > 0">
                            <li class="play" ng-repeat="play in vm.rating.plays">
                                {{play.displayName}} 
                                <span ng-if="play.launchHistory.playLaunch.updated">Launched {{vm.TimestampIntervalUtility.timeAgo(play.launchHistory.playLaunch.updated)}}</span>
                            </li>
                        </ul>
                        <div ng-if="!vm.rating.plays || vm.rating.plays.length == 0">There are <strong>no</strong> Plays using this Rating</div>
                    </div>
                    <div class="dashboard-section-footer">
                        <button class="button blue-button" ui-sref="home.playbook.wizard.rating({rating_id: vm.rating.summary.id})" ng-disabled="!vm.status_toggle">
                            <span>Create a new play</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="dashboard-column">
            <div class="dashboard-section segment">
                <div class="dashboard-section-container">
                    <div class="dashboard-section-header">
                        <h2>
                            {{vm.rating.segment.display_name}}
                        </h2>
                    </div>
                    <div class="dashboard-section-content">
                        <p>
                            <span ng-if="vm.rating.segment.created">Created on: <em>{{vm.rating.segment.created|date}}</em></span><br />
                            <span ng-if="vm.rating.segment.description">Description: <em>{{vm.rating.segment.description}}</em></span>
                        </p>
                    </div>
                    <!--
                    <div class="dashboard-section-footer">
                        <button class="edit button blue-button">
                            <span>Edit</span>
                        </button>
                    </div>
                    -->
                </div>
            </div>
        </div>
    </div>
</section>