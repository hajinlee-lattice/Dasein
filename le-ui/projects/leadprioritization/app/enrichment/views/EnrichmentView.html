<div class="enrichment-container">
    <section id="main-content" class="container">
        <div class="status-alert-box {{vm.status_alert.type}}" ng-show="vm.status_alert.show">
            <div class="icon"></div>
            <div class="message" ng-bind-html="vm.status_alert.message">
            </div>
            <i class="close fa fa-times" ng-click="vm.closeStatusMessage()"></i>
        </div>
        <div class="subheader-container">
            <div class="loading-enrichments" ng-if="!vm.enrichments_completed"><i class="fa fa-spinner fa-spin fa-fw"></i> Loading enrichments...</div>
            <ul class="subheader">
                <li class="query">
                    <div class="ng-search">
                        <a class="button icon-button white-button" ng-click="vm.query.length ? vm.query = null : ''">
                            <span class="fa fa-search" ng-show="!vm.query.length"></span>
                            <span class="fa fa-times" ng-show="vm.query.length"></span>
                        </a>
                        <input type="text" class="form-control" data-filteredTotal="{{filteredList.length}}" placeholder="Search {{vm.enrichments.length > filteredList.length ? '' : 'all '}}{{(vm.placeholderTotal ? vm.placeholderTotal : filteredList.length)|number}} attributes" ng-model="vm.query" ng-change="vm.metadata.current = 1" />
                    </div>
                    <div class="tags">
                        <div class="tag-type" ng-repeat="(key, value) in vm.selected_categories">
                            <div class="tag category" ng-click="vm.changeCategory({category: value.category}); vm.metadata.current = 1;">{{value.category}}</div>
                            <div class="tag subcategory" ng-repeat="(subcategory_key, subcategory_value) in value.subcategories" ng-click="vm.changeSubcategory({category: value.category, subcategory: subcategory_value}); vm.metadata.current = 1;">{{subcategory_value}}</div>
                        </div>
                    </div>
                </li>
                <li class="categories">
                    <div class="dropdown-categories" ng-class="{active: vm.show_categories}">
                        <h4 ng-click="vm.categoriesDropdown($event)">Search and browse by category</h4>
                        <ul ng-class="{active: vm.show_categories}">
                            <li ng-repeat="(key, value) in vm.categories">
                                <div class="category" ng-class="{active: vm.inCategory({Category: value})}">
                                    <span class="subcategory-arrow" ng-class="{'subcategory-toggle': vm.subcategories[value]}"></span>
                                    <span class="category-name" ng-class="{'subcategory-toggle': vm.subcategories[value]}">
                                        <div class="ico ico-light-gray ico-light-gray-from-black ico-attr-{{vm.categoryClass(value)}}"></div>
                                        {{value}}
                                    </span>
                                    <span class="change-category" ng-click="vm.changeCategory({category: value, event: $event});  vm.metadata.current = 1;" ng-class="{active: vm.inCategory({Category: value})}"></span>
                                </div>
                                <ul ng-if="vm.subcategories[value]">
                                    <li ng-repeat="(subcategory_key, subcategory_value) in vm.subcategories[value]" ng-click="vm.changeSubcategory({category: value, subcategory: subcategory_value, event: $event}); vm.metadata.current = 1;" ng-class="{active: vm.inSubcategory({Category: value, Subcategory: subcategory_value})}">
                                        <span class="subcategory-name">{{subcategory_value}}</span>
                                        <span class="change-category"></span>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="menu" ng-click="vm.clickPaginate()">
                    <a class="button icon-button white-button" ng-click="SortOrder = (SortOrder == 'DisplayName' ? '-DisplayName' : 'DisplayName'); vm.metadata.current = 1;" ng-init="SortOrder = 'DisplayName';">
                        <span class="fa fa-sort-alpha-{{ SortOrder == 'DisplayName' ? 'asc' : 'desc' }}"></span>
                    </a>
                    <a ng-if="vm.enable_grid" class="button icon-button white-button" ng-click="vm.view = (vm.view === 'list' ? 'grid' : 'list')">
                        <span class="fa {{(vm.view === 'list' ? 'fa-th-large' : 'fa-th-list')}}"></span>
                    </a>
                    <button class="save button orange-button" ng-disabled="vm.saveDisabled" ng-click="vm.saveSelected()">{{vm.label.button_save}}</button>
                </li>
            </ul>
        </div>
        <div class="filters-enrichments">
            <div class="filters-container">
                <div class="side">
                    <h4>Filter Attributes</h4>
                    <ul class="info">
                        <li class="premiums">
                            <span class="fa fa-star"></span> {{vm.label.premium}} <em class="badge">{{(vm.premiumTotal = vm.enrichments | filter: {'IsSelected': true, 'IsPremium': true}).length}} / {{vm.premiumSelectLimit}}</em>
                        </li>
                        <li class="totals">
                            <span class="fa fa-bars"></span> {{vm.label.total}} <em class="badge">{{(vm.selectedTotal = vm.enrichments | filter: {'IsSelected': true}).length}} / {{vm.generalSelectLimit}}</em>
                        </li>
                    </ul>
                    <ul class="actions">
                        <li class="save">
                            <button class="save button orange-button" ng-disabled="vm.saveDisabled" ng-click="vm.saveSelected()">{{vm.label.button_save}}</button>
                        </li>
                        </ul>
                    </ul>
                    <h4>Filter</h4>
                    <ul class="filters">
                        <li><input type="checkbox" id="enabled" name="enabled" ng-model="vm.metadata.toggle.show.selected" ng-change="vm.metadata.current = 1;" ng-checked="vm.metadata.toggle.show.selected" /> <label for="enabled">Enabled only</label></li>
                        <li><input type="checkbox" id="premium_show" name="premium_show" ng-model="vm.metadata.toggle.show.premium" ng-change="vm.metadata.current = 1;" ng-checked="vm.metadata.toggle.show.premium" ng-disabled="vm.metadata.toggle.hide.premium" /> <label for="premium_show">Premium only</label></li>
                        <li><input type="checkbox" id="premium_hide" name="premium_hide" ng-model="vm.metadata.toggle.hide.premium" ng-change="vm.metadata.current = 1;" ng-checked="vm.metadata.toggle.hide.premium" ng-disabled="vm.metadata.toggle.show.premium" /> <label for="premium_hide">Non-Premium only</label></li>
                        <li ng-if="vm.show_internal_filter"><input type="checkbox" id="internal" name="internal" ng-model="vm.metadata.toggle.show.internal" ng-change="vm.metadata.current = 1;" ng-checked="vm.metadata.toggle.show.internal" /> <label for="internal">Include Internal Attributes</label></li>
                    </ul>
                    <h4>Download Attributes</h4>
                    <ul class="actions">
                        <li class="download">
                            <a href="/files/enrichment/lead/downloadcsv?onlySelectedAttributes=false&Authorization={{vm.authToken}}">{{vm.label.button_download}}</a>
                        </li>
                        <li class="download">
                            <a href="/files/enrichment/lead/downloadcsv?onlySelectedAttributes=true&Authorization={{vm.authToken}}">{{vm.label.button_download_selected}}</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="enrichments-container">
                <div class="row required-fields-pagination" ng-init="vm.metadata.current = 1" ng-show="vm.max > 1">
                    <div class="twelve columns">
                        <pd-pagination-controls 
                                ng-click="vm.clickPaginate()"
                                current="vm.metadata.current" 
                                max="vm.max = filteredList.length / vm.pagesize">
                        </pd-pagination-controls>
                    </div>
                </div>
                <ul class="enrichments {{vm.view}}" data-across="{{vm.across}}">
                    <li class="box category-{{vm.categoryClass(enrichment.Category)}} ngAnimate" 
                    ng-repeat="enrichment in (filteredList = (vm.enrichments 
                    | filter: vm.query
                    | orderBy: SortOrder
                    | filter: vm.inCategory
                    | filter: vm.inSubcategory
                    | filter: { 
                                'IsSelected': (!vm.metadata.toggle.show.selected ? '' : true), 
                                'IsPremium': (!vm.metadata.toggle.show.premium ? '' : true) || (!vm.metadata.toggle.hide.premium ? '' : false),
                                'IsInternal': (!vm.metadata.toggle.show.internal ? '' : true)
                                })) 
                    | startFrom: (vm.metadata.current - 1) * vm.pagesize 
                    | limitTo: vm.pagesize" 
                    ng-class="{'active': enrichment.IsSelected}">
                        <div class="box-inner">
                            <div class="header">
                                <div class="ico ico-light-gray ico-light-gray-from-black ico-attr-{{::vm.categoryClass(enrichment.Category)}}"></div>
                                <ul class="categories">
                                    <li ng-if="::enrichment.Category">{{::enrichment.Category}}</li>
                                    <li ng-if="::enrichment.Subcategory">{{::enrichment.Subcategory}}</li>
                                </ul>
                                <ul class="tags">
                                    <li ng-if="::enrichment.IsPremium" class="premium">premium</li>
                                </ul>
                                <h2>
                                    <strong>{{::enrichment.DisplayName}}</strong>
                                </h2>
                            </div>
                            <p class="description">{{::enrichment.Description}}</p>
                            <div class="controls">
                                <div class="field-type">
                                    <strong>Field Type</strong>
                                    <em>{{::vm.fieldType(enrichment.FieldType)}}</em>
                                </div>
                                <div class="toggle">
                                    <button class="button" 
                                            ng-class="{'msg': enrichment.button_msg, 'error': enrichment.button_error, 'selected': enrichment.IsSelected}" 
                                            ng-click="enrichment.WasDirty = enrichment.IsDirty || false; enrichment.IsDirty = true; enrichment.IsSelected = !enrichment.IsSelected; vm.selectEnrichment(enrichment)">
                                        <span>{{!enrichment.IsSelected ? enrichment.button_select || vm.label.button_select : (enrichment.IsDirty ? vm.label.button_deselect : vm.label.button_selected)}}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li ng-show="!filteredList.length">
                        <div ng-show="!vm.enrichments_loaded">
                            <div class="loader"> </div>
                        </div>       
                        <h2 ng-show="vm.enrichments_loaded">{{vm.label.no_results}}</h2>
                    </li>
                </ul>
                <div class="row required-fields-pagination" ng-init="vm.metadata.current = 1" ng-show="vm.max > 1">
                    <div class="twelve columns">
                        <pd-pagination-controls 
                                ng-click="vm.clickPaginate()"
                                current="vm.metadata.current" 
                                max="vm.max = filteredList.length / vm.pagesize">
                        </pd-pagination-controls>
                    </div>
                </div>
            </div>
        </div>

    </section>
</div>
