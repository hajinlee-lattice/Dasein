

<section class="playbook playbook-launch-history container">
    <div 
        ng-if="vm.launchesCount === 0"
        class="no-data">
        <h2>There are no plays launched. The launch history will be available once you launch plays.</h2>
        <a 
            class="button white-button"
            ui-sref="home.playbook.create">
            Create a play
        </a>
    </div>
    <div
        ng-if="vm.launchesCount > 0" 
        class="card-content" 
        ng-class="{'has-footer': !vm.allPlaysHistory}">

        <menu-filter-by config="vm.header.filter"></menu-filter-by>
        <chips 
            ng-show="vm.allPlaysHistory"
            placeholder="All Launched Plays" 
            datasource="vm.defaultPlayLaunchList" 
            callback-function="vm.playSelectChange(args)"
            single-selection="true"
            id="pid"
            queryscope="displayName"
            displayname="displayName">
        </chips>
        <ul class="history-metadata">
        	<li>
        		<dl>
        			<dt>Selected Targets</dt>
        			<dd class="blue-text">{{vm.summaryData.selectedTargets | number}}</dd>
        		</dl>
        	</li>
        	<li>
        		<dl>
        			<dt>Suppressed</dt>
        			<dd class="red-text">{{vm.summaryData.suppressed | number}}</dd>
        		</dl>
        	</li>
            <li>
                <dl>
                    <dt>Errors</dt>
                    <dd class="red-text">{{vm.summaryData.errors | number}}</dd>
                </dl>
            </li>
        	<li>
        		<dl>
        			<dt>Launched Recommendations</dt>
        			<dd class="green-text">{{vm.summaryData.recommendationsLaunched | number}}</dd>
        		</dl>
        	</li>
        	<li>
        		<dl>
        			<dt>Contacts within Recommendations</dt>
        			<dd class="green-text">{{vm.summaryData.contactsWithinRecommendations | number}}</dd>
        		</dl>
        	</li>
        </ul>

    	<div class="table-metadata">
    		{{vm.launchesCount}} play launch<span ng-if="vm.launchesCount > 1">es</span>
    	</div>

    	<table>
    		<thead>
    			<tr>

    				<th class="sortable" ng-click="vm.sort('created'); vm.sortDesc = !vm.sortDesc">
                        Launch Date
                        <i  aria-hidden="true" 
                            ng-class="{
                                'fa fa-sort': vm.sortBy != 'created',
                                'fa fa-sort-desc': vm.sortBy === 'created' && vm.sortDesc, 
                                'fa fa-sort-asc': vm.sortBy === 'created' && !vm.sortDesc}"></i>
                    </th>
                    <th ng-if="vm.allPlaysHistory">
                        Play Name
                        <!-- <i  aria-hidden="true" 
                            ng-class="{
                                'fa fa-sort': vm.sortBy != 'playDisplayName',
                                'fa fa-sort-desc': vm.sortBy === 'playDisplayName' && vm.sortDesc, 
                                'fa fa-sort-asc': vm.sortBy === 'playDisplayName' && !vm.sortDesc}"></i> -->
                    </th>
    				<th class="sortable" ng-click="vm.sort('accountsSelected'); vm.sortDesc = !vm.sortDesc">
                        Selected Targets
                        <i  aria-hidden="true" 
                            ng-class="{
                                'fa fa-sort': vm.sortBy != 'accountsSelected',
                                'fa fa-sort-desc': vm.sortBy === 'accountsSelected' && vm.sortDesc, 
                                'fa fa-sort-asc': vm.sortBy === 'accountsSelected' && !vm.sortDesc}"></i>
                   </th>
    				<th class="sortable" ng-click="vm.sort('accountsSuppressed'); vm.sortDesc = !vm.sortDesc">
                        Suppressed
                        <i  aria-hidden="true" 
                            ng-class="{
                                'fa fa-sort': vm.sortBy != 'accountsSuppressed',
                                'fa fa-sort-desc': vm.sortBy === 'accountsSuppressed' && vm.sortDesc, 
                                'fa fa-sort-asc': vm.sortBy === 'accountsSuppressed' && !vm.sortDesc}"></i>
                   </th>
                    <th class="sortable" ng-click="vm.sort('accountsErrored'); vm.sortDesc = !vm.sortDesc">
                        Errors
                        <i  aria-hidden="true" 
                            ng-class="{
                                'fa fa-sort': vm.sortBy != 'accountsErrored',
                                'fa fa-sort-desc': vm.sortBy === 'accountsErrored' && vm.sortDesc, 
                                'fa fa-sort-asc': vm.sortBy === 'accountsErrored' && !vm.sortDesc}"></i>
                   </th>
    				<th>
                        Launched <br/>Recommendations
                   </th>
    				<th>
                        Contacts within <br/>Recommendations
                   </th>
                    <th class="sortable" ng-click="vm.sort('launchState'); vm.sortDesc = !vm.sortDesc">
                        Status
                        <i  aria-hidden="true" 
                            ng-class="{
                                'fa fa-sort': vm.sortBy != 'launchState',
                                'fa fa-sort-desc': vm.sortBy === 'launchState' && vm.sortDesc, 
                                'fa fa-sort-asc': vm.sortBy === 'launchState' && !vm.sortDesc}"></i>
                   </th>
    			</tr>
    		</thead>
    		<tbody>
    			<tr ng-repeat="
                    launch in vm.launches.launchSummaries | 
                    filter: vm.header.filter.value : true | 
                    startFrom: (vm.currentPage - 1) * vm.pagesize | 
                    limitTo: vm.pagesize">
    				<td>{{launch.launchTime | date:'hh:mm a on MM/dd/yyyy'}}</td>
                    <td ng-if="vm.allPlaysHistory">{{launch.playDisplayName}}</td>
    				<td class="blue-text">{{launch.stats.selectedTargets | number}}</td>
    				<td class="red-text">{{launch.stats.suppressed | number}}</td>
    				<td class="red-text">{{launch.stats.errors | number}}</td>
                    <td class="green-text">{{launch.stats.recommendationsLaunched | number}}</td>
    				<td class="green-text">{{launch.stats.contactsWithinRecommendations | number}}</td>
                    <td>
                        <span class="fa fa-check" ng-if="launch.launchState === 'Launched'"></span>
                        <span class="fa fa-spinner fa-pulse fw" ng-if="launch.launchState === 'Launching'"></span>
                        <span class="fa fa-exclamation-triangle red-text" ng-if="launch.launchState === 'Failed'"></span>
                        {{launch.launchState}}
                    </td>
    			</tr>
    		</tbody>
    	</table>

        <pd-pagination-controls
            current="vm.currentPage"
            max="max = vm.header.filter.filtered.length / vm.pagesize"
            ng-show="max > 1"
            class="pull-right">
        </pd-pagination-controls>

    </div><!-- End .content -->
    <div class="card-footer" ng-if="!vm.allPlaysHistory">
        <button 
            type="button"
            class="button blue-button pull-right"
            ng-disabled="vm.launching"
            ng-click="vm.relaunchPlay()">
            <span ng-show="!vm.launching">Re-Launch</span>
            <span ng-show="vm.launching">Launching...</span>
        </button>
    </div><!-- End .footer -->
</section>


