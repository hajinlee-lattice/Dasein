<section id="main-content" class="container tile-list play-list">

    <div class="row">
        <div class="list-header">
            <div class="pull-left number-of-items" ng-if="vm.totalLength > 0">
                <menu-filter-by config="vm.header.filter"></menu-filter-by>
                <menu-sort-by config="vm.header.sort"></menu-sort-by>
                <search-filter query="vm.query.displayName"></search-filter>
            </div>
            <div class="pull-right">
                <a
                    class="button orange-button"
                    ui-sref="home.playbook.wizard">
                    Add Play
                </a>
            </div>
        </div>
    </div>

    <div class="row" ng-init="pagesize = 12; current = 1" ng-show="max > 1">
        <div class="twelve columns">
            <pd-pagination-controls current="current" max="max = (vm.header.filter.filtered | filter: vm.query).length / pagesize">
            </pd-pagination-controls>
        </div>
    </div>

    <div class="row">
        <div class="twelve columns">
            <ul class="tiles">
                <li
                    ng-repeat="
                        play in vm.header.filter.filtered |
                        filter: vm.query |
                        orderBy: vm.header.sort.order + vm.header.sort.property |
                        startFrom: (current - 1) * pagesize |
                        limitTo: pagesize"
                    data="play"
                    ng-click="vm.tileClick($event, play.name)"
                    ng-mouseleave="vm.tileStates[play.name].showCustomMenu ? vm.customMenuClick($event, play) : null"
                    ng-if="vm.plays.length > 0"
                    ng-class="{editing: vm.tileStates[play.name].editPlay}">
                    <div class="tile-header" ng-if="!vm.tileStates[play.name].editPlay">
                        <h2 title="{{play.displayName}}">{{play.displayName | limitTo: 44 }}{{play.displayName.length > 44 ? '&hellip;' : ''}}</h2>
                        <div class="edit">
                            <button
                                    type="button"
                                    ng-click="vm.customMenuClick($event, play)"
                                    ng-class="{ 'open': vm.tileStates[play.name].showCustomMenu }">
                                <span class="fa fa-ellipsis-v" ng-class="{ 'fa-rotate-180': vm.tileStates[play.name].showCustomMenu }"></span>
                            </button>
                            <ul class="model-menu" ng-show="vm.tileStates[play.name].showCustomMenu">
                                <li data-ng-click="vm.editPlayClick($event, play)">
                                    <a href="javascript:void(0)">Edit</a>
                                    <i class="fa fa-edit"></i>
                                </li>
                                <li data-ng-click="vm.showDeletePlayModalClick($event, play)">
                                    <a href="javascript:void(0)">Delete</a>
                                    <i class="fa fa-trash"></i>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div 
                        class="tile-metadata"
                        ng-if="!vm.tileStates[play.name].editPlay">
                        <ul>
                            <li>Created by <span class="blue-text">{{play.createdBy}}</span> on <span class="blue-text">{{play.timeStamp | date}}</span></li>
                            <li ng-if="play.segment != null">Segment: <span class="blue-text">{{play.segment}}</span></li>
                            <li>
                                Last Launched: 
                                <span ng-if="play.talkingpoints.length === 0 && play.rating === '' || play.rating === 0"><span class="error-text">Not launched yet</span></span>
                                <span ng-if="play.talkingpoints.length != 0 && play.rating === {}"><span class="blue-text">Ready for launch</span></span>
                                <span ng-if="play.talkingpoints.length != 0 && play.rating != '' || play.rating != 0"><span class="blue-text">Launched {{play.lastUpdatedTimestamp | date}}</span></span>
                            </li>
                            <li>
                                Insights: 
                                <span ng-if="play.talkingpoints.length === 0 && play.rating === '' || play.rating === 0"><span class="error-text">None created</span></span>
                                <span ng-if="play.talkingpoints.length != 0 && play.rating === {}"><span class="blue-text">{{play.talkingpoints.length}} Talking Points created</span></span>
                                <span ng-if="play.talkingpoints.length != 0 && play.rating != '' || play.rating != 0"><span class="blue-text">{{play.talkingpoints.length}} Talking Points - Published {{play.lastUpdatedTimestamp | date}}</span></span>
                            </li>
                        </ul>
                    </div>
                    <div class="tile-body" ng-if="!vm.tileStates[play.name].editPlay">

                        <div ng-if="play.talkingpoints.length === 0 && play.rating === '' || play.rating === 0">
                            <strong>This play was started but not finished.</strong> It can be launched after all steps are completed.
                        </div>
                        <div ng-if="play.talkingpoints.length != 0 && play.rating === {}">
                            {{play.talkingpoints.length}} Talking Points created
                        </div>
                        <div ng-if="play.talkingpoints.length != 0 && play.rating != '' || play.rating != 0">
                            <h4>Account Ratings</h4>
                            <ul>
                               <li ng-repeat="rating in play.rating">
                                    <span>{{rating.count}}</span>
                                </li> 
                            </ul>
                        </div>

                    </div>
                    <div class="tile-footer">
                        <button 
                            type="button"
                            class="button blue-button pull-right"
                             ng-if="play.talkingpoints.length === 0 && play.rating === '' || play.rating === 0"
                            ng-click="vm.continuePlaySetup($event)">
                            Continue
                        </button>
                        <button 
                            type="button"
                            class="button blue-button pull-right"
                             ng-if="play.talkingpoints.length != 0 && play.rating === {}"
                            ng-click="vm.launchPlay($event)">
                            Launch
                        </button>
                        <span class="launch-success pull-right" ng-if="play.talkingpoints.length != 0 && play.rating != '' || play.rating != 0">Launched {{play.lastUpdatedTimestamp | date}}</span>

                    </div>

                    <form
                        class="edit-form"
                        name="editPlayForm"
                        ng-if="vm.tileStates[play.name].editPlay"
                        ng-click="$event.stopPropagation()">
                        <div class="form-group">
                            <label for="playDisplayName">Name
                            <input
                                autofocus
                                type="text"
                                id="display_name"
                                name="display_name"
                                data-ng-model="play.displayName"
                                class="form-control" />
                                </label>
                        </div>
                        <div class="actions">
                            <button
                                type="button"
                                class="button white-button pull-left"
                                ng-click="vm.cancelEditPlayClicked($event, play)"
                                ng-disabled="vm.saveInProgress  ">
                                Cancel</button>
                            <button
                                type="button"
                                class="button orange-button pull-right"
                                ng-disabled="editPlayForm.$pristine"
                                ng-click="vm.savePlayClicked($event, play)"
                                ng-if="!vm.saveInProgress">
                                Save</button>
                            <button
                                type="button"
                                class="button gray-button pull-right"
                                ng-disabled="vm.saveInProgress"
                                ng-if="vm.saveInProgress">
                                Saving...</button>
                        </div>
                    </form>

                </li>

                <li class="no-style" ng-if="vm.plays.length < 12">
                    <a
                        class="button new-tile-button"
                        ui-sref="home.playbook.wizard">
                        <span>&#43;</span>
                        Create Play
                    </a>
                </li>

            </ul>
        </div>
    </div><!-- End .row -->


    <div class="row" ng-init="pagesize = 12; current = 1" ng-show="max > 1">
        <div class="twelve columns">
            <pd-pagination-controls current="current" max="max = (vm.header.filter.filtered | filter: vm.query).length / pagesize">
            </pd-pagination-controls>
        </div>
    </div>


</section>