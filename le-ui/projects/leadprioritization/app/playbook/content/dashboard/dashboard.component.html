<div  ng-if="!vm.play" class="loader vertical-center"></div>
<section class="container playbook-dashboard" ng-if="vm.play">
    <div class="container-body">
        <div class="dashboard-column">
            <div class="dashboard-section play">
                <div class="dashboard-section-container">
                    <div class="dashboard-section-header">
                        <h2><div contenteditable="{{vm.editable}}" ng-blur="vm.edited($event, 'displayName')">{{ vm.play.displayName||'Play Name' }}</div></h2>
                    </div>
                    <div class="dashboard-section-content">
                        <p>
                            <div contenteditable="{{vm.editable}}" ng-blur="vm.edited($event, 'description')">
                                {{vm.play.description}}
                            </div>
                        </p>
                        <div class="dashboard-section-content-subsection rating_ has-icon">
                            <h4>Rating</h4>
                            <h5>{{vm.play.rating.ratingName}}</h5>
                        </div>
                        <div class="dashboard-section-content-subsection segment has-icon">
                            <h4>Segment</h4>
                            <h5>{{vm.play.segment}}</h5>
                            <ul class="controls">
                                <li ng-if="!vm.play.segment"><a ui-sref="home.playbook.dashboard.segment({play_name: vm.play.name})">Add</a></li>
                                <!--
                                <li ng-if="vm.play.segment"><a ui-sref="home.playbook.dashboard.segment({play_name: vm.play.name})">Change</a></li>
                                <li ng-if="vm.play.segment" ng-init="showRemoveSegmentModal = false">
                                    <button class="button white-button" ng-click="showRemoveSegmentModal = !showRemoveSegmentModal">X</button>
                                    <div class="confirmModal" ng-show="showRemoveSegmentModal">
                                        Remove Segment?
                                        <button class="button orange-button" ng-click="vm.removeSegment(vm.play); showRemoveSegmentModal = false">Remove</button>
                                        <button class="button white-button" ng-click="showRemoveSegmentModal = false">Cancel</button>
                                    </div>
                                </li>
                                -->
                            </ul>
                        </div>
                        <div>
                            <a ui-sref="home.playbook.wizard.settings({play_name: vm.play.name})">temp edit link</a><br />
                            <a href="#" ng-click="showPlayData = !showPlayData">debugging: {{!showPlayData ? "show" : "hide"}} play data</a>
                            <div ng-show="showPlayData">
                                <pre>vm.play: {{vm.play|json}}</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-section talking-points">
                <div class="dashboard-section-container">
                    <div class="dashboard-section-header">
                        <h2>Insights</h2>
                    </div>
                    <div class="dashboard-section-content">
                        <div class="dashboard-section-content-subsection talking-points has-icon">
                            <h5>{{vm.play.talkingPoints.length||'No'}} talking points have been created</h5>
                            <ul class="controls">
                                <li ng-if="!vm.play.talkingPoints.length"><a ui-sref="home.playbook.dashboard.insights({play_name: vm.play.name})">Create</a></li>
                                <li ng-if="vm.play.talkingPoints.length"><a ui-sref="home.playbook.dashboard.insights({play_name: vm.play.name})">Edit</a></li>
                            </ul>
                        </div>

                        <div>
                            <a href="#" ng-click="showTalkingPointsData = !showTalkingPointsData">debugging: {{!showTalkingPointsData ? "show" : "hide"}} talking points data</a>
                            <div ng-show="showTalkingPointsData">
                                <pre>vm.play.talkingPoints: {{vm.play.talkingPoints|json}}</pre>
                            </div>
                        </div>
                    </div>
                    <div class="dashboard-section-footer">
                        <span ng-if="vm.play.timeStamp">Published {{vm.TimestampIntervalUtility.timeAgo(vm.play.timeStamp)}} <i class="fa fa-check"></i></span>
                    </div>
                </div>
            </div>

        </div>
        <div class="dashboard-column">
            <div class="dashboard-section launch-history">
                <div class="dashboard-section-container">
                    <div class="dashboard-section-header">
                        <h2>
                            <div class="column">
                                Last Launch
                            </div>
                            <div class="column">
                                <a ui-sref="home.playbook.dashboard.launch_history({play_name: vm.play.name})"><span class="ico ico-cog ico-black"></span> Launch History</a>
                            </div>
                        </h2>
                    </div>
                    <div class="dashboard-section-content">
                        <div class="dashboard-section-content-subsection launches" ng-if="vm.launchGraph">
                            <div class="dashboard-subsection-header">
                                <h3>New vs Last Launched</h3>
                            </div>
                            <ul class="playbook-launch-history graph">
                                <li class="launch-history-graph" ng-repeat="(name, history) in vm.launchGraph.buckets">
                                    <div class="history-label"><strong>{{name}}</strong></div>
                                    <div class="history-bar" style="width:{{history.total/vm.launchGraph.total*100}}%;">
                                        <div class="history-bar-current" ng-if="history.current" style="width:{{history.current/history.total*100}}%;"></div>
                                        <div class="history-bar-new" ng-if="history.new" style="width:{{history.new/history.total*100}}%;"></div>
                                    </div>
                                    <div class="history-count" ng-show="history.total"><strong>{{vm.NumberUtility.AbbreviateLargeNumber(history.total)}}</strong></div>
                                </li>
                            </ul>
                        </div>
                        <div class="dashboard-section-content-subsection ratings">
                            <div class="dashboard-subsection-header">
                                <h3>Account ratings</h3>
                            </div>
                            <ul class="playbook-ratings graph" ng-if="vm.ratingsGraph">
                                <li class="_rating" ng-repeat="rating in vm.ratingsGraph.buckets">
                                    <div class="rating-count" ng-show="rating.bucketCount">{{rating.bucketCount}}</div>
                                    <div class="rating-bar" style="height:{{rating.bucketCount/vm.ratingsGraph.total*100}}%;"></div>
                                    <div class="rating-label">{{rating.bucket}}</div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="dashboard-section-footer">
                        <span ng-if="vm.play.timeStamp && vm.launchedState == 'Launched'">Launched {{vm.TimestampIntervalUtility.timeAgo(vm.play.timeStamp)}} <i class="fa fa-check"></i></span>
                        <button class="launch button blue-button" ng-click="vm.launchPlay()" ng-disabled="vm.invalid.length">
                            <span ng-if="vm.launchedState != 'Launched'">Launch now</span>
                            <span ng-if="vm.launchedState == 'Launched'">Re-Launch now</span>
                            <span ng-if="vm.showLaunchSpinner"><i class="fa fa-spinner fa-spin fa-fw"></i></span>
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>