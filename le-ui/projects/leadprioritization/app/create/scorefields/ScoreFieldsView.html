<section class="container custom-fields">
	<form novalidate name="fieldMappingForm">
	<!--
	<div class="row">
		<div class="ten columns offset-one">
			<hgroup ng-if="vm.RequiredFields.length > 0">
				<h3>{{::vm.ResourceUtility.getString('MODEL_COLUMNS_MUST_MAP_LABEL')}}: <br/>
					<span ng-repeat="RequiredField in vm.RequiredFields"><span ng-if="$index != 0">,&nbsp;</span><span class="orange-text">{{::RequiredField}}</span></span>
				</h3>
			</hgroup>
		</div>
	</div>
	-->
	<div class="row field-mapping-form">
		<div class="six offset-three columns">
			<table class="unstyled">
				<thead ng-if="vm.initialized">
					<tr>
						<th>{{::vm.ResourceUtility.getString('MODEL_COLUMNS_CSV_LABEL_FIELD_NAME')}}</th>
						<th>{{::vm.ResourceUtility.getString('MODEL_COLUMNS_CSV_LABEL_FIELDS_IN_FILE')}}</th>
					</tr>
				</thead>

				<tbody>
                    <tr ng-repeat="field in vm.fieldMappings">
						<td class="field_mapping_label">
							<label for="fieldType_{{ field.mappedField }}">{{ field.mappedField }}</label>
						</td>
						<td class="field-mapping-inputs">
                            <select required
                            		name="mapping_lattice_field_select_{{ field.mappedField }}"
                            		class="form-control"
                            		ng-class="{ 'disabled': field.userField == vm.ignoredFieldName }"
	                            	ng-model="field.userField"
	                            	ng-change="vm.changeLatticeField(field, field.userField)">
	                            <option value="{{ vm.ignoredFieldName }}"
	                            		ng-if="field.userField && field.userField != vm.ignoredFieldName"
	                            		ng-class="{ 'required': (vm.RequiredFields.indexOf(field.userField) > -1) }"
	                            		ng-selected="!field.userField">
	                            	{{ vm.ignoredFieldName }}
	                            </option>
	                            <option value="{{ field.userField }}"
	                            		ng-class="{ 'required': (vm.RequiredFields.indexOf(field.userField) > -1) }"
	                            		ng-selected="true">
	                            	{{ field.userField }}
	                            </option>
	                            <option value="{{ UnmappedField }}"
	                            		ng-class="{ 'required': (vm.RequiredFields.indexOf(UnmappedField) > -1) }"
	                            		ng-repeat="UnmappedField in vm.AvailableFields">
	                            	{{ UnmappedField }}
	                            </option>
                            </select>
						</td>
					</tr>
				</tbody>
			</table>

		</div>
	</div>

	<div class="row field-mapping-validation">
		<div class="ten columns offset-one" ng-class="{ 'has-error' : fieldMappingForm.$invalid }">
      		<p class="help-block">
      			* One or more of your columns is unmapped or is using a reserved name
      		</p>
    	</div>
  	</div>

	<div class="row field-mapping-validation" ng-repeat="RequiredField in ::vm.RequiredFields" ng-if="!vm.MappedFields.indexOf(requiredField) < 0">
		<div class="ten columns offset-one has-error">
			<p class="help-block">
		    	* Required column is missing: <i class="orange-text">{{::RequiredField}}</i>
			</p>
    	</div>
    </div>

	<div class="row">
		<div class="ten columns offset-one field-mapping-actions">
			<div class="pull-left">
				<button data-ng-click="vm.clickReset()" class="button white-button" type="button">
					{{::vm.ResourceUtility.getString('MODEL_COLUMNS_CSV_BUTTON_RESET')}}
				</button>
			</div>
			<div class="pull-right">
				<button 
						ng-click="vm.clickNext(); NextClicked = true;" 
						ng-disabled="fieldMappingForm.$invalid || NextClicked || !vm.FormValidated" 
						class="button orange-button" 
						type="button">
					{{::vm.ResourceUtility.getString('MODEL_COLUMNS_CSV_BUTTON_NEXT')}}
				</button>
			</div>
		</div>
	</div>
	</form>
</section>