var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){for(val=String(val),len=len||2;val.length<len;)val="0"+val;return val};return function(date,mask,utc){var dF=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(date)||/\d/.test(date)||(mask=date,date=void 0),date=date?new Date(date):new Date,isNaN(date))throw SyntaxError("invalid date");mask=String(dF.masks[mask]||mask||dF.masks["default"]),"UTC:"==mask.slice(0,4)&&(mask=mask.slice(4),utc=!0);var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(100*Math.floor(Math.abs(o)/60)+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(mask,utc){return dateFormat(this,mask,utc)},angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.collapse","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.bindHtml","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.dateparser","ui.bootstrap.position","ui.bootstrap.datepicker","ui.bootstrap.dropdown","ui.bootstrap.modal","ui.bootstrap.pagination","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.progressbar","ui.bootstrap.rating","ui.bootstrap.tabs","ui.bootstrap.timepicker","ui.bootstrap.transition","ui.bootstrap.typeahead"]),angular.module("ui.bootstrap.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/carousel/carousel.html","template/carousel/slide.html","template/datepicker/datepicker.html","template/datepicker/day.html","template/datepicker/month.html","template/datepicker/popup.html","template/datepicker/year.html","template/modal/backdrop.html","template/modal/window.html","template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-popup.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/tooltip/tooltip-template-popup.html","template/popover/popover-template.html","template/popover/popover.html","template/progressbar/bar.html","template/progressbar/progress.html","template/progressbar/progressbar.html","template/rating/rating.html","template/tabs/tab.html","template/tabs/tabset.html","template/timepicker/timepicker.html","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("ui.bootstrap.collapse",[]).directive("collapse",["$animate",function($animate){return{link:function(scope,element,attrs){function expand(){element.removeClass("collapse").addClass("collapsing"),$animate.addClass(element,"in",{to:{height:element[0].scrollHeight+"px"}}).then(expandDone)}function expandDone(){element.removeClass("collapsing"),element.css({height:"auto"})}function collapse(){element.css({height:element[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing"),$animate.removeClass(element,"in",{to:{height:"0"}}).then(collapseDone)}function collapseDone(){element.css({height:"0"}),element.removeClass("collapsing"),element.addClass("collapse")}scope.$watch(attrs.collapse,function(shouldCollapse){shouldCollapse?collapse():expand()})}}}]),angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function($scope,$attrs,accordionConfig){this.groups=[],this.closeOthers=function(openGroup){var closeOthers=angular.isDefined($attrs.closeOthers)?$scope.$eval($attrs.closeOthers):accordionConfig.closeOthers;closeOthers&&angular.forEach(this.groups,function(group){group!==openGroup&&(group.isOpen=!1)})},this.addGroup=function(groupScope){var that=this;this.groups.push(groupScope),groupScope.$on("$destroy",function(event){that.removeGroup(groupScope)})},this.removeGroup=function(group){var index=this.groups.indexOf(group);index!==-1&&this.groups.splice(index,1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",function(){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@",isOpen:"=?",isDisabled:"=?"},controller:function(){this.setHeading=function(element){this.heading=element}},link:function(scope,element,attrs,accordionCtrl){accordionCtrl.addGroup(scope),scope.$watch("isOpen",function(value){value&&accordionCtrl.closeOthers(scope)}),scope.toggleOpen=function(){scope.isDisabled||(scope.isOpen=!scope.isOpen)}}}}).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",link:function(scope,element,attr,accordionGroupCtrl,transclude){accordionGroupCtrl.setHeading(transclude(scope,angular.noop))}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(scope,element,attr,controller){scope.$watch(function(){return controller[attr.accordionTransclude]},function(heading){heading&&(element.html(""),element.append(heading))})}}}),angular.module("ui.bootstrap.alert",[]).controller("AlertController",["$scope","$attrs",function($scope,$attrs){$scope.closeable="close"in $attrs,this.close=$scope.close}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"@",close:"&"}}}).directive("dismissOnTimeout",["$timeout",function($timeout){return{require:"alert",link:function(scope,element,attrs,alertCtrl){$timeout(function(){alertCtrl.close()},parseInt(attrs.dismissOnTimeout,10))}}}]),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(scope,element,attr){element.addClass("ng-binding").data("$binding",attr.bindHtmlUnsafe),scope.$watch(attr.bindHtmlUnsafe,function(value){element.html(value||"")})}}),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(buttonConfig){this.activeClass=buttonConfig.activeClass||"active",this.toggleEvent=buttonConfig.toggleEvent||"click"}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",link:function(scope,element,attrs,ctrls){var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,scope.$eval(attrs.btnRadio)))},element.bind(buttonsCtrl.toggleEvent,function(){var isActive=element.hasClass(buttonsCtrl.activeClass);isActive&&!angular.isDefined(attrs.uncheckable)||scope.$apply(function(){ngModelCtrl.$setViewValue(isActive?null:scope.$eval(attrs.btnRadio)),ngModelCtrl.$render()})})}}}).directive("btnCheckbox",function(){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",link:function(scope,element,attrs,ctrls){function getTrueValue(){return getCheckboxValue(attrs.btnCheckboxTrue,!0)}function getFalseValue(){return getCheckboxValue(attrs.btnCheckboxFalse,!1)}function getCheckboxValue(attributeValue,defaultValue){var val=scope.$eval(attributeValue);return angular.isDefined(val)?val:defaultValue}var buttonsCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl.$render=function(){element.toggleClass(buttonsCtrl.activeClass,angular.equals(ngModelCtrl.$modelValue,getTrueValue()))},element.bind(buttonsCtrl.toggleEvent,function(){scope.$apply(function(){ngModelCtrl.$setViewValue(element.hasClass(buttonsCtrl.activeClass)?getFalseValue():getTrueValue()),ngModelCtrl.$render()})})}}}),angular.module("ui.bootstrap.carousel",[]).controller("CarouselController",["$scope","$interval","$animate",function($scope,$interval,$animate){function getSlideByIndex(index){if(angular.isUndefined(slides[index].index))return slides[index];var i;slides.length;for(i=0;i<slides.length;++i)if(slides[i].index==index)return slides[i]}function restartTimer(){resetTimer();var interval=+$scope.interval;!isNaN(interval)&&interval>0&&(currentInterval=$interval(timerFn,interval))}function resetTimer(){currentInterval&&($interval.cancel(currentInterval),currentInterval=null)}function timerFn(){var interval=+$scope.interval;isPlaying&&!isNaN(interval)&&interval>0?$scope.next():$scope.pause()}var currentInterval,isPlaying,self=this,slides=self.slides=$scope.slides=[],currentIndex=-1;self.currentSlide=null;var destroyed=!1;self.select=$scope.select=function(nextSlide,direction){function goNext(){destroyed||(angular.extend(nextSlide,{direction:direction,active:!0}),angular.extend(self.currentSlide||{},{direction:direction,active:!1}),$animate.enabled()&&!$scope.noTransition&&nextSlide.$element&&($scope.$currentTransition=!0,nextSlide.$element.one("$animate:close",function(){$scope.$currentTransition=null})),self.currentSlide=nextSlide,currentIndex=nextIndex,restartTimer())}var nextIndex=self.indexOfSlide(nextSlide);void 0===direction&&(direction=nextIndex>self.getCurrentIndex()?"next":"prev"),nextSlide&&nextSlide!==self.currentSlide&&goNext()},$scope.$on("$destroy",function(){destroyed=!0}),self.getCurrentIndex=function(){return self.currentSlide&&angular.isDefined(self.currentSlide.index)?+self.currentSlide.index:currentIndex},self.indexOfSlide=function(slide){return angular.isDefined(slide.index)?+slide.index:slides.indexOf(slide)},$scope.next=function(){var newIndex=(self.getCurrentIndex()+1)%slides.length;if(!$scope.$currentTransition)return self.select(getSlideByIndex(newIndex),"next")},$scope.prev=function(){var newIndex=self.getCurrentIndex()-1<0?slides.length-1:self.getCurrentIndex()-1;if(!$scope.$currentTransition)return self.select(getSlideByIndex(newIndex),"prev")},$scope.isActive=function(slide){return self.currentSlide===slide},$scope.$watch("interval",restartTimer),$scope.$on("$destroy",resetTimer),$scope.play=function(){isPlaying||(isPlaying=!0,restartTimer())},$scope.pause=function(){$scope.noPause||(isPlaying=!1,resetTimer())},self.addSlide=function(slide,element){slide.$element=element,slides.push(slide),1===slides.length||slide.active?(self.select(slides[slides.length-1]),1==slides.length&&$scope.play()):slide.active=!1},self.removeSlide=function(slide){angular.isDefined(slide.index)&&slides.sort(function(a,b){return+a.index>+b.index});var index=slides.indexOf(slide);slides.splice(index,1),slides.length>0&&slide.active?index>=slides.length?self.select(slides[index-1]):self.select(slides[index]):currentIndex>index&&currentIndex--}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"template/carousel/carousel.html",scope:{interval:"=",noTransition:"=",noPause:"="}}}]).directive("slide",function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/carousel/slide.html",scope:{active:"=?",index:"=?"},link:function(scope,element,attrs,carouselCtrl){carouselCtrl.addSlide(scope,element),scope.$on("$destroy",function(){carouselCtrl.removeSlide(scope)}),scope.$watch("active",function(active){active&&carouselCtrl.select(scope)})}}}).animation(".item",["$animate",function($animate){return{beforeAddClass:function(element,className,done){if("active"==className&&element.parent()&&!element.parent().scope().noTransition){var stopped=!1,direction=element.isolateScope().direction,directionClass="next"==direction?"left":"right";return element.addClass(direction),$animate.addClass(element,directionClass).then(function(){stopped||element.removeClass(directionClass+" "+direction),done()}),function(){stopped=!0}}done()},beforeRemoveClass:function(element,className,done){if("active"==className&&element.parent()&&!element.parent().scope().noTransition){var stopped=!1,direction=element.isolateScope().direction,directionClass="next"==direction?"left":"right";return $animate.addClass(element,directionClass).then(function(){stopped||element.removeClass(directionClass),done()}),function(){stopped=!0}}done()}}}]),angular.module("ui.bootstrap.dateparser",[]).service("dateParser",["$locale","orderByFilter",function($locale,orderByFilter){function createParser(format){var map=[],regex=format.split("");return angular.forEach(formatCodeToRegex,function(data,code){var index=format.indexOf(code);if(index>-1){format=format.split(""),regex[index]="("+data.regex+")",format[index]="$";for(var i=index+1,n=index+code.length;i<n;i++)regex[i]="",format[i]="$";format=format.join(""),map.push({index:index,apply:data.apply})}}),{regex:new RegExp("^"+regex.join("")+"$"),map:orderByFilter(map,"index")}}function isValid(year,month,date){return!(date<1)&&(1===month&&date>28?29===date&&(year%4===0&&year%100!==0||year%400===0):3!==month&&5!==month&&8!==month&&10!==month||date<31)}var SPECIAL_CHARACTERS_REGEXP=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;this.parsers={};var formatCodeToRegex={yyyy:{regex:"\\d{4}",apply:function(value){this.year=+value}},yy:{regex:"\\d{2}",apply:function(value){this.year=+value+2e3}},y:{regex:"\\d{1,4}",apply:function(value){this.year=+value}},MMMM:{regex:$locale.DATETIME_FORMATS.MONTH.join("|"),apply:function(value){this.month=$locale.DATETIME_FORMATS.MONTH.indexOf(value)}},MMM:{regex:$locale.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(value){this.month=$locale.DATETIME_FORMATS.SHORTMONTH.indexOf(value)}},MM:{regex:"0[1-9]|1[0-2]",apply:function(value){this.month=value-1}},M:{regex:"[1-9]|1[0-2]",apply:function(value){this.month=value-1}},dd:{regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(value){this.date=+value}},d:{regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(value){this.date=+value}},EEEE:{regex:$locale.DATETIME_FORMATS.DAY.join("|")},EEE:{regex:$locale.DATETIME_FORMATS.SHORTDAY.join("|")},HH:{regex:"(?:0|1)[0-9]|2[0-3]",apply:function(value){this.hours=+value}},H:{regex:"1?[0-9]|2[0-3]",apply:function(value){this.hours=+value}},mm:{regex:"[0-5][0-9]",apply:function(value){this.minutes=+value}},m:{regex:"[0-9]|[1-5][0-9]",apply:function(value){this.minutes=+value}},sss:{regex:"[0-9][0-9][0-9]",apply:function(value){this.milliseconds=+value}},ss:{regex:"[0-5][0-9]",apply:function(value){this.seconds=+value}},s:{regex:"[0-9]|[1-5][0-9]",apply:function(value){this.seconds=+value}}};this.parse=function(input,format,baseDate){if(!angular.isString(input)||!format)return input;format=$locale.DATETIME_FORMATS[format]||format,format=format.replace(SPECIAL_CHARACTERS_REGEXP,"\\$&"),this.parsers[format]||(this.parsers[format]=createParser(format));var parser=this.parsers[format],regex=parser.regex,map=parser.map,results=input.match(regex);if(results&&results.length){var fields,dt;fields=baseDate?{year:baseDate.getFullYear(),month:baseDate.getMonth(),date:baseDate.getDate(),hours:baseDate.getHours(),minutes:baseDate.getMinutes(),seconds:baseDate.getSeconds(),milliseconds:baseDate.getMilliseconds()}:{year:1900,month:0,date:1,hours:0,minutes:0,seconds:0,milliseconds:0};for(var i=1,n=results.length;i<n;i++){var mapper=map[i-1];mapper.apply&&mapper.apply.call(fields,results[i])}return isValid(fields.year,fields.month,fields.date)&&(dt=new Date(fields.year,fields.month,fields.date,fields.hours,fields.minutes,fields.seconds,fields.milliseconds||0)),dt}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].documentElement.scrollLeft)}},positionElements:function(hostEl,targetEl,positionStr,appendToBody){var hostElPos,targetElWidth,targetElHeight,targetElPos,positionStrParts=positionStr.split("-"),pos0=positionStrParts[0],pos1=positionStrParts[1]||"center";hostElPos=appendToBody?this.offset(hostEl):this.position(hostEl),targetElWidth=targetEl.prop("offsetWidth"),targetElHeight=targetEl.prop("offsetHeight");var shiftWidth={center:function(){return hostElPos.left+hostElPos.width/2-targetElWidth/2},left:function(){return hostElPos.left},right:function(){return hostElPos.left+hostElPos.width}},shiftHeight={center:function(){return hostElPos.top+hostElPos.height/2-targetElHeight/2},top:function(){return hostElPos.top},bottom:function(){return hostElPos.top+hostElPos.height}};switch(pos0){case"right":targetElPos={top:shiftHeight[pos1](),left:shiftWidth[pos0]()};break;case"left":targetElPos={top:shiftHeight[pos1](),left:hostElPos.left-targetElWidth};break;case"bottom":targetElPos={top:shiftHeight[pos0](),left:shiftWidth[pos1]()};break;default:targetElPos={top:hostElPos.top-targetElHeight,left:shiftWidth[pos1]()}}return targetElPos}}}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).constant("datepickerConfig",{formatDay:"dd",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",datepickerMode:"day",minMode:"day",maxMode:"year",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null,shortcutPropagation:!1}).controller("DatepickerController",["$scope","$attrs","$parse","$interpolate","$timeout","$log","dateFilter","datepickerConfig",function($scope,$attrs,$parse,$interpolate,$timeout,$log,dateFilter,datepickerConfig){var self=this,ngModelCtrl={$setViewValue:angular.noop};this.modes=["day","month","year"],angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","minMode","maxMode","showWeeks","startingDay","yearRange","shortcutPropagation"],function(key,index){self[key]=angular.isDefined($attrs[key])?index<8?$interpolate($attrs[key])($scope.$parent):$scope.$parent.$eval($attrs[key]):datepickerConfig[key]}),angular.forEach(["minDate","maxDate"],function(key){$attrs[key]?$scope.$parent.$watch($parse($attrs[key]),function(value){self[key]=value?new Date(value):null,self.refreshView()}):self[key]=datepickerConfig[key]?new Date(datepickerConfig[key]):null}),$scope.datepickerMode=$scope.datepickerMode||datepickerConfig.datepickerMode,$scope.maxMode=self.maxMode,$scope.uniqueId="datepicker-"+$scope.$id+"-"+Math.floor(1e4*Math.random()),angular.isDefined($attrs.initDate)?(this.activeDate=$scope.$parent.$eval($attrs.initDate)||new Date,$scope.$parent.$watch($attrs.initDate,function(initDate){initDate&&(ngModelCtrl.$isEmpty(ngModelCtrl.$modelValue)||ngModelCtrl.$invalid)&&(self.activeDate=initDate,self.refreshView())})):this.activeDate=new Date,$scope.isActive=function(dateObject){return 0===self.compare(dateObject.date,self.activeDate)&&($scope.activeDateId=dateObject.uid,!0)},this.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=function(){self.render()}},this.render=function(){if(ngModelCtrl.$viewValue){var date=new Date(ngModelCtrl.$viewValue),isValid=!isNaN(date);isValid?this.activeDate=date:$log.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),ngModelCtrl.$setValidity("date",isValid)}this.refreshView()},this.refreshView=function(){if(this.element){this._refreshView();var date=ngModelCtrl.$viewValue?new Date(ngModelCtrl.$viewValue):null;ngModelCtrl.$setValidity("date-disabled",!date||this.element&&!this.isDisabled(date))}},this.createDateObject=function(date,format){var model=ngModelCtrl.$viewValue?new Date(ngModelCtrl.$viewValue):null;return{date:date,label:dateFilter(date,format),selected:model&&0===this.compare(date,model),disabled:this.isDisabled(date),current:0===this.compare(date,new Date),customClass:this.customClass(date)}},this.isDisabled=function(date){return this.minDate&&this.compare(date,this.minDate)<0||this.maxDate&&this.compare(date,this.maxDate)>0||$attrs.dateDisabled&&$scope.dateDisabled({date:date,mode:$scope.datepickerMode})},this.customClass=function(date){return $scope.customClass({date:date,mode:$scope.datepickerMode})},this.split=function(arr,size){for(var arrays=[];arr.length>0;)arrays.push(arr.splice(0,size));return arrays},$scope.select=function(date){if($scope.datepickerMode===self.minMode){var dt=ngModelCtrl.$viewValue?new Date(ngModelCtrl.$viewValue):new Date(0,0,0,0,0,0,0);dt.setFullYear(date.getFullYear(),date.getMonth(),date.getDate()),ngModelCtrl.$setViewValue(dt),ngModelCtrl.$render()}else self.activeDate=date,$scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)-1]},$scope.move=function(direction){var year=self.activeDate.getFullYear()+direction*(self.step.years||0),month=self.activeDate.getMonth()+direction*(self.step.months||0);self.activeDate.setFullYear(year,month,1),self.refreshView()},$scope.toggleMode=function(direction){direction=direction||1,$scope.datepickerMode===self.maxMode&&1===direction||$scope.datepickerMode===self.minMode&&direction===-1||($scope.datepickerMode=self.modes[self.modes.indexOf($scope.datepickerMode)+direction])},$scope.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};var focusElement=function(){$timeout(function(){self.element[0].focus()},0,!1)};$scope.$on("datepicker.focus",focusElement),$scope.keydown=function(evt){var key=$scope.keys[evt.which];if(key&&!evt.shiftKey&&!evt.altKey)if(evt.preventDefault(),self.shortcutPropagation||evt.stopPropagation(),"enter"===key||"space"===key){if(self.isDisabled(self.activeDate))return;$scope.select(self.activeDate),focusElement()}else!evt.ctrlKey||"up"!==key&&"down"!==key?(self.handleKeyDown(key,evt),self.refreshView()):($scope.toggleMode("up"===key?1:-1),focusElement())}}]).directive("datepicker",function(){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/datepicker.html",scope:{datepickerMode:"=?",dateDisabled:"&",customClass:"&",shortcutPropagation:"&?"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(scope,element,attrs,ctrls){var datepickerCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&datepickerCtrl.init(ngModelCtrl)}}}).directive("daypicker",["dateFilter",function(dateFilter){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/day.html",require:"^datepicker",link:function(scope,element,attrs,ctrl){function getDaysInMonth(year,month){return 1!==month||year%4!==0||year%100===0&&year%400!==0?DAYS_IN_MONTH[month]:29}function getDates(startDate,n){var dates=new Array(n),current=new Date(startDate),i=0;for(current.setHours(12);i<n;)dates[i++]=new Date(current),current.setDate(current.getDate()+1);return dates}function getISO8601WeekNumber(date){var checkDate=new Date(date);checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();return checkDate.setMonth(0),checkDate.setDate(1),Math.floor(Math.round((time-checkDate)/864e5)/7)+1}scope.showWeeks=ctrl.showWeeks,ctrl.step={months:1},ctrl.element=element;var DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];ctrl._refreshView=function(){var year=ctrl.activeDate.getFullYear(),month=ctrl.activeDate.getMonth(),firstDayOfMonth=new Date(year,month,1),difference=ctrl.startingDay-firstDayOfMonth.getDay(),numDisplayedFromPreviousMonth=difference>0?7-difference:-difference,firstDate=new Date(firstDayOfMonth);numDisplayedFromPreviousMonth>0&&firstDate.setDate(-numDisplayedFromPreviousMonth+1);for(var days=getDates(firstDate,42),i=0;i<42;i++)days[i]=angular.extend(ctrl.createDateObject(days[i],ctrl.formatDay),{secondary:days[i].getMonth()!==month,uid:scope.uniqueId+"-"+i});scope.labels=new Array(7);for(var j=0;j<7;j++)scope.labels[j]={abbr:dateFilter(days[j].date,ctrl.formatDayHeader),full:dateFilter(days[j].date,"EEEE")};if(scope.title=dateFilter(ctrl.activeDate,ctrl.formatDayTitle),scope.rows=ctrl.split(days,7),scope.showWeeks){scope.weekNumbers=[];for(var thursdayIndex=(11-ctrl.startingDay)%7,numWeeks=scope.rows.length,curWeek=0;curWeek<numWeeks;curWeek++)scope.weekNumbers.push(getISO8601WeekNumber(scope.rows[curWeek][thursdayIndex].date))}},ctrl.compare=function(date1,date2){return new Date(date1.getFullYear(),date1.getMonth(),date1.getDate())-new Date(date2.getFullYear(),date2.getMonth(),date2.getDate())},ctrl.handleKeyDown=function(key,evt){var date=ctrl.activeDate.getDate();if("left"===key)date-=1;else if("up"===key)date-=7;else if("right"===key)date+=1;else if("down"===key)date+=7;else if("pageup"===key||"pagedown"===key){var month=ctrl.activeDate.getMonth()+("pageup"===key?-1:1);ctrl.activeDate.setMonth(month,1),date=Math.min(getDaysInMonth(ctrl.activeDate.getFullYear(),ctrl.activeDate.getMonth()),date)}else"home"===key?date=1:"end"===key&&(date=getDaysInMonth(ctrl.activeDate.getFullYear(),ctrl.activeDate.getMonth()));ctrl.activeDate.setDate(date)},ctrl.refreshView()}}}]).directive("monthpicker",["dateFilter",function(dateFilter){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/month.html",require:"^datepicker",link:function(scope,element,attrs,ctrl){ctrl.step={years:1},ctrl.element=element,ctrl._refreshView=function(){for(var months=new Array(12),year=ctrl.activeDate.getFullYear(),i=0;i<12;i++)months[i]=angular.extend(ctrl.createDateObject(new Date(year,i,1),ctrl.formatMonth),{uid:scope.uniqueId+"-"+i});scope.title=dateFilter(ctrl.activeDate,ctrl.formatMonthTitle),scope.rows=ctrl.split(months,3)},ctrl.compare=function(date1,date2){return new Date(date1.getFullYear(),date1.getMonth())-new Date(date2.getFullYear(),date2.getMonth())},ctrl.handleKeyDown=function(key,evt){var date=ctrl.activeDate.getMonth();if("left"===key)date-=1;else if("up"===key)date-=3;else if("right"===key)date+=1;else if("down"===key)date+=3;else if("pageup"===key||"pagedown"===key){var year=ctrl.activeDate.getFullYear()+("pageup"===key?-1:1);ctrl.activeDate.setFullYear(year)}else"home"===key?date=0:"end"===key&&(date=11);ctrl.activeDate.setMonth(date)},ctrl.refreshView()}}}]).directive("yearpicker",["dateFilter",function(dateFilter){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/year.html",require:"^datepicker",link:function(scope,element,attrs,ctrl){function getStartingYear(year){return parseInt((year-1)/range,10)*range+1}var range=ctrl.yearRange;ctrl.step={years:range},ctrl.element=element,ctrl._refreshView=function(){for(var years=new Array(range),i=0,start=getStartingYear(ctrl.activeDate.getFullYear());i<range;i++)years[i]=angular.extend(ctrl.createDateObject(new Date(start+i,0,1),ctrl.formatYear),{uid:scope.uniqueId+"-"+i});scope.title=[years[0].label,years[range-1].label].join(" - "),scope.rows=ctrl.split(years,5)},ctrl.compare=function(date1,date2){return date1.getFullYear()-date2.getFullYear()},ctrl.handleKeyDown=function(key,evt){var date=ctrl.activeDate.getFullYear();"left"===key?date-=1:"up"===key?date-=5:"right"===key?date+=1:"down"===key?date+=5:"pageup"===key||"pagedown"===key?date+=("pageup"===key?-1:1)*ctrl.step.years:"home"===key?date=getStartingYear(ctrl.activeDate.getFullYear()):"end"===key&&(date=getStartingYear(ctrl.activeDate.getFullYear())+range-1),ctrl.activeDate.setFullYear(date)},ctrl.refreshView()}}}]).constant("datepickerPopupConfig",{datepickerPopup:"yyyy-MM-dd",html5Types:{date:"yyyy-MM-dd","datetime-local":"yyyy-MM-ddTHH:mm:ss.sss",month:"yyyy-MM"},currentText:"Today",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","dateParser","datepickerPopupConfig",function($compile,$parse,$document,$position,dateFilter,dateParser,datepickerPopupConfig){return{restrict:"EA",require:"ngModel",scope:{isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",dateDisabled:"&",customClass:"&"},link:function(scope,element,attrs,ngModel){function cameltoDash(string){return string.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})}function parseDate(viewValue){angular.isNumber(viewValue)&&(viewValue=new Date(viewValue));{if(!viewValue)return null;if(angular.isDate(viewValue)&&!isNaN(viewValue))return viewValue;if(angular.isString(viewValue)){var date=dateParser.parse(viewValue,dateFormat,scope.date)||new Date(viewValue);return isNaN(date)?void 0:date}}}function validator(modelValue,viewValue){var value=modelValue||viewValue;if(angular.isNumber(value)&&(value=new Date(value)),value){if(angular.isDate(value)&&!isNaN(value))return!0;if(angular.isString(value)){var date=dateParser.parse(value,dateFormat)||new Date(value);return!isNaN(date)}return!1}return!0}var dateFormat,closeOnDateSelection=angular.isDefined(attrs.closeOnDateSelection)?scope.$parent.$eval(attrs.closeOnDateSelection):datepickerPopupConfig.closeOnDateSelection,appendToBody=angular.isDefined(attrs.datepickerAppendToBody)?scope.$parent.$eval(attrs.datepickerAppendToBody):datepickerPopupConfig.appendToBody;scope.showButtonBar=angular.isDefined(attrs.showButtonBar)?scope.$parent.$eval(attrs.showButtonBar):datepickerPopupConfig.showButtonBar,scope.getText=function(key){return scope[key+"Text"]||datepickerPopupConfig[key+"Text"]};var isHtml5DateInput=!1;if(datepickerPopupConfig.html5Types[attrs.type]?(dateFormat=datepickerPopupConfig.html5Types[attrs.type],
isHtml5DateInput=!0):(dateFormat=attrs.datepickerPopup||datepickerPopupConfig.datepickerPopup,attrs.$observe("datepickerPopup",function(value,oldValue){var newDateFormat=value||datepickerPopupConfig.datepickerPopup;if(newDateFormat!==dateFormat&&(dateFormat=newDateFormat,ngModel.$modelValue=null,!dateFormat))throw new Error("datepickerPopup must have a date format specified.")})),!dateFormat)throw new Error("datepickerPopup must have a date format specified.");if(isHtml5DateInput&&attrs.datepickerPopup)throw new Error("HTML5 date input types do not support custom formats.");var popupEl=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");popupEl.attr({"ng-model":"date","ng-change":"dateSelection()"});var datepickerEl=angular.element(popupEl.children()[0]);if(isHtml5DateInput&&"month"==attrs.type&&(datepickerEl.attr("datepicker-mode",'"month"'),datepickerEl.attr("min-mode","month")),attrs.datepickerOptions){var options=scope.$parent.$eval(attrs.datepickerOptions);options.initDate&&(scope.initDate=options.initDate,datepickerEl.attr("init-date","initDate"),delete options.initDate),angular.forEach(options,function(value,option){datepickerEl.attr(cameltoDash(option),value)})}scope.watchData={},angular.forEach(["minDate","maxDate","datepickerMode","initDate","shortcutPropagation"],function(key){if(attrs[key]){var getAttribute=$parse(attrs[key]);if(scope.$parent.$watch(getAttribute,function(value){scope.watchData[key]=value}),datepickerEl.attr(cameltoDash(key),"watchData."+key),"datepickerMode"===key){var setAttribute=getAttribute.assign;scope.$watch("watchData."+key,function(value,oldvalue){value!==oldvalue&&setAttribute(scope.$parent,value)})}}}),attrs.dateDisabled&&datepickerEl.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),attrs.showWeeks&&datepickerEl.attr("show-weeks",attrs.showWeeks),attrs.customClass&&datepickerEl.attr("custom-class","customClass({ date: date, mode: mode })"),isHtml5DateInput?ngModel.$formatters.push(function(value){return scope.date=value,value}):(ngModel.$$parserName="date",ngModel.$validators.date=validator,ngModel.$parsers.unshift(parseDate),ngModel.$formatters.push(function(value){return scope.date=value,ngModel.$isEmpty(value)?value:dateFilter(value,dateFormat)})),scope.dateSelection=function(dt){angular.isDefined(dt)&&(scope.date=dt);var date=scope.date?dateFilter(scope.date,dateFormat):"";element.val(date),ngModel.$setViewValue(date),closeOnDateSelection&&(scope.isOpen=!1,element[0].focus())},ngModel.$viewChangeListeners.push(function(){scope.date=dateParser.parse(ngModel.$viewValue,dateFormat,scope.date)||new Date(ngModel.$viewValue)});var documentClickBind=function(event){scope.isOpen&&event.target!==element[0]&&scope.$apply(function(){scope.isOpen=!1})},keydown=function(evt,noApply){scope.keydown(evt)};element.bind("keydown",keydown),scope.keydown=function(evt){27===evt.which?(evt.preventDefault(),scope.isOpen&&evt.stopPropagation(),scope.close()):40!==evt.which||scope.isOpen||(scope.isOpen=!0)},scope.$watch("isOpen",function(value){value?(scope.$broadcast("datepicker.focus"),scope.position=appendToBody?$position.offset(element):$position.position(element),scope.position.top=scope.position.top+element.prop("offsetHeight"),$document.bind("click",documentClickBind)):$document.unbind("click",documentClickBind)}),scope.select=function(date){if("today"===date){var today=new Date;angular.isDate(scope.date)?(date=new Date(scope.date),date.setFullYear(today.getFullYear(),today.getMonth(),today.getDate())):date=new Date(today.setHours(0,0,0,0))}scope.dateSelection(date)},scope.close=function(){scope.isOpen=!1,element[0].focus()};var $popup=$compile(popupEl)(scope);popupEl.remove(),appendToBody?$document.find("body").append($popup):element.after($popup),scope.$on("$destroy",function(){$popup.remove(),element.unbind("keydown",keydown),$document.unbind("click",documentClickBind)})}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/datepicker/popup.html",link:function(scope,element,attrs){element.bind("click",function(event){event.preventDefault(),event.stopPropagation()})}}}),angular.module("ui.bootstrap.dropdown",["ui.bootstrap.position"]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document","$rootScope",function($document,$rootScope){var openScope=null;this.open=function(dropdownScope){openScope||($document.bind("click",closeDropdown),$document.bind("keydown",escapeKeyBind)),openScope&&openScope!==dropdownScope&&(openScope.isOpen=!1),openScope=dropdownScope},this.close=function(dropdownScope){openScope===dropdownScope&&(openScope=null,$document.unbind("click",closeDropdown),$document.unbind("keydown",escapeKeyBind))};var closeDropdown=function(evt){if(openScope&&(!evt||"disabled"!==openScope.getAutoClose())){var toggleElement=openScope.getToggleElement();if(!(evt&&toggleElement&&toggleElement[0].contains(evt.target))){var $element=openScope.getElement();evt&&"outsideClick"===openScope.getAutoClose()&&$element&&$element[0].contains(evt.target)||(openScope.isOpen=!1,$rootScope.$$phase||openScope.$apply())}}},escapeKeyBind=function(evt){27===evt.which&&(openScope.focusToggleElement(),closeDropdown())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate","$position","$document",function($scope,$attrs,$parse,dropdownConfig,dropdownService,$animate,$position,$document){var getIsOpen,self=this,scope=$scope.$new(),openClass=dropdownConfig.openClass,setIsOpen=angular.noop,toggleInvoker=$attrs.onToggle?$parse($attrs.onToggle):angular.noop,appendToBody=!1;this.init=function(element){self.$element=element,$attrs.isOpen&&(getIsOpen=$parse($attrs.isOpen),setIsOpen=getIsOpen.assign,$scope.$watch(getIsOpen,function(value){scope.isOpen=!!value})),appendToBody=angular.isDefined($attrs.dropdownAppendToBody),appendToBody&&self.dropdownMenu&&($document.find("body").append(self.dropdownMenu),element.on("$destroy",function(){self.dropdownMenu.remove()}))},this.toggle=function(open){return scope.isOpen=arguments.length?!!open:!scope.isOpen},this.isOpen=function(){return scope.isOpen},scope.getToggleElement=function(){return self.toggleElement},scope.getAutoClose=function(){return $attrs.autoClose||"always"},scope.getElement=function(){return self.$element},scope.focusToggleElement=function(){self.toggleElement&&self.toggleElement[0].focus()},scope.$watch("isOpen",function(isOpen,wasOpen){if(appendToBody&&self.dropdownMenu){var pos=$position.positionElements(self.$element,self.dropdownMenu,"bottom-left",!0);self.dropdownMenu.css({top:pos.top+"px",left:pos.left+"px",display:isOpen?"block":"none"})}$animate[isOpen?"addClass":"removeClass"](self.$element,openClass),isOpen?(scope.focusToggleElement(),dropdownService.open(scope)):dropdownService.close(scope),setIsOpen($scope,isOpen),angular.isDefined(isOpen)&&isOpen!==wasOpen&&toggleInvoker($scope,{open:!!isOpen})}),$scope.$on("$locationChangeSuccess",function(){scope.isOpen=!1}),$scope.$on("$destroy",function(){scope.$destroy()})}]).directive("dropdown",function(){return{controller:"DropdownController",link:function(scope,element,attrs,dropdownCtrl){dropdownCtrl.init(element)}}}).directive("dropdownMenu",function(){return{restrict:"AC",require:"?^dropdown",link:function(scope,element,attrs,dropdownCtrl){dropdownCtrl&&(dropdownCtrl.dropdownMenu=element)}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function(scope,element,attrs,dropdownCtrl){if(dropdownCtrl){dropdownCtrl.toggleElement=element;var toggleDropdown=function(event){event.preventDefault(),element.hasClass("disabled")||attrs.disabled||scope.$apply(function(){dropdownCtrl.toggle()})};element.bind("click",toggleDropdown),element.attr({"aria-haspopup":!0,"aria-expanded":!1}),scope.$watch(dropdownCtrl.isOpen,function(isOpen){element.attr("aria-expanded",!!isOpen)}),scope.$on("$destroy",function(){element.unbind("click",toggleDropdown)})}}}}),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var stack=[];return{add:function(key,value){stack.push({key:key,value:value})},get:function(key){for(var i=0;i<stack.length;i++)if(key==stack[i].key)return stack[i]},keys:function(){for(var keys=[],i=0;i<stack.length;i++)keys.push(stack[i].key);return keys},top:function(){return stack[stack.length-1]},remove:function(key){for(var idx=-1,i=0;i<stack.length;i++)if(key==stack[i].key){idx=i;break}return stack.splice(idx,1)[0]},removeTop:function(){return stack.splice(stack.length-1,1)[0]},length:function(){return stack.length}}}}}).directive("modalBackdrop",["$timeout",function($timeout){function linkFn(scope,element,attrs){scope.animate=!1,$timeout(function(){scope.animate=!0})}return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",compile:function(tElement,tAttrs){return tElement.addClass(tAttrs.backdropClass),linkFn}}}]).directive("modalWindow",["$modalStack","$q",function($modalStack,$q){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:function(tElement,tAttrs){return tAttrs.templateUrl||"template/modal/window.html"},link:function(scope,element,attrs){element.addClass(attrs.windowClass||""),scope.size=attrs.size,scope.close=function(evt){var modal=$modalStack.getTop();modal&&modal.value.backdrop&&"static"!=modal.value.backdrop&&evt.target===evt.currentTarget&&(evt.preventDefault(),evt.stopPropagation(),$modalStack.dismiss(modal.key,"backdrop click"))},scope.$isRendered=!0;var modalRenderDeferObj=$q.defer();attrs.$observe("modalRender",function(value){"true"==value&&modalRenderDeferObj.resolve()}),modalRenderDeferObj.promise.then(function(){scope.animate=!0;var inputsWithAutofocus=element[0].querySelectorAll("[autofocus]");inputsWithAutofocus.length?inputsWithAutofocus[0].focus():element[0].focus();var modal=$modalStack.getTop();modal&&$modalStack.modalRendered(modal.key)})}}}]).directive("modalAnimationClass",[function(){return{compile:function(tElement,tAttrs){tAttrs.modalAnimation&&tElement.addClass(tAttrs.modalAnimationClass)}}}]).directive("modalTransclude",function(){return{link:function($scope,$element,$attrs,controller,$transclude){$transclude($scope.$parent,function(clone){$element.empty(),$element.append(clone)})}}}).factory("$modalStack",["$animate","$timeout","$document","$compile","$rootScope","$$stackedMap",function($animate,$timeout,$document,$compile,$rootScope,$$stackedMap){function backdropIndex(){for(var topBackdropIndex=-1,opened=openedWindows.keys(),i=0;i<opened.length;i++)openedWindows.get(opened[i]).value.backdrop&&(topBackdropIndex=i);return topBackdropIndex}function removeModalWindow(modalInstance){var body=$document.find("body").eq(0),modalWindow=openedWindows.get(modalInstance).value;openedWindows.remove(modalInstance),removeAfterAnimate(modalWindow.modalDomEl,modalWindow.modalScope,function(){body.toggleClass(OPENED_MODAL_CLASS,openedWindows.length()>0),checkRemoveBackdrop()})}function checkRemoveBackdrop(){if(backdropDomEl&&backdropIndex()==-1){var backdropScopeRef=backdropScope;removeAfterAnimate(backdropDomEl,backdropScope,function(){backdropScopeRef=null}),backdropDomEl=void 0,backdropScope=void 0}}function removeAfterAnimate(domEl,scope,done){function afterAnimating(){afterAnimating.done||(afterAnimating.done=!0,domEl.remove(),scope.$destroy(),done&&done())}scope.animate=!1,domEl.attr("modal-animation")&&$animate.enabled()?domEl.one("$animate:close",function(){$rootScope.$evalAsync(afterAnimating)}):$timeout(afterAnimating)}function broadcastClosing(modalWindow,resultOrReason,closing){return!modalWindow.value.modalScope.$broadcast("modal.closing",resultOrReason,closing).defaultPrevented}var backdropDomEl,backdropScope,OPENED_MODAL_CLASS="modal-open",openedWindows=$$stackedMap.createNew(),$modalStack={};return $rootScope.$watch(backdropIndex,function(newBackdropIndex){backdropScope&&(backdropScope.index=newBackdropIndex)}),$document.bind("keydown",function(evt){var modal;27===evt.which&&(modal=openedWindows.top(),modal&&modal.value.keyboard&&(evt.preventDefault(),$rootScope.$apply(function(){$modalStack.dismiss(modal.key,"escape key press")})))}),$modalStack.open=function(modalInstance,modal){var modalOpener=$document[0].activeElement;openedWindows.add(modalInstance,{deferred:modal.deferred,renderDeferred:modal.renderDeferred,modalScope:modal.scope,backdrop:modal.backdrop,keyboard:modal.keyboard});var body=$document.find("body").eq(0),currBackdropIndex=backdropIndex();if(currBackdropIndex>=0&&!backdropDomEl){backdropScope=$rootScope.$new(!0),backdropScope.index=currBackdropIndex;var angularBackgroundDomEl=angular.element('<div modal-backdrop="modal-backdrop"></div>');angularBackgroundDomEl.attr("backdrop-class",modal.backdropClass),modal.animation&&angularBackgroundDomEl.attr("modal-animation","true"),backdropDomEl=$compile(angularBackgroundDomEl)(backdropScope),body.append(backdropDomEl)}var angularDomEl=angular.element('<div modal-window="modal-window"></div>');angularDomEl.attr({"template-url":modal.windowTemplateUrl,"window-class":modal.windowClass,size:modal.size,index:openedWindows.length()-1,animate:"animate"}).html(modal.content),modal.animation&&angularDomEl.attr("modal-animation","true");var modalDomEl=$compile(angularDomEl)(modal.scope);openedWindows.top().value.modalDomEl=modalDomEl,openedWindows.top().value.modalOpener=modalOpener,body.append(modalDomEl),body.addClass(OPENED_MODAL_CLASS)},$modalStack.close=function(modalInstance,result){var modalWindow=openedWindows.get(modalInstance);return modalWindow&&broadcastClosing(modalWindow,result,!0)?(modalWindow.value.deferred.resolve(result),removeModalWindow(modalInstance),modalWindow.value.modalOpener.focus(),!0):!modalWindow},$modalStack.dismiss=function(modalInstance,reason){var modalWindow=openedWindows.get(modalInstance);return modalWindow&&broadcastClosing(modalWindow,reason,!1)?(modalWindow.value.deferred.reject(reason),removeModalWindow(modalInstance),modalWindow.value.modalOpener.focus(),!0):!modalWindow},$modalStack.dismissAll=function(reason){for(var topModal=this.getTop();topModal&&this.dismiss(topModal.key,reason);)topModal=this.getTop()},$modalStack.getTop=function(){return openedWindows.top()},$modalStack.modalRendered=function(modalInstance){var modalWindow=openedWindows.get(modalInstance);modalWindow&&modalWindow.value.renderDeferred.resolve()},$modalStack}]).provider("$modal",function(){var $modalProvider={options:{animation:!0,backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$templateRequest","$controller","$modalStack",function($injector,$rootScope,$q,$templateRequest,$controller,$modalStack){function getTemplatePromise(options){return options.template?$q.when(options.template):$templateRequest(angular.isFunction(options.templateUrl)?options.templateUrl():options.templateUrl)}function getResolvePromises(resolves){var promisesArr=[];return angular.forEach(resolves,function(value){(angular.isFunction(value)||angular.isArray(value))&&promisesArr.push($q.when($injector.invoke(value)))}),promisesArr}var $modal={};return $modal.open=function(modalOptions){var modalResultDeferred=$q.defer(),modalOpenedDeferred=$q.defer(),modalRenderDeferred=$q.defer(),modalInstance={result:modalResultDeferred.promise,opened:modalOpenedDeferred.promise,rendered:modalRenderDeferred.promise,close:function(result){return $modalStack.close(modalInstance,result)},dismiss:function(reason){return $modalStack.dismiss(modalInstance,reason)}};if(modalOptions=angular.extend({},$modalProvider.options,modalOptions),modalOptions.resolve=modalOptions.resolve||{},!modalOptions.template&&!modalOptions.templateUrl)throw new Error("One of template or templateUrl options is required.");var templateAndResolvePromise=$q.all([getTemplatePromise(modalOptions)].concat(getResolvePromises(modalOptions.resolve)));return templateAndResolvePromise.then(function(tplAndVars){var modalScope=(modalOptions.scope||$rootScope).$new();modalScope.$close=modalInstance.close,modalScope.$dismiss=modalInstance.dismiss;var ctrlInstance,ctrlLocals={},resolveIter=1;modalOptions.controller&&(ctrlLocals.$scope=modalScope,ctrlLocals.$modalInstance=modalInstance,angular.forEach(modalOptions.resolve,function(value,key){ctrlLocals[key]=tplAndVars[resolveIter++]}),ctrlInstance=$controller(modalOptions.controller,ctrlLocals),modalOptions.controllerAs&&(modalScope[modalOptions.controllerAs]=ctrlInstance)),$modalStack.open(modalInstance,{scope:modalScope,deferred:modalResultDeferred,renderDeferred:modalRenderDeferred,content:tplAndVars[0],animation:modalOptions.animation,backdrop:modalOptions.backdrop,keyboard:modalOptions.keyboard,backdropClass:modalOptions.backdropClass,windowClass:modalOptions.windowClass,windowTemplateUrl:modalOptions.windowTemplateUrl,size:modalOptions.size})},function(reason){modalResultDeferred.reject(reason)}),templateAndResolvePromise.then(function(){modalOpenedDeferred.resolve(!0)},function(reason){modalOpenedDeferred.reject(reason)}),modalInstance},$modal}]};return $modalProvider}),angular.module("ui.bootstrap.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse",function($scope,$attrs,$parse){var self=this,ngModelCtrl={$setViewValue:angular.noop},setNumPages=$attrs.numPages?$parse($attrs.numPages).assign:angular.noop;this.init=function(ngModelCtrl_,config){ngModelCtrl=ngModelCtrl_,this.config=config,ngModelCtrl.$render=function(){self.render()},$attrs.itemsPerPage?$scope.$parent.$watch($parse($attrs.itemsPerPage),function(value){self.itemsPerPage=parseInt(value,10),$scope.totalPages=self.calculateTotalPages()}):this.itemsPerPage=config.itemsPerPage,$scope.$watch("totalItems",function(){$scope.totalPages=self.calculateTotalPages()}),$scope.$watch("totalPages",function(value){setNumPages($scope.$parent,value),$scope.page>value?$scope.selectPage(value):ngModelCtrl.$render()})},this.calculateTotalPages=function(){var totalPages=this.itemsPerPage<1?1:Math.ceil($scope.totalItems/this.itemsPerPage);return Math.max(totalPages||0,1)},this.render=function(){$scope.page=parseInt(ngModelCtrl.$viewValue,10)||1},$scope.selectPage=function(page,evt){$scope.page!==page&&page>0&&page<=$scope.totalPages&&(evt&&evt.target&&evt.target.blur(),ngModelCtrl.$setViewValue(page),ngModelCtrl.$render())},$scope.getText=function(key){return $scope[key+"Text"]||self.config[key+"Text"]},$scope.noPrevious=function(){return 1===$scope.page},$scope.noNext=function(){return $scope.page===$scope.totalPages}}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function($parse,paginationConfig){return{restrict:"EA",scope:{totalItems:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@"},require:["pagination","?ngModel"],controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(scope,element,attrs,ctrls){function makePage(number,text,isActive){return{number:number,text:text,active:isActive}}function getPages(currentPage,totalPages){var pages=[],startPage=1,endPage=totalPages,isMaxSized=angular.isDefined(maxSize)&&maxSize<totalPages;isMaxSized&&(rotate?(startPage=Math.max(currentPage-Math.floor(maxSize/2),1),endPage=startPage+maxSize-1,endPage>totalPages&&(endPage=totalPages,startPage=endPage-maxSize+1)):(startPage=(Math.ceil(currentPage/maxSize)-1)*maxSize+1,endPage=Math.min(startPage+maxSize-1,totalPages)));for(var number=startPage;number<=endPage;number++){var page=makePage(number,number,number===currentPage);pages.push(page)}if(isMaxSized&&!rotate){if(startPage>1){var previousPageSet=makePage(startPage-1,"...",!1);pages.unshift(previousPageSet)}if(endPage<totalPages){var nextPageSet=makePage(endPage+1,"...",!1);pages.push(nextPageSet)}}return pages}var paginationCtrl=ctrls[0],ngModelCtrl=ctrls[1];if(ngModelCtrl){var maxSize=angular.isDefined(attrs.maxSize)?scope.$parent.$eval(attrs.maxSize):paginationConfig.maxSize,rotate=angular.isDefined(attrs.rotate)?scope.$parent.$eval(attrs.rotate):paginationConfig.rotate;scope.boundaryLinks=angular.isDefined(attrs.boundaryLinks)?scope.$parent.$eval(attrs.boundaryLinks):paginationConfig.boundaryLinks,scope.directionLinks=angular.isDefined(attrs.directionLinks)?scope.$parent.$eval(attrs.directionLinks):paginationConfig.directionLinks,paginationCtrl.init(ngModelCtrl,paginationConfig),attrs.maxSize&&scope.$parent.$watch($parse(attrs.maxSize),function(value){maxSize=parseInt(value,10),paginationCtrl.render()});var originalRender=paginationCtrl.render;paginationCtrl.render=function(){originalRender(),scope.page>0&&scope.page<=scope.totalPages&&(scope.pages=getPages(scope.page,scope.totalPages))}}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:" Previous",nextText:"Next ",align:!0}).directive("pager",["pagerConfig",function(pagerConfig){return{restrict:"EA",scope:{totalItems:"=",previousText:"@",nextText:"@"},require:["pager","?ngModel"],controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(scope,element,attrs,ctrls){var paginationCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&(scope.align=angular.isDefined(attrs.align)?scope.$parent.$eval(attrs.align):pagerConfig.align,paginationCtrl.init(ngModelCtrl,pagerConfig))}}}]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function snake_case(name){var regexp=/[A-Z]/g,separator="-";return name.replace(regexp,function(letter,pos){return(pos?separator:"")+letter.toLowerCase()})}var defaultOptions={placement:"top",animation:!0,popupDelay:0,useContentExp:!1},triggerMap={mouseenter:"mouseleave",click:"click",focus:"blur"},globalOptions={};this.options=function(value){angular.extend(globalOptions,value)},this.setTriggers=function(triggers){angular.extend(triggerMap,triggers)},this.$get=["$window","$compile","$timeout","$document","$position","$interpolate",function($window,$compile,$timeout,$document,$position,$interpolate){return function(type,prefix,defaultTriggerShow,options){function getTriggers(trigger){var show=trigger||options.trigger||defaultTriggerShow,hide=triggerMap[show]||show;return{show:show,hide:hide}}options=angular.extend({},defaultOptions,globalOptions,options);var directiveName=snake_case(type),startSym=$interpolate.startSymbol(),endSym=$interpolate.endSymbol(),template="<div "+directiveName+'-popup title="'+startSym+"title"+endSym+'" '+(options.useContentExp?'content-exp="contentExp()" ':'content="'+startSym+"content"+endSym+'" ')+'placement="'+startSym+"placement"+endSym+'" popup-class="'+startSym+"popupClass"+endSym+'" animation="animation" is-open="isOpen"origin-scope="origScope" ></div>';return{restrict:"EA",compile:function(tElem,tAttrs){var tooltipLinker=$compile(template);return function(scope,element,attrs,tooltipCtrl){function toggleTooltipBind(){ttScope.isOpen?hideTooltipBind():showTooltipBind()}function showTooltipBind(){hasEnableExp&&!scope.$eval(attrs[prefix+"Enable"])||(prepareTooltip(),ttScope.popupDelay?popupTimeout||(popupTimeout=$timeout(show,ttScope.popupDelay,!1),popupTimeout.then(function(reposition){reposition()})):show()())}function hideTooltipBind(){scope.$apply(function(){hide()})}function show(){return popupTimeout=null,transitionTimeout&&($timeout.cancel(transitionTimeout),transitionTimeout=null),(options.useContentExp?ttScope.contentExp():ttScope.content)?(createTooltip(),tooltip.css({top:0,left:0,display:"block"}),ttScope.$digest(),positionTooltip(),ttScope.isOpen=!0,ttScope.$apply(),positionTooltip):angular.noop}function hide(){ttScope.isOpen=!1,$timeout.cancel(popupTimeout),popupTimeout=null,ttScope.animation?transitionTimeout||(transitionTimeout=$timeout(removeTooltip,500)):removeTooltip()}function createTooltip(){tooltip&&removeTooltip(),tooltipLinkedScope=ttScope.$new(),tooltip=tooltipLinker(tooltipLinkedScope,function(tooltip){appendToBody?$document.find("body").append(tooltip):element.after(tooltip)}),tooltipLinkedScope.$watch(function(){$timeout(positionTooltip,0,!1)}),options.useContentExp&&tooltipLinkedScope.$watch("contentExp()",function(val){!val&&ttScope.isOpen&&hide()})}function removeTooltip(){transitionTimeout=null,tooltip&&(tooltip.remove(),tooltip=null),tooltipLinkedScope&&(tooltipLinkedScope.$destroy(),tooltipLinkedScope=null)}function prepareTooltip(){prepPopupClass(),prepPlacement(),prepPopupDelay()}function prepPopupClass(){ttScope.popupClass=attrs[prefix+"Class"]}function prepPlacement(){var val=attrs[prefix+"Placement"];ttScope.placement=angular.isDefined(val)?val:options.placement}function prepPopupDelay(){var val=attrs[prefix+"PopupDelay"],delay=parseInt(val,10);ttScope.popupDelay=isNaN(delay)?options.popupDelay:delay}function prepTriggers(){var val=attrs[prefix+"Trigger"];unregisterTriggers(),triggers=getTriggers(val),triggers.show===triggers.hide?element.bind(triggers.show,toggleTooltipBind):(element.bind(triggers.show,showTooltipBind),element.bind(triggers.hide,hideTooltipBind))}var tooltip,tooltipLinkedScope,transitionTimeout,popupTimeout,appendToBody=!!angular.isDefined(options.appendToBody)&&options.appendToBody,triggers=getTriggers(void 0),hasEnableExp=angular.isDefined(attrs[prefix+"Enable"]),ttScope=scope.$new(!0),positionTooltip=function(){if(tooltip){var ttPosition=$position.positionElements(element,tooltip,ttScope.placement,appendToBody);ttPosition.top+="px",ttPosition.left+="px",tooltip.css(ttPosition)}};ttScope.origScope=scope,ttScope.isOpen=!1,ttScope.contentExp=function(){return scope.$eval(attrs[type])},options.useContentExp||attrs.$observe(type,function(val){ttScope.content=val,!val&&ttScope.isOpen&&hide()}),attrs.$observe("disabled",function(val){val&&ttScope.isOpen&&hide()}),attrs.$observe(prefix+"Title",function(val){ttScope.title=val});var unregisterTriggers=function(){element.unbind(triggers.show,showTooltipBind),element.unbind(triggers.hide,hideTooltipBind)};prepTriggers();var animation=scope.$eval(attrs[prefix+"Animation"]);ttScope.animation=angular.isDefined(animation)?!!animation:options.animation;var appendToBodyVal=scope.$eval(attrs[prefix+"AppendToBody"]);appendToBody=angular.isDefined(appendToBodyVal)?appendToBodyVal:appendToBody,appendToBody&&scope.$on("$locationChangeSuccess",function(){ttScope.isOpen&&hide()}),scope.$on("$destroy",function(){$timeout.cancel(transitionTimeout),$timeout.cancel(popupTimeout),unregisterTriggers(),removeTooltip(),ttScope=null})}}}}}]}).directive("tooltipTemplateTransclude",["$animate","$sce","$compile","$templateRequest",function($animate,$sce,$compile,$templateRequest){return{link:function(scope,elem,attrs){var currentScope,previousElement,currentElement,origScope=scope.$eval(attrs.tooltipTemplateTranscludeScope),changeCounter=0,cleanupLastIncludeContent=function(){previousElement&&(previousElement.remove(),previousElement=null),currentScope&&(currentScope.$destroy(),currentScope=null),currentElement&&($animate.leave(currentElement).then(function(){previousElement=null}),previousElement=currentElement,currentElement=null)};scope.$watch($sce.parseAsResourceUrl(attrs.tooltipTemplateTransclude),function(src){var thisChangeId=++changeCounter;src?($templateRequest(src,!0).then(function(response){if(thisChangeId===changeCounter){var newScope=origScope.$new(),template=response,clone=$compile(template)(newScope,function(clone){cleanupLastIncludeContent(),$animate.enter(clone,elem)});currentScope=newScope,currentElement=clone,currentScope.$emit("$includeContentLoaded",src)}},function(){thisChangeId===changeCounter&&(cleanupLastIncludeContent(),scope.$emit("$includeContentError",src))}),scope.$emit("$includeContentRequested",src)):cleanupLastIncludeContent()}),scope.$on("$destroy",cleanupLastIncludeContent)}}}]).directive("tooltipClasses",function(){return{restrict:"A",link:function(scope,element,attrs){scope.placement&&element.addClass(scope.placement),scope.popupClass&&element.addClass(scope.popupClass),scope.animation()&&element.addClass(attrs.tooltipAnimationClass)}}}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function($tooltip){return $tooltip("tooltip","tooltip","mouseenter")}]).directive("tooltipTemplatePopup",function(){return{restrict:"EA",replace:!0,scope:{contentExp:"&",placement:"@",popupClass:"@",animation:"&",isOpen:"&",originScope:"&"},templateUrl:"template/tooltip/tooltip-template-popup.html"}}).directive("tooltipTemplate",["$tooltip",function($tooltip){return $tooltip("tooltipTemplate","tooltip","mouseenter",{useContentExp:!0})}]).directive("tooltipHtmlPopup",function(){return{restrict:"EA",replace:!0,scope:{contentExp:"&",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-popup.html"}}).directive("tooltipHtml",["$tooltip",function($tooltip){return $tooltip("tooltipHtml","tooltip","mouseenter",{useContentExp:!0})}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).value("tooltipHtmlUnsafeSuppressDeprecated",!1).directive("tooltipHtmlUnsafe",["$tooltip","tooltipHtmlUnsafeSuppressDeprecated","$log",function($tooltip,tooltipHtmlUnsafeSuppressDeprecated,$log){return tooltipHtmlUnsafeSuppressDeprecated||$log.warn("tooltip-html-unsafe is now deprecated. Use tooltip-html or tooltip-template instead."),$tooltip("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverTemplatePopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",contentExp:"&",placement:"@",popupClass:"@",animation:"&",isOpen:"&",originScope:"&"},templateUrl:"template/popover/popover-template.html"}}).directive("popoverTemplate",["$tooltip",function($tooltip){return $tooltip("popoverTemplate","popover","click",{useContentExp:!0})}]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",popupClass:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$tooltip",function($tooltip){return $tooltip("popover","popover","click")}]),angular.module("ui.bootstrap.progressbar",[]).constant("progressConfig",{animate:!0,max:100}).controller("ProgressController",["$scope","$attrs","progressConfig",function($scope,$attrs,progressConfig){var self=this,animate=angular.isDefined($attrs.animate)?$scope.$parent.$eval($attrs.animate):progressConfig.animate;this.bars=[],$scope.max=angular.isDefined($scope.max)?$scope.max:progressConfig.max,this.addBar=function(bar,element){animate||element.css({transition:"none"}),this.bars.push(bar),bar.$watch("value",function(value){bar.percent=+(100*value/$scope.max).toFixed(2)}),bar.$on("$destroy",function(){element=null,self.removeBar(bar)})},this.removeBar=function(bar){this.bars.splice(this.bars.indexOf(bar),1)}}]).directive("progress",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"progress",scope:{},templateUrl:"template/progressbar/progress.html"}}).directive("bar",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^progress",scope:{value:"=",max:"=?",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,element)}}}).directive("progressbar",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",scope:{value:"=",max:"=?",type:"@"},templateUrl:"template/progressbar/progressbar.html",link:function(scope,element,attrs,progressCtrl){progressCtrl.addBar(scope,angular.element(element.children()[0]))}}}),angular.module("ui.bootstrap.rating",[]).constant("ratingConfig",{
max:5,stateOn:null,stateOff:null}).controller("RatingController",["$scope","$attrs","ratingConfig",function($scope,$attrs,ratingConfig){var ngModelCtrl={$setViewValue:angular.noop};this.init=function(ngModelCtrl_){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=this.render,ngModelCtrl.$formatters.push(function(value){return angular.isNumber(value)&&value<<0!==value&&(value=Math.round(value)),value}),this.stateOn=angular.isDefined($attrs.stateOn)?$scope.$parent.$eval($attrs.stateOn):ratingConfig.stateOn,this.stateOff=angular.isDefined($attrs.stateOff)?$scope.$parent.$eval($attrs.stateOff):ratingConfig.stateOff;var ratingStates=angular.isDefined($attrs.ratingStates)?$scope.$parent.$eval($attrs.ratingStates):new Array(angular.isDefined($attrs.max)?$scope.$parent.$eval($attrs.max):ratingConfig.max);$scope.range=this.buildTemplateObjects(ratingStates)},this.buildTemplateObjects=function(states){for(var i=0,n=states.length;i<n;i++)states[i]=angular.extend({index:i},{stateOn:this.stateOn,stateOff:this.stateOff},states[i]);return states},$scope.rate=function(value){!$scope.readonly&&value>=0&&value<=$scope.range.length&&(ngModelCtrl.$setViewValue(value),ngModelCtrl.$render())},$scope.enter=function(value){$scope.readonly||($scope.value=value),$scope.onHover({value:value})},$scope.reset=function(){$scope.value=ngModelCtrl.$viewValue,$scope.onLeave()},$scope.onKeydown=function(evt){/(37|38|39|40)/.test(evt.which)&&(evt.preventDefault(),evt.stopPropagation(),$scope.rate($scope.value+(38===evt.which||39===evt.which?1:-1)))},this.render=function(){$scope.value=ngModelCtrl.$viewValue}}]).directive("rating",function(){return{restrict:"EA",require:["rating","ngModel"],scope:{readonly:"=?",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0,link:function(scope,element,attrs,ctrls){var ratingCtrl=ctrls[0],ngModelCtrl=ctrls[1];ratingCtrl.init(ngModelCtrl)}}}),angular.module("ui.bootstrap.tabs",[]).controller("TabsetController",["$scope",function($scope){var ctrl=this,tabs=ctrl.tabs=$scope.tabs=[];ctrl.select=function(selectedTab){angular.forEach(tabs,function(tab){tab.active&&tab!==selectedTab&&(tab.active=!1,tab.onDeselect())}),selectedTab.active=!0,selectedTab.onSelect()},ctrl.addTab=function(tab){tabs.push(tab),1===tabs.length&&tab.active!==!1?tab.active=!0:tab.active?ctrl.select(tab):tab.active=!1},ctrl.removeTab=function(tab){var index=tabs.indexOf(tab);if(tab.active&&tabs.length>1&&!destroyed){var newActiveIndex=index==tabs.length-1?index-1:index+1;ctrl.select(tabs[newActiveIndex])}tabs.splice(index,1)};var destroyed;$scope.$on("$destroy",function(){destroyed=!0})}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{type:"@"},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",link:function(scope,element,attrs){scope.vertical=!!angular.isDefined(attrs.vertical)&&scope.$parent.$eval(attrs.vertical),scope.justified=!!angular.isDefined(attrs.justified)&&scope.$parent.$eval(attrs.justified)}}}).directive("tab",["$parse","$log",function($parse,$log){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{active:"=?",heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(elm,attrs,transclude){return function(scope,elm,attrs,tabsetCtrl){scope.$watch("active",function(active){active&&tabsetCtrl.select(scope)}),scope.disabled=!1,attrs.disable&&scope.$parent.$watch($parse(attrs.disable),function(value){scope.disabled=!!value}),attrs.disabled&&($log.warn('Use of "disabled" attribute has been deprecated, please use "disable"'),scope.$parent.$watch($parse(attrs.disabled),function(value){scope.disabled=!!value})),scope.select=function(){scope.disabled||(scope.active=!0)},tabsetCtrl.addTab(scope),scope.$on("$destroy",function(){tabsetCtrl.removeTab(scope)}),scope.$transcludeFn=transclude}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(scope,elm,attrs,tabCtrl){scope.$watch("headingElement",function(heading){heading&&(elm.html(""),elm.append(heading))})}}}]).directive("tabContentTransclude",function(){function isTabHeading(node){return node.tagName&&(node.hasAttribute("tab-heading")||node.hasAttribute("data-tab-heading")||"tab-heading"===node.tagName.toLowerCase()||"data-tab-heading"===node.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(scope,elm,attrs){var tab=scope.$eval(attrs.tabContentTransclude);tab.$transcludeFn(tab.$parent,function(contents){angular.forEach(contents,function(node){isTabHeading(node)?tab.headingElement=node:elm.append(node)})})}}}),angular.module("ui.bootstrap.timepicker",[]).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:null,readonlyInput:!1,mousewheel:!0,arrowkeys:!0}).controller("TimepickerController",["$scope","$attrs","$parse","$log","$locale","timepickerConfig",function($scope,$attrs,$parse,$log,$locale,timepickerConfig){function getHoursFromTemplate(){var hours=parseInt($scope.hours,10),valid=$scope.showMeridian?hours>0&&hours<13:hours>=0&&hours<24;if(valid)return $scope.showMeridian&&(12===hours&&(hours=0),$scope.meridian===meridians[1]&&(hours+=12)),hours}function getMinutesFromTemplate(){var minutes=parseInt($scope.minutes,10);return minutes>=0&&minutes<60?minutes:void 0}function pad(value){return angular.isDefined(value)&&value.toString().length<2?"0"+value:value.toString()}function refresh(keyboardChange){makeValid(),ngModelCtrl.$setViewValue(new Date(selected)),updateTemplate(keyboardChange)}function makeValid(){ngModelCtrl.$setValidity("time",!0),$scope.invalidHours=!1,$scope.invalidMinutes=!1}function updateTemplate(keyboardChange){var hours=selected.getHours(),minutes=selected.getMinutes();$scope.showMeridian&&(hours=0===hours||12===hours?12:hours%12),$scope.hours="h"===keyboardChange?hours:pad(hours),"m"!==keyboardChange&&($scope.minutes=pad(minutes)),$scope.meridian=selected.getHours()<12?meridians[0]:meridians[1]}function addMinutes(minutes){var dt=new Date(selected.getTime()+6e4*minutes);selected.setHours(dt.getHours(),dt.getMinutes()),refresh()}var selected=new Date,ngModelCtrl={$setViewValue:angular.noop},meridians=angular.isDefined($attrs.meridians)?$scope.$parent.$eval($attrs.meridians):timepickerConfig.meridians||$locale.DATETIME_FORMATS.AMPMS;this.init=function(ngModelCtrl_,inputs){ngModelCtrl=ngModelCtrl_,ngModelCtrl.$render=this.render,ngModelCtrl.$formatters.unshift(function(modelValue){return modelValue?new Date(modelValue):null});var hoursInputEl=inputs.eq(0),minutesInputEl=inputs.eq(1),mousewheel=angular.isDefined($attrs.mousewheel)?$scope.$parent.$eval($attrs.mousewheel):timepickerConfig.mousewheel;mousewheel&&this.setupMousewheelEvents(hoursInputEl,minutesInputEl);var arrowkeys=angular.isDefined($attrs.arrowkeys)?$scope.$parent.$eval($attrs.arrowkeys):timepickerConfig.arrowkeys;arrowkeys&&this.setupArrowkeyEvents(hoursInputEl,minutesInputEl),$scope.readonlyInput=angular.isDefined($attrs.readonlyInput)?$scope.$parent.$eval($attrs.readonlyInput):timepickerConfig.readonlyInput,this.setupInputEvents(hoursInputEl,minutesInputEl)};var hourStep=timepickerConfig.hourStep;$attrs.hourStep&&$scope.$parent.$watch($parse($attrs.hourStep),function(value){hourStep=parseInt(value,10)});var minuteStep=timepickerConfig.minuteStep;$attrs.minuteStep&&$scope.$parent.$watch($parse($attrs.minuteStep),function(value){minuteStep=parseInt(value,10)}),$scope.showMeridian=timepickerConfig.showMeridian,$attrs.showMeridian&&$scope.$parent.$watch($parse($attrs.showMeridian),function(value){if($scope.showMeridian=!!value,ngModelCtrl.$error.time){var hours=getHoursFromTemplate(),minutes=getMinutesFromTemplate();angular.isDefined(hours)&&angular.isDefined(minutes)&&(selected.setHours(hours),refresh())}else updateTemplate()}),this.setupMousewheelEvents=function(hoursInputEl,minutesInputEl){var isScrollingUp=function(e){e.originalEvent&&(e=e.originalEvent);var delta=e.wheelDelta?e.wheelDelta:-e.deltaY;return e.detail||delta>0};hoursInputEl.bind("mousewheel wheel",function(e){$scope.$apply(isScrollingUp(e)?$scope.incrementHours():$scope.decrementHours()),e.preventDefault()}),minutesInputEl.bind("mousewheel wheel",function(e){$scope.$apply(isScrollingUp(e)?$scope.incrementMinutes():$scope.decrementMinutes()),e.preventDefault()})},this.setupArrowkeyEvents=function(hoursInputEl,minutesInputEl){hoursInputEl.bind("keydown",function(e){38===e.which?(e.preventDefault(),$scope.incrementHours(),$scope.$apply()):40===e.which&&(e.preventDefault(),$scope.decrementHours(),$scope.$apply())}),minutesInputEl.bind("keydown",function(e){38===e.which?(e.preventDefault(),$scope.incrementMinutes(),$scope.$apply()):40===e.which&&(e.preventDefault(),$scope.decrementMinutes(),$scope.$apply())})},this.setupInputEvents=function(hoursInputEl,minutesInputEl){if($scope.readonlyInput)return $scope.updateHours=angular.noop,void($scope.updateMinutes=angular.noop);var invalidate=function(invalidHours,invalidMinutes){ngModelCtrl.$setViewValue(null),ngModelCtrl.$setValidity("time",!1),angular.isDefined(invalidHours)&&($scope.invalidHours=invalidHours),angular.isDefined(invalidMinutes)&&($scope.invalidMinutes=invalidMinutes)};$scope.updateHours=function(){var hours=getHoursFromTemplate();angular.isDefined(hours)?(selected.setHours(hours),refresh("h")):invalidate(!0)},hoursInputEl.bind("blur",function(e){!$scope.invalidHours&&$scope.hours<10&&$scope.$apply(function(){$scope.hours=pad($scope.hours)})}),$scope.updateMinutes=function(){var minutes=getMinutesFromTemplate();angular.isDefined(minutes)?(selected.setMinutes(minutes),refresh("m")):invalidate(void 0,!0)},minutesInputEl.bind("blur",function(e){!$scope.invalidMinutes&&$scope.minutes<10&&$scope.$apply(function(){$scope.minutes=pad($scope.minutes)})})},this.render=function(){var date=ngModelCtrl.$viewValue;isNaN(date)?(ngModelCtrl.$setValidity("time",!1),$log.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(date&&(selected=date),makeValid(),updateTemplate())},$scope.incrementHours=function(){addMinutes(60*hourStep)},$scope.decrementHours=function(){addMinutes(60*-hourStep)},$scope.incrementMinutes=function(){addMinutes(minuteStep)},$scope.decrementMinutes=function(){addMinutes(-minuteStep)},$scope.toggleMeridian=function(){addMinutes(720*(selected.getHours()<12?1:-1))}}]).directive("timepicker",function(){return{restrict:"EA",require:["timepicker","?^ngModel"],controller:"TimepickerController",replace:!0,scope:{},templateUrl:"template/timepicker/timepicker.html",link:function(scope,element,attrs,ctrls){var timepickerCtrl=ctrls[0],ngModelCtrl=ctrls[1];ngModelCtrl&&timepickerCtrl.init(ngModelCtrl,element.find("input"))}}}),angular.module("ui.bootstrap.transition",[]).value("$transitionSuppressDeprecated",!1).factory("$transition",["$q","$timeout","$rootScope","$log","$transitionSuppressDeprecated",function($q,$timeout,$rootScope,$log,$transitionSuppressDeprecated){function findEndEventName(endEventNames){for(var name in endEventNames)if(void 0!==transElement.style[name])return endEventNames[name]}$transitionSuppressDeprecated||$log.warn("$transition is now deprecated. Use $animate from ngAnimate instead.");var $transition=function(element,trigger,options){options=options||{};var deferred=$q.defer(),endEventName=$transition[options.animation?"animationEndEventName":"transitionEndEventName"],transitionEndHandler=function(event){$rootScope.$apply(function(){element.unbind(endEventName,transitionEndHandler),deferred.resolve(element)})};return endEventName&&element.bind(endEventName,transitionEndHandler),$timeout(function(){angular.isString(trigger)?element.addClass(trigger):angular.isFunction(trigger)?trigger(element):angular.isObject(trigger)&&element.css(trigger),endEventName||deferred.resolve(element)}),deferred.promise.cancel=function(){endEventName&&element.unbind(endEventName,transitionEndHandler),deferred.reject("Transition cancelled")},deferred.promise},transElement=document.createElement("trans"),transitionEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},animationEndEventNames={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return $transition.transitionEndEventName=findEndEventName(transitionEndEventNames),$transition.animationEndEventName=findEndEventName(animationEndEventNames),$transition}]),angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function($parse){var TYPEAHEAD_REGEXP=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(input){var match=input.match(TYPEAHEAD_REGEXP);if(!match)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+input+'".');return{itemName:match[3],source:$parse(match[4]),viewMapper:$parse(match[2]||match[1]),modelMapper:$parse(match[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function($compile,$parse,$q,$timeout,$document,$position,typeaheadParser){var HOT_KEYS=[9,13,27,38,40];return{require:"ngModel",link:function(originalScope,element,attrs,modelCtrl){var hasFocus,minSearch=originalScope.$eval(attrs.typeaheadMinLength)||1,waitTime=originalScope.$eval(attrs.typeaheadWaitMs)||0,isEditable=originalScope.$eval(attrs.typeaheadEditable)!==!1,isLoadingSetter=$parse(attrs.typeaheadLoading).assign||angular.noop,onSelectCallback=$parse(attrs.typeaheadOnSelect),inputFormatter=attrs.typeaheadInputFormatter?$parse(attrs.typeaheadInputFormatter):void 0,appendToBody=!!attrs.typeaheadAppendToBody&&originalScope.$eval(attrs.typeaheadAppendToBody),focusFirst=originalScope.$eval(attrs.typeaheadFocusFirst)!==!1,$setModelValue=$parse(attrs.ngModel).assign,parserResult=typeaheadParser.parse(attrs.typeahead),scope=originalScope.$new();originalScope.$on("$destroy",function(){scope.$destroy()});var popupId="typeahead-"+scope.$id+"-"+Math.floor(1e4*Math.random());element.attr({"aria-autocomplete":"list","aria-expanded":!1,"aria-owns":popupId});var popUpEl=angular.element("<div typeahead-popup></div>");popUpEl.attr({id:popupId,matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(attrs.typeaheadTemplateUrl)&&popUpEl.attr("template-url",attrs.typeaheadTemplateUrl);var resetMatches=function(){scope.matches=[],scope.activeIdx=-1,element.attr("aria-expanded",!1)},getMatchId=function(index){return popupId+"-option-"+index};scope.$watch("activeIdx",function(index){index<0?element.removeAttr("aria-activedescendant"):element.attr("aria-activedescendant",getMatchId(index))});var getMatchesAsync=function(inputValue){var locals={$viewValue:inputValue};isLoadingSetter(originalScope,!0),$q.when(parserResult.source(originalScope,locals)).then(function(matches){var onCurrentRequest=inputValue===modelCtrl.$viewValue;if(onCurrentRequest&&hasFocus)if(matches&&matches.length>0){scope.activeIdx=focusFirst?0:-1,scope.matches.length=0;for(var i=0;i<matches.length;i++)locals[parserResult.itemName]=matches[i],scope.matches.push({id:getMatchId(i),label:parserResult.viewMapper(scope,locals),model:matches[i]});scope.query=inputValue,scope.position=appendToBody?$position.offset(element):$position.position(element),scope.position.top=scope.position.top+element.prop("offsetHeight"),element.attr("aria-expanded",!0)}else resetMatches();onCurrentRequest&&isLoadingSetter(originalScope,!1)},function(){resetMatches(),isLoadingSetter(originalScope,!1)})};resetMatches(),scope.query=void 0;var timeoutPromise,scheduleSearchWithTimeout=function(inputValue){timeoutPromise=$timeout(function(){getMatchesAsync(inputValue)},waitTime)},cancelPreviousTimeout=function(){timeoutPromise&&$timeout.cancel(timeoutPromise)};modelCtrl.$parsers.unshift(function(inputValue){return hasFocus=!0,inputValue&&inputValue.length>=minSearch?waitTime>0?(cancelPreviousTimeout(),scheduleSearchWithTimeout(inputValue)):getMatchesAsync(inputValue):(isLoadingSetter(originalScope,!1),cancelPreviousTimeout(),resetMatches()),isEditable?inputValue:inputValue?void modelCtrl.$setValidity("editable",!1):(modelCtrl.$setValidity("editable",!0),inputValue)}),modelCtrl.$formatters.push(function(modelValue){var candidateViewValue,emptyViewValue,locals={};return isEditable||modelCtrl.$setValidity("editable",!0),inputFormatter?(locals.$model=modelValue,inputFormatter(originalScope,locals)):(locals[parserResult.itemName]=modelValue,candidateViewValue=parserResult.viewMapper(originalScope,locals),locals[parserResult.itemName]=void 0,emptyViewValue=parserResult.viewMapper(originalScope,locals),candidateViewValue!==emptyViewValue?candidateViewValue:modelValue)}),scope.select=function(activeIdx){var model,item,locals={};locals[parserResult.itemName]=item=scope.matches[activeIdx].model,model=parserResult.modelMapper(originalScope,locals),$setModelValue(originalScope,model),modelCtrl.$setValidity("editable",!0),modelCtrl.$setValidity("parse",!0),onSelectCallback(originalScope,{$item:item,$model:model,$label:parserResult.viewMapper(originalScope,locals)}),resetMatches(),$timeout(function(){element[0].focus()},0,!1)},element.bind("keydown",function(evt){0!==scope.matches.length&&HOT_KEYS.indexOf(evt.which)!==-1&&(scope.activeIdx!=-1||13!==evt.which&&9!==evt.which)&&(evt.preventDefault(),40===evt.which?(scope.activeIdx=(scope.activeIdx+1)%scope.matches.length,scope.$digest()):38===evt.which?(scope.activeIdx=(scope.activeIdx>0?scope.activeIdx:scope.matches.length)-1,scope.$digest()):13===evt.which||9===evt.which?scope.$apply(function(){scope.select(scope.activeIdx)}):27===evt.which&&(evt.stopPropagation(),resetMatches(),scope.$digest()))}),element.bind("blur",function(evt){hasFocus=!1});var dismissClickHandler=function(evt){element[0]!==evt.target&&(resetMatches(),scope.$digest())};$document.bind("click",dismissClickHandler),originalScope.$on("$destroy",function(){$document.unbind("click",dismissClickHandler),appendToBody&&$popup.remove(),popUpEl.remove()});var $popup=$compile(popUpEl)(scope);appendToBody?$document.find("body").append($popup):element.after($popup)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(scope,element,attrs){scope.templateUrl=attrs.templateUrl,scope.isOpen=function(){return scope.matches.length>0},scope.isActive=function(matchIdx){return scope.active==matchIdx},scope.selectActive=function(matchIdx){scope.active=matchIdx},scope.selectMatch=function(activeIdx){scope.select({activeIdx:activeIdx})}}}}).directive("typeaheadMatch",["$templateRequest","$compile","$parse",function($templateRequest,$compile,$parse){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(scope,element,attrs){var tplUrl=$parse(attrs.templateUrl)(scope.$parent)||"template/typeahead/typeahead-match.html";$templateRequest(tplUrl).then(function(tplContent){$compile(tplContent.trim())(scope,function(clonedElement){element.replaceWith(clonedElement)})})}}}]).filter("typeaheadHighlight",function(){function escapeRegexp(queryToEscape){return queryToEscape.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(matchItem,query){return query?(""+matchItem).replace(new RegExp(escapeRegexp(query),"gi"),"<strong>$&</strong>"):matchItem}}),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion-group.html",'<div class="panel panel-default">\n  <div class="panel-heading">\n    <h4 class="panel-title">\n      <a href="javascript:void(0)" tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" accordion-transclude="heading"><span ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></a>\n    </h4>\n  </div>\n  <div class="panel-collapse collapse" collapse="!isOpen">\n     <div class="panel-body" ng-transclude></div>\n  </div>\n</div>\n')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion.html",'<div class="panel-group" ng-transclude></div>')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/alert/alert.html",'<div class="alert" ng-class="[\'alert-\' + (type || \'warning\'), closeable ? \'alert-dismissable\' : null]" role="alert">\n    <button ng-show="closeable" type="button" class="close" ng-click="close()">\n        <span aria-hidden="true">&times;</span>\n        <span class="sr-only">Close</span>\n    </button>\n    <div ng-transclude></div>\n</div>\n')}]),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides | orderBy:\'index\' track by $index" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-left"></span></a>\n    <a class="right carousel-control" ng-click="next()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-right"></span></a>\n</div>\n')}]),angular.module("template/carousel/slide.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/carousel/slide.html",'<div ng-class="{\n    \'active\': active\n  }" class="item text-center" ng-transclude></div>\n')}]),angular.module("template/datepicker/datepicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/datepicker.html",'<div ng-switch="datepickerMode" role="application" ng-keydown="keydown($event)">\n  <daypicker ng-switch-when="day" tabindex="0"></daypicker>\n  <monthpicker ng-switch-when="month" tabindex="0"></monthpicker>\n  <yearpicker ng-switch-when="year" tabindex="0"></yearpicker>\n</div>')}]),angular.module("template/datepicker/day.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/day.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="{{5 + showWeeks}}"><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n    <tr>\n      <th ng-show="showWeeks" class="text-center"></th>\n      <th ng-repeat="label in labels track by $index" class="text-center"><small aria-label="{{label.full}}">{{label.abbr}}</small></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-show="showWeeks" class="text-center h6"><em>{{ weekNumbers[$index] }}</em></td>\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}" ng-class="dt.customClass">\n        <button type="button" style="width:100%;" class="btn btn-default btn-sm" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-muted\': dt.secondary, \'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/month.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/month.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/popup.html",'<ul class="dropdown-menu" ng-style="{display: (isOpen && \'block\') || \'none\', top: position.top+\'px\', left: position.left+\'px\'}" ng-keydown="keydown($event)">\n   <li ng-transclude></li>\n   <li ng-if="showButtonBar" style="padding:10px 9px 2px">\n       <span class="btn-group pull-left">\n           <button type="button" class="btn btn-sm btn-info" ng-click="select(\'today\')">{{ getText(\'current\') }}</button>\n           <button type="button" class="btn btn-sm btn-danger" ng-click="select(null)">{{ getText(\'clear\') }}</button>\n       </span>\n       <button type="button" class="btn btn-sm btn-success pull-right" ng-click="close()">{{ getText(\'close\') }}</button>\n   </li>\n</ul>\n')}]),angular.module("template/datepicker/year.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/datepicker/year.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="3"><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/backdrop.html",'<div class="modal-backdrop"\n     modal-animation-class="fade"\n     ng-class="{in: animate}"\n     ng-style="{\'z-index\': 1040 + (index && 1 || 0) + index*10}"\n></div>\n')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/modal/window.html",'<div modal-render="{{$isRendered}}" tabindex="-1" role="dialog" class="modal"\n    modal-animation-class="fade"\n   ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click="close($event)">\n    <div class="modal-dialog" ng-class="size ? \'modal-\' + size : \'\'"><div class="modal-content" modal-transclude></div></div>\n</div>\n')}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pager.html",'<ul class="pager">\n  <li ng-class="{disabled: noPrevious(), previous: align}"><a href ng-click="selectPage(page - 1, $event)">{{getText(\'previous\')}}</a></li>\n  <li ng-class="{disabled: noNext(), next: align}"><a href ng-click="selectPage(page + 1, $event)">{{getText(\'next\')}}</a></li>\n</ul>')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-if="boundaryLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(1, $event)">{{getText(\'first\')}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(page - 1, $event)">{{getText(\'previous\')}}</a></li>\n  <li ng-repeat="page in pages track by $index" ng-class="{active: page.active}"><a href ng-click="selectPage(page.number, $event)">{{page.text}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(page + 1, $event)">{{getText(\'next\')}}</a></li>\n  <li ng-if="boundaryLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(totalPages, $event)">{{getText(\'last\')}}</a></li>\n</ul>')}]),angular.module("template/tooltip/tooltip-html-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind-html="contentExp()"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-template-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-template-popup.html",'<div class="tooltip"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner"\n    tooltip-template-transclude="contentExp()"\n    tooltip-template-transclude-scope="originScope()"></div>\n</div>\n');
}]),angular.module("template/popover/popover-template.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover-template.html",'<div class="popover"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-if="title"></h3>\n      <div class="popover-content"\n        tooltip-template-transclude="contentExp()"\n        tooltip-template-transclude-scope="originScope()"></div>\n  </div>\n</div>\n')}]),angular.module("template/popover/popover-window.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover-window.html",'<div class="popover {{placement}}" ng-class="{ in: isOpen, fade: animation }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-show="title"></h3>\n      <div class="popover-content" tooltip-template-transclude></div>\n  </div>\n</div>\n')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover.html",'<div class="popover"\n  tooltip-animation-class="fade"\n  tooltip-classes\n  ng-class="{ in: isOpen() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-if="title"></h3>\n      <div class="popover-content" ng-bind="content"></div>\n  </div>\n</div>\n')}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/bar.html",'<div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: (percent < 100 ? percent : 100) + \'%\'}" aria-valuetext="{{percent | number:0}}%" ng-transclude></div>\n')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progress.html",'<div class="progress" ng-transclude></div>')}]),angular.module("template/progressbar/progressbar.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/progressbar/progressbar.html",'<div class="progress">\n  <div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: (percent < 100 ? percent : 100) + \'%\'}" aria-valuetext="{{percent | number:0}}%" ng-transclude></div>\n</div>\n')}]),angular.module("template/rating/rating.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/rating/rating.html",'<span ng-mouseleave="reset()" ng-keydown="onKeydown($event)" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="{{range.length}}" aria-valuenow="{{value}}">\n    <i ng-repeat="r in range track by $index" ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" class="glyphicon" ng-class="$index < value && (r.stateOn || \'glyphicon-star\') || (r.stateOff || \'glyphicon-star-empty\')">\n        <span class="sr-only">({{ $index < value ? \'*\' : \' \' }})</span>\n    </i>\n</span>')}]),angular.module("template/tabs/tab.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tab.html",'<li ng-class="{active: active, disabled: disabled}">\n  <a href ng-click="select()" tab-heading-transclude>{{heading}}</a>\n</li>\n')}]),angular.module("template/tabs/tabset.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tabset.html",'<div>\n  <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n  <div class="tab-content">\n    <div class="tab-pane" \n         ng-repeat="tab in tabs" \n         ng-class="{active: tab.active}"\n         tab-content-transclude="tab">\n    </div>\n  </div>\n</div>\n')}]),angular.module("template/timepicker/timepicker.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/timepicker/timepicker.html",'<table>\n   <tbody>\n       <tr class="text-center">\n           <td><a ng-click="incrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n           <td>&nbsp;</td>\n           <td><a ng-click="incrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n           <td ng-show="showMeridian"></td>\n       </tr>\n       <tr>\n           <td class="form-group" ng-class="{\'has-error\': invalidHours}">\n               <input style="width:50px;" type="text" ng-model="hours" ng-change="updateHours()" class="form-control text-center" ng-readonly="readonlyInput" maxlength="2">\n           </td>\n           <td>:</td>\n           <td class="form-group" ng-class="{\'has-error\': invalidMinutes}">\n               <input style="width:50px;" type="text" ng-model="minutes" ng-change="updateMinutes()" class="form-control text-center" ng-readonly="readonlyInput" maxlength="2">\n           </td>\n           <td ng-show="showMeridian"><button type="button" class="btn btn-default text-center" ng-click="toggleMeridian()">{{meridian}}</button></td>\n       </tr>\n       <tr class="text-center">\n           <td><a ng-click="decrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n           <td>&nbsp;</td>\n           <td><a ng-click="decrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n           <td ng-show="showMeridian"></td>\n       </tr>\n   </tbody>\n</table>\n')}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-match.html",'<a tabindex="-1" bind-html-unsafe="match.label | typeaheadHighlight:query"></a>')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead-popup.html",'<ul class="dropdown-menu" ng-show="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">\n    <li ng-repeat="match in matches track by $index" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)" role="option" id="{{match.id}}">\n        <div typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>\n')}]),!angular.$$csp()&&angular.element(document).find("head").prepend('<style type="text/css">.ng-animate.item:not(.left):not(.right){-webkit-transition:0s ease-in-out left;transition:0s ease-in-out left}</style>'),angular.module("mainApp.appCommon.directives.charts.ArcChartDirective",[]).directive("arcChart",function($window){return{restrict:"EA",scope:{},link:function(scope,element,attrs){var chartSize=attrs.chartSize,color=attrs.chartColor,value=attrs.chartValue,total=attrs.chartTotal,label=attrs.chartLabel;window.onresize=function(){scope.$apply()},scope.$watch(function(){return angular.element($window)[0].innerWidth},function(){scope.render()}),scope.render=function(){function arcTween(transition,newAngle){transition.attrTween("d",function(d){var interpolate=d3.interpolate(d.endAngle,newAngle);return function(t){return d.endAngle=interpolate(t),arc(d)}})}var twoPi=2*Math.PI;$(element[0]).empty();var svg=d3.select(element[0]).append("svg").attr("width",chartSize).attr("height",chartSize).append("g").attr("transform","translate("+chartSize/2+","+chartSize/2+")"),arc=d3.svg.arc().startAngle(0).innerRadius(chartSize/2-9).outerRadius(chartSize/2),foreground=(svg.append("path").datum({endAngle:twoPi}).style("fill","#DDDDDD").attr("d",arc),svg.append("path").datum({endAngle:0}).style("fill",color).attr("d",arc));foreground.transition().duration(1e3).call(arcTween,value/total*twoPi),svg.append("text").attr("class","arc-chart-value").style("fill","#555555").attr("dy",".20em").text(value),null!=label&&svg.append("text").attr("class","arc-chart-label").attr("dy","1.85em").style("fill","#BBBBBB").text(label)}}}}),angular.module("mainApp.appCommon.directives.helperMarkDirective",["mainApp.appCommon.directives.ngQtipDirective"]).directive("helperMark",function(){return{restrict:"E",scope:{help:"@"},template:'<span class="has-tooltip" ng-qtip title="{{help}}"><i class="fa fa-question-circle"></i></span>'}}),angular.module("mainApp.appCommon.directives.ngEnterDirective",[]).directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.ngEnter)}),event.preventDefault())})}}),angular.module("mainApp.appCommon.directives.ngQtipDirective",[]).directive("ngQtip",function(){return{restrict:"A",link:function(scope,element,attrs){return $(element).qtip({content:attrs.title,style:"qtip-bootstrap"})}}}),angular.module("mainApp.appCommon.modals.SimpleModal",["mainApp.appCommon.utilities.ResourceUtility"]).service("SimpleModal",function(ResourceUtility){this.show=function(overrides,okCallback){var options={showCloseButton:!0,height:250,width:500,title:"",message:"",okButtonLabel:ResourceUtility.getString("BUTTON_OK_LABEL")};angular.extend(options,overrides);var modalClass="no-close-button",modalElement=$("<div></div>");modalElement.html(options.message),modalElement.dialog({height:options.height,width:options.width,autoOpen:!1,closeOnEscape:!1,modal:!0,title:options.title,dialogClass:options.showCloseButton===!0?"":modalClass,buttons:[{text:options.okButtonLabel,click:function(){null!=okCallback&&"function"==typeof okCallback&&okCallback(),modalElement.dialog("close")}}],close:function(evt,ui){modalElement.remove()}}),modalElement.dialog("open")}}),angular.module("mainApp.appCommon.services.ManageFieldsService",["mainApp.appCommon.utilities.StringUtility","mainApp.appCommon.utilities.ResourceUtility"]).service("ManageFieldsService",function(StringUtility,ResourceUtility){this.GetOptionsForSelects=function(fields){for(var allSources=[],allCategories=[],allOptions=[],i=0;i<fields.length;i++){var field=fields[i];!StringUtility.IsEmptyString(field.SourceToDisplay)&&allSources.indexOf(field.SourceToDisplay)<0&&allSources.push(field.SourceToDisplay),!StringUtility.IsEmptyString(field.Category)&&allCategories.indexOf(field.Category)<0&&allCategories.push(field.Category);for(var exist=!1,j=0;j<allOptions.length;j++)if(allOptions[j][0]==field.SourceToDisplay&&allOptions[j][1]==field.Category){exist=!0;break}exist||allOptions.push([field.SourceToDisplay,field.Category])}var obj={};return obj.sourcesToSelect=allSources.sort(),obj.categoriesToSelect=allCategories.sort(),obj.allOptions=allOptions,obj},this.CategoryEditable=function(dataItem){return null!=dataItem&&(null==dataItem.Tags||""===dataItem.Tags||"internal"===dataItem.Tags.toLowerCase())}}),angular.module("mainApp.appCommon.services.ModelAlertsService",["mainApp.appCommon.utilities.StringUtility","mainApp.appCommon.utilities.ResourceUtility"]).service("ModelAlertsService",function($filter,StringUtility,ResourceUtility){function addSuccessEventsWarning(warnings,modelQualityWarnings){var successEvents=modelQualityWarnings.LowSuccessEvents,minValue=modelQualityWarnings.MinSuccessEvents;if(null!=successEvents&&null!=minValue){var warning={};successEvents=$filter("number")(successEvents,0),minValue=$filter("number")(minValue,0),warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_SUCCESS_EVENTS_TOO_LOWER_TITLE",[successEvents,minValue]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ADJUST_FILTERS_EVENT_DEFINITION"),warning.successEvents=successEvents,warning.minValue=minValue,warnings.push(warning)}}function addConversionRateWarning(warnings,modelQualityWarnings){var conversionPercentage=modelQualityWarnings.LowConversionPercentage,minValue=modelQualityWarnings.MinConversionPercentage;if(null!=conversionPercentage&&null!=minValue){var warning={};conversionPercentage=$filter("number")(conversionPercentage,1),warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_CONVERSION_RATE_TOO_LOWER_TITLE",[conversionPercentage,minValue]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ADJUST_FILTERS_EVENT_DEFINITION"),warning.conversionPercentage=conversionPercentage,warning.minValue=minValue,warnings.push(warning)}}function addOutOfRangeRocScoreWarning(warnings,modelQualityWarnings){var rocScore=modelQualityWarnings.OutOfRangeRocScore,minValue=modelQualityWarnings.MinRocScore,maxValue=modelQualityWarnings.MaxRocScore;if(null!=rocScore&&null!=minValue&&null!=maxValue){var warning={};rocScore=$filter("number")(rocScore,2),warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ROC_SCORE_OUTSIDE_CREDIBLE_RANGE",[rocScore,minValue,maxValue]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ADJUST_FILTERS_EVENT_DEFINITION"),warning.rocScore=rocScore,warning.minValue=minValue,warning.maxValue=maxValue,warnings.push(warning)}}function addExcessiveDiscreteValuesAttributesWarning(warnings,modelQualityWarnings){var attributes=modelQualityWarnings.ExcessiveDiscreteValuesAttributes,maxValue=modelQualityWarnings.MaxNumberOfDiscreteValues;if(null!=attributes&&attributes.length>0&&null!=maxValue){var warning={},count=$filter("number")(attributes.length,0);maxValue=$filter("number")(maxValue,0),warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ATTRIBUTES_OVERLY_DISCRETE_VALUES_TITLE",[count,maxValue]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ATTRIBUTES_REMOVED_FROM_MODELING"),warning.impactedLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_IMPACTED_ATTRIBUTES"),warning.impactedContent=joinStringList(attributes,0),warning.count=count,warning.maxValue=maxValue,warnings.push(warning)}}function addExcessivePredictiveAttributesWarning(warnings,modelQualityWarnings){var attributes=modelQualityWarnings.ExcessivePredictiveAttributes,maxValue=modelQualityWarnings.MaxFeatureImportance;if(null!=attributes&&attributes.length>0&&null!=maxValue){var warning={},count=$filter("number")(attributes.length,0);warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ATTRIBUTES_OVERLY_PREDICTIVE_TITLE",[count,maxValue]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ATTRIBUTES_CONTAIN_FUTURE_INFORMATION_REQUIRE_EM_JSUTIFICATION_VALID_PREDICTOR"),warning.impactedLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_IMPACTED_ATTRIBUTES"),warning.impactedContent=joinMapList(attributes,1),warning.count=count,warning.maxValue=maxValue,warnings.push(warning)}}function addExcessivePredictiveNullValuesAttributesWarning(warnings,modelQualityWarnings){var attributes=modelQualityWarnings.ExcessivePredictiveNullValuesAttributes,maxValue=modelQualityWarnings.MaxLiftForNull;if(null!=attributes&&attributes.length>0&&null!=maxValue){var warning={},count=$filter("number")(attributes.length,0);warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ATTRIBUTES_HIGHLY_PREDICTIVE_NULL_VALUES",[count,maxValue]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_ATTRIBUTES_CONFIRM_ABSENCE_DATA_HAS_BUSINESS_MEANING"),warning.impactedLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_IMPACTED_ATTRIBUTES"),warning.impactedContent=joinMapList(attributes,1),warning.count=count,warning.maxValue=maxValue,warnings.push(warning)}}function addInvalidApprovedUsageAttributesWarning(warnings,missingMetaDataWarnings){var attributes=missingMetaDataWarnings.InvalidApprovedUsageAttributes;if(null!=attributes&&attributes.length>0){var warning={},count=$filter("number")(attributes.length,0);warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_INVALID_APPROVED_USAGE",[count]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_SUPPRESSED_FROM_TOP_PREDICTORS_UI_CSV_BUYER_INSIGHTS"),warning.impactedLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_IMPACTED_ATTRIBUTES"),warning.impactedContent=joinStringList(attributes),warning.count=count,warnings.push(warning)}}function addInvalidTagsAttributesWarning(warnings,missingMetaDataWarnings){var attributes=missingMetaDataWarnings.InvalidTagsAttributes;if(null!=attributes&&attributes.length>0){var warning={},count=$filter("number")(attributes.length,0);warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_INVALID_TAGS",[count]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_SUPPRESSED_FROM_TOP_PREDICTORS_UI_CSV_BUYER_INSIGHTS"),warning.impactedLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_IMPACTED_ATTRIBUTES"),warning.impactedContent=joinStringList(attributes),warning.count=count,warnings.push(warning)}}function addInvalidCategoryAttributesWarning(warnings,missingMetaDataWarnings){var attributes=missingMetaDataWarnings.InvalidCategoryAttributes;if(null!=attributes&&attributes.length>0){var warning={},count=$filter("number")(attributes.length,0);warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_INVALID_CATEGORY",[count]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_SUPPRESSED_FROM_TOP_PREDICTORS_UI_CSV_BUYER_INSIGHTS"),warning.impactedLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_IMPACTED_ATTRIBUTES"),warning.impactedContent=joinStringList(attributes),warning.count=count,warnings.push(warning)}}function addInvalidDisplayNameAttributesWarning(warnings,missingMetaDataWarnings){var attributes=missingMetaDataWarnings.InvalidDisplayNameAttributes;if(null!=attributes&&attributes.length>0){var warning={},count=$filter("number")(attributes.length,0);warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_INVALID_DISPLAY_NAME",[count]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_SUPPRESSED_FROM_TOP_PREDICTORS_UI_CSV_BUYER_INSIGHTS"),warning.impactedLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_IMPACTED_ATTRIBUTES"),warning.impactedContent=joinStringList(attributes),warning.count=count,warnings.push(warning)}}function addInvalidStatisticalTypeAttributesWarning(warnings,missingMetaDataWarnings){var attributes=missingMetaDataWarnings.InvalidStatisticalTypeAttributes;if(null!=attributes&&attributes.length>0){var warning={},count=$filter("number")(attributes.length,0);warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_INVALID_STATISTICAL_TYPE",[count]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_ATTRIBUTES_BUCKETED_INCORRECTLY_IN_TOP_PREDICTORS_UI_CSV_BUYER_INSIGHTS"),warning.impactedLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_IMPACTED_ATTRIBUTES"),warning.impactedContent=joinStringList(attributes),warning.count=count,warnings.push(warning)}}function addExcessiveCategoriesInModelSummaryWarning(warnings,suppressedCategories){var categories=suppressedCategories;if(null!=categories&&categories.length>0){var warning={},count=$filter("number")(categories.length+8,0),maxValue=8,categoryNames=getCategoryNames(categories);warning.title=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_MODEL_SUMMARY_CONTAINS_OVERLY_CATEFORIES",[count,maxValue]),warning.description=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_TWO_CATEFORIES_AND_ATTRIBUTES_SUPPRESSED_FROM_TOP_PREDICTORS_UI"),warning.impactedLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_IMPACTED_CATEGORIES"),warning.impactedContent=joinStringList(categoryNames),warning.count=count,warning.maxValue=maxValue,warnings.push(warning)}}function getCategoryNames(categories){var categoryNames=[];if(null==categories)return categoryNames;for(var i=0;i<categories.length;i++){var category=categories[i];categoryNames.push(category.name)}return categoryNames}function joinMapList(elements,fractionSize){for(var content="",length=elements.length,i=0;i<length;i++){var element=elements[i],value=null!=fractionSize?$filter("number")(element.value,fractionSize):element.value;content+=element.key+" ("+value+")",i+1<length&&(content+=", ")}return content}function joinStringList(elements){for(var content="",length=elements.length,i=0;i<length;i++)content+=elements[i],i+1<length&&(content+=", ");return content}this.GetWarnings=function(modelAlerts,suppressedCategories){var warnings={};warnings.noWarning=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_NO_WARNING"),warnings.modelQualityWarningsTitle=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_TITLE"),warnings.modelQualityWarningsLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MODEL_QUALITY_LABEL"),warnings.missingMetaDataWarningsTitle=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_TITLE"),warnings.missingMetaDataWarningsLabel=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_MISSING_META_DATA_LABEL");var modelQualityWarnings=[],modelQualityWarningsObj=modelAlerts.ModelQualityWarnings;null!=modelQualityWarningsObj&&(addSuccessEventsWarning(modelQualityWarnings,modelQualityWarningsObj),addConversionRateWarning(modelQualityWarnings,modelQualityWarningsObj),addOutOfRangeRocScoreWarning(modelQualityWarnings,modelQualityWarningsObj),addExcessiveDiscreteValuesAttributesWarning(modelQualityWarnings,modelQualityWarningsObj),addExcessivePredictiveAttributesWarning(modelQualityWarnings,modelQualityWarningsObj),addExcessivePredictiveNullValuesAttributesWarning(modelQualityWarnings,modelQualityWarningsObj)),warnings.noModelQualityWarnings=0===modelQualityWarnings.length,warnings.modelQualityWarnings=modelQualityWarnings;var missingMetaDataWarnings=[],missingMetaDataWarningsObj=modelAlerts.MissingMetaDataWarnings;return null!=missingMetaDataWarningsObj&&(addInvalidApprovedUsageAttributesWarning(missingMetaDataWarnings,missingMetaDataWarningsObj),addInvalidTagsAttributesWarning(missingMetaDataWarnings,missingMetaDataWarningsObj),addInvalidCategoryAttributesWarning(missingMetaDataWarnings,missingMetaDataWarningsObj),addInvalidDisplayNameAttributesWarning(missingMetaDataWarnings,missingMetaDataWarningsObj),addInvalidStatisticalTypeAttributesWarning(missingMetaDataWarnings,missingMetaDataWarningsObj),addExcessiveCategoriesInModelSummaryWarning(missingMetaDataWarnings,suppressedCategories)),warnings.noMissingMetaDataWarnings=0===missingMetaDataWarnings.length,warnings.missingMetaDataWarnings=missingMetaDataWarnings,warnings}}),angular.module("mainApp.appCommon.services.ModelSummaryValidationService",["mainApp.appCommon.utilities.ResourceUtility"]).service("ModelSummaryValidationService",function(ResourceUtility){function PushErrors(errors,newErrors){for(var i=0;i<newErrors.length;i++)errors.push(newErrors[i])}function PushError(errors,key){errors.push(ResourceUtility.getString(key))}function PushErrorWithOffset(errors,key,i){errors.push(ResourceUtility.getString(key)+ErrorOffset(i))}function PushErrorWithOffsets(errors,key,i,j){errors.push(ResourceUtility.getString(key)+ErrorOffsets(i,j))}function ErrorOffset(i){return" [i = "+i+"]"}function ErrorOffsets(i,j){return" [i = "+i+"] [j = "+j+"]"}function ValidateSegmentations(modelSummary){var i,segment,errors=[];if(modelSummary.hasOwnProperty("Segmentations"))if(Array.isArray(modelSummary.Segmentations)&&1==modelSummary.Segmentations.length){var segmentation=modelSummary.Segmentations[0];if(segmentation.hasOwnProperty("Segments"))if(Array.isArray(segmentation.Segments)&&100==segmentation.Segments.length)for(i=0;i<100;i++)segment=segmentation.Segments[i],segment.hasOwnProperty("Score")?segment.Score!=parseInt(segment.Score)&&PushErrorWithOffset(errors,"VALIDATION_ERROR_SEGMENT_SCORE_INVALID",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_SEGMENT_SCORE_MISSING",i),segment.hasOwnProperty("Count")?segment.Count!=parseInt(segment.Count)&&PushErrorWithOffset(errors,"VALIDATION_ERROR_SEGMENT_COUNT_INVALID",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_SEGMENT_COUNT_MISSING",i),segment.hasOwnProperty("Converted")?segment.Converted!=parseInt(segment.Converted)&&PushErrorWithOffset(errors,"VALIDATION_ERROR_SEGMENT_CONVERTED_INVALID",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_SEGMENT_CONVERTED_MISSING",i);else PushError(errors,"VALIDATION_ERROR_SEGMENTS_UNEXPECTED");else PushError(errors,"VALIDATION_ERROR_SEGMENTS_MISSING")}else PushError(errors,"VALIDATION_ERROR_SEGMENTATIONS_UNEXPECTED");else PushError(errors,"VALIDATION_ERROR_SEGMENTATIONS_MISSING");return errors}function ValidatePredictors(modelSummary){var i,j,predictor,errors=[];if(modelSummary.hasOwnProperty("Predictors")){var predictors=modelSummary.Predictors;if(Array.isArray(predictors))for(i=0;i<predictors.length;i++)if(predictor=predictors[i],predictor.hasOwnProperty("Name")||PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_NAME_MISSING",i),predictor.hasOwnProperty("Tags")?null==predictor.Tags||Array.isArray(predictor.Tags)||PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_TAGS_UNEXPECTED",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_TAGS_MISSING",i),predictor.hasOwnProperty("DataType")||PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_DATA_TYPE_MISSING",i),predictor.hasOwnProperty("DisplayName")||PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_DISPLAY_NAME_MISSING",i),predictor.hasOwnProperty("Description")||PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_DESCRIPTION_MISSING",i),predictor.hasOwnProperty("ApprovedUsage")?null==predictor.ApprovedUsage||Array.isArray(predictor.ApprovedUsage)||PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_APPROVED_USAGE_UNEXPECTED",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_APPROVED_USAGE_MISSING",i),predictor.hasOwnProperty("FundamentalType")||PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_FUNDAMENTAL_TYPE_MISSING",i),predictor.hasOwnProperty("Category")||PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_CATEGORY_MISSING",i),predictor.hasOwnProperty("UncertaintyCoefficient")?predictor.UncertaintyCoefficient!=parseFloat(predictor.UncertaintyCoefficient)&&PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_UNCERTAINTY_COEFFICIENT_INVALID",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_UNCERTAINTY_COEFFICIENT_MISSING",i),predictor.hasOwnProperty("Elements"))if(Array.isArray(predictor.Elements))for(j=0;j<predictor.Elements.length;j++){var element=predictor.Elements[j];element.hasOwnProperty("CorrelationSign")?element.CorrelationSign!==-1&&1!==element.CorrelationSign&&PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_CORRELATION_SIGN_INVALID",i,j):PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_CORRELATION_SIGN_MISSING",i,j),element.hasOwnProperty("Count")?element.Count!=parseInt(element.Count)&&PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_COUNT_INVALID",i,j):PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_COUNT_MISSING",i,j),element.hasOwnProperty("Lift")?element.Lift!=parseFloat(element.Lift)&&PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_LIFT_INVALID",i,j):PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_LIFT_MISSING",i,j),element.hasOwnProperty("LowerInclusive")&&null!=element.LowerInclusive&&element.LowerInclusive!=parseFloat(element.LowerInclusive)&&PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_LOWER_INCLUSIVE_INVALID",i,j),element.hasOwnProperty("UpperExclusive")&&null!=element.UpperExclusive&&element.UpperExclusive!=parseFloat(element.UpperExclusive)&&PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_UPPER_EXCLUSIVE_INVALID",i,j),element.hasOwnProperty("Name")||PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_NAME_MISSING",i,j),element.hasOwnProperty("UncertaintyCoefficient")?element.UncertaintyCoefficient!=parseFloat(element.UncertaintyCoefficient)&&PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_UNCERTAINTY_COEFFICIENT_INVALID",i,j):PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_UNCERTAINTY_COEFFICIENT_MISSING",i,j),element.hasOwnProperty("Values")?Array.isArray(element.Values)||PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_VALUES_UNEXPECTED",i,j):PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_VALUES_MISSING",i,j),element.hasOwnProperty("IsVisible")?"boolean"!=typeof element.IsVisible&&PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_IS_VISIBLE_INVALID",i,j):PushErrorWithOffsets(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENT_IS_VISIBLE_MISSING",i,j)}else PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENTS_UNEXPECTED",i);else PushErrorWithOffset(errors,"VALIDATION_ERROR_PREDICTOR_ELEMENTS_MISSING",i);else PushError(errors,"VALIDATION_ERROR_PREDICTORS_UNEXPECTED")}else PushError(errors,"VALIDATION_ERROR_PREDICTORS_MISSING");return errors}function ValidateModelDetails(modelSummary){var errors=[];if(modelSummary.hasOwnProperty("ModelDetails")){var details=modelSummary.ModelDetails;details.hasOwnProperty("Name")||PushError(errors,"VALIDATION_ERROR_MODEL_NAME_MISSING"),details.hasOwnProperty("TotalLeads")?details.TotalLeads!=parseInt(details.TotalLeads)&&PushError(errors,"VALIDATION_ERROR_TOTAL_LEADS_INVALID"):PushError(errors,"VALIDATION_ERROR_TOTAL_LEADS_MISSING"),details.hasOwnProperty("TestingLeads")?details.TestingLeads!=parseInt(details.TestingLeads)&&PushError(errors,"VALIDATION_ERROR_TESTING_LEADS_INVALID"):PushError(errors,"VALIDATION_ERROR_TESTING_LEADS_MISSING"),details.hasOwnProperty("TrainingLeads")?details.TrainingLeads!=parseInt(details.TrainingLeads)&&PushError(errors,"VALIDATION_ERROR_TRAINING_LEADS_INVALID"):PushError(errors,"VALIDATION_ERROR_TRAINING_LEADS_MISSING"),details.hasOwnProperty("TotalConversions")?details.TotalConversions!=parseInt(details.TotalConversions)&&PushError(errors,"VALIDATION_ERROR_TOTAL_CONVERSIONS_INVALID"):PushError(errors,"VALIDATION_ERROR_TOTAL_CONVERSIONS_MISSING"),details.hasOwnProperty("TestingConversions")?details.TestingConversions!=parseInt(details.TestingConversions)&&PushError(errors,"VALIDATION_ERROR_TESTING_CONVERSIONS_INVALID"):PushError(errors,"VALIDATION_ERROR_TESTING_CONVERSIONS_MISSING"),details.hasOwnProperty("TrainingConversions")?details.TrainingConversions!=parseInt(details.TrainingConversions)&&PushError(errors,"VALIDATION_ERROR_TRAINING_CONVERSIONS_INVALID"):PushError(errors,"VALIDATION_ERROR_TRAINING_CONVERSIONS_MISSING"),details.hasOwnProperty("RocScore")?details.RocScore!=parseFloat(details.RocScore)&&PushError(errors,"VALIDATION_ERROR_ROC_SCORE_INVALID"):PushError(errors,"VALIDATION_ERROR_ROC_SCORE_MISSING"),details.hasOwnProperty("ConstructionTime")?details.ConstructionTime!=parseInt(details.ConstructionTime)&&PushError(errors,"VALIDATION_ERROR_CONSTRUCTION_TIME_INVALID"):PushError(errors,"VALIDATION_ERROR_CONSTRUCTION_TIME_MISSING")}else PushError(errors,"VALIDATION_ERROR_MODEL_DETAILS_MISSING");return errors}function ValidateTopSample(modelSummary){var i,errors=[];if(modelSummary.hasOwnProperty("TopSample")){var topSample=modelSummary.TopSample;if(Array.isArray(topSample))for(i=0;i<topSample.length;i++)sample=topSample[i],sample.hasOwnProperty("Company")||PushErrorWithOffset(errors,"VALIDATION_ERROR_TOP_SAMPLE_COMPANY_MISSING",i),sample.hasOwnProperty("FirstName")||PushErrorWithOffset(errors,"VALIDATION_ERROR_TOP_SAMPLE_FIRST_NAME_MISSING",i),sample.hasOwnProperty("LastName")||PushErrorWithOffset(errors,"VALIDATION_ERROR_TOP_SAMPLE_LAST_NAME_MISSING",i),
sample.hasOwnProperty("Converted")?"boolean"!=typeof sample.Converted&&PushErrorWithOffset(errors,"VALIDATION_ERROR_TOP_SAMPLE_CONVERTED_INVALID",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_TOP_SAMPLE_CONVERTED_MISSING",i),sample.hasOwnProperty("Score")?sample.Score!=parseInt(sample.Score)&&PushErrorWithOffset(errors,"VALIDATION_ERROR_TOP_SAMPLE_SCORE_INVALID",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_TOP_SAMPLE_SCORE_MISSING",i);else PushError(errors,"VALIDATION_ERROR_TOP_SAMPLE_UNEXPECTED")}else PushError(errors,"VALIDATION_ERROR_TOP_SAMPLE_MISSING");return errors}function ValidateBottomSample(modelSummary){var i,errors=[];if(modelSummary.hasOwnProperty("BottomSample")){var bottomSample=modelSummary.BottomSample;if(Array.isArray(bottomSample))for(i=0;i<bottomSample.length;i++)sample=bottomSample[i],sample.hasOwnProperty("Company")||PushErrorWithOffset(errors,"VALIDATION_ERROR_BOTTOM_SAMPLE_COMPANY_MISSING",i),sample.hasOwnProperty("FirstName")||PushErrorWithOffset(errors,"VALIDATION_ERROR_BOTTOM_SAMPLE_FIRST_NAME_MISSING",i),sample.hasOwnProperty("LastName")||PushErrorWithOffset(errors,"VALIDATION_ERROR_BOTTOM_SAMPLE_LAST_NAME_MISSING",i),sample.hasOwnProperty("Converted")?"boolean"!=typeof sample.Converted&&PushErrorWithOffset(errors,"VALIDATION_ERROR_BOTTOM_SAMPLE_CONVERTED_INVALID",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_BOTTOM_SAMPLE_CONVERTED_MISSING",i),sample.hasOwnProperty("Score")?sample.Score!=parseInt(sample.Score)&&PushErrorWithOffset(errors,"VALIDATION_ERROR_BOTTOM_SAMPLE_SCORE_INVALID",i):PushErrorWithOffset(errors,"VALIDATION_ERROR_BOTTOM_SAMPLE_SCORE_MISSING",i);else PushError(errors,"VALIDATION_ERROR_BOTTOM_SAMPLE_UNEXPECTED")}else PushError(errors,"VALIDATION_ERROR_BOTTOM_SAMPLE_MISSING");return errors}this.ValidateModelSummary=function(modelSummary){var errors=[];if(!modelSummary)return errors.push(ResourceUtility.getString("VALIDATION_ERROR_MODEL_SUMMARY_MISSING")),errors;try{var segmentationErrors=ValidateSegmentations(modelSummary);segmentationErrors.length>0&&PushErrors(errors,segmentationErrors);var predictorErrors=ValidatePredictors(modelSummary);predictorErrors.length>0&&PushErrors(errors,predictorErrors);var detailErrors=ValidateModelDetails(modelSummary);detailErrors.length>0&&PushErrors(errors,detailErrors);var topSampleErrors=ValidateTopSample(modelSummary);topSampleErrors.length>0&&PushErrors(errors,topSampleErrors);var bottomSampleErrors=ValidateBottomSample(modelSummary);bottomSampleErrors.length>0&&PushErrors(errors,bottomSampleErrors)}catch(exc){errors.push(exc.message)}return errors}}),angular.module("mainApp.appCommon.services.PlayTileService",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.MetadataUtility","mainApp.appCommon.utilities.DateTimeFormatUtility","mainApp.appCommon.utilities.NumberUtility"]).service("PlayTileService",function(ResourceUtility,MetadataUtility,DateTimeFormatUtility,NumberUtility){this.GetTileData=function(data,widgetConfig,metadata,successCallback){if(null==data||null==widgetConfig||null==metadata)return{};var tileData={ID:null,Name:"",Lift:null,LiftDisplayKey:null,ActiveDays:null,ActiveDaysDisplayKey:null,Revenue:null,RevenueDisplayKey:null,Objective:"",PlayType:"",IsActive:!0,CrmId:null},notionMetadata=MetadataUtility.GetNotionMetadata(widgetConfig.Notion,metadata),leadIdProperty=MetadataUtility.GetNotionProperty(widgetConfig.IdProperty,notionMetadata);null!=leadIdProperty&&(tileData.ID=data[leadIdProperty.Name]||null);var nameProperty=MetadataUtility.GetNotionProperty(widgetConfig.NameProperty,notionMetadata);null!=nameProperty&&nameProperty.PropertyTypeString==MetadataUtility.PropertyType.STRING&&(tileData.Name=data[nameProperty.Name]||"");var liftProperty=MetadataUtility.GetNotionProperty(widgetConfig.LiftProperty,notionMetadata);null!=liftProperty&&liftProperty.PropertyTypeString==MetadataUtility.PropertyType.DOUBLE&&(tileData.Lift=data[liftProperty.Name]||null,null!=tileData.Lift&&(tileData.Lift=tileData.Lift.toPrecision(2),tileData.Lift+="x",tileData.LiftDisplayKey=ResourceUtility.getString(liftProperty.DisplayNameKey)));var launchDateProperty=MetadataUtility.GetNotionProperty(widgetConfig.LaunchDateProperty,notionMetadata);if(null!=launchDateProperty){tileData.ActiveDaysDisplayKey=ResourceUtility.getString(launchDateProperty.DisplayNameKey);var launchDate=data[launchDateProperty.Name]||null;if(null!=launchDate){var dateObj;if(launchDateProperty.PropertyTypeString==MetadataUtility.PropertyType.DATE_TIME_OFFSET)dateObj=DateTimeFormatUtility.ConvertCSharpDateTimeOffsetToJSDate(launchDate),tileData.ActiveDays=DateTimeFormatUtility.CalculateDaysBetweenDates(dateObj,new Date);else if(launchDateProperty.PropertyTypeString==MetadataUtility.PropertyType.EPOCH_TIME){var epochTime=1e3*parseInt(launchDate);dateObj=new Date,dateObj.setTime(epochTime),tileData.ActiveDays=DateTimeFormatUtility.CalculateDaysBetweenDates(dateObj,new Date)}}}0===tileData.ActiveDays&&(tileData.ActiveDays=1);var revenueProperty=MetadataUtility.GetNotionProperty(widgetConfig.RevenueProperty,notionMetadata);if(null!=revenueProperty&&revenueProperty.PropertyTypeString==MetadataUtility.PropertyType.CURRENCY){var revenueInt=data[revenueProperty.Name]||null;null!=revenueInt&&(tileData.Revenue=NumberUtility.AbbreviateLargeNumber(revenueInt),tileData.RevenueDisplayKey=ResourceUtility.getString(revenueProperty.DisplayNameKey))}var objectiveProperty=MetadataUtility.GetNotionProperty(widgetConfig.ObjectiveProperty,notionMetadata);null!=objectiveProperty&&objectiveProperty.PropertyTypeString==MetadataUtility.PropertyType.STRING&&(tileData.Objective=data[objectiveProperty.Name]||"",tileData.Objective.length>140&&(tileData.Objective=this.Objective.substring(0,140)+"..."));var playTypeProperty=MetadataUtility.GetNotionProperty(widgetConfig.PlayTypeProperty,notionMetadata);null!=playTypeProperty&&(tileData.PlayType=data[playTypeProperty.Name]||null);var salesforceIdProperty=MetadataUtility.GetNotionProperty(widgetConfig.CrmIdProperty,notionMetadata);if(null!=salesforceIdProperty)if(tileData.CrmId=data[salesforceIdProperty.Name],null==tileData.CrmId)null!=successCallback&&"function"==typeof successCallback&&successCallback(tileData);else{var isActiveEvent="IsLeadActiveEvent="+tileData.CrmId;window.parent.postMessage(isActiveEvent,"*"),window.addEventListener("message",function(evt){if(evt&&evt.data.indexOf("IsLeadActiveReturnEvent="+tileData.CrmId)!==-1){var questionMarkIndex=evt.data.indexOf("?"),isActiveQueryString=evt.data.substring(questionMarkIndex+1,evt.data.length),separatorIndex=isActiveQueryString.indexOf("="),isActiveString=isActiveQueryString.substring(separatorIndex+1,isActiveQueryString.length);tileData.IsActive="true"===isActiveString,null!=successCallback&&"function"==typeof successCallback&&successCallback(tileData)}})}else null!=successCallback&&"function"==typeof successCallback&&successCallback(tileData)}}),angular.module("mainApp.appCommon.services.ThresholdExplorerService",["mainApp.appCommon.utilities.ResourceUtility"]).service("ThresholdExplorerService",function(ResourceUtility){this.PrepareData=function(modelSummary){if(null==modelSummary||null==modelSummary.ModelDetails||null==modelSummary.Segmentations)return{ChartData:[],DecileData:[]};var chartData=this.GetChartData(modelSummary),decileData=this.GetDecileData(chartData),liftData=this.GetLiftData(chartData);return{ChartData:chartData,DecileData:decileData,LiftData:liftData}},this.GetChartData=function(modelSummary){var conversion,i,totalLeads=modelSummary.ModelDetails.TestingLeads,totalConversions=modelSummary.ModelDetails.TestingConversions,avgConversion=totalConversions/totalLeads,segments=modelSummary.Segmentations[0].Segments,percentLeads=[];for(i=0;i<101;i++)percentLeads.push(i);var cumConversions=[];cumConversions.push(0);var cumCount=[];for(cumCount.push(0),i=1;i<101;i++)cumConversions.push(cumConversions[i-1]+segments[i-1].Converted),cumCount.push(cumCount[i-1]+segments[i-1].Count);var cumPctConversions=[];for(cumPctConversions.push(0),i=1;i<101;i++)cumPctConversions.push(100*(cumConversions[i]/totalConversions));var leftLift=[];for(leftLift.push(0),i=1;i<101;i++)conversion=cumConversions[i]/cumCount[i],leftLift.push(conversion/avgConversion);var rightLift=[];for(i=0;i<100;i++)conversion=(totalConversions-cumConversions[i])/(totalLeads-cumCount[i]),rightLift.push(conversion/avgConversion);rightLift.push(0);var score=[];for(score.push(0),i=100;i>0;i--)score.push(i);var data=[];for(i=0;i<101;i++)data.push({leads:percentLeads[i],score:score[i],conversions:cumPctConversions[i],leftLift:leftLift[i],rightLift:rightLift[i]});return data},this.GetDecileData=function(chartData){for(var result=[],i=1;i<11;i++)result.push(chartData[10*i].conversions);return result},this.GetLiftData=function(chartData){for(var result=[],i=1;i<11;i++){var bucket_conversion=chartData[10*i].conversions-chartData[10*(i-1)].conversions;result.push(bucket_conversion/10)}return result},this.PrepareExportData=function(modelSummary){var result=[],chartData=modelSummary.hasOwnProperty("ThresholdChartData")?modelSummary.ThresholdChartData:this.GetChartData(modelSummary),segments=modelSummary.Segmentations[0].Segments,columns=[ResourceUtility.getString("MODEL_ADMIN_THRESHOLD_EXPORT_SCORE_LABEL"),ResourceUtility.getString("MODEL_ADMIN_THRESHOLD_EXPORT_LEADS_LABEL"),ResourceUtility.getString("MODEL_ADMIN_THRESHOLD_EXPORT_CONVERSIONS_LABEL"),ResourceUtility.getString("MODEL_ADMIN_THRESHOLD_EXPORT_LEFT_LIFT_LABEL"),ResourceUtility.getString("MODEL_ADMIN_THRESHOLD_EXPORT_RIGHT_LIFT_LABEL"),ResourceUtility.getString("MODEL_ADMIN_THRESHOLD_EXPORT_COUNT_LABEL"),ResourceUtility.getString("MODEL_ADMIN_THRESHOLD_EXPORT_CONVERTED_LABEL")];result.push(columns);for(var i=1;i<101;i++){var row=[];row.push(chartData[i].score),row.push(chartData[i].leads+"%"),row.push(chartData[i].conversions.toFixed(0)+"%"),row.push(chartData[i].leftLift.toFixed(2)),row.push(chartData[i].rightLift.toFixed(2)),row.push(segments[i-1].Count),row.push(segments[i-1].Converted),result.push(row)}return result}}),angular.module("mainApp.appCommon.services.TopPredictorService",["mainApp.appCommon.utilities.StringUtility","mainApp.appCommon.utilities.AnalyticAttributeUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.UnderscoreUtility"]).service("TopPredictorService",function(_,StringUtility,AnalyticAttributeUtility,ResourceUtility){this.GetSuppressedCategories=function(modelSummary){var categories=this.GetAllCategories(modelSummary);return this.SelectSuppressedCategories(modelSummary,categories)},this.GetTopCategories=function(modelSummary){var categories=this.GetAllCategories(modelSummary);return this.SelectTopCategories(modelSummary,categories)},this.GetAllCategories=function(modelSummary){if(null==modelSummary||null==modelSummary.Predictors||0===modelSummary.Predictors.length)return null;modelSummary.Predictors=modelSummary.Predictors.sort(this.SortByPredictivePower);for(var category,categories=[],categoryNames=[],i=0;i<modelSummary.Predictors.length;i++){var predictor=modelSummary.Predictors[i];AnalyticAttributeUtility.IsAllowedForInsights(predictor)&&this.PredictorHasValidBuckets(predictor,modelSummary.ModelDetails.TotalLeads)&&!StringUtility.IsEmptyString(predictor.Category)&&categoryNames.indexOf(predictor.Category)===-1&&(categoryNames.push(predictor.Category),category={name:predictor.Category,categoryName:predictor.Category,UncertaintyCoefficient:predictor.UncertaintyCoefficient,size:1,color:null,children:[]},categories.push(category))}return categories},this.SelectTopCategories=function(modelSummary,categories){var sortedCategories=this.SortCategoriesByPowerSumDescending(modelSummary,categories),topCategories=sortedCategories;return sortedCategories.length>8&&(topCategories=sortedCategories.slice(0,8)),topCategories},this.SelectSuppressedCategories=function(modelSummary,categories){var sortedCategories=this.SortCategoriesByPowerSumDescending(modelSummary,categories),suppressedCategories=null;return sortedCategories.length>8&&(suppressedCategories=sortedCategories.slice(8,sortedCategories.length)),suppressedCategories},this.SortCategoriesByPowerSumDescending=function(modelSummary,categories){if(null==categories)return null;for(var category,attributes,i=0;i<categories.length;i++)category=categories[i],attributes=this.GetAttributesByCategory(modelSummary,category.name,category.color,3),category.PowerSum=_.reduce(attributes,function(acc,e){return acc+e.power},0);return categories=_.sortBy(categories,function(e){return-e.PowerSum}),_.each(categories,function(e){delete e.PowerSum}),categories},this.PredictorHasValidBuckets=function(predictor,totalLeads){if(null==predictor||null==totalLeads)return!1;for(var toReturn=!0,y=0;y<predictor.Elements.length;y++){var element=predictor.Elements[y],attributeValue=AnalyticAttributeUtility.GetAttributeBucketName(element,predictor),percentTotal=element.Count/totalLeads*100;if(null!=attributeValue&&("NULL"==attributeValue.toUpperCase()||"NOT AVAILABLE"==attributeValue.toUpperCase()||""===attributeValue)&&percentTotal>=99.5){toReturn=!1;break}}return toReturn},this.GetAttributesByCategory=function(modelSummary,categoryName,categoryColor,maxNumber){if(StringUtility.IsEmptyString(categoryName)||null==modelSummary.Predictors||null==maxNumber)return[];for(var totalPredictors=[],i=0;i<modelSummary.Predictors.length;i++)categoryName==modelSummary.Predictors[i].Category&&totalPredictors.push(modelSummary.Predictors[i]);totalPredictors=totalPredictors.sort(this.SortByPredictivePower);for(var toReturn=[],x=0;x<totalPredictors.length&&toReturn.length!=maxNumber;x++){var predictor=totalPredictors[x];if(AnalyticAttributeUtility.IsAllowedForInsights(predictor)&&this.PredictorHasValidBuckets(predictor,modelSummary.ModelDetails.TotalLeads)&&(this.ShowBasedOnInternalOrExternal(predictor,!0)||this.ShowBasedOnInternalOrExternal(predictor,!1))){var displayPredictor={name:predictor.Name,categoryName:categoryName,power:predictor.UncertaintyCoefficient,size:1,color:categoryColor};toReturn.push(displayPredictor)}}return toReturn},this.ShowBasedOnInternalOrExternal=function(predictor,isExternal){var toReturn=!1;if(null!=predictor&&null!=predictor.Tags){var tag=isExternal?"External":"Internal";if("Lead Information"===predictor.Category||"Marketing Activity"===predictor.Category){if(isExternal)return!1;tag="Internal"}for(var x=0;x<predictor.Tags.length;x++)if(tag==predictor.Tags[x]){toReturn=!0;break}}return toReturn},this.GetNumberOfAttributesByCategory=function(categoryList,isExternal,modelSummary){var toReturn={totalAttributeValues:0,total:0,categories:[]};if(null==categoryList||null==isExternal||null==modelSummary.Predictors)return toReturn;for(var x=0;x<categoryList.length;x++){for(var category=categoryList[x],displayCategory={name:category.name,count:0,color:category.color,activeClass:""},i=0;i<modelSummary.Predictors.length;i++){var predictor=modelSummary.Predictors[i];if(predictor.Category==category.name&&this.ShowBasedOnInternalOrExternal(predictor,isExternal)&&AnalyticAttributeUtility.IsAllowedForInsights(predictor)&&this.PredictorHasValidBuckets(predictor,modelSummary.ModelDetails.TotalLeads)){for(var y=0;y<predictor.Elements.length;y++){var element=predictor.Elements[y],percentTotal=element.Count/modelSummary.ModelDetails.TotalLeads*100,isCategorical=this.IsPredictorElementCategorical(element);isCategorical&&percentTotal<1||toReturn.totalAttributeValues++}displayCategory.count++}}displayCategory.count>0&&(toReturn.categories.push(displayCategory),toReturn.total+=displayCategory.count)}return toReturn},this.SortByCategoryName=function(a,b){return a.name.toUpperCase()<b.name.toUpperCase()?-1:a.name.toUpperCase()>b.name.toUpperCase()?1:0},this.SortBySize=function(a,b){return a.size>b.size?-1:a.size<b.size?1:0},this.SortByPredictivePower=function(a,b){return a.UncertaintyCoefficient>b.UncertaintyCoefficient?-1:a.UncertaintyCoefficient<b.UncertaintyCoefficient?1:0},this.SortByLift=function(a,b){return a.Lift>b.Lift?-1:a.Lift<b.Lift?1:0},this.AssignColorsToCategories=function(categoryList){if(null!=categoryList&&0!==categoryList.length){var possibleNumberofCategories=categoryList.length<=8?categoryList.length:8,colorChoices=["#4bd1bb","#00a2d0","#f6b300","#a981e1","#95cb2c","#9a9a9a","#3488d3","#e55e1b"];categoryList=categoryList.sort(this.SortByCategoryName);for(var i=0;i<possibleNumberofCategories;i++)categoryList[i].color=colorChoices[i]}},this.CalculateAttributeSize=function(attributeList,numLargeCategories,numMediumCategories){if(null==attributeList||0===attributeList.length)return null;null==numLargeCategories&&(numLargeCategories=Math.round(.16*attributeList.length)),null==numMediumCategories&&(numMediumCategories=Math.round(.32*attributeList.length));for(var i=0;i<attributeList.length;i++){var attribute=attributeList[i];numLargeCategories>0?(attribute.size=6.55,numLargeCategories--):numMediumCategories>0?(attribute.size=2.56,numMediumCategories--):attribute.size=1}},this.IsPredictorElementCategorical=function(predictorElement){return null!=predictorElement&&(null==predictorElement.LowerInclusive&&null==predictorElement.UpperExclusive&&null!=predictorElement.Values&&predictorElement.Values.length>0&&null!=predictorElement.Values[0])},this.GetTopPredictorExport=function(modelSummary){function cleanupForExcel(text){return text.replace("","'").replace("",'"').replace("",'"')}if(null==modelSummary||null==modelSummary.Predictors||0===modelSummary.Predictors.length)return null;var columns=[ResourceUtility.getString("TOP_PREDICTOR_EXPORT_CATEGORY_LABEL"),ResourceUtility.getString("TOP_PREDICTOR_EXPORT_ATTRIBUTE_NAME_LABEL"),ResourceUtility.getString("TOP_PREDICTOR_EXPORT_ATTRIBUTE_VALUE_LABEL"),ResourceUtility.getString("TOP_PREDICTOR_EXPORT_ATTRIBUTE_DESCRIPTION_LABEL"),ResourceUtility.getString("TOP_PREDICTOR_EXPORT_PERCENT_LEADS_LABEL"),ResourceUtility.getString("TOP_PREDICTOR_EXPORT_LIFT_LABEL"),ResourceUtility.getString("TOP_PREDICTOR_EXPORT_CONVERSION_RATE_LABEL"),ResourceUtility.getString("TOP_PREDICTOR_EXPORT_PREDICTIVE_POWER_LABEL")],toReturn=[];toReturn.push(columns);for(var totalPredictors=modelSummary.Predictors.sort(this.SortByPredictivePower),averageConversionRate=modelSummary.ModelDetails.TestingConversions/modelSummary.ModelDetails.TestingLeads,x=0;x<totalPredictors.length;x++){var predictor=totalPredictors[x];if(!StringUtility.IsEmptyString(predictor.Category)&&(this.ShowBasedOnInternalOrExternal(predictor,!0)||this.ShowBasedOnInternalOrExternal(predictor,!1))&&AnalyticAttributeUtility.IsAllowedForInsights(predictor)&&this.PredictorHasValidBuckets(predictor,modelSummary.ModelDetails.TotalLeads))for(var y=0;y<predictor.Elements.length;y++){var element=predictor.Elements[y],percentTotal=element.Count/modelSummary.ModelDetails.TotalLeads*100,isCategorical=this.IsPredictorElementCategorical(element);if(!(isCategorical&&percentTotal<1)){percentTotal=percentTotal.toFixed(1);var lift=element.Lift.toPrecision(2),conversionRate=element.Lift*averageConversionRate,description=cleanupForExcel(predictor.Description?predictor.Description:""),attributeValue=AnalyticAttributeUtility.GetAttributeBucketName(element,predictor);"NULL"!=attributeValue.toUpperCase()&&"NOT AVAILABLE"!=attributeValue.toUpperCase()||(attributeValue="N/A"),attributeValue="'"+attributeValue+"'";var predictivePower=100*predictor.UncertaintyCoefficient,attributeRow=[predictor.Category,predictor.DisplayName,attributeValue,description,percentTotal,lift,conversionRate,predictivePower];toReturn.push(attributeRow)}}}return toReturn},this.FormatDataForTopPredictorChart=function(modelSummary){if(null==modelSummary||null==modelSummary.Predictors||0===modelSummary.Predictors.length)return null;var topCategories=this.GetTopCategories(modelSummary);this.AssignColorsToCategories(topCategories),topCategories=topCategories.sort(this.SortByPredictivePower);for(var category,attributesPerCategory=3,numLargeCategories=Math.round(topCategories.length*attributesPerCategory*.16),numMediumCategories=Math.round(topCategories.length*attributesPerCategory*.32),totalAttributes=[],x=0;x<topCategories.length;x++){category=topCategories[x],category.children=this.GetAttributesByCategory(modelSummary,category.name,category.color,attributesPerCategory);for(var y=0;y<category.children.length;y++)totalAttributes.push(category.children[y])}this.CalculateAttributeSize(totalAttributes,numLargeCategories,numMediumCategories),topCategories=topCategories.sort(this.SortBySize);var toReturn={name:"root",size:1,color:"#FFFFFF",attributesPerCategory:attributesPerCategory,children:topCategories};return toReturn},this.GetAttributeByName=function(attributeName,predictorList){if(null==attributeName||null==predictorList)return null;for(var i=0;i<predictorList.length;i++)if(attributeName==predictorList[i].Name)return predictorList[i];return null},this.FormatDataForAttributeValueChart=function(attributeName,attributeColor,modelSummary){if(null==attributeName||null==modelSummary)return null;var predictor=this.GetAttributeByName(attributeName,modelSummary.Predictors);if(null==predictor)return null;var toReturn={name:predictor.DisplayName,color:attributeColor,description:predictor.Description||"",elementList:[]},maxElementsToDisplay=7,nullBucket=null,otherBucket=null,otherBucketElements=[],topBucketCandidates=[],doOtherBucket=!1,isContinuous=!1,i=0,bucket=null,bucketName=null;if(!AnalyticAttributeUtility.IsPredictorBoolean(predictor))for(i=0;i<predictor.Elements.length;i++){if(bucket=predictor.Elements[i],this.IsPredictorElementCategorical(bucket)){doOtherBucket=!0;break}if(null!=bucket.LowerInclusive||null!=bucket.UpperExclusive){isContinuous=!0;break}}if(doOtherBucket)for(i=0;i<predictor.Elements.length;i++){bucket=predictor.Elements[i],bucketName=AnalyticAttributeUtility.GetAttributeBucketName(bucket,predictor);var percentTotal=bucket.Count/modelSummary.ModelDetails.TotalLeads*100;percentTotal<1||null!=bucketName&&"string"==typeof bucketName&&"other"==bucketName.toLowerCase()?otherBucketElements.push(bucket):topBucketCandidates.push(bucket)}var topPredictorElements=null;for(topPredictorElements=doOtherBucket?topBucketCandidates:predictor.Elements,i=0;i<topPredictorElements.length;i++){bucket=topPredictorElements[i],bucketName=AnalyticAttributeUtility.GetAttributeBucketName(bucket,predictor);var bucketToDisplay={name:bucketName,lift:bucket.Lift,percentTotal:bucket.Count/modelSummary.ModelDetails.TotalLeads*100};if(isContinuous?bucketToDisplay.SortProperty=null!=bucket.LowerInclusive?bucket.LowerInclusive:bucket.UpperExclusive:bucketToDisplay.SortProperty=bucketToDisplay.lift,bucket.IsVisible){if(null!=bucketToDisplay.name&&"string"==typeof bucketToDisplay.name&&("NULL"===bucketToDisplay.name.toUpperCase()||"NONE"===bucketToDisplay.name.toUpperCase()||"NOT AVAILABLE"===bucketToDisplay.name.toUpperCase())){nullBucket=bucketToDisplay,nullBucket.name="N/A";continue}toReturn.elementList.push(bucketToDisplay)}}toReturn.elementList.sort(function(a,b){return a.SortProperty<b.SortProperty?isContinuous?-1:1:a.SortProperty==b.SortProperty?0:a.SortProperty>b.SortProperty?isContinuous?1:-1:0});var nullBucketLength=null==nullBucket?0:1,otherBucketLength=otherBucketElements.length>0?1:0,currentTotalNumBuckets=toReturn.elementList.length+nullBucketLength+otherBucketLength;if(currentTotalNumBuckets>maxElementsToDisplay){var numToRemove=currentTotalNumBuckets-maxElementsToDisplay,removed=toReturn.elementList.splice(toReturn.elementList.length-numToRemove,numToRemove);Array.prototype.push.apply(otherBucketElements,removed)}if(otherBucketElements.length>0){var otherBucketTotalPercentage=0,averagedLift=0;for(i=0;i<otherBucketElements.length;i++){var otherBucketElement=otherBucketElements[i],otherBucketPercentage=null!=otherBucketElement.Count?otherBucketElement.Count/modelSummary.ModelDetails.TotalLeads:otherBucketElement.percentTotal/100;otherBucketTotalPercentage+=otherBucketPercentage;var otherBucketLift=null!=otherBucketElement.Lift?otherBucketElement.Lift:otherBucketElement.lift;averagedLift+=otherBucketLift*otherBucketPercentage}otherBucket={name:"Other",lift:averagedLift/otherBucketTotalPercentage,percentTotal:100*otherBucketTotalPercentage}}return null!=otherBucket&&toReturn.elementList.push(otherBucket),null!=nullBucket&&toReturn.elementList.push(nullBucket),isContinuous&&null!=nullBucket&&2==toReturn.elementList.length&&(toReturn.elementList[0].name="Available"),toReturn},this.SumToOne=function(percentList){for(var topPercentage=100,index=0,maxPercentage=0,i=0;i<percentList.length;i++){var currentPercentage=0;currentPercentage="string"==typeof percentList[i]&&"<0.1"==percentList[i]?.1:percentList[i],currentPercentage>maxPercentage&&(index=i,maxPercentage=currentPercentage)}for(i=0;i<percentList.length;i++)i!=index&&(topPercentage-="string"==typeof percentList[i]&&"<0.1"==percentList[i]?.1:percentList[i]);return percentList[index]=topPercentage.toFixed(1),percentList},this.FormatPercent=function(percent){var formattedPercent=percent;return formattedPercent=formattedPercent>=.95?Math.round(formattedPercent):formattedPercent<=.95&&formattedPercent>=.1?Number(formattedPercent.toFixed(1)):"<0.1"},this.createTicks=function(maxTickValue,maxTickNumber){for(var steps=[.5,1,2,5,10],step=_.reduce(steps,function(memo,s){return maxTickNumber*memo>=maxTickValue?memo:s},0);maxTickNumber*step<maxTickValue;)step*=2;for(var tick=0,ticks=[tick];tick<maxTickValue;)tick+=step,ticks.push(tick);return ticks},this.ClearCategoryClasses=function(categoryList){if(null!=categoryList&&0!==categoryList.length)for(var i=0;i<categoryList.length;i++)categoryList[i].activeClass=""}}),angular.module("mainApp.appCommon.services.WidgetFrameworkService",["mainApp.appCommon.utilities.WidgetConfigUtility","mainApp.appCommon.utilities.MetadataUtility","mainApp.appCommon.widgets.RepeaterWidget","mainApp.appCommon.widgets.ScreenWidget","mainApp.appCommon.widgets.ArcChartWidget","mainApp.appCommon.widgets.CollapsiblePanelWidget","mainApp.appCommon.widgets.ScreenHeaderWidget","mainApp.appCommon.widgets.SimpleGridWidget","mainApp.appCommon.widgets.SimpleTabWidget","mainApp.appCommon.widgets.TabWidget","mainApp.appCommon.widgets.TopPredictorWidget","mainApp.appCommon.widgets.ThresholdExplorerWidget","mainApp.appCommon.widgets.PerformanceTabWidget","mainApp.appCommon.widgets.UserManagementWidget","mainApp.appCommon.widgets.AdminInfoSummaryWidget","mainApp.appCommon.widgets.AdminInfoAlertsWidget","mainApp.appCommon.widgets.LeadsTabWidget","mainApp.appCommon.widgets.ModelListCreationHistoryWidget","mainApp.appCommon.widgets.ManageFieldsWidget"]).service("WidgetFrameworkService",function($compile,$rootScope,WidgetConfigUtility,MetadataUtility){this.CreateWidget=function(options){if(null!=options&&null!=options.element&&null!=options.widgetConfig){var root=$rootScope,scope=root.$new();switch(scope.data=options.data,scope.parentData=options.parentData,scope.metadata=options.metadata,scope.widgetConfig=options.widgetConfig,scope.element=options.element,scope.isActive=options.isActive,options.widgetConfig.Type){case WidgetConfigUtility.ANALYTIC_ATTRIBUTE_LIST_WIDGET:$compile(options.element.html("<div data-analytic-attribute-list-widget></div>"))(scope);break;case WidgetConfigUtility.ANALYTIC_ATTRIBUTE_TILE_WIDGET:$compile(options.element.html("<div data-analytic-attribute-tile-widget></div>"))(scope);break;case WidgetConfigUtility.ARC_CHART_WIDGET:$compile(options.element.html("<div data-arc-chart-widget></div>"))(scope);break;case WidgetConfigUtility.COLLAPSIBLE_PANEL_WIDGET:$compile(options.element.html("<div data-collapsible-panel-widget></div>"))(scope);break;case WidgetConfigUtility.GRID_WIDGET:break;case WidgetConfigUtility.LEAD_DETAILS_TILE_WIDGET:$compile(options.element.html("<div data-lead-details-tile-widget></div>"))(scope);break;case WidgetConfigUtility.MODEL_DETAILS_WIDGET:$compile(options.element.html("<div data-model-details-widget></div>"))(scope);break;case WidgetConfigUtility.MODEL_LIST_TILE_WIDGET:$compile(options.element.html("<div data-model-list-tile-widget></div>"))(scope);break;case WidgetConfigUtility.MODEL_LIST_CREATION_HISTORY:$compile(options.element.html("<div data-model-list-creation-history-widget></div>"))(scope);break;case WidgetConfigUtility.PLAY_DETAILS_TILE_WIDGET:$compile(options.element.html("<div data-play-details-tile-widget></div>"))(scope);break;case WidgetConfigUtility.PLAY_LIST_TILE_WIDGET:$compile(options.element.html("<div data-play-list-tile-widget></div>"))(scope);break;case WidgetConfigUtility.REPEATER_WIDGET:$compile(options.element.html("<div data-repeater-widget></div>"))(scope);break;case WidgetConfigUtility.SCREEN_WIDGET:$compile(options.element.html("<div data-screen-widget></div>"))(scope);break;case WidgetConfigUtility.SCREEN_HEADER_WIDGET:$compile(options.element.html("<div data-screen-header-widget></div>"))(scope);break;case WidgetConfigUtility.SIMPLE_GRID_WIDGET:$compile(options.element.html("<div data-simple-grid-widget></div>"))(scope);break;case WidgetConfigUtility.SIMPLE_TAB_WIDGET:$compile(options.element.html("<div data-simple-tab-widget></div>"))(scope);break;case WidgetConfigUtility.TALKING_POINT_WIDGET:$compile(options.element.html("<div data-talking-point-widget></div>"))(scope);break;case WidgetConfigUtility.TAB_WIDGET:$compile(options.element.html("<div data-tab-widget></div>"))(scope);break;case WidgetConfigUtility.TEST_WIDGET:break;case WidgetConfigUtility.THRESHOLD_EXPLORER_WIDGET:$compile(options.element.html("<div data-threshold-explorer-widget></div>"))(scope);break;case WidgetConfigUtility.PERFORMANCE_TAB_WIDGET:$compile(options.element.html("<div data-performance-tab-widget></div>"))(scope);break;case WidgetConfigUtility.TOP_PREDICTOR_WIDGET:$compile(options.element.html("<div data-top-predictor-widget></div>"))(scope);break;case WidgetConfigUtility.ADMIN_INFO_SUMMARY_WIDGET:$compile(options.element.html("<div data-admin-info-summary-widget></div>"))(scope);break;case WidgetConfigUtility.ADMIN_INFO_ALERTS_WIDGET:$compile(options.element.html("<div data-admin-info-alerts-widget></div>"))(scope);break;case WidgetConfigUtility.LEADS_TAB_WIDGET:$compile(options.element.html("<div data-leads-tab-widget></div>"))(scope);break;case WidgetConfigUtility.USER_MANAGEMENT_WIDGET:$compile(options.element.html("<div data-user-management-widget></div>"))(scope);break;case WidgetConfigUtility.MANAGE_FIELDS_WIDGET:$compile(options.element.html("<div data-manage-fields-widget></div>"))(scope);break;default:return}}},this.CreateChildWidgets=function(options,dataForChildren){var numLayoutColumns=options.widgetConfig.Columns||1;this.CreateChildWidgetsInColumnLayout(options,dataForChildren,numLayoutColumns)},this.CreateChildWidgetsInColumnLayout=function(options,dataForChildren,numLayoutColumns){var self=this;if(null!=options&&null!=options.widgetConfig){var children=options.widgetConfig.Widgets;null!=children&&self.CreateWidgetsInColumnLayout(options.element,children.length,numLayoutColumns,function(childElement,numItems,childIndex){self.CreateChildWidget(options,childElement,children,dataForChildren,numItems,childIndex)})}},this.CreateWidgetsInColumnLayout=function(element,numItems,numCols,createWidgetCallback){var isMultiCol=1!==numCols&&"number"==typeof numCols,colClass="layout-column";isMultiCol&&this.CreateLayoutColumnHtml(element,numCols,colClass);for(var numItemsPerCol=Math.floor(numItems/numCols),leftoverItems=numItems%numCols,curColNum=0,curColItemCount=0,i=0;i<numItems;i++){var childElement=$("<div></div>");isMultiCol?(curColItemCount>=numItemsPerCol&&(leftoverItems>0&&curColItemCount==numItemsPerCol?leftoverItems--:(curColNum++,curColItemCount=0)),curColItemCount++,this.AddItemToColumn(element,colClass,curColNum,childElement)):this.AddItemToElement(element,childElement),"function"==typeof createWidgetCallback&&createWidgetCallback(childElement,numItems,i)}},this.CreateLayoutColumnHtml=function(element,numCols,colClass){for(var colWidth=100/numCols,col=0;col<numCols;col++){
var cols=$('<div class="float-left '+colClass+" "+colClass+"-"+col+'"></div>');$(element).append(cols),cols.css("width",colWidth+"%")}},this.AddItemToColumn=function(element,colClass,curColNum,item){var curCol=$(element).find("."+colClass+"-"+curColNum);$(curCol).append(item)},this.AddItemToElement=function(element,item){$(element).append(item)},this.CreateChildWidget=function(options,childElement,children,dataForChildren,numChildren,index){var child=children[index],childData=this.GetChildDataAtIndex(dataForChildren,numChildren,index),childIsActive=options.isActive;this.CreateWidget({scope:options.scope,element:childElement,widgetConfig:child,metadata:options.metadata,data:childData,parentData:options.parentData,isActive:childIsActive})},this.IsChildActive=function(activeWidgetStates,childIndex,numChildren){if(!Array.isArray(activeWidgetStates))return!0;var isAllActive=activeWidgetStates.indexOf(WidgetConfigUtility.ACTIVE_WIDGET_ALL)!==-1,isEvenActive=activeWidgetStates.indexOf(WidgetConfigUtility.ACTIVE_WIDGET_EVEN)!==-1,isFirstActive=activeWidgetStates.indexOf(WidgetConfigUtility.ACTIVE_WIDGET_FIRST)!==-1,isLastActive=activeWidgetStates.indexOf(WidgetConfigUtility.ACTIVE_WIDGET_LAST)!==-1,isNoneActive=activeWidgetStates.indexOf(WidgetConfigUtility.ACTIVE_WIDGET_NONE)!==-1,isOddActive=activeWidgetStates.indexOf(WidgetConfigUtility.ACTIVE_WIDGET_ODD)!==-1,isChildActive=!1;return isAllActive?isChildActive=!0:isNoneActive?isChildActive=!1:isEvenActive||isFirstActive||isLastActive||isOddActive?(isEvenActive&&(isChildActive=isChildActive||(childIndex+1)%2===0),isFirstActive&&(isChildActive=isChildActive||0===childIndex),isLastActive&&(isChildActive=isChildActive||childIndex===numChildren-1),isOddActive&&(isChildActive=isChildActive||(childIndex+1)%2!==0)):isChildActive=!0,isChildActive},this.GetChildDataAtIndex=function(dataForChildren,numChildren,index){var childData=null;return childData=dataForChildren instanceof Array&&dataForChildren.length===numChildren?dataForChildren[index]:dataForChildren},this.GetSortProperties=function(widgetConfig,metadata){if(null==widgetConfig)return[];var widgetConfigSorts=widgetConfig.Sorts;if(!(widgetConfigSorts instanceof Array))return[];if(null==metadata)return[];for(var targetNotionMetadata=MetadataUtility.GetNotionMetadata(widgetConfig.TargetNotion,metadata),propsToSortOn=[],i=0;i<widgetConfigSorts.length;i++){var widgetConfigSort=widgetConfigSorts[i];if(null!=widgetConfigSort){var propName=widgetConfigSort.Property,propIsAscending=widgetConfigSort.IsAscending,metadataProperty=MetadataUtility.GetNotionProperty(propName,targetNotionMetadata),propTypeString=null!=metadataProperty?metadataProperty.PropertyTypeString:null,propCompareFunction=MetadataUtility.GetCompareFunction(propTypeString),prop={Name:propName,IsAscending:propIsAscending,CompareFunction:propCompareFunction};propsToSortOn.push(prop)}}return propsToSortOn}}),angular.module("mainApp.appCommon.utilities.AnalyticAttributeUtility",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.DateTimeFormatUtility","mainApp.appCommon.utilities.NumberUtility"]).service("AnalyticAttributeUtility",function(ResourceUtility,DateTimeFormatUtility,NumberUtility){this.ApprovedUsage={None:"None",Model:"Model",ModelAndModelInsights:"ModelAndModelInsights",ModelAndAllInsights:"ModelAndAllInsights",IndividualDisplay:"IndividualDisplay"},this.DataType={String:"STRING",LongString:"LONGSTRING",Date:"DATE",DateTime:"DATETIME",Time:"TIME",Double:"DOUBLE",Float:"FLOAT",Int:"INT",Integer:"INTEGER",Short:"SHORT",Long:"LONG",Boolean:"BOOLEAN",Bit:"BIT",Epoch:"EPOCHTIME"},this.FundamentalType={Email:"EMAIL",Probability:"PROBABILITY",Phone:"PHONE",Enum:"ENUM",URI:"URI",Currency:"CURRENCY",Percent:"PERCENT",Year:"YEAR",Boolean:"BOOLEAN",Numeric:"NUMERIC"},this.FindAttributeMetadataData=function(modelSummary,attributeData){if(null==attributeData||null==modelSummary||null==modelSummary.AttributeMetadata||0===modelSummary.AttributeMetadata.length)return null;for(var i=0;i<modelSummary.AttributeMetadata.length;i++)if(attributeData.AttributeName==modelSummary.AttributeMetadata[i].ColumnName)return modelSummary.AttributeMetadata[i];return null},this.FindAttributeBucket=function(modelSummary,attributeData){if(null==attributeData||null==modelSummary||null==modelSummary.Summary||null==modelSummary.Summary.Predictors||0===modelSummary.Summary.Predictors.length)return null;for(var predictor=null,i=0;i<modelSummary.Summary.Predictors.length;i++)if(attributeData.AttributeName==modelSummary.Summary.Predictors[i].Name){predictor=modelSummary.Summary.Predictors[i];break}if(null==predictor||null==predictor.Elements||0===predictor.Elements.length)return null;for(var x=0;x<predictor.Elements.length;x++){var bucket=predictor.Elements[x];if(null!=bucket.Values&&bucket.Values.length>0){for(var y=0;y<bucket.Values.length;y++)if(attributeData.AttributeValue==bucket.Values[y])return bucket}else{var lowerBound=null!=bucket.LowerInclusive?parseFloat(bucket.LowerInclusive):null,upperBound=null!=bucket.UpperExclusive?parseFloat(bucket.UpperExclusive):null,parsedAttributeValue=null!=attributeData.AttributeValue?parseFloat(attributeData.AttributeValue):null;if(parsedAttributeValue>=lowerBound&&(parsedAttributeValue<upperBound||null==upperBound))return bucket}}return null},this.FormatBooleanBucketName=function(value){var toReturn=value;return"NA"==value||"N/A"==value||"NULL"==value||"NOT AVAILABLE"==value||parseInt(value)==-1?toReturn="Not Available":"N"==value||"NO"==value||"FALSE"==value||"F"==value||0===parseInt(value)?toReturn="No":"Y"!=value&&"YES"!=value&&"TRUE"!=value&&"T"!=value&&1!=parseInt(value)||(toReturn="Yes"),toReturn},this.GetAttributeBucketName=function(bucket,attributeMetadata){if(null==bucket)return"";var lowerValue,upperValue,toReturn=null;if(null!=bucket.Values&&bucket.Values.length>0)if(null==bucket.Values[0])toReturn=ResourceUtility.getString("ANALYTIC_ATTRIBUTE_NULL_VALUE_LABEL");else{if(null!=attributeMetadata){var fundamentalType=null!=attributeMetadata.FundamentalType?attributeMetadata.FundamentalType.toUpperCase():null;if(fundamentalType==this.FundamentalType.Boolean){var value=bucket.Values[0].toString().toUpperCase();return toReturn=this.FormatBooleanBucketName(value)}}for(var discreteValueString="",i=0;i<bucket.Values.length;i++){var bucketValue=this.FormatBucketValue(bucket.Values[i],attributeMetadata);""===discreteValueString?discreteValueString=bucketValue:discreteValueString+=", "+bucketValue}toReturn=discreteValueString}else if(null!=bucket.LowerInclusive&&null!=bucket.UpperExclusive)if(null!=attributeMetadata){var dataType=null!=attributeMetadata.DataType?attributeMetadata.DataType.toUpperCase():null;dataType==this.DataType.Int||dataType==this.DataType.Integer?toReturn=this.FormatIntegerBucket(bucket.LowerInclusive,bucket.UpperExclusive,attributeMetadata):(lowerValue=this.FormatBucketValue(bucket.LowerInclusive,attributeMetadata),upperValue=this.FormatBucketValue(bucket.UpperExclusive,attributeMetadata),toReturn=ResourceUtility.getString("ANALYTIC_ATTRIBUTE_CONTINUOUS_BETWEEN_LABEL",[lowerValue,upperValue]))}else lowerValue=this.FormatBucketValue(bucket.LowerInclusive,attributeMetadata),upperValue=this.FormatBucketValue(bucket.UpperExclusive,attributeMetadata),toReturn=ResourceUtility.getString("ANALYTIC_ATTRIBUTE_CONTINUOUS_BETWEEN_LABEL",[lowerValue,upperValue]);else null==bucket.LowerInclusive&&null==bucket.UpperExclusive?toReturn=ResourceUtility.getString("ANALYTIC_ATTRIBUTE_ALL_VALUES_LABEL"):null!=bucket.LowerInclusive?(lowerValue=this.FormatBucketValue(bucket.LowerInclusive,attributeMetadata),toReturn=ResourceUtility.getString("ANALYTIC_ATTRIBUTE_GREATER_THAN_LABEL",[lowerValue])):(upperValue=this.FormatBucketValue(bucket.UpperExclusive,attributeMetadata),toReturn=ResourceUtility.getString("ANALYTIC_ATTRIBUTE_LESS_THAN_LABEL",[upperValue]));return String(toReturn)},this.FormatIntegerBucket=function(lower,upper,attributeMetadata){if(upper-lower<=1)return lower;var lowerValue=this.FormatBucketValue(lower,attributeMetadata),upperValue=this.FormatBucketValue(upper-1,attributeMetadata);return ResourceUtility.getString("ANALYTIC_ATTRIBUTE_CONTINUOUS_BETWEEN_LABEL",[lowerValue,upperValue])},this.AbbreviateNumber=function(realValue,fundamentalType){var parsedValue=parseFloat(realValue);if(isNaN(parsedValue))return realValue;if(fundamentalType==this.FundamentalType.Year)return parsedValue;var abbreviatedNumber;return abbreviatedNumber=0===parsedValue?parsedValue:parsedValue<1?parsedValue.toFixed(2):parsedValue<1e3&&parsedValue%1!==0?parsedValue.toFixed(1):NumberUtility.AbbreviateLargeNumber(parsedValue,1)},this.IsPredictorBoolean=function(attributeMetadata){if(null==attributeMetadata)return!1;var fundamentalType=null!=attributeMetadata.FundamentalType?attributeMetadata.FundamentalType.toUpperCase():null;return fundamentalType==this.FundamentalType.Boolean},this.FormatBucketValue=function(value,attributeMetadata){if(null==value||null==attributeMetadata)return value;var fundamentalType=null!=attributeMetadata.FundamentalType?attributeMetadata.FundamentalType.toUpperCase():null;if(fundamentalType==this.FundamentalType.Year||fundamentalType==this.FundamentalType.Currency||fundamentalType==this.FundamentalType.Numeric||fundamentalType==this.FundamentalType.Percent){var abbreviatedNumber=this.AbbreviateNumber(value,fundamentalType);return fundamentalType==this.FundamentalType.Currency?ResourceUtility.getString("CURRENCY_SYMBOL")+abbreviatedNumber:fundamentalType==this.FundamentalType.Percent?abbreviatedNumber+"%":abbreviatedNumber}var toReturn,dataType=null!=attributeMetadata.DataType?attributeMetadata.DataType.toUpperCase():null;switch(dataType){case this.DataType.Double:case this.DataType.Int:case this.DataType.Integer:case this.DataType.Short:case this.DataType.Long:case this.DataType.Float:toReturn=this.AbbreviateNumber(value,fundamentalType);break;case this.DataType.Date:toReturn=DateTimeFormatUtility.FormatStringDate(value,!1);break;case this.DataType.DateTime:case this.DataType.Time:toReturn=DateTimeFormatUtility.FormatStringDate(value,!0);break;case this.DataType.Boolean:case this.DataType.Bit:toReturn=this.FormatBooleanValueForDisplay(value);break;case this.DataType.Epoch:toReturn=DateTimeFormatUtility.FormatEpochDate(value);break;default:toReturn=value}return toReturn},this.SortAttributeList=function(groomedAttributeList,descending){return null==groomedAttributeList||0===groomedAttributeList.length?groomedAttributeList:(descending===!1?groomedAttributeList.sort(function(a,b){return a.Lift-b.Lift<0?-1:a.Lift-b.Lift===0?0:a.Lift-b.Lift>0?1:0}):groomedAttributeList.sort(function(a,b){return b.Lift-a.Lift<0?-1:b.Lift-a.Lift===0?0:b.Lift-a.Lift>0?1:0}),groomedAttributeList)},this.FormatLift=function(rawLift){return null==rawLift||"number"!=typeof rawLift?null:0===rawLift?"0":rawLift.toFixed(1)},this.ShouldShowNullBucket=function(bucket,nullThreshold){if(null==bucket)return!1;if(nullThreshold=null!=nullThreshold?parseFloat(nullThreshold):100,null!=bucket.Values&&bucket.Values.length>0)for(var i=0;i<bucket.Values.length;i++)if(null==bucket.Values[i]&&bucket.Lift<=nullThreshold)return!1;return!0},this.ShowBasedOnTags=function(widgetConfig,attributeMetadata){if(null==widgetConfig||null==attributeMetadata)return!1;null==attributeMetadata.Tags&&(attributeMetadata.Tags=[]);var hasAllRequired=!0;if(null!=widgetConfig.RequiredTags)for(var i=0;i<widgetConfig.RequiredTags.length;i++){for(var requiredTag=widgetConfig.RequiredTags[i],hasRequired=!1,x=0;x<attributeMetadata.Tags.length;x++)if(requiredTag==attributeMetadata.Tags[x]){hasRequired=!0;break}if(!hasRequired){hasAllRequired=!1;break}}var hasExcluded=!1;if(null!=widgetConfig.ExcludedTags)for(var y=0;y<widgetConfig.ExcludedTags.length;y++)for(var excludedTag=widgetConfig.ExcludedTags[y],z=0;z<attributeMetadata.Tags.length;z++)if(excludedTag==attributeMetadata.Tags[z]){hasExcluded=!0;break}return!hasExcluded&&!(null!=widgetConfig.RequiredTags&&!hasAllRequired)},this.IsApprovedForUsage=function(usage,attributeMetadata){if(null==usage||null==attributeMetadata||null==attributeMetadata.ApprovedUsage)return!1;for(var i=0;i<attributeMetadata.ApprovedUsage.length;i++)if(attributeMetadata.ApprovedUsage[i]==usage)return!0;return!1},this.IsAllowedForInsights=function(attributeMetadata){return null!=attributeMetadata&&(null==attributeMetadata.ApprovedUsage||0===attributeMetadata.ApprovedUsage.length||(this.IsApprovedForUsage(this.ApprovedUsage.ModelAndAllInsights,attributeMetadata)===!0||this.IsApprovedForUsage(this.ApprovedUsage.ModelAndModelInsights,attributeMetadata)===!0))},this.FormatBooleanValueForDisplay=function(booleanValue){return null===booleanValue||""===booleanValue||void 0===booleanValue?"":("boolean"!=typeof booleanValue&&"number"!=typeof booleanValue||(booleanValue=booleanValue.toString()),booleanValue=booleanValue.toUpperCase(),"1"==booleanValue||"TRUE"===booleanValue?ResourceUtility.getString("BOOLEAN_TRUE_DISPLAY_LABEL"):"0"==booleanValue||"FALSE"===booleanValue?ResourceUtility.getString("BOOLEAN_FALSE_DISPLAY_LABEL"):"")},this.GetAttributeList=function(groomedPositiveAttributeList,groomedNegativeAttributeList,attributeLimit,score){return groomedPositiveAttributeList.length+groomedNegativeAttributeList.length<=attributeLimit?groomedPositiveAttributeList.concat(groomedNegativeAttributeList):score>=80?this.PopulateGroomedAttributeList(groomedPositiveAttributeList,groomedNegativeAttributeList,attributeLimit,5):score>=60?this.PopulateGroomedAttributeList(groomedPositiveAttributeList,groomedNegativeAttributeList,attributeLimit,4):score>=40?this.PopulateGroomedAttributeList(groomedPositiveAttributeList,groomedNegativeAttributeList,attributeLimit,3):this.PopulateGroomedAttributeList(groomedPositiveAttributeList,groomedNegativeAttributeList,attributeLimit,0)},this.PopulateGroomedAttributeList=function(groomedPositiveAttributeList,groomedNegativeAttributeList,attributeLimit,positiveAttributeCount){var groomedAttributeList=[];if(attributeLimit<positiveAttributeCount)return groomedAttributeList;if(groomedPositiveAttributeList.length<=positiveAttributeCount){groomedAttributeList=groomedPositiveAttributeList;for(var posAttrListLen=groomedPositiveAttributeList.length,i=0;i<attributeLimit-posAttrListLen&&i<groomedNegativeAttributeList.length;i++)groomedAttributeList.push(groomedNegativeAttributeList[i])}else{groomedNegativeAttributeList.length<attributeLimit-positiveAttributeCount&&(positiveAttributeCount=Math.min(attributeLimit-groomedNegativeAttributeList.length,groomedPositiveAttributeList.length));for(var j=0;j<positiveAttributeCount;j++)groomedAttributeList.push(groomedPositiveAttributeList[j]);for(var k=0;k<attributeLimit-positiveAttributeCount;k++)groomedAttributeList.push(groomedNegativeAttributeList[k])}return groomedAttributeList},this.GetLeadCount=function(modelSummary){return modelSummary.Summary.DLEventTableData.SourceRowCount}}),angular.module("mainApp.appCommon.utilities.AnimationUtility",[]).service("AnimationUtility",function(){this.CalculateRgbBetweenValues=function(highColor,lowColor,scalor){if(null==highColor||null==lowColor||null==scalor||scalor<0)return null;scalor>1&&(scalor/=100);var diffRed=scalor*highColor.R+(1-scalor)*lowColor.R,diffGreen=scalor*highColor.G+(1-scalor)*lowColor.G,diffBlue=scalor*highColor.B+(1-scalor)*lowColor.B;return diffRed=Math.round(diffRed),diffGreen=Math.round(diffGreen),diffBlue=Math.round(diffBlue),{R:diffRed,G:diffGreen,B:diffBlue}},this.ConvertSingleRgbToHex=function(c){if(null==c)return null;var hex=c.toString(16);return 1==hex.length?"0"+hex:hex},this.ConvertRgbToHex=function(r,g,b){return null==r||null==g||null==b?null:"#"+this.ConvertSingleRgbToHex(r)+this.ConvertSingleRgbToHex(g)+this.ConvertSingleRgbToHex(b)}}),angular.module("mainApp.appCommon.utilities.AuthenticationUtility",["mainApp.appCommon.utilities.URLUtility"]).service("AuthenticationUtility",function(URLUtility){this.AppendHttpHeaders=function($http){if(null!=$http){$http.defaults.timeout=12e4;var type=URLUtility.GetSSOType();switch(type){case URLUtility.SALESFORCE:null!=URLUtility.Directory()&&($http.defaults.headers.common.Directory=URLUtility.Directory()),$http.defaults.headers.common.sessionid=URLUtility.CrmSessionID(),$http.defaults.headers.common.serverurl=URLUtility.CrmServerURL(),$http.defaults.headers.common.userlink=URLUtility.CrmUser();break;case URLUtility.SAML:null!=URLUtility.SamlDirectoryValue()&&($http.defaults.headers.common.Directory=URLUtility.SamlDirectoryValue()),$http.defaults.headers.common.LESAMLUserLookup=URLUtility.SamlResponseValue();break;case URLUtility.LEA:null!=URLUtility.Directory()&&($http.defaults.headers.common.Directory=URLUtility.Directory()),$http.defaults.headers.common.LEAuthenticatedLookup=URLUtility.LeaResponse();break;case URLUtil.ORACLE:$http.defaults.headers.common.Directory=URLUtility.Directory(),$http.defaults.headers.common.ssoToken=URLUtility.CrmSessionID(),$http.defaults.headers.common.hostName=URLUtility.CrmServerURL(),$http.defaults.headers.common.userlink=URLUtility.CrmUser()}}}}),angular.module("mainApp.appCommon.utilities.ConfigConstantUtility",[]).service("ConfigConstantUtility",function(){this.ViewAccount="VIEW_ACCOUNT",this.ViewActionItems="VIEW_ACTION_ITEMS",this.ViewAdmin="VIEW_ADMIN",this.ViewBard="VIEW_LEAD_SCORING",this.ViewMessages="VIEW_INVITATION",this.ViewPlay="VIEW_PLAY",this.ViewSales="VIEW_SALES",this.ViewDashboardCenter="VIEW_DASHBOARDCENTER",this.ViewChangePassword="VIEW_CHANGE_PASSWORD",this.ViewProductHierarchy="VIEW_PRODUCTHIERARCHY",this.ActionCenterHash="#ActionCenter",this.SalesListHash="#SalesList",this.PlayListHash="#PlayList",this.LaunchMetricsHash="#LaunchMetrics",this.LaunchRulesHash="#LaunchRules",this.LaunchFiltersHash="#LaunchFilters",this.PlayQuestionsHash="#PlayQuestions",this.HoldoutsHash="#Holdouts",this.ConfigConsoleHash="#ConfigConsole",this.AdminConsoleHash="#AdminConsole",this.UsersHash="#Users",this.UserGroupsHash="#UserGroups",this.AlertsHash="#Alerts",this.PreviewAlertsHash="#PreviewAlerts",this.FileTemplatesHash="#FileTemplates",this.MailTemplatesHash="#MailTemplates",this.FileUploadHash="#FileUpload",this.ExternalDataHash="#ExternalData",this.InvitationsHash="#Invitations",this.ProductHierarchyHash="#ProductHierarchy",this.BardStatusHash="#BardStatus",this.BardConfigHash="#BardConfig",this.BardReportHash="#BardReport",this.BardModelHash="#BardModel",this.DantePlayHash="#DantePlays",this.DantePurchaseTrendsHash="#DantePurchaseTrends",this.DanteCompanyDetailsHash="#DanteCompanyDetails",this.DanteContactsHash="#DanteContacts",this.Play="Play",this.ApprovePlay="Approve_Play",this.DetailedDescriptionDataKey="DetailedDescription",this.ImpersonationWriteError="IMPERSONATION_WRITE_ERROR",this.ValidationInProgressError="VALIDATION_ALREADY_IN_PROGRESS",this.ModelScoreErrorTargetFilterNoTargets="MODELSCORE_TARGET_FILTERS_NO_ACCOUNTS",this.ModelScoreErrorTrainingFilterNoTargets="MODELSCORE_TRAINING_FILTERS_NO_ACCOUNTS",this.SalesHelp="/Help/Sales_Help/index.html",this.PlayHelp="/Help/PlayMaker_Help/index.html",this.AdminHelp="/Help/Admin_Help/index.html",this.ScoreSourceAnalytic="Analytics",this.ScoreSourceUploaded="Uploaded",this.ScoreSourceRuleBased="RuleBased",this.ScoreSourceUnspecified="Unspecified",this.StringShort=150,this.StringInternalName=50,this.FileUploadMaxBytes=4194304,this.NumericFieldMaxLength=9,this.MonetaryFieldMaxLength=12,this.PlayStageDetails="Details",this.PlayStageTargets="Targets",this.PlayStageRules="Rules",this.PlayStageScore="Score",this.PlayStageContent="Content",this.PlayStageComplete="Complete",this.PlayScoreNone="None",this.PlayScoreError="Error",this.PlayScoreCanceled="Canceled",this.PlayScoreProcessing="Processing",this.PlayScoreComplete="Complete",this.Contains="CONTAINS",this.Equal="EQUAL",this.GreaterThan="GREATER_THAN",this.GreaterOrEqual="GREATER_OR_EQUAL",this.LessThan="LESS_THAN",this.LessOrEqual="LESS_OR_EQUAL",this.GreaterThanSymbol=">",this.GreaterOrEqualSymbol="",this.LessThanSymbol="<",this.LessOrEqualSymbol="",this.NotEqual="NOT_EQUAL",this.StartsWith="STARTS_WITH",this.AfterNowOffsetMinutes="AFTER_NOW_OFFSET_MINUTES",this.BeforeNowOffsetMinutes="BEFORE_NOW_OFFSET_MINUTES",this.Ever="EVER",this.Before="BEFORE",this.After="AFTER",this.Between="BETWEEN",this.InCurrentPeriod="IN_CURRENT_PERIOD",this.InSamePeriod="IN_SAME_PERIOD",this.InNextPeriod="IN_NEXT_PERIOD",this.Sum="Sum",this.Each="Each",this.AtLeastOnce="AtLeastOnce",this.Average="Average",this.HavePurchased="HavePurchased",this.HaveNotPurchased="HaveNotPurchased",this.Spent="Spent",this.Units="Units",this.Revenue="Revenue",this.IsNull="IS_NULL",this.IsNotNull="IS_NOT_NULL",this.IsEmpty="IS_EMPTY",this.IsNotEmpty="IS_NOT_EMPTY",this.FilterTargetTypeStandard="STANDARD",this.FilterTargetTypeProductPurchase="PRODUCT_PURCHASE",this.FilterCategoryStatic="STATIC",FilterCategoryTimesSeries="TIMES_SERIES",this.TargetBuildTypeNone="None",this.TargetBuildTypeBuilder="Builder",this.TargetBuildTypeUpload="Upload",this.UploadAccountAndProbabilityList="UploadAccountAndProbabilityList",this.UploadAccountList="UploadAccountList",this.UploadHoldoutList="UploadHoldoutList",this.UploadPlayAccountProducts="UploadPlayAccountProducts",this.FileUploadManagerPlay="PlayAccountList",this.FileUploadManagerPlayAccountProducts="PlayAccountProducts",this.TrainingBuildTypeCopyTargetFilter="CopyTargetFilter",this.TrainingBuildTypeExplicitlyDefined="ExplicitlyDefined",this.TrainingBuildTypeEmpty="Empty",this.EventBuildTypeExplicitlyDefined="ExplicitlyDefined",EventBuildTypeDefaultFilter="DefaultFilter",this.PlaysWithExistingLeads="PlaysWithExistingLeads",this.LeadLaunchDestination={SalesPrism:"salesprism",Salesforce:"salesforce",SalesPrismAndCRM:"salesprism_and_CRM"},this.ExportPlayCustomerList="PlayCustomerListExport",this.ExportPlayCustomerListContacts="PlayCustomerListContactsExport",this.ExportPlayCustomerListWithContacts="PlayCustomerListWithContactsExport",this.ExportHoldoutAccounts="HoldoutAccountsExport",this.LikelihoodScoringMethodProbability="Probability",this.LikelihoodScoringMethodLift="Lift",this.LikelihoodScoringMethodManual="Manual",this.LikelihoodScoringMethodNumValues="NumValues",this.ScoringMethodSuffixLift="x",this.ScoringMethodSuffixProbability="%",this.ModelHealthScoreExcellent="EXCELLENT",this.ModelHealthScoreGood="GOOD",this.ModelHealthScoreAverage="AVERAGE",this.ModelHealthScoreError="ERROR",this.ModelStatusActive="Active",this.ModelStatusInactive="Inactive",this.ComplexFilterType={Training:"TRAINING",Target:"TARGET",Event:"EVENT",RuleBased:"RULE_BASED"},this.SalesprismChangePasswordMethod="./WebLEApplicationServiceHost.svc/RegisterPendingLogAnchorIDs",this.SalesprismPasswordEncryptionType="rsa",this.BardChangePasswordMethod="./BardService.svc/ChangePassword",this.BardChangePasswordUponLoginMethod="./LoginService.svc/ChangePasswordUponLogin",this.SHA256="SHA-256",this.Base64="Base64",this.RSA="rsa",this.rsa={n:"BEB87612E3BBEFCFE80F58578A54D58DA46EB5B34D15D5F1B66F0C6040467D9910B434876F4730EAC92A9618C1B9B69CAFB3C4CA6ABC93ACEB018D8A8FA90E53301E6DA68A2D0E059654F0605769E60E7B366990AB55E65B7489C7A79A38F3CE0ECF26DF51401C16702D5811D354F1ED64B22919EFBE67332022C1AE75FDB5CFDE0CB45761AB9D26AFA301581CF06F76BF99CCF466B98836E6752E162FAEE550BE9ADCE5125063F9FAF37ECB5E206A830CE64B97A362260EF99582B4B1D3A3A2334261EDA281C112B478C32E609EDA9408BC3AD518F7F49C71236947D9F7677FD62655958349894AFD079595A7DC0D835A23D6F06A995C17EA254DE0961710B1",e:"10001"},this.CrmType={None:"None",Salesforce:"Salesforce",Siebel:"Siebel",Oracle:"Oracle"}}),angular.module("mainApp.appCommon.utilities.DateTimeFormatUtility",[]).service("DateTimeFormatUtility",function(){this.OneDayInMS=864e5,this.FormatJsonDateCSharpFormat=function(jsonDate,formatType){var datetime=this.ParseJsonDate(jsonDate),dtformat=this.ConvertCSharpFormat(formatType);return null==datetime||isNaN(datetime)||null==dtformat?"":dateFormat(new Date(datetime),dtformat)},this.FormatCSharpDate=function(jsonDate,formatType){var datetime=this.ConvertCSharpDateTimeOffsetToJSDate(jsonDate),dtformat=this.ConvertCSharpFormat(formatType);return null==datetime||isNaN(datetime)||null==dtformat?"":dateFormat(new Date(datetime),dtformat)},this.ConvertCSharpDateTimeOffsetToJSDate=function(csDate){if(null==csDate||null==csDate.DateTime||null==csDate.OffsetMinutes)return null;var csDateTime=csDate.DateTime,startParenIndex=csDateTime.indexOf("("),endParenIndex=csDateTime.indexOf(")");if(startParenIndex===-1||endParenIndex===-1)return null;var dateTimeInt=parseInt(csDateTime.substring(startParenIndex+1,endParenIndex));return null==dateTimeInt||isNaN(dateTimeInt)?null:new Date(dateTimeInt)},this.CalculateDaysBetweenDates=function(startDate,endDate){if(null==startDate||null==endDate)return null;var timeInMS=endDate.getTime()-startDate.getTime();return Math.floor(timeInMS/this.OneDayInMS)},this.ParseJsonDate=function(jsonDate){var txt=$.trim(jsonDate);if(0===txt.length)return null;var start=txt.indexOf("("),end=txt.indexOf("-");if(start==-1||end==-1||start>=end)return null;var dt=txt.substring(start+1,end);return Number(dt)},this.ConvertJSDateToCSharpDateTimeOffset=function(jsDate,isEndDate){if(!(jsDate instanceof Date))return jsDate;isEndDate===!0?jsDate.setHours(23,59,59,999):isEndDate===!1&&jsDate.setHours(0,0,0,0);var utcMsec=jsDate.getTime(),cSharpDateTimeOffset={DateTime:"/Date("+utcMsec+")/",OffsetMinutes:-1*jsDate.getTimezoneOffset()};return cSharpDateTimeOffset},this.ConvertCSharpSimpleDateToJSDate=function(simpleDate){var jsDate=new Date(simpleDate.Year,simpleDate.Month-1,simpleDate.Day);return jsDate},this.MinutesToHoursAndMinutes=function(minutes){if(isNaN(minutes))return null;var toReturn={};return toReturn.Hours=parseInt(minutes/60),toReturn.Minutes=minutes%60,toReturn},this.ConvertCSharpFormat=function(formatType,dateTimeFormatList){if(null==dateTimeFormatList)return"m/d/yyyy h:MM tt Z";for(var dateFormatValue=null,i=0;i<dateFormatList.length;i++)if(dateFormatList[i].Key==formatType){dateFormatValue=dateFormatList[i].Value;break}if(null==dateFormatValue||0===dateFormatValue.length)return null;var str=dateFormatValue.split("");for(i=0;i<str.length;i++)switch(str[i]){case"M":str[i]="m";break;case"m":str[i]="M";break;case"z":str[i]="o";for(var j=i+1;j<str.length;j++)"z"==str[j]&&(str[j]="");break;case"K":str[i]="Z"}return dateFormatValue=str.join("")},this.Now=function(formatType){var dtformat=this.ConvertCSharpFormat(formatType);return null==dtformat?"":dateFormat(new Date,dtformat)},this.FormatStringDate=function(dateString,includeTime){if(includeTime=null!=includeTime&&"boolean"==typeof includeTime&&includeTime,null==dateString||""===dateString)return"";var dateObj=new Date(dateString);return"Invalid Date"==dateObj?"":includeTime?dateObj.toLocaleDateString()+" "+dateObj.toLocaleTimeString():dateObj.toLocaleDateString()},this.FormatEpochDate=function(dateString){if(null==dateString||""===dateString)return"";if(isNaN(dateString))return"";var epochTime=1e3*parseInt(dateString),dateObj=new Date;return dateObj.setTime(epochTime),dateObj.toUTCString()},this.FormatShortDate=function(dateString){return dateFormat(new Date(dateString),"m/d/yyyy")},this.FormatDateTime=function(dateString,formatString){return dateFormat(new Date(dateString),formatString)}}),angular.module("exceptionOverride",[]).factory("$exceptionHandler",function(){return function(exception,cause){exception.message+=' (caused by "'+cause+'")',null!=console&&console.log("Error: "+exception.message)}}),angular.module("mainApp.appCommon.utilities.FaultUtility",["mainApp.appCommon.utilities.ConfigConstantUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.modals.SimpleModal"]).service("FaultUtility",function(ResourceUtility,BrowserStorageUtility,SimpleModal){this.HandleServiceResponseFailure=function(response,faultTitle,failSilently){if(failSilently="undefined"!=typeof failSilently&&failSilently,!this.HandleSessionTimeout(response)&&!this.HandleAuthenticationIssue(response)&&!failSilently){if(this.HandleSpecialErrors(response))return;var message=this.GenerateErrorMessage(response.Errors);this.ShowFaultAlert(message,faultTitle)}},this.HandleNoResponseFailure=function(response,settings){if(faultTitle=settings.faultTitle,failSilently=settings.failSilently,failSilently="undefined"!=typeof failSilently&&failSilently,!failSilently){var message=this.GetWebServiceFaultDetails(response,settings);this.ShowFaultAlert(message,settings.faultTitle)}},this.HandleSessionTimeout=function(response){var result=!1,timeoutString=ResourceUtility.getString("USER_SESSION_TIMEOUT");return this.GetUserDisplayableErrors(response).indexOf(timeoutString)!=-1&&(this.ShowFaultAlert(timeoutString,ResourceUtility.getString("USER_SESSION_TIMEOUT_TITLE"),this.ResetApp),result=!0),result},this.HandleAuthenticationIssue=function(response){var result=!1,expiredString=ResourceUtility.getString("LOGIN_EXPIRED_AUTHENTICATION_CREDENTIALS"),invalidString=ResourceUtility.getString("LOGIN_INVALID_AUTHENTICATION_CREDENTIALS");return this.GetUserDisplayableErrors(response).indexOf(expiredString)!=-1?(this.ResetApp(),result=!0):this.GetUserDisplayableErrors(response).indexOf(invalidString)!=-1&&(this.ShowFaultAlert(invalidString,ResourceUtility.getString("INVALID_AUTHENTICATION_CREDENTIALS_TITLE"),this.ResetApp),result=!0),result},this.HandleSpecialErrors=function(response){if(null!=response&&null!=response.Errors&&response.Errors.length>0)for(var x=0;x<response.Errors.length;x++){var error=response.Errors[x];if(error.CodeString==ConfigConstantUtility.ImpersonationWriteError)return this.ShowFaultAlert(ResourceUtility.getString(error.CodeString)),!0;if(error.CodeString==ConfigConstantUtility.ValidationInProgressError){for(var detailedDescription=null,y=0;y<error.DataList.length;y++){var errorDetail=error.DataList[y];if(errorDetail==ResourceUtility.getString(ConfigConstantUtility.DetailedDescriptionDataKey)){detailedDescription=errorDetail;break}}return null==detailedDescription&&(detailedDescription=ResourceUtility.getString(error.CodeString)),this.ShowFaultAlert(detailedDescription,error.Message),!0}}return!1},this.GetUserDisplayableErrors=function(response){var result="";if(null!=response&&null!=response.Errors&&response.Errors.length>0)for(var x=0;x<response.Errors.length;x++){var errorValue=response.Errors[x],errorMessage=errorValue.Message,fullErrorMessage=errorMessage.replace(errorValue.CodeString,ResourceUtility.getString(errorValue.CodeString));result+=errorMessage===fullErrorMessage?ResourceUtility.getString(errorValue.CodeString)+" "+fullErrorMessage+" ":fullErrorMessage+" "}return result},this.GetWebServiceFaultDetails=function(response,settings){var result="";switch(response.statusText){case"timeout":var timeoutString=ResourceUtility.getString("REQUEST_TIMEOUT_BEGIN"),timeoutInSeconds=settings.timeout/1e3,unitString=1e3!=settings.timeout?ResourceUtility.getString("REQUEST_TIMEOUT_SECONDS"):ResourceUtility.getString("REQUEST_TIMEOUT_SECOND");"REQUEST_TIMEOUT_BEGIN"!==timeoutString?result=timeoutString+" "+timeoutInSeconds+" "+unitString+".":(unitString=" second"+(1e3!=settings.timeout?"s.":"."),result="Request timed out after "+settings.timeout+unitString)}if(""===result){var message="SERVER_UNAVAILABLE"!=ResourceUtility.getString("SERVER_UNAVAILABLE")?ResourceUtility.getString("SERVER_UNAVAILABLE"):"Server temporarily unavailable. Please retry later.";if(result=message,0!==response.status){result+="<br /><br />Status Code: "+response.status;var loc=settings.url.indexOf("?");NewRelicWorker.SendActivity("Error: "+response.status+" "+settings.url.substring(0,loc),1)}null!=response.statusText&&(result+="<br /><br />Fault Detail: "+response.statusText)}return result},this.GenerateErrorMessage=function(errors){var toReturn="";if(!$.isEmptyObject(errors))for(var x=0;x<errors.length;x++){var parentError=errors[x],numChildErrors=0;$.isEmptyObject(parentError.InnerErrors)||(numChildErrors=parentError.InnerErrors.length),
(0===numChildErrors||numChildErrors>0&&"VALIDATION_ERROR"!=parentError.CodeString)&&(toReturn+=this.GenerateSingleErrorMessage(parentError,numChildErrors>0)),numChildErrors>0&&(toReturn+=this.GenerateErrorMessage(parentError.InnerErrors))}return toReturn},this.GenerateSingleErrorMessage=function(error,isParent){return isParent="undefined"!=typeof isParent&&isParent,isParent?"PARENT ERROR: "+ResourceUtility.getString(error.CodeString)+"<br /><br />"+error.Message+"<br /><br /><br />":"ERROR: "+ResourceUtility.getString(error.CodeString)+"<br /><br />"+error.Message+"<br /><br /><br />"},this.ShowFaultAlert=function(faultMessage,faultTitle,callback){SimpleModal.show({message:faultMessage,title:faultTitle,okCallback:callback})},this.ResetApp=function(){BrowserStorageUtility.clear(!1),ResourceUtility.clearResourceStrings(),window.location.hash="/Initial"},this.HandleFriendlyServiceResponseErrors=function(response){if(null!=response&&!this.HandleSessionTimeout(response)&&!this.HandleAuthenticationIssue(response))return this.GenerateErrorMessage(response.Errors)}}),angular.module("mainApp.appCommon.utilities.MetadataUtility",["mainApp.appCommon.utilities.SortUtility"]).service("MetadataUtility",function(SortUtility){this.PropertyType={INTEGER:"Int",INTEGER64:"Int64",DECIMAL:"Decimal",DOUBLE:"Double",BOOL:"Bool",STRING:"String",DATE_TIME_OFFSET:"DateTimeOffset",CURRENCY:"Currency",PROBABILITY:"Probability",PERCENTAGE:"Percentage",EPOCH_TIME:"EpochTime"},this.ApplicationContext={Account:"LatticeForAccounts",Lead:"LatticeForLeads"},this.NotionNames={Lead:"DanteLead"},this.GetNotionMetadata=function(notionName,metadata){if(null==metadata||null==metadata.Notions||0===metadata.Notions.length||null==notionName||""===notionName)return null;for(var i=0;i<metadata.Notions.length;i++){var notion=metadata.Notions[i];if(notionName==notion.Key)return notion.Value}return null},this.GetNotionAssociationMetadata=function(notionName,associationNotionName,rootMetadata){if(null==rootMetadata||null==notionName||null==associationNotionName||""===associationNotionName)return null;var metadata=this.GetNotionMetadata(notionName,rootMetadata);if(null==metadata||null==metadata.Associations)return null;for(var i=0;i<metadata.Associations.length;i++){var metadataAssociation=metadata.Associations[i];if(associationNotionName==metadataAssociation.TargetNotion)return metadataAssociation}return null},this.GetNotionProperty=function(propertyName,notionMetadata){if(null==notionMetadata||null==notionMetadata.Properties||null==propertyName||""===propertyName)return null;for(var i=0;i<notionMetadata.Properties.length;i++){var metadataProperty=notionMetadata.Properties[i];if(propertyName==metadataProperty.Name)return metadataProperty}return null},this.GetCompareFunction=function(propertyTypeString){switch(propertyTypeString){default:return SortUtility.DefaultCompare}}}),angular.module("mainApp.appCommon.utilities.NumberUtility",[]).service("NumberUtility",function(){this.AbbreviateLargeNumber=function(number,decimal_places){if(null==number||"number"!=typeof number)return null;decimal_places=null!=decimal_places&&"number"==typeof decimal_places?decimal_places:2,decimal_places=Math.pow(10,decimal_places);for(var abbreviation=["K","M","B","T"],i=abbreviation.length-1;i>=0;i--){var size=Math.pow(10,3*(i+1));if(size<=number){number=Math.round(number*decimal_places/size)/decimal_places,1e3==number&&i<abbreviation.length-1&&(number=1,i++),number+=abbreviation[i];break}}return number}}),angular.module("mainApp.appCommon.utilities.ResourceUtility",[]).service("ResourceUtility",function(){this.DefaultLocale="en-US",this.configStringsStorageKey="ConfigStrings",this.configStringsKeyValueStorageKey="ConfigStringKeyValues",this.configStringsLocaleStorageKey="ConfigStringsLocale",this.configStrings=null,this.resourceStringsInitialized=!1,this.keyValuePairs=[],this.getString=function(key,replacements){null==this.configStrings&&this.populateConfigStrings();var toReturn=this.configStrings[key]||key;return replacements&&(toReturn=this.replaceTokens(toReturn,replacements)),toReturn},this.clearResourceStrings=function(){$.jStorage.set(this.configStringsStorageKey,null),$.jStorage.set(this.configStringsKeyValueStorageKey,null),$.jStorage.set(this.configStringsLocaleStorageKey,null)},this.getResourceStrings=function(){return $.jStorage.get(this.configStringsStorageKey)},this.getResourceStringKeyValues=function(){return $.jStorage.get(this.configStringsKeyValueStorageKey)},this.setCurrentLocale=function(localeName){$.jStorage.set(this.configStringsLocaleStorageKey,localeName)},this.getCurrentLocale=function(){return $.jStorage.get(this.configStringsLocaleStorageKey)},this.replaceTokens=function(key,replacements){for(var i=0;i<replacements.length;i++)for(;key.indexOf("{"+i+"}")!=-1;)key=key.replace("{"+i+"}",replacements[i]);return key},this.populateConfigStrings=function(){var configStringsFromStorage=$.jStorage.get(this.configStringsStorageKey);this.configStrings=configStringsFromStorage||{}},this.storeStringList=function(stringList,successHandler){if(null==this.configStrings&&this.populateConfigStrings(),null!=stringList){for(var i=0;i<stringList.length;i++){var curPair=stringList[i],curKey=curPair.Key,curValue=curPair.Value;this.keyValuePairs.push(curPair),this.configStrings[curKey]=curValue}this.resourceStringsInitialized=!0}$.jStorage.set(this.configStringsStorageKey,this.configStrings),$.jStorage.set(this.configStringsKeyValueStorageKey,this.keyValuePairs),$(document).trigger("configStringsLoadedEvent"),null!=successHandler&&successHandler()},this.PreloadImage=function(el,callback){var img=new Image;img.onload=function(){callback(img)},img.src=el.attr("src")},this.SetBrowserTitle=function(){document.title=this.getString("BROWSER_TITLE")}}),angular.module("mainApp.appCommon.utilities.SortUtility",[]).service("SortUtility",function(){this.MultiSort=function(objsToSort,propsToSortOn){if(objsToSort instanceof Array&&!(objsToSort.length<=0)){var firstObj=objsToSort[0],objType=typeof firstObj;if("boolean"===objType||"number"===objType||"string"===objType)objsToSort.sort();else{var compareFunction=this.GetCompareFunction(propsToSortOn);"function"==typeof compareFunction&&objsToSort.sort(compareFunction)}}},this.GetCompareFunction=function(propsToSortOn){var compareFunction,self=this;return propsToSortOn instanceof Array&&propsToSortOn.length>0&&(compareFunction=function(a,b){for(var i=0;i<propsToSortOn.length;i++){var prop=propsToSortOn[i],propName=prop.Name,propIsAscending=prop.IsAscending;"boolean"!=typeof propIsAscending&&(propIsAscending=!0);var propCompareFunction=prop.CompareFunction,compareResult=self.CompareObjectsByProperty(a,b,propName,propIsAscending,propCompareFunction);if(0!==compareResult)return compareResult}return 0}),compareFunction},this.CompareObjectsByProperty=function(a,b,propName,propIsAscending,propCompareFunction){var result=0;if(null==a&&null==b)result=0;else if(null==a)result=-1;else if(null==b)result=1;else{var compareFunction,propA=a[propName],propB=b[propName];compareFunction="function"==typeof propCompareFunction?propCompareFunction:this.DefaultCompare,result=compareFunction(propA,propB)}return propIsAscending?result:-1*result},this.DefaultCompare=function(a,b){return a<b?-1:a==b?0:a>b?1:0},this.ReverseBooleanCompare=function(a,b){return"boolean"!=typeof a||"boolean"!=typeof b?0:a===b?0:a===!1?1:a===!0?-1:void 0}}),angular.module("mainApp.appCommon.utilities.StringUtility",[]).service("StringUtility",function(){this.IsEmptyString=function(stringToCheck){var isEmpty=!0;return null!=stringToCheck&&""!==stringToCheck.trim()&&(isEmpty=!1),isEmpty},this.AddCommas=function(stringToChange){if(null==stringToChange)return null;var parts=stringToChange.toString().split(".");return parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),parts.join(".")}}),angular.module("mainApp.appCommon.utilities.TenantIdParsingUtility",[]).service("TenantIdParsingUtility",function(){this.getDataLoaderTenantNameFromTenantId=function(tenantId){return tenantNameArray=tenantId.split("."),3==tenantNameArray.length?tenantNameArray[1]:tenantNameArray[0]}}),angular.module("mainApp.appCommon.utilities.TimestampIntervalUtility",[]).service("TimestampIntervalUtility",function(){this.isTimestampFartherThanNinetyDaysAgo=function(timestamp){if(!timestamp)return!1;var MILLISECOND_PER_DAY=864e5,numDaysAgoPasswordLastModified=Math.floor((Date.now()-timestamp)/MILLISECOND_PER_DAY);return numDaysAgoPasswordLastModified>=90}}),angular.module("mainApp.appCommon.utilities.TrackingConstantsUtility",[]).service("TrackingConstantsUtility",function(){this.PLAY_TAB_CLICKED="PlayTabClicked",this.PLAY_LIST_TILE_CLICKED="PlayListTileClicked",this.PLAY_DETAIL_TILE_CLICKED="PlayDetailTileClicked",this.TALKING_POINT_EXPANDED="TalkingPointExpanded",this.TALKING_POINT_COLLAPSED="TalkingPointCollapsed",this.COMPANY_SNAPSHOT_TAB_CLICKED="CompanySnapshotTabClicked"}),angular.module("mainApp.appCommon.utilities.URLUtility",["mainApp.appCommon.utilities.ConfigConstantUtility"]).service("URLUtility",function(){this.GetWebServerAddress=function(mainPage){if(null==mainPage)return null;var pathname=location.pathname,pageIndex=pathname.indexOf(mainPage);return pathname=pageIndex!=-1?pathname.substring(0,pageIndex):pathname.substring(0,pathname.length-1),location.protocol+"//"+location.host+pathname},this.GetBaseUrl=function(){return location.protocol+"//"+location.host+location.pathname},this.GetUrlQueryStrings=function(url){if(null==url)return"";var result="",hashIndex=url.indexOf("#");hashIndex!=-1&&(url=url.substring(0,hashIndex));var qIndex=url.indexOf("?");return qIndex!=-1&&(result=url.substring(qIndex,url.length)),result},this.GetUrlWithQueryStrings=function(baseUrl){if(null==baseUrl)return null;var url=this.HandleProtocol(baseUrl),queryStringParameters=this.GetUrlQueryStrings(window.location.href);return null!=queryStringParameters&&"?"!=queryStringParameters&&(url+=queryStringParameters),url},this.RemoveQueryStringParameter=function(url,parameter){var urlHash="",hashIndex=url.indexOf("#"),qIndex=url.indexOf("?");hashIndex>-1&&(hashIndex<qIndex?urlHash=url.substring(hashIndex,qIndex):(urlHash=url.substring(hashIndex),url=url.replace(urlHash,"")));var urlparts=url.split("?");if(urlparts.length>=2){for(var prefix=encodeURIComponent(parameter)+"=",pars=urlparts[1].split(/[&;]/g),i=pars.length;i-- >0;)pars[i].lastIndexOf(prefix,0)!==-1&&pars.splice(i,1);url=0===pars.length?urlparts[0]:urlparts[0]+"?"+pars.join("&")}return hashIndex>-1&&hashIndex<qIndex?url:url+urlHash},this.GetSalesPrismWebServerAddress=function(salesPrismURL){return null==salesPrismURL?null:this.HandleProtocol(salesPrismURL.replace(/\/salesprism.aspx/gi,""))},this.GetSalesPrismMainPageAddress=function(salesPrismURL){if(null==salesPrismURL)return null;var hasPage=salesPrismURL.indexOf("salesprism.aspx")!==-1;return hasPage?this.HandleProtocol(salesPrismURL):(salesPrismURL+="/"===salesPrismURL.charAt(salesPrismURL.length-1)?"salesprism.aspx":"/salesprism.aspx",this.HandleProtocol(salesPrismURL))},this.GetBardWebServerAddress=function(bardUrl){return null==bardUrl?null:this.HandleProtocol(bardUrl.replace(/\/index.aspx/gi,""))},this.GetBardMainPageAddress=function(bardUrl){if(null==bardUrl)return null;var hasPage=bardUrl.indexOf("index.aspx")!==-1;return hasPage?this.HandleProtocol(bardUrl):(bardUrl+="/"===bardUrl.charAt(bardUrl.length-1)?"index.aspx":"/index.aspx",this.HandleProtocol(bardUrl))},this.GetBardMainPageAddressWithHash=function(bardUrl){if(null==bardUrl)return null;var currentLocation=window.location.href,urlHash="",hashIndex=currentLocation.indexOf("#"),qIndex=currentLocation.indexOf("?");return hashIndex>-1&&(urlHash=hashIndex<qIndex?currentLocation.substring(hashIndex,qIndex):currentLocation.substring(hashIndex)),this.GetBardMainPageAddress(bardUrl)+urlHash},this.OpenWindow=function(url,location){null!=url&&null!=location&&window.open(url,location)},this.OpenNewWindow=function(url){this.OpenWindow(url,"_blank")},this.OpenPostWindow=function(target,url,data,fetchType){var content=this.ConstructPostContent(url,data,fetchType),win=window.open("about:blank",target);return win&&win.document.write(content),win},this.OpenPostIframe=function(target,url,data,fetchType){var content=this.ConstructPostContent(url,data,fetchType);$("#"+target).html(content)},this.ConstructPostContent=function(url,data,fetchType){fetchType="undefined"!=typeof fetchType?fetchType:"POST";var content="<!DOCTYPE html><html><head></head><body>";return content+='<form id="postForm" method=\''+fetchType+"' action='"+url+"'>",$.each(data,function(name,value){content+="<input type='hidden' name='"+name+"' value='"+value+"'></input>"}),content+="</form>",content+="<script type='text/javascript'>document.getElementById(\"postForm\").submit();</script>",content+="</body></html>"},this.GetQueryStringValue=function(key,keepHash){keepHash="boolean"==typeof keepHash&&keepHash;var result=null,payload=window.location.href,qIndex=payload.indexOf("?");if(qIndex!=-1){var queryString=payload.substring(qIndex+1),pair=null,params=queryString.split("&");for(i=0;i<params.length;i++)if(pair=params[i].split("="),2==pair.length&&pair[0]==key){result=pair[1];break}}if(null!=result&&!keepHash){var hashIndex=result.indexOf("#");hashIndex!=-1&&(result=result.substring(0,hashIndex))}return null!=result?this.Decode(result):null},this.Decode=function(value){var result=value,matches=result.match(new RegExp("%..","gi"));if(null!=matches)for(i=0;i<matches.length;i++){var charCode=parseInt("0x"+matches[i].substring(1)),character=String.fromCharCode(charCode);result=result.replace(matches[i],character)}return result},this.ExtractTabFromHash=function(hash){var toReturn=null;switch(hash){case ConfigConstantUtility.BardModelHash:case ConfigConstantUtility.BardStatusHash:case ConfigConstantUtility.BardConfigHash:case ConfigConstantUtility.BardReportHash:toReturn=ConfigConstantUtility.ViewBard;break;case ConfigConstantUtility.ActionCenterHash:toReturn=ConfigConstantUtility.ViewActionItems;break;case ConfigConstantUtility.SalesListHash:toReturn=ConfigConstantUtility.ViewSales;break;case ConfigConstantUtility.PlayListHash:case ConfigConstantUtility.LaunchMetricsHash:case ConfigConstantUtility.LaunchRulesHash:case ConfigConstantUtility.LaunchFiltersHash:case ConfigConstantUtility.PlayQuestionsHash:case ConfigConstantUtility.HoldoutsHash:toReturn=ConfigConstantUtility.ViewPlay;break;case ConfigConstantUtility.ConfigConsoleHash:case ConfigConstantUtility.AdminConsoleHash:case ConfigConstantUtility.UsersHash:case ConfigConstantUtility.UserGroupsHash:case ConfigConstantUtility.AlertsHash:case ConfigConstantUtility.PreviewAlertsHash:case ConfigConstantUtility.FileTemplatesHash:case ConfigConstantUtility.MailTemplatesHash:case ConfigConstantUtility.FileUploadHash:case ConfigConstantUtility.ExternalDataHash:toReturn=ConfigConstantUtility.ViewAdmin;break;case ConfigConstantUtility.InvitationsHash:toReturn=ConfigConstantUtility.ViewMessages;break;case ConfigConstantUtility.DashboardCenterHash:toReturn=ConfigConstantUtility.ViewDashboardCenter;break;case ConfigConstantUtility.ChangePasswordHash:toReturn=ConfigConstantUtility.ViewChangePassword;break;case ConfigConstantUtility.ProductHierarchyHash:toReturn=ConfigConstantUtility.ViewProductHierarchy;break;case ConfigConstantUtility.DantePlayHash:toReturn=ConfigConstantUtility.DantePlayHash;break;case ConfigConstantUtility.DantePurchaseTrendsHash:toReturn=ConfigConstantUtility.DantePurchaseTrendsHash;break;case ConfigConstantUtility.DanteCompanyDetailsHash:toReturn=ConfigConstantUtility.DanteCompanyDetailsHash;break;case ConfigConstantUtility.DanteContactsHash:toReturn=ConfigConstantUtility.DanteContactsHash}return toReturn},this.ExtractSubViewFromHash=function(hash){var toReturn=null;switch(hash){case ConfigConstantUtility.PlayListHash:toReturn="Plays";break;case ConfigConstantUtility.LaunchMetricsHash:toReturn="LaunchMetrics";break;case ConfigConstantUtility.LaunchRulesHash:toReturn="LaunchRules";break;case ConfigConstantUtility.LaunchFiltersHash:toReturn="FilterRules";break;case ConfigConstantUtility.PlayQuestionsHash:toReturn="PlayQuestions";break;case ConfigConstantUtility.HoldoutsHash:toReturn="UploadHoldouts";break;case ConfigConstantUtility.ConfigConsoleHash:toReturn="ConfigConsole";break;case ConfigConstantUtility.AdminConsoleHash:toReturn="AdminConsole";break;case ConfigConstantUtility.UsersHash:toReturn="Users";break;case ConfigConstantUtility.UserGroupsHash:toReturn="UserGroups";break;case ConfigConstantUtility.AlertsHash:toReturn="Alerts";break;case ConfigConstantUtility.PreviewAlertsHash:toReturn="PreviewAlerts";break;case ConfigConstantUtility.FileTemplatesHash:toReturn="FeedTemplates";break;case ConfigConstantUtility.MailTemplatesHash:toReturn="MailMerge";break;case ConfigConstantUtility.FileUploadHash:toReturn="FileUpload";break;case ConfigConstantUtility.ExternalDataHash:toReturn="ExternalData";break;case ConfigConstantUtility.BardStatusHash:toReturn="BardStatus";break;case ConfigConstantUtility.BardConfigHash:toReturn="BardConfig";break;case ConfigConstantUtility.BardReportHash:toReturn="BardReport";break;case ConfigConstantUtility.BardModelHash:toReturn="BardModel"}return toReturn},this.HandleProtocol=function(url){if(null==url)return null;var httpIncluded=0===url.indexOf("http://"),httpsIncluded=0===url.indexOf("https://");return httpIncluded||httpsIncluded?url:location.protocol+"//"+url},this.SALESFORCE="salesforce",this.SAML="saml",this.LEA="lea",this.ORACLE="oracle",this.Directory=function(){return this.GetQueryStringValue("Directory")},this.SamlResponseValue=function(){return this.GetQueryStringValue("LESAMLUserLookup")},this.SamlDirectoryValue=function(){return this.GetQueryStringValue("LESAMLDirectoryKey")},this.LeaResponse=function(){return this.GetQueryStringValue("LEAuthenticatedLookup")},this.GetSSOType=function(){return this.Directory()==this.ORACLE?this.ORACLE:null!=this.CrmSessionID()&&null!=this.CrmServerURL()?this.SALESFORCE:null!=this.SamlResponseValue()?this.SAML:null!=this.LeaResponse()?this.LEA:null},this.CrmSessionID=function(){var secretSessionId=this.GetQueryStringValue("sin");return null!=secretSessionId?secretSessionId:this.GetQueryStringValue("sessionid")},this.CrmServerURL=function(){return this.GetQueryStringValue("serverurl")},this.CrmUser=function(){var result=null,rawValue=this.GetQueryStringValue("userlink");if(null!=rawValue){var sIndex=rawValue.lastIndexOf("/");result=sIndex!=-1?rawValue.substring(sIndex+1):rawValue}return null!=result&&result.length>15&&(result=result.substr(0,15)),result},this.CrmType=function(){var crmType=this.GetQueryStringValue("crmtype");crmType=crmType.toLowerCase(),crmType=StringUtil.CapitalizeFirstLetter(crmType);var crmTypes=ConfigConstantUtility.CrmType;switch(crmType){case crmTypes.None:case crmTypes.Salesforce:case crmTypes.Siebel:case crmTypes.Oracle:return crmType;default:return crmTypes.None}},this.CrmAccount=function(){return this.GetQueryStringValue("Account")},this.CrmLead=function(){return this.GetQueryStringValue("Lead")},this.CrmContact=function(){return this.GetQueryStringValue("Contact")},this.CrmIntegrationServer=function(){var result=null,rawValue=this.GetQueryStringValue("userlink");if(null!=rawValue){var sIndex=rawValue.lastIndexOf("/");sIndex!=-1&&(result=rawValue.substring(0,sIndex))}return result},this.IntegrationServer=function(){var result=null;return null!=this.CrmServerURL()&&(result=this.CrmIntegrationServer()),null!=result?result:""},this.GetApplicationDirectory=function(){var result=this.Directory();return null==result&&(result=this.SamlDirectoryValue()),result}}),angular.module("mainApp.appCommon.utilities.UnderscoreUtility",[]).factory("_",function(){return window._}),angular.module("mainApp.appCommon.utilities.WidgetConfigUtility",[]).service("WidgetConfigUtility",function(){this.ANALYTIC_ATTRIBUTE_LIST_WIDGET="AnalyticAttributeListWidget",this.ANALYTIC_ATTRIBUTE_TILE_WIDGET="AnalyticAttributeTileWidget",this.ARC_CHART_WIDGET="ArcChartWidget",this.COLLAPSIBLE_PANEL_WIDGET="CollapsiblePanelWidget",this.GRID_WIDGET="GridWidget",this.LEAD_DETAILS_TILE_WIDGET="LeadDetailsTileWidget",this.MODEL_DETAILS_WIDGET="ModelDetailsWidget",this.MODEL_LIST_TILE_WIDGET="ModelListTileWidget",this.MODEL_LIST_CREATION_HISTORY="ModelListCreationHistoryWidget",this.REPEATER_WIDGET="RepeaterWidget",this.PLAY_DETAILS_TILE_WIDGET="PlayDetailsTileWidget",this.PLAY_LIST_TILE_WIDGET="PlayListTileWidget",this.RICH_TEXT_WIDGET="RichTextWidget",this.SCREEN_WIDGET="ScreenWidget",this.SCREEN_HEADER_WIDGET="ScreenHeaderWidget",this.SIMPLE_GRID_WIDGET="SimpleGridWidget",this.SIMPLE_TAB_WIDGET="SimpleTabWidget",this.TALKING_POINT_WIDGET="TalkingPointWidget",this.TEST_WIDGET="TestWidget",this.TAB_WIDGET="TabWidget",this.THRESHOLD_EXPLORER_WIDGET="ThresholdExplorerWidget",this.TOP_PREDICTOR_WIDGET="TopPredictorWidget",this.PERFORMANCE_TAB_WIDGET="PerformanceTabWidget",this.ADMIN_INFO_SUMMARY_WIDGET="AdminInfoSummaryWidget",this.ADMIN_INFO_ALERTS_WIDGET="AdminInfoAlertsWidget",this.LEADS_TAB_WIDGET="LeadsTabWidget",this.USER_MANAGEMENT_WIDGET="UserManagementWidget",this.MANAGE_FIELDS_WIDGET="ManageFieldsWidget",this.ACTIVE_WIDGET_ALL="All",this.ACTIVE_WIDGET_EVEN="Even",this.ACTIVE_WIDGET_FIRST="First",this.ACTIVE_WIDGET_LAST="Last",this.ACTIVE_WIDGET_NONE="None",this.ACTIVE_WIDGET_ODD="Odd",this.GetWidgetConfig=function(applicationWidgetConfig,id){if(null==applicationWidgetConfig)return null;if(null==id||""===id)return null;if(applicationWidgetConfig.ID===id)return applicationWidgetConfig;if(null==applicationWidgetConfig.Widgets)return null;for(var i=0;i<applicationWidgetConfig.Widgets.length;i++){var child=applicationWidgetConfig.Widgets[i],matchedChild=this.GetWidgetConfig(child,id);if(null!==matchedChild)return matchedChild}return null}}),angular.module("mainApp.appCommon.utilities.WidgetEventConstantUtility",[]).service("WidgetEventConstantUtility",function(){this.PLAY_DETAILS_TAB_CLICKED="PlayDetailsTabClickedEvent"}),angular.module("mainApp.appCommon.widgets.AdminInfoAlertsWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.services.ModelAlertsService","mainApp.core.services.SessionService"]).controller("AdminInfoAlertsWidgetController",function($scope,$rootScope,$http,ResourceUtility,ModelAlertsService){$scope.ResourceUtility=ResourceUtility;var modelAlerts=$scope.data.ModelAlerts,suppressedCategories=$scope.data.SuppressedCategories;null==modelAlerts&&null==suppressedCategories?($scope.showErrorMessage=!0,$scope.alertTabErrorMessage=ResourceUtility.getString("ADMIN_INFO_ALERTS_PAGE_ERROR_MESSAGE")):($scope.showErrorMessage=!1,$scope.warnings=ModelAlertsService.GetWarnings(modelAlerts,suppressedCategories))}).directive("adminInfoAlertsWidget",function(){return{templateUrl:"app/AppCommon/widgets/adminInfoAlertsWidget/AdminInfoAlertsWidgetTemplate.html"}}),angular.module("mainApp.appCommon.widgets.AdminInfoSummaryWidget",["mainApp.appCommon.services.ThresholdExplorerService","mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.DateTimeFormatUtility","mainApp.config.services.ConfigService","mainApp.core.services.SessionService"]).controller("AdminInfoSummaryWidgetController",function($scope,$rootScope,$http,ResourceUtility,ThresholdExplorerService,ConfigService){$scope.ResourceUtility=ResourceUtility,$scope.Error={ShowError:!1};var data=$scope.data;$scope.ModelId=data.ModelId,$scope.TenantId=data.TenantId,$scope.TenantName=$scope.data.TenantName,$scope.DataLoaderTenantName=$scope.data.DataLoaderTenantName,$scope.ModelHealthScore=data.ModelDetails.RocScore,$scope.TemplateVersion=data.ModelDetails.TemplateVersion,$scope.modelUploaded=data.ModelDetails.Uploaded,$scope.exportThresholdClicked=function(){var csvRows=ThresholdExplorerService.PrepareExportData(data);alasql("SELECT * INTO CSV('performance.csv') FROM ?",[csvRows])},ConfigService.GetCurrentDataLoaderUrl().then(function(data){data.success&&null!=data.resultObj?$scope.DataLoaderUrl=data.resultObj:$scope.DataLoaderUrlError=data.resultErrors})}).directive("adminInfoSummaryWidget",function(){return{templateUrl:"app/AppCommon/widgets/adminInfoSummaryWidget/AdminInfoSummaryWidgetTemplate.html"}}).directive("healthScore",function(){return{restrict:"E",template:'{{score | number: 4}}&nbsp;&nbsp;&nbsp;&nbsp;<strong class="{{healthClass}}">{{healthLevel}}</strong>',scope:{score:"="},controller:["$scope","ResourceUtility",function($scope,ResourceUtility){$scope.score>=.75?($scope.healthLevel=ResourceUtility.getString("MODEL_ADMIN_HEALTH_EXCELLENT"),$scope.healthClass="health-excellent"):$scope.score>=.6?($scope.healthLevel=ResourceUtility.getString("MODEL_ADMIN_HEALTH_GOOD"),$scope.healthClass="health-good"):$scope.score>=.5?($scope.healthLevel=ResourceUtility.getString("MODEL_ADMIN_HEALTH_MEDIUM"),$scope.healthClass="health-medium"):($scope.healthLevel=ResourceUtility.getString("MODEL_ADMIN_HEALTH_POOR"),$scope.healthClass="health-poor")}]}}).directive("fileDownloader",function(){return{restrict:"E",template:'<a href="" data-ng-click="downloadFile($event)" data-ng-hide="modelUploaded||fetching">{{ResourceUtility.getString("MODEL_ADMIN_DOWNLOAD")}}</a><span data-ng-show="fetching">{{ResourceUtility.getString("MODEL_ADMIN_FETCHING")}}</span><span data-ng-show="modelUploaded">{{ResourceUtility.getString("MODEL_ADMIN_LINK_DISABLED")}}</span>',scope:!0,link:function(scope,element,attr){var anchor=element.children()[0];scope.$on("download-start",function(){$(anchor).attr("disabled","disabled")}),scope.$on("download-finished",function(){$(anchor).removeAttr("disabled")})},controller:["$scope","$attrs","$http","ResourceUtility","SessionService",function($scope,$attrs,$http,ResourceUtility,SessionService){$scope.fetching=!1,$scope.fetched=!1,$scope.ResourceUtility=ResourceUtility,$scope.blob=null,$scope.downloadFile=function(){return $scope.fetching=!0,$scope.$parent.Error.ShowError=!1,null!=$scope.blob?($scope.fetching=!1,void saveAs($scope.blob,$attrs.filename)):($scope.$emit("download-start"),void $http.get($attrs.url).then(function(response){"application/json"===$attrs.filetype?$scope.blob=new Blob([JSON.stringify(response.data)],{type:$attrs.filetype}):$scope.blob=new Blob([response.data],{type:$attrs.filetype}),$scope.downloadFile(),$scope.$emit("download-finished")},function(response){SessionService.HandleResponseErrors(response.data,response.status),$scope.$parent.Error.ShowError=!0,$scope.$parent.Error.ErrorMsg=ResourceUtility.getString("MODEL_ADMIN_FETCH_ERROR",[$attrs.filename]),$scope.fetching=!1,$scope.$emit("download-finished")}))}}]}}),angular.module("mainApp.appCommon.widgets.AnalyticAttributeListWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.MetadataUtility","mainApp.appCommon.utilities.AnalyticAttributeUtility","mainApp.appCommon.services.WidgetFrameworkService"]).service("AnalyticAttributeListService",function(AnalyticAttributeUtility){this.GroomAttributeList=function(rawAttributeList,modelId,widgetConfig,metadata){if(null==rawAttributeList||0===rawAttributeList.length||null==widgetConfig)return rawAttributeList;var modelSummary=this.GetStoredNotion(widgetConfig.ModelNotion,modelId);if(null==modelSummary)return null;for(var attributeLimit=parseInt(widgetConfig.Limit),approvedUsages=[AnalyticAttributeUtility.ApprovedUsage.IndividualDisplay,AnalyticAttributeUtility.ApprovedUsage.ModelAndAllInsights,AnalyticAttributeUtility.ApprovedUsage.ModelAndModelInsights],groomedAttributeList=[],i=0;i<rawAttributeList.length;i++){var rawAttribute=rawAttributeList[i],attributeMetadata=AnalyticAttributeUtility.FindAttributeMetadataData(modelSummary,rawAttribute),attributeBucket=AnalyticAttributeUtility.FindAttributeBucket(modelSummary,rawAttribute);if(null!=attributeMetadata&&null!=attributeBucket&&attributeBucket.IsVisible===!0&&AnalyticAttributeUtility.IsAllowedForInsights(attributeMetadata,approvedUsages)&&AnalyticAttributeUtility.ShowBasedOnTags(widgetConfig,attributeMetadata)&&AnalyticAttributeUtility.ShouldShowNullBucket(attributeBucket,widgetConfig.NullThreshold)){var showLift="true"==widgetConfig.ShowLift,bucketName=AnalyticAttributeUtility.GetAttributeBucketName(attributeBucket,attributeMetadata),attributeLift=AnalyticAttributeUtility.FormatLift(attributeBucket.Lift),attribute={DisplayName:attributeMetadata.DisplayName,Description:attributeMetadata.Description,BucketName:bucketName,Lift:attributeLift,ShowLift:showLift};groomedAttributeList.push(attribute)}}return groomedAttributeList=AnalyticAttributeUtility.SortAttributeList(groomedAttributeList),groomedAttributeList.length>attributeLimit&&(groomedAttributeList=groomedAttributeList.slice(0,attributeLimit)),groomedAttributeList},this.GetStoredNotion=function(notionName,notionId){var notion=null,localData=$.jStorage.get(notionName);if(null!=localData&&null!=localData.listData)for(var i=0;i<localData.listData.length;i++){var notionData=localData.listData[i];if(notionData.Id==notionId){notion=notionData.Data;break}}return notion}}).controller("AnalyticAttributeListWidgetController",function($scope,ResourceUtility,MetadataUtility,AnalyticAttributeUtility,WidgetFrameworkService,AnalyticAttributeListService){var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data;$scope.ResourceUtility=ResourceUtility,$scope.liftDescending=!0,$scope.hasAttributes=!1;var showLift=null!=widgetConfig&&"true"==widgetConfig.ShowLift;showLift?$scope.liftLabel=ResourceUtility.getString("ANALYTIC_ATTRIBUTE_LIFT_HEADER_LABEL"):$scope.liftLabel=ResourceUtility.getString("ANALYTIC_ATTRIBUTE_PROBABILITY_HEADER_LABEL");var targetNotionProperty=MetadataUtility.GetNotionAssociationMetadata(widgetConfig.Notion,widgetConfig.TargetNotion,metadata);if(null!=targetNotionProperty){var groomedAttributeList=AnalyticAttributeListService.GroomAttributeList(data[targetNotionProperty.Name],data[widgetConfig.ModelIdProperty],widgetConfig,metadata);$scope.hasAttributes=null!=groomedAttributeList&&groomedAttributeList.length>0,$scope.liftSortClicked=function($event){null!=$event&&$event.preventDefault(),$scope.liftDescending=!$scope.liftDescending,groomedAttributeList=AnalyticAttributeUtility.SortAttributeList(groomedAttributeList,$scope.liftDescending),$scope.createAttributeList()},$scope.createAttributeList=function(){var listContainer=$(".js-analytic-attribute-list",$scope.element);listContainer.empty();for(var i=0;i<groomedAttributeList.length;i++){var container=$("<div></div>");listContainer.append(container);var options={element:container,widgetConfig:widgetConfig,metadata:metadata,data:data};WidgetFrameworkService.CreateChildWidgets(options,groomedAttributeList[i])}},$scope.hasAttributes&&$scope.createAttributeList()}}).directive("analyticAttributeListWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/analyticAttributeListWidget/AnalyticAttributeListWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.AnalyticAttributeTileWidget",["mainApp.appCommon.utilities.ResourceUtility"]).controller("AnalyticAttributeTileWidgetController",function($scope,ResourceUtility){var data=($scope.widgetConfig,$scope.metadata,$scope.data);$scope.ResourceUtility=ResourceUtility,$scope.hasLift=null!=data.Lift,$scope.showLift=data.ShowLift,$scope.aboveAverageLift=null!=data.Lift&&data.Lift>1}).directive("analyticAttributeTileWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/analyticAttributeTileWidget/AnalyticAttributeTileWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.ArcChartWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.MetadataUtility","mainApp.appCommon.utilities.AnimationUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.appCommon.directives.charts.ArcChartDirective"]).service("ArcChartService",function(WidgetConfigUtility,MetadataUtility,AnimationUtility){
this.CalculateArcColor=function(score){if(null==score)return null;var highestRgb={R:27,G:172,B:94},midRangeRgb={R:255,G:255,B:102},lowestRgb={R:178,G:0,B:0},rgbColor=null;return score>50?(rgbColor=AnimationUtility.CalculateRgbBetweenValues(highestRgb,midRangeRgb,score),AnimationUtility.ConvertRgbToHex(rgbColor.R,rgbColor.G,rgbColor.B)):(score=2*score,rgbColor=AnimationUtility.CalculateRgbBetweenValues(midRangeRgb,lowestRgb,score),AnimationUtility.ConvertRgbToHex(rgbColor.R,rgbColor.G,rgbColor.B))}}).controller("ArcChartWidgetController",function($scope,ResourceUtility,MetadataUtility,WidgetFrameworkService,ArcChartService){var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data;$scope.ChartValue=0,$scope.ChartTotal=100,$scope.ChartLabel=null,$scope.ChartColor="#FF0000",$scope.ChartSize=100;var notionMetadata=MetadataUtility.GetNotionMetadata(widgetConfig.Notion,metadata),valueProperty=MetadataUtility.GetNotionProperty(widgetConfig.ValueProperty,notionMetadata);null!=valueProperty&&($scope.ChartValue=data[valueProperty.Name]||null,null!=$scope.ChartValue&&($scope.ChartValue=Math.round($scope.ChartValue)),$scope.ChartColor=ArcChartService.CalculateArcColor($scope.ChartValue));var labelProperty=MetadataUtility.GetNotionProperty(widgetConfig.LabelProperty,notionMetadata);null!=labelProperty&&($scope.ChartLabel=data[labelProperty.Name]||null),null!=$scope.ChartLabel||null==widgetConfig.LabelResourceKey&&""===widgetConfig.LabelResourceKey||($scope.ChartLabel=ResourceUtility.getString(widgetConfig.LabelResourceKey))}).directive("arcChartWidget",function($compile){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/arcChartWidget/ArcChartWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.CollapsiblePanelWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.MetadataUtility","mainApp.appCommon.services.WidgetFrameworkService"]).controller("CollapsiblePanelWidgetController",function($scope,MetadataUtility,ResourceUtility,WidgetFrameworkService){var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data,parentData=$scope.parentData,isActive=$scope.isActive;if(isActive="undefined"==typeof isActive||isActive,null!=data){var contentContainer=$(".js-collapsible-panel-content",$scope.element);$scope.panelOpen=isActive,$scope.panelOpen||contentContainer.slideToggle();var notionMetadata=MetadataUtility.GetNotionMetadata(widgetConfig.Notion,metadata),titleProperty=MetadataUtility.GetNotionProperty(widgetConfig.TitleProperty,notionMetadata);$scope.panelTitle="",null!=titleProperty&&titleProperty.PropertyTypeString==MetadataUtility.PropertyType.STRING?$scope.panelTitle=data[titleProperty.Name]||"":null!=widgetConfig.TitleString&&($scope.panelTitle=ResourceUtility.getString(widgetConfig.TitleString)),$scope.panelClicked=function(){$scope.panelOpen=!$scope.panelOpen,contentContainer.slideToggle()};var options={scope:$scope,element:contentContainer,widgetConfig:widgetConfig,metadata:metadata,data:data,parentData:parentData};WidgetFrameworkService.CreateChildWidgets(options,data)}}).directive("collapsiblePanelWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/collapsiblePanelWidget/CollapsiblePanelWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.LeadDetailsTileWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.services.WidgetFrameworkService"]).controller("LeadDetailsTileWidgetController",function($scope,ResourceUtility,WidgetFrameworkService){$scope.header=ResourceUtility.getString("DANTE_LEAD_TILE_HEADER");var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data,leadTileScoreContainer=$(".js-dante-lead-tile-score",$scope.element),options={element:leadTileScoreContainer,widgetConfig:widgetConfig,metadata:metadata,data:data};WidgetFrameworkService.CreateChildWidgets(options,$scope.data)}).directive("leadDetailsTileWidget",function($compile){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/leadDetailsTileWidget/LeadDetailsTileWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.LeadsTabWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.DateTimeFormatUtility","mainApp.appCommon.utilities.TenantIdParsingUtility","mainApp.core.utilities.RightsUtility","mainApp.core.services.FeatureFlagService","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.NavUtility"]).controller("LeadsTabWidgetController",function($scope,$rootScope,ResourceUtility,TenantIdParsingUtility,BrowserStorageUtility,RightsUtility,FeatureFlagService,NavUtility){$scope.ResourceUtility=ResourceUtility;var clientSession=BrowserStorageUtility.getClientSession(),flags=FeatureFlagService.Flags();$scope.showAdminLink=FeatureFlagService.FlagIsEnabled(flags.ADMIN_PAGE),$scope.data.TenantId=clientSession.Tenant.Identifier,$scope.data.TenantName=clientSession.Tenant.DisplayName,$scope.data.DataLoaderTenantName=TenantIdParsingUtility.getDataLoaderTenantNameFromTenantId($scope.data.TenantId),$scope.adminLinkClick=function(){$rootScope.$broadcast(NavUtility.ADMIN_INFO_NAV_EVENT,$scope.data)}}).directive("leadsTabWidget",function($compile){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/leadsTabWidget/LeadsTabWidgetTemplate.html"};return directiveDefinitionObject}).directive("leadsTable",function(){return{restrict:"E",templateUrl:"app/AppCommon/widgets/leadsTabWidget/LeadsTableTemplate.html",scope:{leads:"=",title:"@"},controller:["$scope","$attrs","$http","ResourceUtility",function($scope,$attrs,$http,ResourceUtility){$scope.ResourceUtility=ResourceUtility}]}}),angular.module("mainApp.appCommon.widgets.ManageFieldsWidget",["mainApp.appCommon.utilities.StringUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.setup.utilities.SetupUtility","mainApp.setup.services.MetadataService","mainApp.appCommon.services.ManageFieldsService","mainApp.setup.modals.EditFieldModel","mainApp.setup.controllers.DiscardEditFieldsModel","kendo.directives"]).controller("ManageFieldsWidgetController",function($scope,$rootScope,$timeout,StringUtility,ResourceUtility,SetupUtility,MetadataService,ManageFieldsService,EditFieldModel,DiscardEditFieldsModel){function getOptionsAndFields(){$scope.loading=!0,MetadataService.GetOptions().then(function(result){if(result.Success){var options=result.ResultObj;$scope.CategoryOptions=options.CategoryOptions,$scope.ApprovedUsageOptions=options.ApprovedUsageOptions,$scope.StatisticalTypeOptions=options.StatisticalTypeOptions,$scope.FundamentalTypeOptions=options.FundamentalTypeOptions,loadFields()}else $scope.showLoadingError=!0,$scope.loadingError=result.ResultErrors,$scope.loading=!1})}function loadFields(){$scope.loading=!0,MetadataService.GetFields().then(function(result){if(result.Success){if($scope.fields=result.ResultObj,renderSelects($scope.fields),renderGrid($scope.fields),null!=$scope.fields&&$scope.fields.length>0){$scope.fieldAttributes=[];for(var attr in $scope.fields[0])$scope.fieldAttributes.push(attr)}initBuildModel()}else $scope.showLoadingError=!0,$scope.loadingError=result.ResultErrors,$scope.loading=!1})}function renderSelects(fields){var obj=ManageFieldsService.GetOptionsForSelects(fields);$scope.sourcesToSelect=obj.sourcesToSelect,$scope.categoriesToSelect=obj.categoriesToSelect,$scope.allOptions=obj.allOptions}function renderGrid(fields){$scope.dirtyRows={};var grid=$("#fieldsGrid").data("kendoGrid");if(null!=grid&&null!=grid.dataSource){var state=kendo.stringify({page:grid.dataSource.page(),pageSize:grid.dataSource.pageSize(),sort:grid.dataSource.sort(),filter:grid.dataSource.filter()});grid.dataSource.data(fields),state=JSON.parse(state),(state.page>1||null!=state.sort||null!=state.filter)&&grid.dataSource.query(state)}else{var pageSize=fields.length;pageSize>50&&(pageSize=50);var dataSource=new kendo.data.DataSource({data:fields,schema:{model:{fields:{ColumnName:{type:"string",editable:!1},SourceToDisplay:{type:"string",editable:!1},DisplayName:{type:"string"},Tags:{type:"string",editable:!1},Category:{type:"string"},ApprovedUsage:{type:"string"},FundamentalType:{type:"string"}}}},pageSize:pageSize});$scope.gridOptions={dataSource:dataSource,scrollable:!1,sortable:{mode:"single",allowUnsort:!1},pageable:{messages:{first:"",previous:"",next:"",last:"",display:"{0} - {1} of {2}",empty:"No data"}},columns:[{field:"ColumnName",title:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GRID_FIELD"),template:kendo.template($("#fieldTemplate").html()),width:184},{field:"SourceToDisplay",title:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GRID_SOURCE"),template:kendo.template($("#sourceTemplate").html()),width:108},{field:"DisplayName",title:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GRID_DISPLAY_NAME"),template:kendo.template($("#displayNameTemplate").html()),width:150},{field:"Tags",title:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GRID_TAGS"),template:kendo.template($("#tagsTemplate").html()),width:90},{field:"Category",title:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GRID_CATEGORY"),template:kendo.template($("#categoryTemplate").html()),width:120},{field:"ApprovedUsage",title:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GRID_APPROVED_USAGE"),template:kendo.template($("#approvedUsageTemplate").html()),width:128},{field:"FundamentalType",title:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GRID_FUNDAMENTAL_TYPE"),template:kendo.template($("#fundamentalTypeTemplate").html()),width:128}]}}}function initBuildModel(){MetadataService.IsBuildModelGroupRunning().then(function(result){if(result.Success){var running=result.ResultObj;$scope.buildModelEnable=!running,running&&startGetBuildModelStatusTimer()}else $scope.buildModelErrorMessage=result.ResultErrors,$scope.showBuildModelError=!0;$scope.loading=!1})}function startGetBuildModelStatusTimer(){clearBuildModelTimer(),$scope.buildModelTimerId=window.setInterval(getBuildModelStatus,1e4)}function getBuildModelStatus(){return 1!==$("#manage-fields-build-model").length?(clearBuildModelTimer(),void($scope.gettingQueryStatus=!1)):void($scope.gettingBuildModelStatus!==!0&&($scope.gettingBuildModelStatus=!0,MetadataService.IsBuildModelGroupRunning().then(function(result){if(result.Success){var running=result.ResultObj;$scope.buildModelEnable=!running,running||clearBuildModelTimer(),$scope.getBuildModelStatusRetries=0}else $scope.getBuildModelStatusRetries++>10&&(clearBuildModelTimer(),$scope.buildModelErrorMessage=result.ResultErrors,$scope.showBuildModelError=!0);$scope.gettingBuildModelStatus=!1})))}function clearBuildModelTimer(){null!=$scope.buildModelTimerId&&(window.clearInterval($scope.buildModelTimerId),$scope.buildModelTimerId=null),$scope.getBuildModelStatusRetries=0}function sourceSelectChanged(){for(var categories=[],allOptions=$scope.allOptions,selectedSource=$scope.source,sourceIsEmpty=StringUtility.IsEmptyString(selectedSource),j=0;j<allOptions.length;j++)if(sourceIsEmpty||allOptions[j][0]==selectedSource){var category=allOptions[j][1];!StringUtility.IsEmptyString(category)&&categories.indexOf(category)<0&&categories.push(category)}$scope.categoriesToSelect=categories.sort(),$scope.categoriesToSelect.indexOf($scope.category)<0&&($scope.category="")}function getEditedData(){var grid=$("#fieldsGrid").data("kendoGrid");return $.grep(grid.dataSource.data(),function(item){return item.dirty})}$scope.ResourceUtility=ResourceUtility,$scope.saveInProgress=!1,$scope.showFieldDetails=!1,$scope.buildModelEnable=!1,$scope.fieldAttributes=[],getOptionsAndFields(),$scope.buildModelClicked=function($event){null!=$event&&$event.preventDefault(),$scope.buildModelEnable&&($scope.buildModelEnable=!1,$scope.showBuildModelError=!1,MetadataService.BuildModel().then(function(result){result.Success?startGetBuildModelStatusTimer():($scope.buildModelEnable=!0,$scope.buildModelErrorMessage=result.ResultErrors,$scope.showBuildModelError=!0)}))},$scope.categoryEditable=function(dataItem){return ManageFieldsService.CategoryEditable(dataItem)},$scope.categoryWarning=function(dataItem){return $scope.isEmpty(dataItem.Category)&&"None"!==dataItem.ApprovedUsage&&"Model"!==dataItem.ApprovedUsage},$scope.selectChanged=function($event,filerColumn){"source"==filerColumn&&sourceSelectChanged(),$scope.filterFields($event)},$scope.keyEnterFilter=function($event){13===$event.keyCode&&$scope.filterFields($event)},$scope.filterFields=function($event){null!=$event&&$event.preventDefault();var orFilters=[];if(!StringUtility.IsEmptyString($scope.field)){var nameFiler={logic:"or",filters:[{field:"ColumnName",operator:"contains",value:$scope.field},{field:"DisplayName",operator:"contains",value:$scope.field}]};orFilters.push(nameFiler)}var andFilters=[];StringUtility.IsEmptyString($scope.source)||andFilters.push({field:"SourceToDisplay",operator:"eq",value:$scope.source}),StringUtility.IsEmptyString($scope.category)||andFilters.push({field:"Category",operator:"eq",value:$scope.category});var errorFilters=[];if($scope.onlyShowErrorFields)for(var columns=$scope.gridOptions.columns,i=0;i<columns.length;i++)"SourceToDisplay"!==columns[i].field&&"Tags"!==columns[i].field&&("Category"===columns[i].field?errorFilters.push({logic:"and",filters:[{field:"Tags",operator:"eq",value:"Internal"},{field:"ApprovedUsage",operator:"neq",value:"None"},{field:"ApprovedUsage",operator:"neq",value:"Model"},{field:columns[i].field,operator:"eq",value:""}]}):errorFilters.push({field:columns[i].field,operator:"eq",value:""}));var filter;orFilters.length>0&&andFilters.length>0?(filter={logic:"and",filters:[{logic:"or",filters:orFilters},{logic:"and",filters:andFilters}]},errorFilters.length>0&&filter.filters.push({logic:"or",filters:errorFilters})):filter=orFilters.length>0?errorFilters.length>0?{logic:"and",filters:[{logic:"or",filters:orFilters},{logic:"or",filters:errorFilters}]}:{logic:"or",filters:orFilters}:andFilters.length>0?errorFilters.length>0?{logic:"and",filters:[{logic:"and",filters:andFilters},{logic:"or",filters:errorFilters}]}:{logic:"and",filters:andFilters}:errorFilters.length>0?{logic:"or",filters:errorFilters}:{},$("#fieldsGrid").data("kendoGrid").dataSource.filter(filter)},$scope.editClicked=function($event){null!=$event&&$event.preventDefault(),$scope.batchEdit=!0},$scope.saveClicked=function($event){if(null!=$event&&$event.preventDefault(),!$scope.saveInProgress){$scope.saveInProgress=!0,$scope.showEditFieldsError=!1;var editedData=getEditedData();null!=editedData&&editedData.length>0?MetadataService.UpdateFields(editedData).then(function(result){result.Success?($scope.batchEdit=!1,$scope.saveInProgress=!1,loadFields()):($scope.editFieldsErrorMessage=result.ResultErrors,$scope.showEditFieldsError=!0,$scope.saveInProgress=!1)}):($scope.batchEdit=!1,$scope.saveInProgress=!1)}},$scope.cancelClicked=function($event){if(null!=$event&&$event.preventDefault(),!$scope.saveInProgress){var editedData=getEditedData();null!=editedData&&editedData.length>0?DiscardEditFieldsModel.show($scope):$scope.discardChanges()}},$scope.discardChanges=function(){$("#fieldsGrid").data("kendoGrid").cancelChanges(),$scope.showEditFieldsError=!1,$scope.batchEdit=!1,$scope.dirtyRows={}},$scope.textboxClicked=function($event){$scope.activeTextbox!=$event.target&&($event.target.select(),$scope.activeTextbox=$event.target)},$scope.valueChanged=function($event,dataItem,field,originalValue){null!=$event&&$event.preventDefault();var dirtyRow=$scope.dirtyRows[dataItem.uid]||{};if(null==dirtyRow[field])dirtyRow[field]={dirty:!0,ov:originalValue};else{var newValue=dataItem[field];dirtyRow[field].dirty=newValue!=dirtyRow[field].ov}$scope.dirtyRows[dataItem.uid]=dirtyRow,dataItem.dirty=!1;for(var f in dirtyRow)if(dirtyRow[f].dirty){dataItem.dirty=!0;break}},$scope.isChanged=function(uid,field){var row=$scope.dirtyRows[uid];return row&&row[field]&&row[field].dirty},$scope.fieldLinkClicked=function($event,field){null!=$event&&$event.preventDefault(),EditFieldModel.show(field,$scope)},$scope.$on(SetupUtility.LOAD_FIELDS_EVENT,function(event,data){loadFields()}),$scope.isEmpty=function(value){return null==value||""===value}}).directive("manageFieldsWidget",function(){return{templateUrl:"app/AppCommon/widgets/manageFieldsWidget/ManageFieldsWidgetTemplate.html"}}),angular.module("mainApp.appCommon.widgets.ModelDetailsWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.DateTimeFormatUtility","mainApp.core.utilities.NavUtility","mainApp.appCommon.utilities.StringUtility"]).controller("ModelDetailsWidgetController",function($scope,$rootScope,ResourceUtility,DateTimeFormatUtility,NavUtility,StringUtility){$scope.ResourceUtility=ResourceUtility;var widgetConfig=$scope.widgetConfig,data=($scope.metadata,$scope.data),modelDetails=$scope.data.ModelDetails;$scope.displayName=modelDetails[widgetConfig.NameProperty];var isActive="Active"==modelDetails[widgetConfig.StatusProperty];isActive?$scope.status=ResourceUtility.getString("MODEL_DETAILS_ACTIVE_LABEL"):$scope.status=ResourceUtility.getString("MODEL_DETAILS_INACTIVE_LABEL"),$scope.score=modelDetails[widgetConfig.ScoreProperty],null!=$scope.score&&$scope.score<1&&($scope.score=Math.round(100*$scope.score)),$scope.externalAttributes=data.ExternalAttributes.total,$scope.externalAttributes=StringUtility.AddCommas($scope.externalAttributes),$scope.internalAttributes=data.InternalAttributes.total,$scope.internalAttributes=StringUtility.AddCommas($scope.internalAttributes),$scope.createdDate=modelDetails[widgetConfig.CreatedDateProperty],$scope.createdDate=1e3*$scope.createdDate,$scope.createdDate=DateTimeFormatUtility.FormatShortDate($scope.createdDate),$scope.totalLeads=modelDetails[widgetConfig.TotalLeadsProperty],$scope.totalLeads=StringUtility.AddCommas($scope.totalLeads),$scope.testSet=modelDetails[widgetConfig.TestSetProperty],$scope.testSet=StringUtility.AddCommas($scope.testSet),$scope.trainingSet=modelDetails[widgetConfig.TrainingSetProperty],$scope.trainingSet=StringUtility.AddCommas($scope.trainingSet),$scope.totalSuccessEvents=modelDetails[widgetConfig.TotalSuccessEventsProperty],$scope.totalSuccessEvents=StringUtility.AddCommas($scope.totalSuccessEvents),$scope.conversionRate=modelDetails[widgetConfig.TotalSuccessEventsProperty]/(modelDetails[widgetConfig.TestSetProperty]+modelDetails[widgetConfig.TrainingSetProperty]),null!=$scope.conversionRate&&$scope.conversionRate<1&&($scope.conversionRate=100*$scope.conversionRate,$scope.conversionRate=$scope.conversionRate.toFixed(2)),$scope.leadSource=modelDetails[widgetConfig.LeadSourceProperty],$scope.opportunity=modelDetails[widgetConfig.OpportunityProperty],$scope.dataExpanded=!1,$scope.showMoreLabel=ResourceUtility.getString("MODEL_DETAILS_SHOW_MORE_BUTTON"),$("#moreDataPoints").hide(),$scope.backButtonClick=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.MODEL_LIST_NAV_EVENT)},$scope.showMoreClicked=function($event){null!=$event&&$event.preventDefault(),$scope.dataExpanded=!$scope.dataExpanded,$scope.dataExpanded?$scope.showMoreLabel=ResourceUtility.getString("MODEL_DETAILS_SHOW_LESS_BUTTON"):$scope.showMoreLabel=ResourceUtility.getString("MODEL_DETAILS_SHOW_MORE_BUTTON"),$("#moreDataPoints").slideToggle("400")}}).directive("modelDetailsWidget",function($compile){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/modelDetailsWidget/ModelDetailsWidgetTemplate.html"};return directiveDefinitionObject});var app=angular.module("mainApp.appCommon.widgets.ModelListCreationHistoryWidget",["mainApp.models.services.ModelService","mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.NavUtility","mainApp.core.services.FeatureFlagService","mainApp.models.modals.ImportModelModal"]);app.controller("ModelListCreationHistoryWidgetController",function($scope,$rootScope,ModelService,ResourceUtility,FeatureFlagService,NavUtility,ImportModelModal){$scope.ResourceUtility=ResourceUtility,$scope.models=$scope.data;var flags=FeatureFlagService.Flags();$scope.showUploadModel=FeatureFlagService.FlagIsEnabled(flags.UPLOAD_JSON),$scope.undoDeleteModel=function(modelId){null!=modelId&&ModelService.undoDeletedModel(modelId).then(function(result){result.Success?$rootScope.$broadcast(NavUtility.MODEL_CREATION_HISTORY_NAV_EVENT):$rootScope.$broadcast(NavUtility.MODEL_CREATION_HISTORY_NAV_EVENT)})},$scope.importClicked=function(){ImportModelModal.show()}}).directive("modelListCreationHistoryWidget",function(){return{templateUrl:"app/AppCommon/widgets/modelListCreationHistoryWidget/ModelListCreationHistoryWidgetTemplate.html"}}),angular.module("mainApp.appCommon.widgets.ModelListTileWidget",["mainApp.appCommon.utilities.TrackingConstantsUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.DateTimeFormatUtility","mainApp.core.utilities.NavUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.services.FeatureFlagService","mainApp.appCommon.services.WidgetFrameworkService","mainApp.models.services.ModelService","mainApp.models.modals.DeleteModelModal","mainApp.models.modals.StaleModelModal"]).controller("ModelListTileWidgetController",function($scope,$rootScope,$element,ResourceUtility,BrowserStorageUtility,DateTimeFormatUtility,TrackingConstantsUtility,NavUtility,WidgetFrameworkService,DeleteModelModal,StaleModelModal,FeatureFlagService){$scope.ResourceUtility=ResourceUtility,$scope.nameStatus={editing:!1};var widgetConfig=$scope.widgetConfig,data=$scope.data,flags=FeatureFlagService.Flags();if($scope.mayChangeModelNames=FeatureFlagService.FlagIsEnabled(flags.CHANGE_MODEL_NAME),$scope.mayDeleteModels=FeatureFlagService.FlagIsEnabled(flags.DELETE_MODEL),$scope.mayEditModelsClass=$scope.mayChangeModelNames?"model-name-editable":"",null!=widgetConfig&&null!=data){$(".panel-model-fancy").hover(function(){$(this).toggleClass("hover")}),$(".panel .model-delete a").hover(function(){$(this).toggleClass("hover")}),$scope.displayName=data[widgetConfig.NameProperty],$scope.isActive="Active"===data[widgetConfig.StatusProperty],$scope.createdDate=data[widgetConfig.CreatedDateProperty];var incomplete=data[widgetConfig.IncompleteProperty];$scope.modelNameEditClick=function($event){null!=$event&&$event.stopPropagation(),$scope.mayChangeModelNames&&($scope.nameStatus.editing=!0)},$scope.tileClick=function($event){null!=$event&&$scope.nameStatus.editing&&$event.preventDefault();var targetElement=$($event.target);targetElement.hasClass("fa-trash-o")||targetElement.hasClass("delete-model")?DeleteModelModal.show($scope.data.Id):$scope.nameStatus.editing||incomplete?!$scope.nameStatus.editing&&incomplete&&StaleModelModal.show($scope.data.Id):$rootScope.$broadcast(NavUtility.MODEL_DETAIL_NAV_EVENT,data)}}}).controller("ChangeModelNameController",function($scope,$rootScope,NavUtility,ResourceUtility,ModelService){$scope.data={name:$scope.$parent.displayName},$scope.submitting=!1,$scope.showNameEditError=!1,$scope.closeErrorClick=function($event){null!=$event&&$event.preventDefault(),$scope.showPasswordError=!1},$scope.submit=function($event){if(null!=$event&&$event.stopPropagation(),$scope.showNameEditError=!1,!$scope.submitting){$scope.submitting=!0;var validationResult=ModelService.validateModelName($scope.data.name);return validationResult.valid?void ModelService.ChangeModelDisplayName($scope.$parent.data.Id,$scope.data.name).then(function(result){result.Success?$rootScope.$broadcast(NavUtility.MODEL_LIST_NAV_EVENT,{}):($scope.nameEditErrorMessage=result.ResultErrors,$scope.showNameEditError=!0,$scope.submitting=!1)}):($scope.nameEditErrorMessage=validationResult.errMsg,$scope.showNameEditError=!0,void($scope.submitting=!1))}},$scope.cancel=function($event){null!=$event&&$event.stopPropagation(),$scope.showNameEditError=!1,$scope.data={name:$scope.$parent.displayName},$scope.nameStatus.editing=!1}}).directive("modelListTileWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/modelListTileWidget/ModelListTileWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.performanceTab.DataTable",["mainApp.appCommon.utilities.ResourceUtility"]).directive("dataTable",function(){return{templateUrl:"app/AppCommon/widgets/performanceTabWidget/DataTableTemplate.html",scope:{data:"=",columns:"=",title:"@"},controller:function($scope,ResourceUtility){}}}),angular.module("mainApp.appCommon.widgets.performanceTab.LiftChart",["mainApp.appCommon.utilities.ResourceUtility"]).directive("liftChart",function(){return{template:'<div id="liftChart" class="lift-chart"></div>',scope:{data:"="},controller:function($scope,$filter,ResourceUtility){function bucketLabel(i){var start=91-10*i,end=100-10*i;return String(start)+" - "+String(end)}function drawBar(xCent,lift,majorColor,minorColor){var yTop=y(lift);svg.append("rect").attr("x",xCent-33).attr("y",yTop).attr("width",59).attr("height",y(0)-yTop).attr("fill",majorColor),svg.append("rect").attr("x",xCent+26).attr("y",yTop).attr("width",7).attr("height",y(0)-yTop).attr("fill",minorColor),svg.append("text").attr("x",xCent).attr("y",yTop-5).style("text-anchor","middle").style("font-size","16px").style("font-family","ProximaNova-Bold").style("fill","#333333").text(lift2str(lift))}function drawLiftLevel(lift){function points2str(pts){return pts.map(function(pt){return[String(pt.x),String(pt.y)].join(",")}).join(" ")}var yLoc=y(lift);svg.append("line").attr("x1",0).attr("y1",yLoc).attr("x2",x(1)).attr("y2",yLoc).attr("stroke-width","1").style("stroke-dasharray","2, 2").style("stroke","#bbbbbb");var points=[{x:-3,y:yLoc},{x:-8,y:yLoc+7},{x:-23,y:yLoc+7},{x:-24,y:yLoc+6},{x:-24,y:yLoc-6},{x:-23,y:yLoc-7},{x:-8,y:yLoc-7}];svg.append("polygon").attr("points",points2str(points)).attr("fill","#666"),svg.append("text").attr("x",-15).attr("y",yLoc+3.8).style("text-anchor","middle").style("font-size","11px").style("font-family","ProximaNova-Bold").style("fill","white").text($filter("number")(lift,1))}function lift2str(lift){return $filter("number")(lift,1)+"x"}if(null!=$scope.data){var i,maxLift,nTicks,data=$scope.data,width=840,margin={top:5,right:0,bottom:69,left:936-width},height=363-margin.top-margin.bottom;maxLift=1.1*d3.max(data);var halfIntegerTicks=maxLift<=5.5;halfIntegerTicks?(nTicks=Math.ceil(2*maxLift),maxLift=.5*nTicks):(nTicks=Math.ceil(maxLift),maxLift=nTicks);var x=d3.scale.linear().range([0,width]),y=d3.scale.linear().range([height,0]),yAxis=d3.svg.axis().scale(y).ticks(nTicks).innerTickSize(3).orient("left");halfIntegerTicks?yAxis.tickFormat(function(d){return 2*d%1===0?$filter("number")(d,1):""}):yAxis.tickFormat(function(d){return d%1===0?$filter("number")(d,1):""}),x.domain([0,1,2,3,4,5,6,7,8,9,10]),y.domain([0,maxLift]);var svg=d3.select("#liftChart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");for(svg.append("rect").attr("id","upper-gradient").attr("x",0).attr("y",0).attr("width",width).attr("height",height).attr("fill","#f2f4f8"),i=1;i<10;i++){var xLoc=x(.1*i);svg.append("line").attr("x1",xLoc).attr("y1","0").attr("x2",xLoc).attr("y2",height).attr("stroke-width","1").style("stroke","white")}for(i=0;i<10;i++)svg.append("text").attr("x",x(.1*i+.05)).attr("y",height+15).style("text-anchor","middle").style("font-size","11px").style("font-family","ProximaNova-Semibold").style("fill","#aaa").text(bucketLabel(i));svg.append("g").attr("class","y axis").attr("transform","translate(-3, 0)").style("font-size","11px").style("font-weight","700").style("fill","#999").call(yAxis),svg.append("text").attr("transform","translate(-55, "+height/2+") rotate(-90)").style("text-anchor","middle").style("font-size","12px").style("font-family","ProximaNova-Semibold").style("fill","#aaa").text(ResourceUtility.getString("LIFT_CHART_Y_AXIS_LABEL")),svg.append("text").attr("transform","translate("+x(.5)+", "+(height+58)+")").style("text-anchor","middle").style("font-size","12px").style("font-family","ProximaNova-Semibold").style("fill","#aaa").text(ResourceUtility.getString("LIFT_CHART_X_AXIS_LABEL")),d3.selectAll(".axis g.tick line").style("stroke","#999"),d3.selectAll(".axis path").style("display","none"),data.forEach(function(lift,index){drawBar(x(.1*(index+.5)),lift,lift>=1?"#477cba":"#f6b300",lift>=1?"#4376b1":"#e9aa00")}),drawLiftLevel(1)}}}}),angular.module("mainApp.appCommon.widgets.PerformanceTabWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.appCommon.widgets.performanceTab.ThresholdExplorer","mainApp.appCommon.widgets.performanceTab.LiftChart","mainApp.appCommon.widgets.performanceTab.DataTable"]).directive("performanceTabWidget",function(){return{templateUrl:"app/AppCommon/widgets/performanceTabWidget/PerformanceTabTemplate.html",controller:["$scope","$filter","ResourceUtility",function($scope,$filter,ResourceUtility){if(null!=$scope.data){$scope.threasholdData=$scope.data.ThresholdChartData,$scope.decileData=[[ResourceUtility.getString("DECILE_GRID_CONVERSIONS")]],$scope.data.ThresholdDecileData.forEach(function(d){$scope.decileData[0].push($filter("number")(d,0)+"%")});var top_label=ResourceUtility.getString("DECILE_GRID_TOP_LABEL");$scope.decileColumns=[{title:ResourceUtility.getString("DECILE_GRID_LEADS_LABEL")},{title:"10%",superTitle:top_label},{title:"20%",superTitle:top_label},{title:"30%",superTitle:top_label},{title:"40%",superTitle:top_label},{title:"50%",superTitle:top_label},{title:"60%",superTitle:top_label},{title:"70%",superTitle:top_label},{title:"80%",superTitle:top_label},{title:"90%",superTitle:top_label},{title:"100%",superTitle:top_label}],$scope.liftChartData=$scope.data.ThresholdLiftData,$scope.liftData=[[ResourceUtility.getString("LIFT_GRID_LIFT")]],$scope.data.ThresholdLiftData.forEach(function(d){$scope.liftData[0].push($filter("number")(d,1)+"x")}),$scope.liftColumns=[{title:ResourceUtility.getString("LIFT_GRID_LEAD_SCORE")},{title:"91-100"},{title:"81-90"},{title:"71-80"},{title:"61-70"},{title:"51-60"},{title:"41-50"},{title:"31-40"},{title:"21-30"},{title:"11-20"},{title:"1-10"}]}}]}}),angular.module("mainApp.appCommon.widgets.performanceTab.ThresholdExplorer",["mainApp.appCommon.utilities.ResourceUtility"]).directive("thresholdExplorer",function(){return{template:'<div id="thresholdExplorerChart" class="threshold-explorer-chart"></div>',scope:{data:"="},controller:function($scope,ResourceUtility){function updateInfoElements(d){infoElements.select("circle.y").attr("transform","translate("+x(d.leads)+","+y(d.conversions)+")"),infoElements.select("line.x").attr("transform","translate(0,"+y(d.conversions)+")"),infoElements.select("line.y").attr("transform","translate("+x(d.leads)+",-40)"),infoElements.select("line.d").attr("transform","translate("+x(d.leads)+","+(height+30)+")"),infoElements.select("text.rltext").attr("transform","translate("+(x(d.leads)+15)+",-30)"),infoElements.select("text.rtext").text((0!==d.rightLift?d.rightLift.toFixed(2):0)+"x").attr("transform","translate("+(x(d.leads)+14)+",-13)"),infoElements.select("text.lltext").attr("transform","translate("+(x(d.leads)-16)+",-30)"),infoElements.select("text.ltext").text(d.leftLift.toFixed(2)+"x").attr("transform","translate("+(x(d.leads)-16)+",-13)"),infoElements.select("polygon.larrow").attr("transform","translate("+(x(d.leads)-10)+",-30)"),infoElements.select("polygon.rarrow").attr("transform","translate("+(x(d.leads)+5)+",-30)"),infoElements.select("circle.xball").attr("transform","translate(-36,"+y(d.conversions)+")"),infoElements.select("circle.yball").attr("transform","translate("+x(d.leads)+","+(height+25)+")"),infoElements.select("text.xltext").attr("transform","translate(-40,"+(y(d.conversions)-3)+")"),infoElements.select("text.xtext").text(d.conversions.toFixed(0)+"%").attr("transform","translate(-40,"+(y(d.conversions)+14)+")"),
infoElements.select("text.lyltext").attr("transform","translate("+(x(d.leads)-10)+","+(height+38)+")"),infoElements.select("text.lytext").text(d.leads+"%").attr("transform","translate("+(x(d.leads)-10)+","+(height+55)+")"),infoElements.select("text.ryltext").attr("transform","translate("+(x(d.leads)+9)+","+(height+38)+")"),infoElements.select("text.rytext").text("> "+(d.score-1)).attr("transform","translate("+(x(d.leads)+9)+","+(height+55)+")")}function setDefaultInfoElements(){updateInfoElements(data[20])}function captureMouseMove(){if(!targetSet){var x0=x.invert(d3.mouse(this)[0]),i=bisectLeads(data,x0,1),d0=data[i-1],d1=data[i],d=x0-d0.leads>d1.leads-x0?d1:d0;updateInfoElements(0===d.leads?data[1]:d)}}function captureMouseDown(){targetSet=!targetSet;var x0=x.invert(d3.mouse(this)[0]),i=bisectLeads(data,x0,1),d0=data[i-1],d1=data[i],d=x0-d0.leads>d1.leads-x0?d1:d0;updateInfoElements(0===d.leads?data[1]:d)}if(null!=$scope.data){var data=$scope.data,targetSet=!0,margin={top:47,right:150,bottom:89,left:204},width=1154-margin.left-margin.right,height=336-margin.top-margin.bottom,x=d3.scale.linear().range([0,width]),y=d3.scale.linear().range([height,0]),xAxis=d3.svg.axis().scale(x).ticks(100).innerTickSize(3).orient("bottom"),yAxis=d3.svg.axis().scale(y).ticks(10).innerTickSize(3).orient("left");xAxis.tickFormat(function(d){return d%10===0?d:""}),yAxis.tickFormat(function(d){return d%10===0?d:""}),x.domain(d3.extent(data,function(d){return d.leads})),y.domain(d3.extent(data,function(d){return d.conversions}));var line=d3.svg.line().x(function(d){return x(d.leads)}).y(function(d){return y(d.conversions)}),lowerArea=d3.svg.area().x(function(d){return x(d.leads)}).y0(height).y1(function(d){return y(d.conversions)}),upperArea=d3.svg.area().x(function(d){return x(d.leads)}).y0(-1).y1(function(d){return y(d.conversions)}),svg=d3.select("#thresholdExplorerChart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").style("cursor","pointer").attr("transform","translate("+margin.left+","+margin.top+")");svg.append("linearGradient").attr("id","lower-gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","pad").selectAll("stop").data([{offset:"0%",color:"#6aa9ff",opacity:.6},{offset:"100%",color:"#6aa9ff",opacity:.1}]).enter().append("stop").attr("offset",function(d){return d.offset}).attr("stop-color",function(d){return d.color}).attr("stop-opacity",function(d){return d.opacity}),svg.append("path").datum(data).style("fill","url(#lower-gradient)").attr("d",lowerArea),svg.append("linearGradient").attr("id","upper-gradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%").attr("spreadMethod","pad").selectAll("stop").data([{offset:"0%",color:"#f2f4f8",opacity:1},{offset:"100%",color:"#f2f4f8",opacity:1}]).enter().append("stop").attr("offset",function(d){return d.offset}).attr("stop-color",function(d){return d.color}).attr("stop-opacity",function(d){return d.opacity}),svg.append("path").datum(data).style("fill","url(#upper-gradient)").attr("d",upperArea),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(height+3)+")").style("font-size","9px").style("font-weight","700").style("fill","#999").call(xAxis).append("text").attr("transform","translate("+width/2+" , 77)").style("text-anchor","middle").style("font-size","12px").style("font-family","ProximaNova-Semibold").style("fill","#aaa").text(ResourceUtility.getString("THRESHOLD_EXPLORER_X_AXIS_LABEL")),svg.append("g").attr("class","y axis").attr("transform","translate(-3, 0)").style("font-size","9px").style("font-weight","700").style("fill","#999").call(yAxis).append("text").attr("transform","translate(-100, "+height/2+") rotate(-90)").style("text-anchor","middle").style("font-size","12px").style("font-family","ProximaNova-Semibold").style("fill","#aaa").text(ResourceUtility.getString("THRESHOLD_EXPLORER_Y_AXIS_LABEL")),d3.selectAll(".axis g.tick line").style("stroke",function(d){return d%10===0?"#666":"#ddd"}),d3.selectAll(".axis path").style("display","none");for(var i=1;i<10;i++){var xLoc=x(10*i);svg.append("line").attr("x1",xLoc).attr("y1","0").attr("x2",xLoc).attr("y2",height).attr("stroke-width","1").style("stroke","white")}svg.append("path").datum(data).style("fill","none").style("stroke","#2579ad").style("stroke-width","2").attr("d",line),svg.append("line").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2",height).style("stroke","#ccc"),svg.append("line").attr("x1",width).attr("y1","0").attr("x2",width).attr("y2",height).style("stroke","#ccc");var infoElements=svg.append("g");infoElements.append("line").attr("class","x").attr("x1",-34).attr("y1","0").attr("x2",width).attr("y2","0").attr("stroke-dasharray","2 2").style("stroke","#666"),infoElements.append("line").attr("class","y").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2",height+62).attr("stroke-dasharray","2 2").style("stroke","#666"),infoElements.append("circle").attr("class","y").style("fill","white").style("stroke","#2579ad").style("stroke-width","2").attr("r",6.5),infoElements.append("text").attr("class","rltext").style("text-anchor","start").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_LIFT_LABEL")),infoElements.append("text").attr("class","rtext").style("text-anchor","start").style("fill","#333").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("text").attr("class","lltext").style("text-anchor","end").style("startOffset","100%").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_LIFT_LABEL")),infoElements.append("text").attr("class","ltext").style("text-anchor","end").style("startOffset","100%").style("fill","#333").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("text").attr("class","xltext").style("text-anchor","end").style("startOffset","100%").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_CONVERSION_LABEL")),infoElements.append("text").attr("class","xtext").style("text-anchor","end").style("startOffset","100%").style("fill","#477cba").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("text").attr("class","lyltext").style("text-anchor","end").style("startOffset","100%").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_LEADS_LABEL")),infoElements.append("text").attr("class","lytext").style("text-anchor","end").style("startOffset","100%").style("fill","#477cba").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("text").attr("class","ryltext").style("text-anchor","start").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_SCORE_LABEL")),infoElements.append("text").attr("class","rytext").style("text-anchor","start").style("fill","#477cba").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("polygon").attr("class","rarrow").attr("points","0,0, 0,6, 4,3").style("fill","#447bbc").attr("stroke","#447bbc"),infoElements.append("polygon").attr("class","larrow").attr("points","4,0, 4,6, 0,3").style("fill","#447bbc").attr("stroke","#447bbc"),infoElements.append("circle").attr("class","xball").style("fill","#447bbc").attr("stroke","#447bbc").attr("r",2),infoElements.append("circle").attr("class","yball").style("fill","#447bbc").attr("stroke","#447bbc").attr("r",2),infoElements.append("line").attr("class","d").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2","25").style("stroke","#c6cbd1"),setDefaultInfoElements(),svg.append("rect").attr("x",-10).attr("y",-10).attr("width",width+20).attr("height",height+20).style("fill","none").style("pointer-events","all").on("mousemove",captureMouseMove).on("mousedown",captureMouseDown);var bisectLeads=d3.bisector(function(d){return d.leads}).left}}}}),angular.module("mainApp.appCommon.widgets.PlayDetailsTileWidget",["mainApp.appCommon.utilities.WidgetEventConstantUtility","mainApp.appCommon.utilities.TrackingConstantsUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.appCommon.services.PlayTileService"]).controller("PlayDetailsTileWidgetController",function($scope,$rootScope,$element,TrackingConstantsUtility,WidgetEventConstantUtility,WidgetFrameworkService,PlayTileService){var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data,successCallback=function(tileData){$scope.tileData=tileData;var tileElement=$($element),tileScoreContainer=$(".js-dante-play-details-nav-tile-score",tileElement),options={element:tileScoreContainer,widgetConfig:widgetConfig,metadata:metadata,data:data};WidgetFrameworkService.CreateChildWidgets(options,$scope.data)};PlayTileService.GetTileData(data,widgetConfig,metadata,successCallback),$scope.isSelected=data.isSelected,$scope.playNameClicked=function(){$rootScope.$broadcast(WidgetEventConstantUtility.PLAY_DETAILS_TAB_CLICKED,$scope.tileData.ID)},$scope.$on("PlayDetailsTabClickedEvent",function(event,data){$scope.isSelected=$scope.tileData.ID==data})}).directive("playDetailsTileWidget",function($compile){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/playDetailsTileWidget/PlayDetailsTileWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.PlayListTileWidget",["mainApp.appCommon.utilities.TrackingConstantsUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.appCommon.services.PlayTileService"]).controller("PlayListTileWidgetController",function($scope,$element,TrackingConstantsUtility,WidgetFrameworkService,PlayTileService){var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data,successCallback=function(tileData){$scope.tileData=tileData;var tileElement=$($element),tileScoreContainer=$(".js-dante-play-tile-score",tileElement),options={element:tileScoreContainer,widgetConfig:widgetConfig,metadata:metadata,data:data};WidgetFrameworkService.CreateChildWidgets(options,$scope.data)};PlayTileService.GetTileData(data,widgetConfig,metadata,successCallback),$scope.playNameClicked=function(){window.location.hash="/Main/PlayDetails/"+$scope.tileData.ID}}).directive("playListTileWidget",function($compile){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/playListTileWidget/PlayListTileWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.RepeaterWidget",["mainApp.appCommon.utilities.MetadataUtility","mainApp.appCommon.utilities.SortUtility","mainApp.appCommon.services.WidgetFrameworkService"]).controller("RepeaterWidgetController",function($scope,$element,$q,MetadataUtility,SortUtility,WidgetFrameworkService){var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data,parentData=$scope.parentData,repeaterData=null,targetNotionProperty=MetadataUtility.GetNotionAssociationMetadata(widgetConfig.Notion,widgetConfig.TargetNotion,metadata);if(null==metadata||null!=targetNotionProperty&&null!=data[targetNotionProperty.Name]){repeaterData=null==metadata?parentData:data[targetNotionProperty.Name];var propsToSortOn=WidgetFrameworkService.GetSortProperties(widgetConfig,metadata);SortUtility.MultiSort(repeaterData,propsToSortOn);var numItems=repeaterData.length,numCols=widgetConfig.Columns||1;WidgetFrameworkService.CreateWidgetsInColumnLayout($element,numItems,numCols,function(childElement,numItems,childIndex){var activeWidgets=widgetConfig.ActiveWidgets,isCurrentItemActive=WidgetFrameworkService.IsChildActive(activeWidgets,childIndex,repeaterData.length),options={element:childElement,widgetConfig:widgetConfig,metadata:metadata,data:data,parentData:parentData,isActive:isCurrentItemActive},currentItemData=repeaterData[childIndex],numberOfColumns=1;WidgetFrameworkService.CreateChildWidgetsInColumnLayout(options,currentItemData,numberOfColumns)})}}).directive("repeaterWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/repeaterWidget/RepeaterWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.ScreenHeaderWidget",["mainApp.appCommon.utilities.MetadataUtility","mainApp.appCommon.services.WidgetFrameworkService"]).controller("ScreenHeaderWidgetController",function($scope,MetadataUtility,WidgetFrameworkService){var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data,notionMetadata=MetadataUtility.GetNotionMetadata(widgetConfig.Notion,metadata),titleProperty=MetadataUtility.GetNotionProperty(widgetConfig.TitleProperty,notionMetadata);null!=titleProperty&&($scope.title=data[titleProperty.Name]||"");var subtitleProperty=MetadataUtility.GetNotionProperty(widgetConfig.SubtitleProperty,notionMetadata);null!=subtitleProperty&&($scope.subtitle=data[subtitleProperty.Name]||"")}).directive("screenHeaderWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/screenHeaderWidget/ScreenHeaderWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.ScreenWidget",["mainApp.appCommon.services.WidgetFrameworkService"]).controller("ScreenWidgetController",function($scope,$element,WidgetFrameworkService){var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data,parentData=$scope.parentData,container=$("<div></div>");$($element).append(container);var options={element:container,widgetConfig:widgetConfig,metadata:metadata,data:data,parentData:parentData};WidgetFrameworkService.CreateChildWidgets(options,$scope.data)}).directive("screenWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/screenWidget/ScreenWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.SimpleGridWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.services.WidgetFrameworkService"]).controller("SimpleGridWidgetController",function($scope,$element,ResourceUtility,WidgetFrameworkService){var widgetConfig=$scope.widgetConfig,data=$scope.data;$scope.parentData;if(null!=widgetConfig&&0!==widgetConfig.length&&($scope.gridTitle=ResourceUtility.getString(widgetConfig.TitleString),null!=widgetConfig.Columns&&0!==widgetConfig.Columns.length)){$scope.customGridClass="",null!=widgetConfig.CustomGridClass&&($scope.customGridClass=widgetConfig.CustomGridClass),$scope.columnTitles=[];for(var i=0;i<widgetConfig.Columns.length;i++){var column=widgetConfig.Columns[i],columnTitle={title:ResourceUtility.getString(column.TitleString),subtitle:ResourceUtility.getString(column.SubtitleString)};$scope.columnTitles.push(columnTitle)}for(var gridBody=$(".js-simple-grid-rows",$element),dataProvider=data[widgetConfig.DataProvider],y=0;y<dataProvider.length;y++){var gridRow=$("<tr></tr>");gridBody.append(gridRow);for(var rowData=dataProvider[y],x=0;x<widgetConfig.Columns.length;x++){var columnMetaData=widgetConfig.Columns[x],gridColumn=$("<td></td>"),columnData=rowData[columnMetaData.PropertyName];switch(columnMetaData.DisplayType){case"Boolean":columnData=columnData===!0?'<i class="fa fa-check"></i>':""}gridColumn.html(columnData),gridRow.append(gridColumn)}}}}).directive("simpleGridWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/simpleGridWidget/SimpleGridWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.SimpleTabWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.services.WidgetFrameworkService"]).controller("SimpleTabWidgetController",function($scope,$element,ResourceUtility,WidgetFrameworkService){var widgetConfig=$scope.widgetConfig,data=$scope.data,parentData=$scope.parentData;if(null!=widgetConfig&&0!==widgetConfig.length){var defaultTab=null!=widgetConfig.DefaultTab?parseInt(widgetConfig.DefaultTab):1;$scope.tabs=[];var createTabs=function(){for(var i=0;i<widgetConfig.Tabs.length;i++){var tab=widgetConfig.Tabs[i];tab.IsActive=!1,tab.Title=ResourceUtility.getString(tab.TitleString),$scope.tabs.push(tab)}if(0!==$scope.tabs.length){for(var foundActiveTab=!1,x=0;x<$scope.tabs.length;x++){var nextTab=$scope.tabs[x];defaultTab===x&&(foundActiveTab=!0,nextTab.IsActive=!0)}foundActiveTab||($scope.tabs[0].IsActive=!0)}};createTabs(),setTimeout(function(){for(var i=0;i<widgetConfig.Tabs.length;i++)for(var tab=widgetConfig.Tabs[i],x=0;x<tab.Widgets.length;x++){var tabWidgetConfig=tab.Widgets[x],childElement=$("#"+tab.ID,$element),container=$("<div></div>");childElement.append(container),childElement&&WidgetFrameworkService.CreateWidget({element:container,widgetConfig:tabWidgetConfig,data:data,parentData:parentData})}},0),$scope.tabClicked=function($event,tab){null!=$event&&$event.preventDefault();for(var i=0;i<$scope.tabs.length;i++)$scope.tabs[i].IsActive=!1;tab.IsActive=!0}}}).directive("simpleTabWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/simpleTabWidget/SimpleTabWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.TabWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.MetadataUtility","mainApp.appCommon.services.WidgetFrameworkService"]).controller("TabWidgetController",function($scope,$element,ResourceUtility,MetadataUtility,WidgetFrameworkService){var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data,parentData=$scope.parentData;if(null!=widgetConfig&&0!==widgetConfig.length){var checkTabWidgetData=function(widgetConfig){if(null==widgetConfig||null==widgetConfig.Notion||null==widgetConfig.TargetNotion)return!1;var targetNotionProperty=MetadataUtility.GetNotionAssociationMetadata(widgetConfig.Notion,widgetConfig.TargetNotion,metadata);if(null==targetNotionProperty)return!1;var tabData=data[targetNotionProperty.Name];return null!=tabData&&tabData.length>0};$scope.tabs=[];var createTabs=function(){for(var i=0;i<widgetConfig.Widgets.length;i++){var widget=widgetConfig.Widgets[i],hasData=checkTabWidgetData(widget),tab={ID:widget.ID,IsActive:!1,Title:ResourceUtility.getString(widget.TitleString),HasData:hasData,NoDataString:ResourceUtility.getString(widget.NoDataString)};$scope.tabs.push(tab)}if(0!==$scope.tabs.length){var firstTab=$scope.tabs[0];if(firstTab.HasData)firstTab.IsActive=!0;else if($scope.tabs.length>1&&!firstTab.HasData){var secondTab=$scope.tabs[1];secondTab.HasData?secondTab.IsActive=!0:firstTab.IsActive=!0}else firstTab.IsActive=!0}};createTabs(),setTimeout(function(){for(var i=0;i<widgetConfig.Widgets.length;i++){var tabWidgetConfig=widgetConfig.Widgets[i],tabHasData=checkTabWidgetData(tabWidgetConfig),childElement=$("#"+tabWidgetConfig.ID,$element),container=$("<div></div>");childElement.append(container),childElement&&tabHasData&&WidgetFrameworkService.CreateWidget({element:container,widgetConfig:tabWidgetConfig,metadata:metadata,data:data,parentData:parentData})}},0),$scope.tabClicked=function($event,tab){null!=$event&&$event.preventDefault();for(var i=0;i<$scope.tabs.length;i++)$scope.tabs[i].IsActive=!1;tab.IsActive=!0}}}).directive("tabWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/tabWidget/TabWidgetTemplate.html"};return directiveDefinitionObject});var talkingPointParser=function(){function stripQuotes(string){if("string"==typeof string){var toReturn=string.replace(/^\'|\'$/g,"");return toReturn}return string}function Parser(){this.yy={}}var parser={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"&&":6,"||":7,"==":8,"!=":9,">":10,"<":11,">=":12,"<=":13,"(":14,")":15,TRUE:16,FALSE:17,StringLiteral:18,DecimalLiteral:19,NUMERIC_LITERAL:20,STRING_LITERAL:21,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"&&",7:"||",8:"==",9:"!=",10:">",11:"<",12:">=",13:"<=",14:"(",15:")",16:"TRUE",17:"FALSE",20:"NUMERIC_LITERAL",21:"STRING_LITERAL"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[19,1],[18,1]],performAction:function(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return"undefined"!=typeof console?console.log($$[$0-1]):print($$[$0-1]),$$[$0-1];case 2:this.$=$$[$0-2]&&$$[$0];break;case 3:this.$=$$[$0-2]||$$[$0];break;case 4:this.$=$$[$0-2]==$$[$0];break;case 5:this.$=parseInt($$[$0-2])!=parseInt($$[$0]);break;case 6:this.$=parseInt($$[$0-2])>parseInt($$[$0]);break;case 7:this.$=parseInt($$[$0-2])<parseInt($$[$0]);break;case 8:this.$=parseInt($$[$0-2])>=parseInt($$[$0]);break;case 9:this.$=parseInt($$[$0-2])<=parseInt($$[$0]);break;case 10:this.$=$$[$0-1];break;case 11:this.$=!0;break;case 12:this.$=!1;break;case 15:console.log("decimal: "+$$[$0]),this.$=stripQuotes($$[$0]);break;case 16:console.log("string: "+$$[$0]);var unquoted=stripQuotes($$[$0]);"true"==unquoted.toLowerCase()?this.$=!0:"false"==unquoted.toLowerCase()?this.$=!1:this.$=unquoted}},table:[{3:1,4:2,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{1:[3]},{5:[1,10],6:[1,11],7:[1,12],8:[1,13],9:[1,14],10:[1,15],11:[1,16],12:[1,17],13:[1,18]},{4:19,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],15:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],15:[2,12]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],15:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],15:[2,14]},{5:[2,16],6:[2,16],7:[2,16],8:[2,16],9:[2,16],10:[2,16],11:[2,16],12:[2,16],13:[2,16],15:[2,16]},{5:[2,15],6:[2,15],7:[2,15],8:[2,15],9:[2,15],10:[2,15],11:[2,15],12:[2,15],13:[2,15],15:[2,15]},{1:[2,1]},{4:20,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{4:21,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{4:22,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{4:23,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{4:24,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{4:25,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{4:26,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{4:27,14:[1,3],16:[1,4],17:[1,5],18:6,19:7,20:[1,9],21:[1,8]},{6:[1,11],7:[1,12],8:[1,13],9:[1,14],10:[1,15],11:[1,16],12:[1,17],13:[1,18],15:[1,28]},{5:[2,2],6:[2,2],7:[2,2],8:[2,2],9:[2,2],10:[2,2],11:[2,2],12:[2,2],13:[2,2],15:[2,2]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[2,3],10:[2,3],11:[2,3],12:[2,3],13:[2,3],15:[2,3]},{5:[2,4],6:[1,11],7:[1,12],8:[2,4],9:[2,4],10:[2,4],11:[2,4],12:[2,4],13:[2,4],15:[2,4]},{5:[2,5],6:[1,11],7:[1,12],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],15:[2,5]},{5:[2,6],6:[1,11],7:[1,12],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],15:[2,6]},{5:[2,7],6:[1,11],7:[1,12],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],15:[2,7]},{5:[2,8],6:[1,11],7:[1,12],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],15:[2,8]},{5:[2,9],6:[1,11],7:[1,12],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],15:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],15:[2,10]}],defaultActions:{10:[2,1]},parseError:function(str,hash){if(!hash.recoverable)throw new Error(str);this.trace(str)},parse:function(input){function lex(){var token;return token=self.lexer.lex()||EOF,"number"!=typeof token&&(token=self.symbols_[token]||token),token}var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1,args=lstack.slice.call(arguments,1);this.lexer.setInput(input),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError?this.parseError=this.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var symbol,preErrorSymbol,state,action,r,p,len,newState,expected,yyval={};;){if(state=stack[stack.length-1],this.defaultActions[state]?action=this.defaultActions[state]:(null!==symbol&&"undefined"!=typeof symbol||(symbol=lex()),action=table[state]&&table[state][symbol]),"undefined"==typeof action||!action.length||!action[0]){var errStr="";expected=[];for(p in table[state])this.terminals_[p]&&p>TERROR&&expected.push("'"+this.terminals_[p]+"'");errStr=this.lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==EOF?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'"),this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol),vstack.push(this.lexer.yytext),lstack.push(this.lexer.yylloc),stack.push(action[1]),symbol=null,preErrorSymbol?(symbol=preErrorSymbol,preErrorSymbol=null):(yyleng=this.lexer.yyleng,yytext=this.lexer.yytext,yylineno=this.lexer.yylineno,yyloc=this.lexer.yylloc,recovering>0&&recovering--);break;case 2:if(len=this.productions_[action[1]][1],yyval.$=vstack[vstack.length-len],yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column},ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]),r=this.performAction.apply(yyval,[yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack].concat(args)),"undefined"!=typeof r)return r;len&&(stack=stack.slice(0,-1*len*2),vstack=vstack.slice(0,-1*len),lstack=lstack.slice(0,-1*len)),stack.push(this.productions_[action[1]][0]),vstack.push(yyval.$),lstack.push(yyval._$),newState=table[stack[stack.length-2]][stack[stack.length-1]],stack.push(newState);break;case 3:return!0}}return!0}},lexer=function(){var lexer={EOF:1,parseError:function(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input){return this._input=input,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var ch=this._input[0];this.yytext+=ch,this.yyleng++,this.offset++,this.match+=ch,this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);return lines?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-len-1),this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),lines.length-1&&(this.yylineno-=lines.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;return next.length<20&&(next+=this._input.substr(0,20-next.length)),(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},test_match:function(match,indexed_rule){var token,lines,backup;if(this.options.backtrack_lexer&&(backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(backup.yylloc.range=this.yylloc.range.slice(0))),lines=match[0].match(/(?:\r\n?|\n).*/g),lines&&(this.yylineno+=lines.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length},this.yytext+=match[0],this.match+=match[0],this.matches=match,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(match[0].length),this.matched+=match[0],token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),token)return token;if(this._backtrack){for(var k in backup)this[k]=backup[k];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var token,match,tempMatch,index;this._more||(this.yytext="",this.match="");for(var rules=this._currentRules(),i=0;i<rules.length;i++)if(tempMatch=this._input.match(this.rules[rules[i]]),tempMatch&&(!match||tempMatch[0].length>match[0].length)){if(match=tempMatch,index=i,this.options.backtrack_lexer){if(token=this.test_match(tempMatch,rules[i]),token!==!1)return token;if(this._backtrack){match=!1;continue}return!1}if(!this.options.flex)break}return match?(token=this.test_match(match,rules[index]),token!==!1&&token):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var r=this.next();return r?r:this.lex()},begin:function(condition){this.conditionStack.push(condition)},popState:function(){var n=this.conditionStack.length-1;return n>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(n){return n=this.conditionStack.length-1-Math.abs(n||0),n>=0?this.conditionStack[n]:"INITIAL"},pushState:function(condition){this.begin(condition)},stateStackSize:function(){return this.conditionStack.length},options:{flex:!0},performAction:function(yy,yy_,$avoiding_name_collisions,YY_START){switch($avoiding_name_collisions){case 0:break;case 1:return"STRING_LITERAL";case 2:return"NUMERIC_LITERAL";case 3:return"TRUE";case 4:return"TRUE";case 5:return"FALSE";case 6:return"FALSE";
case 7:return"(";case 8:return")";case 9:return"[";case 10:return"]";case 11:return".";case 12:return"==";case 13:return"!=";case 14:return"<=";case 15:return"<";case 16:return">=";case 17:return">";case 18:return"&&";case 19:return"||";case 20:return"EOF";case 21:return"ERROR";case 22:console.log(yy_.yytext)}},rules:[/^(?:\s+)/,/^(?:("([^\"\\]*(\\.[^\"\\]*)*)"|'([^\'\\]*(\\.[^\'\\]*)*)'))/,/^(?:((([0]|(([1-9])([0-9]+)*))\.([0-9]+)*)|(\.([0-9]+))|(([0]|(([1-9])([0-9]+)*)))))/,/^(?:true)/,/^(?:'true')/,/^(?:false)/,/^(?:'false')/,/^(?:\()/,/^(?:\))/,/^(?:\[)/,/^(?:\])/,/^(?:\.)/,/^(?:==)/,/^(?:!=)/,/^(?:<=)/,/^(?:<)/,/^(?:>=)/,/^(?:>)/,/^(?:&&)/,/^(?:\|\|)/,/^(?:$)/,/^(?:.)/,/^(?:.)/],conditions:{REGEXP:{rules:[],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],inclusive:!0}}};return lexer}();return parser.lexer=lexer,Parser.prototype=parser,parser.Parser=Parser,new Parser}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=talkingPointParser,exports.Parser=talkingPointParser.Parser,exports.parse=function(){return talkingPointParser.parse.apply(talkingPointParser,arguments)},exports.main=function(args){args[1]||(console.log("Usage: "+args[0]+" FILE"),process.exit(1));var source=require("fs").readFileSync(require("path").normalize(args[1]),"utf8");return exports.parser.parse(source)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1))),angular.module("mainApp.appCommon.widgets.TalkingPointWidget",[]).service("TalkingPointWidgetService",function(){this.decodeHtmlEntities=function(text){return text=text.replace(/&gt;/g,">"),text=text.replace(/&lt;/g,"<"),text=text.replace(/&#39;/g,"'"),text=text.replace(/&apos;/g,"'")},this.evaluateLookupPath=function(token,account,playID,accountMetadata,leadMetadata){var toReturn="",regex=/^account\.(.*?)/i;if(regex.test(token))token=token.replace(regex,"$1"),property=MetadataUtility.GetNotionProperty(token,accountMetadata),toReturn=this.lookupHelper(account,token);else{var play=this.getPlay(playID,account.SalesforceAccountID);property=MetadataUtility.GetNotionProperty(token,leadMetadata),toReturn=this.lookupHelper(play,token)}if(property)switch(property.PropertyTypeString){case MetadataConstants.PropertyType.CURRENCY:toReturn=CurrencyUtil.FormatCurrency(toReturn);break;case MetadataConstants.PropertyType.EPOCH_TIME:toReturn=new Date(1e3*toReturn).toLocaleDateString()}return toReturn},this.lookupHelper=function(object,property){if(null!=object&&null!=property){property=property.toLowerCase();for(var p in object)if(object.hasOwnProperty(p)&&property==p.toLowerCase())return object[p]}},this.getPlay=function(playID,sfdcAccountId){if(null==playID||null==sfdcAccountId)return null;var localStorageKey="DanteLead-"+sfdcAccountId,leadObj=$.jStorage.get(localStorageKey);if(null==leadObj)return null;for(var i=0;i<leadObj.listData.length;i++)if(leadObj.listData[i].PlayID===playID)return leadObj.listData[i];return null},this.logError=function(error){},this.FormatTalkingPoint=function(content,account,playID){function replaceToken(match,token,offset,string,quote){return result=self.evaluateLookupPath(token,account,playID,accountMetadata,leadMetadata),void 0===result&&self.logError("Could not evaluate lookup path "+token),result}function replaceCondition(match,condition,text,offset,string){function replaceAndQuoteToken(match,token,offset,string){return"'"+replaceToken(match,token,offset,string)+"'"}var x=condition;x=condition.replace(tokens,replaceAndQuoteToken),x=self.decodeHtmlEntities(x),x=x.replace(/([^<>])=/g,"$1=="),x=x.replace(/<>/g,"!="),x=x.replace(/[^a-zA-Z0-9.]True[^a-zA-Z0-9.]/g,"true"),x=x.replace(/[^a-zA-Z0-9.]False[^a-zA-Z0-9.]/g,"false"),x=x.replace(/[^a-zA-Z0-9.]OR[^a-zA-Z0-9.]/g,"||"),x=x.replace(/[^a-zA-Z0-9.]AND[^a-zA-Z0-9.]/g,"&&"),x=x.replace(/[^a-zA-Z0-9.]null[^a-zA-Z0-9.]/g,"''"),x=x.replace(/(\s+|^|\||&)((?:\S+?)\s*?(?:==|!=|<=|>=|>|<)\s*?(?:\S+?))(\s+|$|\||&)/g,"$1($2)$3");try{var evaluation=talkingPointParser.parse(x);if(evaluation)return text}catch(e){self.logError(e)}return""}var self=this,tokens=/\{!([^\}]*)\}/g,conditions=/\[([^\]]*)\]([^\[]*)\[end\]/g,accountMetadata=MetadataUtility.GetNotionMetadata("DanteAccount",options.metadata),leadMetadata=MetadataUtility.GetNotionMetadata("DanteLead",options.metadata);return content=content.replace(conditions,replaceCondition),content=content.replace(tokens,replaceToken)}}).controller("TalkingPointWidgetController",function($scope,$element,TalkingPointWidgetService){var data=($scope.widgetConfig,$scope.metadata,$scope.data),parentData=$scope.parentData;if(null!=data){var talkingPointText=TalkingPointWidgetService.FormatTalkingPoint(data.Content,parentData,data.PlayID),regex=/(<[^>]*>|\s)*/,matches=talkingPointText.match(regex);matches[0].length==talkingPointText.length&&(talkingPointText=ResourceUtil.getString("DANTE_NO_TALKING_POINTS_FOR_SECTION")),$scope.talkingPointText=talkingPointText}}).directive("talkingPointWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/talkingPointWidget/TalkingPointWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.ThresholdExplorerWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.services.WidgetFrameworkService"]).controller("ThresholdExplorerWidgetController",function($scope,ResourceUtility,WidgetFrameworkService){function updateInfoElements(d){infoElements.select("circle.y").attr("transform","translate("+x(d.leads)+","+y(d.conversions)+")"),infoElements.select("line.x").attr("transform","translate(0,"+y(d.conversions)+")"),infoElements.select("line.y").attr("transform","translate("+x(d.leads)+",-40)"),infoElements.select("line.d").attr("transform","translate("+x(d.leads)+","+(height+30)+")"),infoElements.select("text.rltext").attr("transform","translate("+(x(d.leads)+15)+",-30)"),infoElements.select("text.rtext").text((0!==d.rightLift?d.rightLift.toFixed(2):0)+"x").attr("transform","translate("+(x(d.leads)+14)+",-13)"),infoElements.select("text.lltext").attr("transform","translate("+(x(d.leads)-16)+",-30)"),infoElements.select("text.ltext").text(d.leftLift.toFixed(2)+"x").attr("transform","translate("+(x(d.leads)-16)+",-13)"),infoElements.select("polygon.larrow").attr("transform","translate("+(x(d.leads)-10)+",-30)"),infoElements.select("polygon.rarrow").attr("transform","translate("+(x(d.leads)+5)+",-30)"),infoElements.select("circle.xball").attr("transform","translate(-36,"+y(d.conversions)+")"),infoElements.select("circle.yball").attr("transform","translate("+x(d.leads)+","+(height+25)+")"),infoElements.select("text.xltext").attr("transform","translate(-40,"+(y(d.conversions)-3)+")"),infoElements.select("text.xtext").text(d.conversions.toFixed(0)+"%").attr("transform","translate(-40,"+(y(d.conversions)+14)+")"),infoElements.select("text.lyltext").attr("transform","translate("+(x(d.leads)-10)+","+(height+38)+")"),infoElements.select("text.lytext").text(d.leads+"%").attr("transform","translate("+(x(d.leads)-10)+","+(height+55)+")"),infoElements.select("text.ryltext").attr("transform","translate("+(x(d.leads)+9)+","+(height+38)+")"),infoElements.select("text.rytext").text("> "+(d.score-1)).attr("transform","translate("+(x(d.leads)+9)+","+(height+55)+")")}function setDefaultInfoElements(){updateInfoElements(data[20])}function captureMouseMove(){if(!targetSet){var x0=x.invert(d3.mouse(this)[0]),i=bisectLeads(data,x0,1),d0=data[i-1],d1=data[i],d=x0-d0.leads>d1.leads-x0?d1:d0;updateInfoElements(0===d.leads?data[1]:d)}}function captureMouseDown(){targetSet=!targetSet;var x0=x.invert(d3.mouse(this)[0]),i=bisectLeads(data,x0,1),d0=data[i-1],d1=data[i],d=x0-d0.leads>d1.leads-x0?d1:d0;updateInfoElements(0===d.leads?data[1]:d)}var modelSummary=($scope.widgetConfig,$scope.data);if(null!=modelSummary){var data=modelSummary.ThresholdChartData,targetSet=!0,margin={top:47,right:150,bottom:89,left:204},width=1154-margin.left-margin.right,height=336-margin.top-margin.bottom,x=d3.scale.linear().range([0,width]),y=d3.scale.linear().range([height,0]),xAxis=d3.svg.axis().scale(x).ticks(100).innerTickSize(3).orient("bottom"),yAxis=d3.svg.axis().scale(y).ticks(100).innerTickSize(3).orient("left");xAxis.tickFormat(function(d){return d%10===0?d:""}),yAxis.tickFormat(function(d){return d%10===0?d:""}),x.domain(d3.extent(data,function(d){return d.leads})),y.domain(d3.extent(data,function(d){return d.conversions}));var line=d3.svg.line().x(function(d){return x(d.leads)}).y(function(d){return y(d.conversions)}),lowerArea=d3.svg.area().x(function(d){return x(d.leads)}).y0(height).y1(function(d){return y(d.conversions)}),upperArea=d3.svg.area().x(function(d){return x(d.leads)}).y0(-1).y1(function(d){return y(d.conversions)}),svg=d3.select("#thresholdExplorerChart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").style("cursor","pointer").attr("transform","translate("+margin.left+","+margin.top+")");svg.append("linearGradient").attr("id","lower-gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").attr("spreadMethod","pad").selectAll("stop").data([{offset:"0%",color:"#6aa9ff",opacity:.6},{offset:"100%",color:"#6aa9ff",opacity:.1}]).enter().append("stop").attr("offset",function(d){return d.offset}).attr("stop-color",function(d){return d.color}).attr("stop-opacity",function(d){return d.opacity}),svg.append("path").datum(data).style("fill","url(#lower-gradient)").attr("d",lowerArea),svg.append("linearGradient").attr("id","upper-gradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%").attr("spreadMethod","pad").selectAll("stop").data([{offset:"0%",color:"#f2f4f8",opacity:1},{offset:"100%",color:"#f2f4f8",opacity:1}]).enter().append("stop").attr("offset",function(d){return d.offset}).attr("stop-color",function(d){return d.color}).attr("stop-opacity",function(d){return d.opacity}),svg.append("path").datum(data).style("fill","url(#upper-gradient)").attr("d",upperArea),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(height+3)+")").style("font-size","9px").style("font-weight","700").style("fill","#999").call(xAxis).append("text").attr("transform","translate("+width/2+" , 77)").style("text-anchor","middle").style("font-size","14px").style("font-family","ProximaNova-Semibold").style("fill","#aaa").text(ResourceUtility.getString("THRESHOLD_EXPLORER_X_AXIS_LABEL")),svg.append("g").attr("class","y axis").attr("transform","translate(-3, 0)").style("font-size","9px").style("font-weight","700").style("fill","#999").call(yAxis).append("text").attr("transform","translate(-100, "+height/2+") rotate(-90)").style("text-anchor","middle").style("font-size","14px").style("font-family","ProximaNova-Semibold").style("fill","#aaa").text(ResourceUtility.getString("THRESHOLD_EXPLORER_Y_AXIS_LABEL")),d3.selectAll(".axis g.tick line").style("stroke",function(d){return d%10===0?"#666":"#ddd"}),d3.selectAll(".axis path").style("display","none");for(var i=1;i<10;i++){var xLoc=x(10*i);svg.append("line").attr("x1",xLoc).attr("y1","0").attr("x2",xLoc).attr("y2",height).attr("stroke-width","1").style("stroke","white")}svg.append("path").datum(data).style("fill","none").style("stroke","#2579ad").style("stroke-width","2").attr("d",line),svg.append("line").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2",height).style("stroke","#ccc"),svg.append("line").attr("x1",width).attr("y1","0").attr("x2",width).attr("y2",height).style("stroke","#ccc");var infoElements=svg.append("g");infoElements.append("line").attr("class","x").attr("x1",-34).attr("y1","0").attr("x2",width).attr("y2","0").attr("stroke-dasharray","2 2").style("stroke","#666"),infoElements.append("line").attr("class","y").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2",height+62).attr("stroke-dasharray","2 2").style("stroke","#666"),infoElements.append("circle").attr("class","y").style("fill","white").style("stroke","#2579ad").style("stroke-width","2").attr("r",6.5),infoElements.append("text").attr("class","rltext").style("text-anchor","start").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_LIFT_LABEL")),infoElements.append("text").attr("class","rtext").style("text-anchor","start").style("fill","#333").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("text").attr("class","lltext").style("text-anchor","end").style("startOffset","100%").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_LIFT_LABEL")),infoElements.append("text").attr("class","ltext").style("text-anchor","end").style("startOffset","100%").style("fill","#333").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("text").attr("class","xltext").style("text-anchor","end").style("startOffset","100%").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_CONVERSION_LABEL")),infoElements.append("text").attr("class","xtext").style("text-anchor","end").style("startOffset","100%").style("fill","#477cba").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("text").attr("class","lyltext").style("text-anchor","end").style("startOffset","100%").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_LEADS_LABEL")),infoElements.append("text").attr("class","lytext").style("text-anchor","end").style("startOffset","100%").style("fill","#477cba").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("text").attr("class","ryltext").style("text-anchor","start").style("fill","#333").style("font-size","11px").style("font-family","ProximaNova-Bold").text(ResourceUtility.getString("THRESHOLD_EXPLORER_SCORE_LABEL")),infoElements.append("text").attr("class","rytext").style("text-anchor","start").style("fill","#477cba").style("font-size","18px").style("font-family","ProximaNova-Bold"),infoElements.append("polygon").attr("class","rarrow").attr("points","0,0, 0,6, 4,3").style("fill","#447bbc").attr("stroke","#447bbc"),infoElements.append("polygon").attr("class","larrow").attr("points","4,0, 4,6, 0,3").style("fill","#447bbc").attr("stroke","#447bbc"),infoElements.append("circle").attr("class","xball").style("fill","#447bbc").attr("stroke","#447bbc").attr("r",2),infoElements.append("circle").attr("class","yball").style("fill","#447bbc").attr("stroke","#447bbc").attr("r",2),infoElements.append("line").attr("class","d").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2","25").style("stroke","#c6cbd1"),setDefaultInfoElements(),svg.append("rect").attr("x",-10).attr("y",-10).attr("width",width+20).attr("height",height+20).style("fill","none").style("pointer-events","all").on("mousemove",captureMouseMove).on("mousedown",captureMouseDown);var bisectLeads=d3.bisector(function(d){return d.leads}).left}}).directive("thresholdExplorerWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/thresholdExplorerWidget/ThresholdExplorerWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.TopPredictorAttributeWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.appCommon.services.TopPredictorService","ngSanitize"]).controller("TopPredictorAttributeWidgetController",function($scope,_,$sce,$filter,ResourceUtility,TopPredictorService){function setHoverPosition(xPos,chartHeight){var attributeHover=$(".attribute-hover"),hoverElem=$("#topPredictorAttributeHover"),donut=document.getElementById("chart"),path=$scope.selectedPath[0][0],donutRect=donut.getBoundingClientRect(),pathRect=path.getBoundingClientRect(),center=donutRect.left+(donutRect.width>>1),top=(pathRect.top-donutRect.top+(pathRect.height>>1))/donutRect.height,styleSheet=document.styleSheets[0],addMethod="insertRule";styleSheet[addMethod](".attribute-hover-left-arrow>div:after,.attribute-hover-left-arrow>div:before,.attribute-hover-right-arrow>div:after,.attribute-hover-right-arrow>div:before {top: "+100*top+"% !important; }",styleSheet.cssRules.length),hoverElem.css("top",donutRect.top+(donutRect.height>>1)),xPos>0?(hoverElem.css("left",center+width-5),attributeHover.removeClass("attribute-hover-left-arrow"),attributeHover.addClass("attribute-hover-right-arrow")):(hoverElem.css("left",center-width+15-360),attributeHover.removeClass("attribute-hover-right-arrow"),attributeHover.addClass("attribute-hover-left-arrow")),hoverElem[0].style.opacity=0,hoverElem.show(),setTimeout(function(){var description=$(".attribute-hover-header p")[0],height=description.offsetHeight;height>28&&$(description).addClass("truncate_2lines"),hoverElem[0].style.opacity=1},0)}function wrap(text,width){text.each(function(){for(var word,text=d3.select(this),words=text.text().split(/\s+/).reverse(),wordLength=words.length,line=[],lineNumber=0,lineHeight=1.05,y=text.attr("y"),dy=parseFloat(text.attr("dy")),tspan=text.text(null).append("tspan").attr("x",left_width-5).attr("y",y).attr("dy",dy+"em"),i=0;i<wordLength&&!(lineNumber>=1);i++)word=words.pop(),line.push(word),tspan.text(line.join(" ")),tspan.node().getComputedTextLength()>width&&(dy=-.5,tspan.attr("dy",dy+"em"),line.pop(),tspan.text(line.join(" ").substring(0,18)),line=[word],tspan=text.append("tspan").attr("x",left_width-5).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word))})}var data=$scope.data;$scope.attributeName=data.name,$scope.attributeFullDescription=data.description,$scope.attributeDescription=data.description,$scope.attributeColor=data.color;var chartData=data.elementList,liftValues=_.map(chartData,function(d){return d.lift}),bucketNames=_.map(chartData,"name"),percentLeads=_.map(chartData,function(d){return TopPredictorService.FormatPercent(d.percentTotal)});percentLeads=TopPredictorService.SumToOne(percentLeads),$scope.generateAttributeName=function(){return $sce.trustAsHtml('<h4 style="border-left: '+$scope.attributeColor+' solid 6px;" title="'+$scope.attributeName+'">'+$scope.attributeName+'</h4><p title="'+$scope.attributeDescription+'">'+decodeURIComponent(encodeURIComponent($scope.attributeDescription))+"</p>")};var chart,width=145,left_width=101,chartWidth=left_width+width+45,barHeight=20,gap=6,baseHeight=(barHeight+2*gap)*chartData.length-2*gap,titleHeight=80,labelHeight=70,chartHeight=baseHeight+labelHeight+titleHeight,labelSize="10px",fontSize="12px",commonDy="0em",labelDx=0;setHoverPosition($scope.mouseX,chartHeight);var maxTick=_.max([_.max(liftValues),1.5]),xTicks=TopPredictorService.createTicks(maxTick,5),x=d3.scale.linear().domain([0,xTicks[xTicks.length-1]]).range([0,width]);chart=d3.select("#attributeChart").append("svg").attr("class","chart").attr("width",chartWidth).attr("height",baseHeight+labelHeight).append("g").attr("transform","translate(0, 0)"),chart.selectAll("rect.background").data(liftValues).enter().append("rect").attr("display",function(d,i){return i%2==1?"none":null}).attr("x",left_width).attr("y",function(d,i){return i*(barHeight+2*gap)+24}).attr("width",function(){return width+80}).attr("height",barHeight+8).style("fill","#EEF3F7").attr("opacity",.7),chart.selectAll("line").data(xTicks).enter().append("line").attr("x1",function(d){return x(d)+left_width}).attr("x2",function(d){return x(d)+left_width}).attr("y1",function(d,i){return 0===i||i===xTicks.length-1?0:15}).attr("y2",baseHeight+32),chart.selectAll(".rule").data(xTicks).enter().append("text").attr("class","rule").attr("x",function(d){return x(d)+left_width}).attr("y",baseHeight+50).attr("dx",function(d){return 0===d?0:labelDx}).attr("dy",-6).attr("font-weight","semi-bold").attr("font-size","10px").attr("text-anchor","middle").style("fill","#666666").text(function(d){return 0===d?d:1===d?"":d});var liftText=ResourceUtility.getString("TOP_PREDICTORS_HOVER_CHART_LIFT_LABEL").toUpperCase();chart.append("text").attr("x",function(){return left_width+width/2-20}).attr("y",baseHeight+60).attr("dy",commonDy).attr("font-size",labelSize).style("fill","#999").text(liftText),chart.selectAll("rect.bar").data(liftValues).enter().append("rect").attr("x",left_width).attr("y",function(d,i){return i*(barHeight+2*gap)+28}).attr("width",x).attr("height",barHeight).style("fill",data.color).attr("opacity",function(d){return d>1?.8:.4}),chart.selectAll("rect.barBorder").data(liftValues).enter().append("rect").attr("x",left_width).attr("y",function(d,i){return i*(barHeight+2*gap)+(28+barHeight)}).attr("width",function(d){var barWidth=x(d);return barWidth-.4}).attr("height",1).style("fill",data.color).attr("opacity",function(d){return d>1?1:.6}),chart.selectAll("line.baselineLift").data([1]).enter().append("line").attr("x1",function(d){return x(d)+left_width}).attr("x2",function(d){return x(d)+left_width}).attr("y1",15).attr("y2",baseHeight+32).style("fill","#BBB").attr("opacity",1),chart.selectAll(".baselineLiftBottom").data([1]).enter().append("text").attr("x",function(d){return x(d)+left_width}).attr("y",baseHeight+50).attr("dy",-6).attr("dx",labelDx).attr("font-weight","semi-bold").attr("font-size","10px").attr("text-anchor","middle").style("fill","#666").text(function(d){return d}),chart.selectAll(".baselineLiftTop").data([1]).enter().append("text").attr("x",function(d){return x(d)+left_width}).attr("y",15).attr("dy",-6).attr("dx",labelDx).attr("font-weight","semi-bold").attr("font-size",fontSize).attr("text-anchor","middle").style("fill","#666").text(function(d){return d+"x"}),chart.selectAll("text.lift").data(liftValues).enter().append("text").attr("x",width+135).attr("y",function(d,i){return i*(barHeight+2*gap)+42}).attr("dy",commonDy).attr("font-weight","semi-bold").attr("font-size",fontSize).attr("text-anchor","end").attr("class","lift").style("fill","#666").text(function(d){return $filter("number")(d,1)+"x"}),chart.append("text").attr("x",width+115).attr("y",5).attr("dy","0.36em").attr("font-size",labelSize).style("fill","#999").text(liftText),chart.selectAll("text.percentLeads").data(percentLeads).enter().append("text").attr("x",width+177).attr("y",function(d,i){return i*(barHeight+2*gap)+42}).attr("dx",-5).attr("dy",commonDy).attr("font-weight","semi-bold").attr("font-size",fontSize).attr("text-anchor","end").attr("class","lift").style("fill","#666").text(function(d){return d+"%"});var leadsText=ResourceUtility.getString("TOP_PREDICTORS_HOVER_CHART_LEADS_LABEL").toUpperCase();chart.append("text").attr("x",width+142).attr("y",5).attr("dy","0.36em").attr("font-size",labelSize).style("fill","#999").text(leadsText),chart.selectAll("text.name").data(bucketNames).enter().append("text").attr("x",left_width-5).attr("y",function(d,i){return i*(barHeight+2*gap)+42}).attr("dy",commonDy).attr("font-weight","semi-bold").attr("font-size",fontSize).attr("text-anchor","end").style("fill","black").text(String).call(wrap,left_width-20),$scope.showtitle=!0}).directive("topPredictorAttributeWidget",function(){return{templateUrl:"app/AppCommon/widgets/topPredictorWidget/TopPredictorAttributeWidgetTemplate.html"}}),angular.module("mainApp.appCommon.widgets.TopPredictorWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.appCommon.services.TopPredictorService","mainApp.appCommon.widgets.TopPredictorAttributeWidget","ngSanitize"]).controller("TopPredictorWidgetController",function($scope,$sce,$element,$compile,$rootScope,ResourceUtility,WidgetFrameworkService,TopPredictorService){function stash(d){d.x0=d.x,d.dx0=d.dx}function clearSelectedCategory(){TopPredictorService.ClearCategoryClasses($scope.externalCategories),TopPredictorService.ClearCategoryClasses($scope.internalCategories)}function highlightSelectedCategory(category){clearSelectedCategory();for(var i=0;i<$scope.externalCategories.length;i++)if($scope.externalCategories[i].name===category.name){$scope.externalCategories[i].activeClass="active";break}for(var x=0;x<$scope.internalCategories.length;x++)if($scope.internalCategories[x].name===category.name){$scope.internalCategories[x].activeClass="active";break}}function showAttributeHover(attributeName,attributeColor,mouseX,mouseY,path){null!=showAttributeTimeout&&clearTimeout(showAttributeTimeout),showAttributeTimeout=setTimeout(function(){var topPredictorAttributeHover=$("#topPredictorAttributeHover"),scope=$rootScope.$new();scope.mouseX=mouseX,scope.mouseY=mouseY,scope.selectedPath=path,scope.data=TopPredictorService.FormatDataForAttributeValueChart(attributeName,attributeColor,data),$compile(topPredictorAttributeHover.html("<div data-top-predictor-attribute-widget></div>"))(scope)},500)}function hideAttributeHover(){null!=showAttributeTimeout&&clearTimeout(showAttributeTimeout);var topPredictorAttributeHover=$("#topPredictorAttributeHover");topPredictorAttributeHover.hide(),topPredictorAttributeHover.empty()}var widgetConfig=$scope.widgetConfig,metadata=$scope.metadata,data=$scope.data,parentData=$scope.parentData;$scope.ResourceUtility=ResourceUtility;var container=$("<div></div>");$($element).append(container);var options={element:container,widgetConfig:widgetConfig,metadata:metadata,data:data,parentData:parentData};WidgetFrameworkService.CreateChildWidgets(options,$scope.data);var chartData=data.ChartData;$scope.backToSummaryView=!1,$scope.chartHeader=ResourceUtility.getString("TOP_PREDICTORS_CHART_HEADER",[chartData.attributesPerCategory]);var internalCategoryObj=data.InternalAttributes;$scope.internalPredictorTotal=internalCategoryObj.total+" "+ResourceUtility.getString("TOP_PREDICTORS_INTERNAL_TITLE"),$scope.internalCategories=internalCategoryObj.categories,$scope.showInternalCategories=internalCategoryObj.total>0;var externalCategoryObj=data.ExternalAttributes;$scope.externalPredictorTotal=externalCategoryObj.total+" "+ResourceUtility.getString("TOP_PREDICTORS_EXTERNAL_TITLE"),$scope.externalCategories=externalCategoryObj.categories,$scope.showExternalCategories=externalCategoryObj.total>0;var totalAttributes=data.TotalAttributeValues;$scope.topPredictorTitle=totalAttributes+" "+ResourceUtility.getString("TOP_PREDICTORS_TITLE"),$scope.generateCategoryLabel=function(category){return $sce.trustAsHtml(category.name+'<span style="background-color:'+category.color+'">'+category.count+"</span>")};var showAttributeTimeout,width=300,height=300,radius=Math.min(width,height)/2,hoverOpacity=.7,fakePartition=d3.layout.partition().sort(null).size([.01,.01]).value(function(d){return 1}),partition=d3.layout.partition().sort(null).size([2*Math.PI,radius*radius]).value(function(d){return d.size});$scope.drawSummaryChart=function(){function attributeClicked(d){for(var category=null,i=0;i<chartData.children.length;i++)if(chartData.children[i].categoryName==d.categoryName){category=chartData.children[i];break}null!=category&&$scope.$apply($scope.categoryClicked(category))}function arcTween(a){var i=d3.interpolate({x:a.x0,dx:a.dx0},a);return function(t){var b=i(t);return a.x0=b.x,a.dx0=b.dx,arc(b)}}$(".js-top-predictor-donut").empty();var svg=d3.select(".js-top-predictor-donut").append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2+","+height/2+")"),gutterWidth=.0075,arc=d3.svg.arc().startAngle(function(d){var gutter=null;if(2===d.depth){var children=d.parent.children;gutter=children[0].name==d.name?gutterWidth:0}return d.x+(gutter||0)}).endAngle(function(d){var gutter=null;if(2===d.depth){var children=d.parent.children,child=children[children.length-1];gutter=child&&child.name==d.name?2*gutterWidth:0}return d.x+d.dx-(gutter||0)}).innerRadius(function(d){switch(d.depth){case 1:return 50;case 2:return 61;default:return 0}}).outerRadius(function(d){switch(d.depth){case 1:return 60;case 2:return 125;default:return 0}}),path=svg.datum(chartData).selectAll("path").data(fakePartition.nodes).enter().append("path").attr("display",function(d){return d.depth?null:"none"}).attr("d",arc).attr("stroke-width",function(d){return 1===d.depth?2.5:1}).style("stroke","#fff").style("cursor","pointer").attr("opacity",function(d){return 1===d.depth?1:2===d.depth?hoverOpacity:void 0}).style("fill",function(d){return d.color}).on("click",attributeClicked).on("mouseover",function(d){var path=svg.selectAll("path").filter(function(node){return 2==node.depth&&node.name==d.name});path.style("opacity",1),2==d.depth&&showAttributeHover(d.name,d.color,d3.mouse(this)[0],d3.mouse(this)[1],path)}).on("mouseout",function(d){svg.selectAll("path").filter(function(node){return 2==node.depth}).style("opacity",hoverOpacity),hideAttributeHover()}).each(stash);path.data(partition.nodes).transition().duration(1e3).attrTween("d",arcTween)},$scope.drawSummaryChart(),$scope.exportClicked=function(){var fileName="attributes.csv",csvRows=TopPredictorService.GetTopPredictorExport(data);alasql("SELECT * INTO CSV('"+fileName+"') FROM ?",[csvRows])},$scope.backToSummaryClicked=function(){clearSelectedCategory(),$scope.backToSummaryView=!1,$scope.chartHeader=ResourceUtility.getString("TOP_PREDICTORS_CHART_HEADER",[chartData.attributesPerCategory]),$scope.drawSummaryChart()},$scope.categoryClicked=function(category){function arcTween(a){var i=d3.interpolate({x:a.x0,dx:a.dx0},a);return function(t){var b=i(t);return a.x0=b.x,a.dx0=b.dx,arc2(b)}}clearTimeout(showAttributeTimeout);var categoryList=TopPredictorService.GetAttributesByCategory(data,category.name,category.color,50);highlightSelectedCategory(category),category.activeClass="active",TopPredictorService.CalculateAttributeSize(categoryList),$scope.backToSummaryView=!0;var prefix=categoryList.length>=50?ResourceUtility.getString("TOP_PREDICTORS_CHART_CATEGORY_HEADER_PREFIX"):"";$scope.chartHeader=ResourceUtility.getString("TOP_PREDICTORS_CHART_CATEGORY_HEADER",[category.name,prefix,categoryList.length]);var root={name:"root",size:1,color:"#FFFFFF",children:categoryList};$(".js-top-predictor-donut").empty();var svg=d3.select(".js-top-predictor-donut").append("svg").attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2+","+height/2+")");setTimeout(function(){svg.append("svg:image").attr("id","donutChartBackButton").attr("class","donut-chart-back-button").attr("xlink:href","assets/images/Donut-Center-Back.png").attr("x",-14).attr("y",-13).attr("width","29px").attr("height","29px").on("mouseover",function(d){d3.select(this).attr("xlink:href","assets/images/Donut-Center-Back-Hover.png")}).on("mouseout",function(d){d3.select(this).attr("xlink:href","assets/images/Donut-Center-Back.png")}).on("click",function(){$("#back-to-summary-link").click()})},1e3),svg.append("circle").attr("cx",0).attr("cy",0).attr("r",50).attr("fill","#fff").on("mouseover",function(){svg.selectAll("circle").style("cursor","pointer")}).on("click",function(){$("#back-to-summary-link").click()});var arc2=d3.svg.arc().startAngle(function(d){return d.x}).endAngle(function(d){return d.x+d.dx}).innerRadius(function(d){return 1===d.depth?50:0}).outerRadius(function(d){return 1===d.depth?125:0}),path=svg.datum(root).selectAll("path").data(fakePartition.nodes).enter().append("path").attr("display",function(d){return d.depth?null:"none"}).attr("d",arc2).style("stroke","#fff").attr("opacity",function(d){return 1===d.depth?1:2===d.depth?hoverOpacity:void 0}).style("fill",function(d){return d.color}).on("mouseover",function(d){var path=svg.selectAll("path").filter(function(node){return 1==node.depth&&node.name==d.name});path.style("opacity",hoverOpacity),1==d.depth&&showAttributeHover(d.name,d.color,d3.mouse(this)[0],d3.mouse(this)[1],path)}).on("mouseout",function(d){svg.selectAll("path").filter(function(node){return 1==node.depth}).style("opacity",1),hideAttributeHover()}).each(stash);path.data(partition.nodes).transition().duration(1e3).attrTween("d",arcTween);
}}).directive("topPredictorWidget",function(){var directiveDefinitionObject={templateUrl:"app/AppCommon/widgets/topPredictorWidget/TopPredictorWidgetTemplate.html"};return directiveDefinitionObject}),angular.module("mainApp.appCommon.widgets.UserManagementWidget",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.DateTimeFormatUtility","mainApp.core.utilities.NavUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.appCommon.utilities.StringUtility","mainApp.core.utilities.RightsUtility","mainApp.core.services.FeatureFlagService","mainApp.userManagement.modals.AddUserModal","mainApp.userManagement.modals.DeleteUserModal","mainApp.userManagement.modals.EditUserModal","mainApp.userManagement.services.UserManagementService","mainApp.core.utilities.BrowserStorageUtility"]).controller("UserManagementWidgetController",function($scope,$rootScope,_,ResourceUtility,BrowserStorageUtility,RightsUtility,FeatureFlagService,AddUserModal,DeleteUserModal,EditUserModal){$scope.ResourceUtility=ResourceUtility,$scope.deleteInProgress=!1,"[object Array]"!==Object.prototype.toString.call($scope.data)&&($scope.data=[$scope.data]),$scope.users=_.sortBy(_.sortBy($scope.data,"Email"),function(u){var accessLevel=RightsUtility.getAccessLevel(u.AccessLevel);return null!=accessLevel?accessLevel.ordinal:0});var flags=FeatureFlagService.Flags();$scope.mayAddUsers=FeatureFlagService.FlagIsEnabled(flags.ADD_USER),$scope.mayDeleteUsers=FeatureFlagService.FlagIsEnabled(flags.DELETE_USER),$scope.showEditUserButton=FeatureFlagService.FlagIsEnabled(flags.CHANGE_USER_ACCESS),$scope.showDeleteUserButton=FeatureFlagService.FlagIsEnabled(flags.DELETE_USER);var currentLevel=RightsUtility.getAccessLevel(BrowserStorageUtility.getClientSession().AccessLevel);$scope.addUserClicked=function($event){null!=$event&&$event.preventDefault(),AddUserModal.show($scope.users.map(function(u){return u.Email}))},$scope.deleteUserClicked=function(user){DeleteUserModal.show(user)},$scope.editUserClicked=function(user){EditUserModal.show(user)},$scope.manipulateAccessLevel=function(accessLevel){var prefix="ACCESS_LEVEL_",toReturn=null;return toReturn=null==accessLevel?"NA":ResourceUtility.getString(prefix+accessLevel)},$scope.showEditButton=function(user,number){var userLevel=RightsUtility.getAccessLevel(user.AccessLevel);return(3!=currentLevel.ordinal||4!=userLevel.ordinal)&&(1==number?$scope.showEditUserButton:$scope.showDeleteUserButton)}}).directive("userManagementWidget",function(){return{templateUrl:"app/AppCommon/widgets/userManagementWidget/UserManagementWidgetTemplate.html"}}),angular.module("mainApp.config.controllers.ManageCredentialsController",["mainApp.appCommon.directives.ngQtipDirective","mainApp.appCommon.directives.helperMarkDirective","mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.utilities.StringUtility","mainApp.config.services.ConfigService"]).service("ManageCredentialsService",function(StringUtility){this.ValidateCredentials=function(type,credentials){if(StringUtility.IsEmptyString(type)||null==credentials)return!1;var isValid=!1;switch(type){case"sfdc":isValid=!StringUtility.IsEmptyString(credentials.UserName)&&!StringUtility.IsEmptyString(credentials.Password);break;case"eloqua":isValid=!StringUtility.IsEmptyString(credentials.UserName)&&!StringUtility.IsEmptyString(credentials.Password)&&!StringUtility.IsEmptyString(credentials.Company);break;case"marketo":isValid=!StringUtility.IsEmptyString(credentials.UserName)&&!StringUtility.IsEmptyString(credentials.Password)&&!StringUtility.IsEmptyString(credentials.Url)}return isValid}}).controller("ManageCredentialsController",function($scope,$rootScope,ResourceUtility,BrowserStorageUtility,ConfigService,ManageCredentialsService){function Credentials(url,securitytoken,orgid,password,username,company){this.Url=url||null,this.SecurityToken=securitytoken||null,this.OrgId=orgid||null,this.Password=password||null,this.UserName=username||null,this.Company=company||null}function getSFDCCredentials(){ConfigService.GetCurrentCredentials("sfdc",!0).then(function(result){if(null!=result&&result.success===!0){var returned=result.resultObj;$scope.crmProductionCredentials=new Credentials(null,returned.SecurityToken,null,returned.Password,returned.UserName,null),$scope.crmProductionComplete=!0}else $scope.crmProductionCredentials=new Credentials;ConfigService.GetCurrentCredentials("sfdc",!1).then(function(result){if(null!=result&&result.success===!0){var returned=result.resultObj;$scope.crmSandboxCredentials=new Credentials(null,returned.SecurityToken,null,returned.Password,returned.UserName,null),$scope.crmSandboxComplete=!0}else $scope.crmSandboxCredentials=new Credentials})})}$scope.ResourceUtility=ResourceUtility,$scope.crmProductionComplete=!1,$scope.crmProductionError="",$scope.crmProductionSaveInProgress=!1,$scope.crmSandboxComplete=!1,$scope.crmSandboxError="",$scope.crmSandboxSaveInProgress=!1,$scope.mapComplete=!1,$scope.mapError="",$scope.mapSaveInProgress=!1,$scope.loading=!0,$scope.showError=!1,$scope.errorMessage="",$scope.closeErrorClick=function($event){null!=$event&&$event.preventDefault(),$scope.showError=!1},ConfigService.GetCurrentTopology().then(function(result){if($scope.loading=!1,result.success===!0)if("string"==typeof result.resultObj&&"marketo"===result.resultObj.toLowerCase()&&($scope.isMarketo=!0),"string"==typeof result.resultObj&&"eloqua"===result.resultObj.toLowerCase()&&($scope.isEloqua=!0),$scope.isMarketo||$scope.isEloqua){var mapType=$scope.isMarketo?"marketo":"eloqua";ConfigService.GetCurrentCredentials(mapType).then(function(result){if(null!=result&&result.success===!0){var returned=result.resultObj;$scope.mapCredentials=new Credentials(returned.Url,returned.SecurityToken,returned.OrgId,returned.Password,returned.UserName,returned.Company),$scope.mapComplete=!0}else $scope.mapCredentials=new Credentials;getSFDCCredentials()})}else getSFDCCredentials();else $scope.showError=!0,$scope.errorMessage=result.resultErrors,getSFDCCredentials()}),$scope.crmProductionSaveClicked=function(){if($scope.crmProductionError="",ManageCredentialsService.ValidateCredentials("sfdc",$scope.crmProductionCredentials)){if($scope.crmProductionSaveInProgress)return;$scope.crmProductionSaveInProgress=!0,ConfigService.ValidateApiCredentials("sfdc",$scope.crmProductionCredentials,!0).then(function(result){$scope.crmProductionSaveInProgress=!1,null==result?$scope.crmProductionError=ResourceUtility.getString("SYSTEM_ERROR"):result.success===!0?$scope.crmProductionComplete=!0:$scope.crmProductionError=result.resultErrors})}else $scope.crmProductionError=ResourceUtility.getString("SYSTEM_SETUP_REQUIRED_FIELDS_ERROR")},$scope.crmSandboxSaveClicked=function(){if($scope.crmSandboxError="",ManageCredentialsService.ValidateCredentials("sfdc",$scope.crmSandboxCredentials)){if($scope.crmSandboxSaveInProgress)return;$scope.crmSandboxSaveInProgress=!0,ConfigService.ValidateApiCredentials("sfdc",$scope.crmSandboxCredentials,!1).then(function(result){$scope.crmSandboxSaveInProgress=!1,null==result?$scope.crmSandboxError=ResourceUtility.getString("SYSTEM_ERROR"):result.success===!0?$scope.crmSandboxComplete=!0:$scope.crmSandboxError=result.resultErrors})}else $scope.crmSandboxError=ResourceUtility.getString("SYSTEM_SETUP_REQUIRED_FIELDS_ERROR")},$scope.marketoSaveClicked=function(){if($scope.mapError="",ManageCredentialsService.ValidateCredentials("marketo",$scope.mapCredentials)){if($scope.mapSaveInProgress)return;$scope.mapSaveInProgress=!0,ConfigService.ValidateApiCredentials("marketo",$scope.mapCredentials,!1).then(function(result){$scope.mapSaveInProgress=!1,null==result?$scope.mapError=ResourceUtility.getString("SYSTEM_ERROR"):result.success===!0?$scope.mapComplete=!0:$scope.mapError=result.resultErrors})}else $scope.mapError=ResourceUtility.getString("SYSTEM_SETUP_REQUIRED_FIELDS_ERROR")},$scope.eloquaSaveClicked=function(){if($scope.mapError="",ManageCredentialsService.ValidateCredentials("eloqua",$scope.mapCredentials)){if($scope.mapSaveInProgress)return;$scope.mapSaveInProgress=!0,ConfigService.ValidateApiCredentials("eloqua",$scope.mapCredentials,!1).then(function(result){$scope.mapSaveInProgress=!1,null==result?$scope.mapError=ResourceUtility.getString("SYSTEM_ERROR"):result.success===!0?$scope.mapComplete=!0:$scope.mapError=result.resultErrors})}else $scope.mapError=ResourceUtility.getString("SYSTEM_SETUP_REQUIRED_FIELDS_ERROR")}}),angular.module("mainApp.config.modals.EnterCredentialsModal",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.config.services.ConfigService"]).service("EnterCredentialsModal",function($compile,$rootScope,$http,ResourceUtility){this.TopologyType={Salesforce:"sfdc",Marketo:"marketo",Eloqua:"eloqua"},this.show=function(topologyType,previousCredentials,successCallback){$http.get("./app/config/views/EnterCredentialsView.html").success(function(html){var scope=$rootScope.$new();scope.topologyType=topologyType,scope.previousCredentials=previousCredentials,scope.successCallback=successCallback;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}).controller("EnterCredentialsController",function($scope,ResourceUtility,StringUtility,EnterCredentialsModal,ConfigService){function areCredentialsValid(){var isValid=!1;switch(topology){case EnterCredentialsModal.TopologyType.Salesforce:isValid=!(StringUtility.IsEmptyString($scope.apiUserId)||StringUtility.IsEmptyString($scope.apiPassword)||StringUtility.IsEmptyString($scope.securityToken)||StringUtility.IsEmptyString($scope.connectionUrlLabel));break;case EnterCredentialsModal.TopologyType.Marketo:isValid=!StringUtility.IsEmptyString($scope.apiUserId)&&!StringUtility.IsEmptyString($scope.securityToken)&&!StringUtility.IsEmptyString($scope.connectionUrl);break;case EnterCredentialsModal.TopologyType.Eloqua:isValid=!StringUtility.IsEmptyString($scope.apiUserId)&&!StringUtility.IsEmptyString($scope.apiPassword)&&!StringUtility.IsEmptyString($scope.securityToken)}return isValid}function updateDisplayValidation(){switch(topology){case EnterCredentialsModal.TopologyType.Salesforce:$scope.apiUserIdInputError=null==$scope.apiUserId||""===$scope.apiUserId?"error":"",$scope.apiPasswordInputError=null==$scope.apiPassword||""===$scope.apiPassword?"error":"",$scope.securityTokenInputError=null==$scope.securityToken||""===$scope.securityToken?"error":"",$scope.connectionUrlInputError=null==$scope.connectionUrl||""===$scope.connectionUrl?"error":"";break;case EnterCredentialsModal.TopologyType.Marketo:$scope.apiUserIdInputError=null==$scope.apiUserId||""===$scope.apiUserId?"error":"",$scope.securityTokenInputError=null==$scope.securityToken||""===$scope.securityToken?"error":"",$scope.connectionUrlInputError=null==$scope.connectionUrl||""===$scope.connectionUrl?"error":"";break;case EnterCredentialsModal.TopologyType.Eloqua:$scope.apiUserIdInputError=null==$scope.apiUserId||""===$scope.apiUserId?"error":"",$scope.apiPasswordInputError=null==$scope.apiPassword||""===$scope.apiPassword?"error":"",$scope.companyInputError=null==$scope.company||""===$scope.company?"error":""}}function createApiCredentialsObject(){var toReturn={Type:$scope.topologyType};switch(topology){case EnterCredentialsModal.TopologyType.Salesforce:toReturn.UserName=$scope.apiUserId,toReturn.Password=$scope.apiPassword,toReturn.SecurityToken=$scope.securityToken,toReturn.Url=$scope.connectionUrl;break;case EnterCredentialsModal.TopologyType.Marketo:toReturn.UserName=$scope.apiUserId,toReturn.Password=$scope.securityToken,toReturn.Url=$scope.connectionUrl;break;case EnterCredentialsModal.TopologyType.Eloqua:toReturn.UserName=$scope.apiUserId,toReturn.Password=$scope.apiPassword,toReturn.Company=$scope.company}return toReturn}$scope.ResourceUtility=ResourceUtility;var topology=$scope.topologyType;switch($scope.validateErrorMessage=null,$scope.validateInProgess=!1,$scope.apiUserId=null,$scope.apiPassword=null,$scope.securityToken=null,$scope.connectionUrl=null,$scope.company=null,$scope.apiUserIdInputError="",$scope.apiPasswordInputError="",$scope.securityTokenInputError="",$scope.connectionUrlInputError="",$scope.companyInputError="",$("#enterCredentialsValidateError").hide(),null!=$scope.previousCredentials&&($scope.apiUserId=$scope.previousCredentials.UserName,topology==EnterCredentialsModal.TopologyType.Marketo?$scope.securityToken=$scope.previousCredentials.Password:$scope.securityToken=$scope.previousCredentials.SecurityToken,$scope.connectionUrl=$scope.previousCredentials.ConnectionURL,$scope.company=$scope.previousCredentials.Company),topology){case EnterCredentialsModal.TopologyType.Salesforce:$scope.topologyTypeImage="logo_salesforce.png",$scope.apiUserIdLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_USER_NAME"),$scope.apiPasswordLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_PASSWORD"),$scope.securityTokenLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_SECURITY_TOKEN"),$scope.connectionUrlLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_ORG_ID"),$scope.showPassword=!0,$scope.showConnectionUrl=!0,$scope.showCompany=!1,$scope.showSecurityToken=!0;break;case EnterCredentialsModal.TopologyType.Marketo:$scope.topologyTypeImage="logo_marketo.png",$scope.apiUserIdLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_USER_ID"),$scope.securityTokenLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_ENCRYPTION_KEY"),$scope.connectionUrlLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_URL"),$scope.showPassword=!1,$scope.showConnectionUrl=!0,$scope.showCompany=!1,$scope.showSecurityToken=!0;break;case EnterCredentialsModal.TopologyType.Eloqua:$scope.topologyTypeImage="logo_eloqua.png",$scope.apiUserIdLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_USER_NAME"),$scope.apiPasswordLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_PASSWORD"),$scope.companyLabel=ResourceUtility.getString("ENTER_CREDENTIALS_API_COMPANY"),$scope.showPassword=!0,$scope.showCompany=!0,$scope.showConnectionUrl=!1,$scope.showSecurityToken=!1}var successCallback=$scope.successCallback;$scope.saveClicked=function(){if($("#enterCredentialsValidateError").fadeOut(),$scope.validateErrorMessage=null,updateDisplayValidation(),areCredentialsValid()&&!$scope.validateInProgess){var apiObj=createApiCredentialsObject();$scope.validateInProgess=!0,ConfigService.ValidateApiCredentials($scope.topologyType,apiObj).then(function(data){$scope.validateInProgess=!1,null!=data&&data.Success===!0?($("#modalContainer").modal("hide"),null!=successCallback&&"function"==typeof successCallback&&successCallback(apiObj)):("VALIDATE_CREDENTIALS_FAILURE"==data.FailureReason?$scope.validateErrorMessage=ResourceUtility.getString("VALIDATE_CREDENTIALS_FAILURE"):$scope.validateErrorMessage=ResourceUtility.getString("ENTER_CREDENTIALS_CONNECTION_ERROR"),$("#enterCredentialsValidateError").fadeIn())})}}}),angular.module("mainApp.config.services.ConfigService",["mainApp.core.utilities.ServiceErrorUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.URLUtility","mainApp.core.services.SessionService"]).service("ConfigService",function($http,$q,BrowserStorageUtility,ServiceErrorUtility,ResourceUtility,URLUtility,SessionService){this.GetWidgetConfigDocument=function(){var deferred=$q.defer(),result=null,cachedConfigDoc=BrowserStorageUtility.getWidgetConfigDocument();if(null!=cachedConfigDoc&&cachedConfigDoc.Timestamp>(new Date).getTime())return result={success:!0,resultObj:cachedConfigDoc,resultErrors:null},deferred.resolve(result),deferred.promise;var webServer=(URLUtility.GetBaseUrl(),"assets/resources/WidgetConfigurationDocument.json");return $http({method:"GET",url:webServer}).success(function(data,status,headers,config){return null==data?(result={success:!1,resultObj:null,resultErrors:null},void deferred.resolve(result)):(BrowserStorageUtility.setWidgetConfigDocument(data),result={success:!0,resultObj:data,resultErrors:null},void deferred.resolve(result))}).error(function(data,status,headers,config){result={success:!1,resultObj:null,resultErrors:null},deferred.resolve(result)}),deferred.promise},this.GetCurrentTopology=function(){var result,deferred=$q.defer(),tenant=BrowserStorageUtility.getClientSession().Tenant.Identifier,credentialUrl="/pls/config/topology?tenantId="+tenant;return $http({method:"GET",url:credentialUrl}).success(function(data,status,headers,config){result=200===status?{success:!0,resultObj:data.Topology,resultErrors:null}:{success:!1,resultObj:null,resultErrors:data.errorMsg},deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var errorMessage;errorMessage=null!=data&&""!==data?data.errorMsg:ResourceUtility.getString("SYSTEM_ERROR"),result={success:!1,resultObj:null,resultErrors:errorMessage},deferred.resolve(result)}),deferred.promise},this.GetCurrentCredentials=function(topologyType,isProduction){isProduction="undefined"==typeof isProduction||isProduction;var deferred=$q.defer(),tenant=BrowserStorageUtility.getClientSession().Tenant.Identifier,credentialUrl="/pls/credentials/"+topologyType+"?tenantId="+tenant;"sfdc"===topologyType&&(credentialUrl+="&isProduction="+isProduction);var result;return $http({method:"GET",url:credentialUrl}).success(function(data,status,headers,config){result=200===status?{success:!0,resultObj:data,resultErrors:null}:{success:!1,resultObj:null,resultErrors:data.errorMsg},deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("SYSTEM_ERROR")},deferred.resolve(result)}),deferred.promise},this.ValidateApiCredentials=function(topologyType,apiObj,isProduction){if(null==apiObj)return null;isProduction="undefined"==typeof isProduction||isProduction;var deferred=$q.defer(),tenant=BrowserStorageUtility.getClientSession().Tenant.Identifier,credentialUrl="/pls/credentials/"+topologyType+"/?tenantId="+tenant;"sfdc"===topologyType&&(credentialUrl+="&isProduction="+isProduction);var result;return $http({method:"POST",url:credentialUrl,data:JSON.stringify(apiObj),timeout:6e4}).success(function(data,status,headers,config){200===status?result={success:!0,resultObj:data,resultErrors:null}:(SessionService.HandleResponseErrors(data,status),result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("VALIDATE_CREDENTIALS_FAILURE")}),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var errorMessage;0===status?errorMessage=ResourceUtility.getString("VALIDATE_CREDENTIALS_TIMEOUT"):"LEDP_18030"===data.errorCode?errorMessage=ResourceUtility.getString("VALIDATE_CREDENTIALS_FAILURE"):(errorMessage=ResourceUtility.getString("SYSTEM_ERROR"),console.error(data.errorMsg)),result={success:!1,resultObj:null,resultErrors:errorMessage},deferred.resolve(result)}),deferred.promise},this.GetCurrentDataLoaderUrl=function(){var deferred=$q.defer();return $http({method:"GET",url:"/pls/config/dataloaderurl?tenantId="+BrowserStorageUtility.getClientSession().Tenant.Identifier}).success(function(data){var result={success:!0,resultObj:data,resultErrors:null};deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("GET_DATALOADER_URL_ERROR")};deferred.resolve(result)}),deferred.promise}}),angular.module("mainApp.core.controllers.MainHeaderController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.NavUtility","mainApp.login.services.LoginService","mainApp.core.services.FeatureFlagService"]).controller("MainHeaderController",function($scope,$rootScope,ResourceUtility,BrowserStorageUtility,NavUtility,LoginService,FeatureFlagService){$scope.ResourceUtility=ResourceUtility,$scope.showUserManagement=!1;var clientSession=BrowserStorageUtility.getClientSession();null!=clientSession&&FeatureFlagService.GetAllFlags().then(function(){var flags=FeatureFlagService.Flags();$scope.userDisplayName=clientSession.DisplayName,$scope.showUserManagement=FeatureFlagService.FlagIsEnabled(flags.USER_MGMT_PAGE),$scope.showSystemSetup=FeatureFlagService.FlagIsEnabled(flags.SYSTEM_SETUP_PAGE),$scope.showModelCreationHistoryDropdown=FeatureFlagService.FlagIsEnabled(flags.MODEL_HISTORY_PAGE),$scope.showActivateModel=FeatureFlagService.FlagIsEnabled(flags.ACTIVATE_MODEL_PAGE),$scope.showSetup=FeatureFlagService.FlagIsEnabled(flags.SETUP_PAGE),$scope.showDeploymentWizard=FeatureFlagService.FlagIsEnabled(flags.DEPLOYMENT_WIZARD_PAGE),$scope.redirectToDeploymentWizard=FeatureFlagService.FlagIsEnabled(flags.REDIRECT_TO_DEPLOYMENT_WIZARD_PAGE),$scope.showLeadEnrichment=FeatureFlagService.FlagIsEnabled(flags.LEAD_ENRICHMENT_PAGE)}),$scope.logoClicked=function($event){$scope.redirectToDeploymentWizard&&0===$("#finishDeploymentBtn:visible").length?$scope.deploymentWizardClicked($event):$scope.modelListClicked($event)},$scope.dropdownClicked=function($event){null!=$event&&$event.preventDefault()},$scope.modelListClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.MODEL_LIST_NAV_EVENT)},$scope.userManagementClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.USER_MANAGEMENT_NAV_EVENT)},$scope.systemSetupClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.MANAGE_CREDENTIALS_NAV_EVENT)},$scope.showModelCreationHistory=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.MODEL_CREATION_HISTORY_NAV_EVENT)},$scope.updatePasswordClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.UPDATE_PASSWORD_NAV_EVENT)},$scope.manageCredentialsClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.MANAGE_CREDENTIALS_NAV_EVENT)},$scope.activateModelClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.ACTIVATE_MODEL)},$scope.setupClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.SETUP_NAV_EVENT)},$scope.deploymentWizardClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.DEPLOYMENT_WIZARD_NAV_EVENT)},$scope.leadEnrichmentClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.LEAD_ENRICHMENT_NAV_EVENT)},$scope.logoutClicked=function($event){null!=$event&&$event.preventDefault(),LoginService.Logout()}}),angular.module("mainApp.core.controllers.MainViewController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.MetadataUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.NavUtility","mainApp.config.services.ConfigService","mainApp.core.controllers.MainHeaderController","mainApp.config.controllers.ManageCredentialsController","mainApp.login.controllers.UpdatePasswordController","mainApp.userManagement.controllers.UserManagementController","mainApp.models.controllers.AdminInfoController","mainApp.models.controllers.ModelListController","mainApp.models.controllers.ModelDetailController","mainApp.models.controllers.ModelCreationHistoryController","mainApp.models.controllers.ActivateModelController","mainApp.core.services.FeatureFlagService","mainApp.setup.controllers.SetupController","mainApp.setup.controllers.DeploymentWizardController","mainApp.setup.controllers.LeadEnrichmentController"]).controller("MainViewController",function($scope,$http,$rootScope,$compile,ResourceUtility,BrowserStorageUtility,TimestampIntervalUtility,NavUtility,FeatureFlagService,ConfigService){function createManageCredentialsView(){window.location.hash=NavUtility.MANAGE_CREDENTIALS_HASH,$http.get("./app/config/views/ManageCredentialsView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainContentView").html(html))(scope)})}function createUpdatePasswordView(){window.location.hash=NavUtility.UPDATE_PASSWORD_HASH,$http.get("./app/login/views/UpdatePasswordView.html").success(function(html){var scope=$rootScope.$new();scope.isLoggedInWithTempPassword=$scope.isLoggedInWithTempPassword,scope.isPasswordOlderThanNinetyDays=$scope.isPasswordOlderThanNinetyDays,$compile($("#mainContentView").html(html))(scope)})}function createUpdatePasswordSuccessView(){window.location.hash=NavUtility.UPDATE_PASSWORD_HASH,$http.get("./app/login/views/UpdatePasswordSuccessView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainContentView").html(html))(scope)})}function createUserManagementView(){window.location.hash=NavUtility.USER_MANAGEMENT_HASH,$http.get("./app/userManagement/views/UserManagementView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainContentView").html(html))(scope)})}function createAdminInfoView(data){window.location.hash=NavUtility.ADMIN_INFO_HASH,$http.get("./app/models/views/AdminInfoView.html").success(function(html){var scope=$rootScope.$new();scope.data=data,$compile($("#mainContentView").html(html))(scope)})}function modelCreationHistoryView(){window.location.hash=NavUtility.MODEL_CREATION_HISTORY_HASH,$http.get("./app/models/views/ModelCreationHistoryView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainContentView").html(html))(scope)})}function createMainContentViewAndRefreshFeatures(){FeatureFlagService.GetAllFlags().then(function(){var flags=FeatureFlagService.Flags();FeatureFlagService.FlagIsEnabled(flags.REDIRECT_TO_DEPLOYMENT_WIZARD_PAGE)?createDeploymentWizardView():createModelListView()})}function createModelListView(){window.location.hash=NavUtility.MODEL_LIST_HASH,$http.get("./app/models/views/ModelListView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainContentView").html(html))(scope)})}function createModelDetailView(data){window.location.hash=NavUtility.MODEL_DETAIL_HASH,$http.get("./app/models/views/ModelDetailView.html").success(function(html){var scope=$rootScope.$new();scope.data=data,$compile($("#mainContentView").html(html))(scope)})}function createActivateModelView(){window.location.hash=NavUtility.ACTIVATE_MODEL,$http.get("./app/models/views/ActivateModelView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainContentView").html(html))(scope)})}function createSetupView(){window.location.hash=NavUtility.SETUP_HASH,$http.get("./app/setup/views/SetupView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainContentView").html(html))(scope)})}function createDeploymentWizardView(){window.location.hash=NavUtility.DEPLOYMENT_WIZARD_HASH,$http.get("./app/setup/views/DeploymentWizardView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainContentView").html(html))(scope)})}function createLeadEnrichmentView(){window.location.hash=NavUtility.LEAD_ENRICHMENT_HASH,$http.get("./app/setup/views/LeadEnrichmentView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainContentView").html(html))(scope)})}$scope.ResourceUtility=ResourceUtility,$scope.isLoggedInWithTempPassword||$scope.isPasswordOlderThanNinetyDays?createUpdatePasswordView():createMainContentViewAndRefreshFeatures(),$http.get("./app/core/views/MainHeaderView.html").success(function(html){var scope=$rootScope.$new();scope.mandatePasswordChange=$scope.isLoggedInWithTempPassword||$scope.isPasswordOlderThanNinetyDays,$compile($("#mainHeaderView").html(html))(scope)}),$scope.$on(NavUtility.MANAGE_CREDENTIALS_NAV_EVENT,function(event,data){createManageCredentialsView()}),$scope.$on(NavUtility.UPDATE_PASSWORD_NAV_EVENT,function(event,data){null!=data&&data.Success?createUpdatePasswordSuccessView():createUpdatePasswordView()}),$scope.$on(NavUtility.USER_MANAGEMENT_NAV_EVENT,function(event,data){createUserManagementView()}),$scope.$on(NavUtility.ADMIN_INFO_NAV_EVENT,function(event,data){createAdminInfoView(data)}),$scope.$on(NavUtility.MODEL_CREATION_HISTORY_NAV_EVENT,function(event,data){modelCreationHistoryView()}),$scope.$on(NavUtility.MODEL_LIST_NAV_EVENT,function(event,data){createModelListView()}),$scope.$on(NavUtility.MODEL_DETAIL_NAV_EVENT,function(event,data){createModelDetailView(data)}),$scope.$on(NavUtility.ACTIVATE_MODEL,function(event,data){createActivateModelView()}),$scope.$on(NavUtility.SETUP_NAV_EVENT,function(event,data){createSetupView()}),$scope.$on(NavUtility.DEPLOYMENT_WIZARD_NAV_EVENT,function(event,data){createDeploymentWizardView()}),$scope.$on(NavUtility.LEAD_ENRICHMENT_NAV_EVENT,function(event,data){createLeadEnrichmentView()})}),angular.module("mainApp.core.controllers.SalesforceCredentialController",["mainApp.appCommon.utilities.ResourceUtility"]).controller("SalesforceCredentialController",function($scope,$rootScope,$http,ResourceUtility){$scope.ResourceUtility=ResourceUtility}).directive("salesforceCredential",function(){return{scope:{logoLeftAlign:"=",productionComplete:"=",productionError:"=",productionSaveInProgress:"=",productionCredentials:"=",productionSaveButtonText:"@",productionSaveButtonClicked:"&",productionEditButtonText:"@",productionImportButtonText:"@",productionImportButtonClicked:"&",sandboxComplete:"=",sandboxError:"=",sandboxSaveInProgress:"=",sandboxCredentials:"=",sandboxSaveButtonText:"@",sandboxSaveButtonClicked:"&",sandboxEditButtonText:"@",sandboxImportButtonText:"@",sandboxImportButtonClicked:"&"},templateUrl:"app/core/views/SalesforceCredentialTemplate.html"}});var mod=angular.module("mainApp.core.services.FeatureFlagService",["mainApp.core.utilities.RightsUtility","mainApp.core.utilities.BrowserStorageUtility"]);mod.service("FeatureFlagService",function($q,$http,BrowserStorageUtility,RightsUtility){function GetAllFlagsAsync(promise){if(flagValues.length>0)return void promise.resolve(flagValues);var sessionDoc=BrowserStorageUtility.getClientSession();if(null===sessionDoc||!sessionDoc.hasOwnProperty("Tenant"))return void promise.resolve({});var tenantId=sessionDoc.Tenant.Identifier;$http({method:"GET",url:"/pls/config/featureflags?tenantId="+tenantId}).success(function(data){for(var key in data)flagValues[key]=data[key];UpdateFlagsBasedOnRights(),promise.resolve(flagValues)}).error(function(){SetFlag(flags.ADMIN_ALERTS_TAB,!1),SetFlag(flags.SETUP_PAGE,!1),SetFlag(flags.ACTIVATE_MODEL_PAGE,!1),SetFlag(flags.SYSTEM_SETUP_PAGE,!1),SetFlag(flags.DEPLOYMENT_WIZARD_PAGE,!1),SetFlag(flags.REDIRECT_TO_DEPLOYMENT_WIZARD_PAGE,!1),SetFlag(flags.LEAD_ENRICHMENT_PAGE,!1),UpdateFlagsBasedOnRights(),promise.resolve(flagValues)})}function SetFlag(flag,value){flagValues[flag]=value}function UpdateFlag(flag,value){SetFlagUsingBooleanAnd(flag,value)}function SetFlagUsingBooleanAnd(flag,value){flagValues.hasOwnProperty(flag)?SetFlag(flag,flagValues[flag]&&value):SetFlag(flag,value)}function GetFlag(flag){return flagValues[flag]||!1}function UpdateFlagsBasedOnRights(){UpdateFlag(flags.CHANGE_MODEL_NAME,RightsUtility.currentUserMay("Edit","Models")),UpdateFlag(flags.DELETE_MODEL,RightsUtility.currentUserMay("Edit","Models")),UpdateFlag(flags.UPLOAD_JSON,RightsUtility.currentUserMay("Create","Models")),UpdateFlag(flags.USER_MGMT_PAGE,RightsUtility.currentUserMay("View","Users")),UpdateFlag(flags.ADD_USER,RightsUtility.currentUserMay("Edit","Users")),UpdateFlag(flags.CHANGE_USER_ACCESS,RightsUtility.currentUserMay("Edit","Users")),UpdateFlag(flags.DELETE_USER,RightsUtility.currentUserMay("Edit","Users")),UpdateFlag(flags.ADMIN_PAGE,RightsUtility.currentUserMay("View","Reporting")),UpdateFlag(flags.MODEL_HISTORY_PAGE,RightsUtility.currentUserMay("View","Reporting")),
UpdateFlag(flags.SYSTEM_SETUP_PAGE,RightsUtility.currentUserMay("Edit","Configurations")),UpdateFlag(flags.ACTIVATE_MODEL_PAGE,RightsUtility.currentUserMay("Edit","Configurations")),UpdateFlag(flags.SETUP_PAGE,RightsUtility.currentUserMay("Edit","Configurations")),UpdateFlag(flags.DEPLOYMENT_WIZARD_PAGE,RightsUtility.currentUserMay("Edit","Configurations")),UpdateFlag(flags.REDIRECT_TO_DEPLOYMENT_WIZARD_PAGE,RightsUtility.currentUserMay("Edit","Configurations")),UpdateFlag(flags.LEAD_ENRICHMENT_PAGE,RightsUtility.currentUserMay("Edit","Configurations"))}this.GetAllFlags=function(){var deferred=$q.defer();return GetAllFlagsAsync(deferred),deferred.promise},this.FlagIsEnabled=GetFlag;var flags={CHANGE_MODEL_NAME:"ChangeModelNames",DELETE_MODEL:"DeleteModels",UPLOAD_JSON:"UploadSummaryJson",USER_MGMT_PAGE:"UserManagementPage",ADD_USER:"AddUsers",CHANGE_USER_ACCESS:"ChangeUserAccess",DELETE_USER:"DeleteUsers",ADMIN_PAGE:"AdminPage",ADMIN_ALERTS_TAB:"AdminAlertsTab",MODEL_HISTORY_PAGE:"ModelCreationHistoryPage",SYSTEM_SETUP_PAGE:"SystemSetupPage",ACTIVATE_MODEL_PAGE:"ActivateModelPage",SETUP_PAGE:"SetupPage",DEPLOYMENT_WIZARD_PAGE:"DeploymentWizardPage",REDIRECT_TO_DEPLOYMENT_WIZARD_PAGE:"RedirectToDeploymentWizardPage",LEAD_ENRICHMENT_PAGE:"LeadEnrichmentPage"};this.Flags=function(){return flags};var flagValues={}}),angular.module("mainApp.core.services.HelpService",["mainApp.appCommon.utilities.URLUtility"]).service("HelpService",function(URLUtility){this.OpenPrivacyPolicy=function(){URLUtility.OpenNewWindow("./help/PrivacyPolicy.html")}}),angular.module("mainApp.core.services.ResourceStringsService",["mainApp.appCommon.utilities.URLUtility","mainApp.appCommon.utilities.ResourceUtility"]).service("ResourceStringsService",function($http,$q,URLUtility,ResourceUtility){function getResourceStringsAtWebAddress(webAddress){var deferred=$q.defer();return $http({method:"GET",url:webAddress}).success(function(data,status,headers,config){if(null!=data){for(var resourceStrings={},result=data.split("\r\n"),x=0;x<result.length;x++)if(""!==result[x]){var resourceString=result[x].split("=");resourceStrings[resourceString[0]]=resourceString[1]}ResourceUtility.configStrings=resourceStrings,ResourceUtility.resourceStringsInitialized=!0,deferred.resolve(!0)}}).error(function(data,status,headers,config){deferred.resolve(!0)}),deferred.promise}this.DefaultLocale="en-US",this.GetExternalResourceStringsForLocale=function(locale){null==locale&&(locale=this.DefaultLocale);var webAddress="assets/resources/"+locale+"/ResourceStringsExternal.txt";return getResourceStringsAtWebAddress(webAddress)},this.GetInternalResourceStringsForLocale=function(locale){null==locale&&(locale=this.DefaultLocale);var webAddress="assets/resources/"+locale+"/ResourceStrings.txt";return getResourceStringsAtWebAddress(webAddress)}}),angular.module("mainApp.core.services.SessionService",["mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.utilities.ResourceUtility"]).service("SessionService",function(BrowserStorageUtility,ResourceUtility){this.ClearSession=function(){BrowserStorageUtility.clear(!1),ResourceUtility.clearResourceStrings(),window.location.reload()},this.HandleResponseErrors=function(data,status){401===status&&this.ClearSession()}}),angular.module("mainApp.core.services.WidgetService",["mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.utilities.WidgetConfigUtility","mainApp.appCommon.utilities.MetadataUtility"]).service("WidgetService",function($compile,BrowserStorageUtility,WidgetConfigUtility,MetadataUtility){this.GetApplicationWidgetConfig=function(){var applicationId="PredictiveLeadScoring",rootWidgetConfig=BrowserStorageUtility.getWidgetConfigDocument();if(null!=rootWidgetConfig.Applications)for(var x=0;x<rootWidgetConfig.Applications.length;x++){var matchedWidget=WidgetConfigUtility.GetWidgetConfig(rootWidgetConfig.Applications[x],applicationId);if(null!=matchedWidget)return matchedWidget}return null}}),angular.module("mainApp.core.utilities.BrowserStorageUtility",[]).service("BrowserStorageUtility",function(){this.CacheTimeout=288e5,this._tokenDocumentStorageKey="GriotTokenDocument",this._tokenDocument=null,this._loginDocumentStorageKey="GriotLoginDocument",this._loginDocument=null,this._sessionDocumentStorageKey="GriotSessionDocument",this._sessionDocument=null,this._clientSessionStorageKey="GriotClientSession",this._clientSession=null,this._currentTabStorageKey="GriotCurrentTab",this._currentTab=null,this._configDocumentStorageKey="GriotConfigDocument",this._configDocument=null,this._widgetConfigDocumentStorageKey="GriotWidgetConfigDocument",this._widgetConfigDocument=null,this._featureFlagsDocumentStorageKey="GriotFeatureFlagsDocument",this._featureFlagsDocument=null,this._sessionLastActiveTimestampStorageKey="GriotSessionLastActiveTimestamp",this.setSessionLastActiveTimestamp=function(timeStamp){$.jStorage.set(this._sessionLastActiveTimestampStorageKey,timeStamp)},this.getSessionLastActiveTimestamp=function(){return $.jStorage.reInit(),$.jStorage.get(this._sessionLastActiveTimestampStorageKey)},this.setTokenDocument=function(data,successHandler){this._setProperty(data,successHandler,"_tokenDocument","_tokenDocumentStorageKey")},this.getTokenDocument=function(){return this._getProperty("_tokenDocument","_tokenDocumentStorageKey")},this.setLoginDocument=function(data,successHandler){this._setProperty(data,successHandler,"_loginDocument","_loginDocumentStorageKey")},this.getLoginDocument=function(){return this._getProperty("_loginDocument","_loginDocumentStorageKey")},this.setFeatureFlagsDocument=function(data,successHandler){this._setProperty(data,successHandler,"_featureFlagsDocument","_featureFlagsDocumentStorageKey")},this.getFeatureFlagsDocument=function(){var featureFlags=this._getProperty("_featureFlagsDocument","_featureFlagsDocumentStorageKey");return featureFlags||{}},this.setSessionDocument=function(data,successHandler){this._setProperty(data,successHandler,"_sessionDocument","_sessionDocumentStorageKey")},this.getSessionDocument=function(){return this._getProperty("_sessionDocument","_sessionDocumentStorageKey")},this.setClientSession=function(data,successHandler){var availableRightsDictionary={};null!=data&&null!=data.AvailableRights&&($.each(data.AvailableRights,function(key,availableRight){availableRightsDictionary[availableRight.Key]=availableRight.Value}),data.availableRightsDictionary=availableRightsDictionary),this._setProperty(data,successHandler,"_clientSession","_clientSessionStorageKey")},this.getClientSession=function(){return this._getProperty("_clientSession","_clientSessionStorageKey")},this.setCurrentTab=function(data,successHandler){this._setProperty(data,successHandler,"_currentTab","_currentTabStorageKey")},this.getCurrentTab=function(){return this._getProperty("_currentTab","_currentTabStorageKey")},this.setConfigDocument=function(data,successHandler){this._setProperty(data,successHandler,"_configDocument","_configDocumentStorageKey")},this.getConfigDocument=function(){return this._getProperty("_configDocument","_configDocumentStorageKey")},this.setWidgetConfigDocument=function(data,successHandler){this._setProperty(data,successHandler,"_widgetConfigDocument","_widgetConfigDocumentStorageKey")},this.getWidgetConfigDocument=function(){return this._getProperty("_widgetConfigDocument","_widgetConfigDocumentStorageKey")},this._setProperty=function(data,successHandler,propStorageObjName,propStorageKeyName){this[propStorageKeyName]&&(null!=data?data.Timestamp=(new Date).getTime()+this.CacheTimeout:$.jStorage.deleteKey(this[propStorageKeyName]),$.jStorage.set(this[propStorageKeyName],data),this[propStorageObjName]=data,successHandler&&"function"==typeof successHandler&&successHandler())},this._getProperty=function(propStorageObjName,propStorageKeyName){if(propStorageObjName&&propStorageKeyName){if(null==this[propStorageObjName]){$.jStorage.reInit();var fromStorage=$.jStorage.get(this[propStorageKeyName]);this[propStorageObjName]=fromStorage||null}return this[propStorageObjName]}return null},this.clear=function(keepAuthentication){keepAuthentication="boolean"==typeof keepAuthentication&&keepAuthentication;var clientSession;keepAuthentication&&(clientSession=this.getClientSession()),$.jStorage.flush(),keepAuthentication&&this.setClientSession(clientSession)}}),angular.module("mainApp.core.utilities.NavUtility",[]).service("NavUtility",function(){this.MANAGE_CREDENTIALS_HASH="/ManageCredentials",this.UPDATE_PASSWORD_HASH="/UpdatePassword",this.USER_MANAGEMENT_HASH="/UserManagement",this.MODEL_LIST_HASH="/ModelList",this.MODEL_DETAIL_HASH="/ModelDetail",this.MODEL_CREATION_HISTORY_HASH="/ModelCreationHistory",this.ACTIVATE_MODEL="/ActivateModel",this.SETUP_HASH="/ManageFields",this.DEPLOYMENT_WIZARD_HASH="/DeploymentWizard",this.LEAD_ENRICHMENT_HASH="/LeadEnrichment",this.MANAGE_CREDENTIALS_NAV_EVENT="ManageCredentialsNavEvent",this.UPDATE_PASSWORD_NAV_EVENT="UpdatePasswordNavEvent",this.USER_MANAGEMENT_NAV_EVENT="UserManagementNavEvent",this.MODEL_LIST_NAV_EVENT="ModelListNavEvent",this.MODEL_DETAIL_NAV_EVENT="ModelDetailNavEvent",this.MODEL_CREATION_HISTORY_NAV_EVENT="ModelCreationHistoryNavEvent",this.SETUP_NAV_EVENT="SetupNavEvent",this.LOAD_FIELDS_NAV_EVENT="LoadFieldsEvent",this.DEPLOYMENT_WIZARD_NAV_EVENT="DeploymentWizardNavEvent",this.LEAD_ENRICHMENT_NAV_EVENT="LeadEnrichment",this.SYSTEM_CONFIGURED_COMPLETE_EVENT="SystemConfiguredCompleteEvent"}),angular.module("mainApp.core.utilities.PasswordUtility",["mainApp.appCommon.utilities.ResourceUtility"]).service("PasswordUtility",function(ResourceUtility){this.validPassword=function(password){var result={Valid:!0,ErrorMsg:null};if(password.length<8)return result.Valid=!1,result.ErrorMsg=ResourceUtility.getString("CHANGE_PASSWORD_HELP"),result;var uppercase=/[A-Z]/;if(!uppercase.test(password))return result.Valid=!1,result.ErrorMsg=ResourceUtility.getString("CHANGE_PASSWORD_HELP"),result;var lowercase=/[a-z]/;if(!lowercase.test(password))return result.Valid=!1,result.ErrorMsg=ResourceUtility.getString("CHANGE_PASSWORD_HELP"),result;var number=/[0-9]/;return number.test(password)?result:(result.Valid=!1,result.ErrorMsg=ResourceUtility.getString("CHANGE_PASSWORD_HELP"),result)}});var app=angular.module("mainApp.core.utilities.RightsUtility",["mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility"]);app.service("RightsUtility",function(_,BrowserStorageUtility){this.accessLevel={EXTERNAL_USER:{name:"EXTERNAL_USER",ordinal:0},EXTERNAL_ADMIN:{name:"EXTERNAL_ADMIN",ordinal:1},INTERNAL_USER:{name:"INTERNAL_USER",ordinal:2},INTERNAL_ADMIN:{name:"INTERNAL_ADMIN",ordinal:3},SUPER_ADMIN:{name:"SUPER_ADMIN",ordinal:4}},this.getAccessLevel=function(s){return _.findWhere(this.accessLevel,{name:s})},this.may=function(rightsDict,operation,category){if(rightsDict.hasOwnProperty("PLS_"+category)){var rights=rightsDict["PLS_"+category];return rights["May"+operation]}return!1},this.currentUserMay=function(operation,category){var clientSession=BrowserStorageUtility.getClientSession();return this.may(clientSession.AvailableRights,operation,category)}}),angular.module("mainApp.core.utilities.ServiceErrorUtility",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.FaultUtility","mainApp.appCommon.modals.SimpleModal"]).service("ServiceErrorUtility",function(FaultUtility,ResourceUtility,SimpleModal){this.InvalidCredentials="LOGIN_INVALID_AUTHENTICATION_CREDENTIALS",this.ExpiredCredentials="LOGIN_EXPIRED_AUTHENTICATION_CREDENTIALS",this.ExpiredPassword="LOGIN_EXPIRED_USER_PASSWORD",this.HandleFriendlyServiceResponseErrors=function(response){if(null!=response&&!this.HandleSessionTimeout(response))return this.GetUserDisplayableErrors(response)},this.HandleServiceResponseFailure=function(response,faultTitle,failSilently){if(failSilently="undefined"!=typeof failSilently&&failSilently,!failSilently){var message=this.HandleFriendlyServiceResponseErrors(response);FaultUtility.ShowFaultAlert(message,faultTitle)}},this.HandleFriendlyNoResponseFailure=function(){var resultError=ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR");"UNEXPECTED_SERVICE_ERROR"==resultError&&(resultError="Unknown error occurred.");var result={success:!1,resultObj:null,resultErrors:resultError};return result},this.HandleSessionTimeout=function(response){var result=!1;return this.ServiceResponseContainsError(response,this.ExpiredCredentials)&&(SimpleModal.show({message:ResourceUtility.getString(this.ExpiredCredentials),title:ResourceUtility.getString("EXPIRED_SESSION_TITLE"),showCloseButton:!1}),result=!0),result},this.GetUserDisplayableErrors=function(response){var result="";if(null!=response&&null!=response.Errors&&response.Errors.length>0)for(var x=0;x<response.Errors.length;x++){var errorValue=response.Errors[x].Key,errorMessage=response.Errors[x].Value,fullErrorMessage=errorMessage.replace(errorValue,ResourceUtility.getString(errorValue));result+=fullErrorMessage}return result},this.ServiceResponseContainsError=function(response,errorCode){var result=!1;if(null!=response&&null!=response.Errors&&response.Errors.length>0)for(var x=0;x<response.Errors.length;x++)response.Errors[x].Key==errorCode&&(result=!0);return result},this.ServiceResultError="",this.ShowErrorView=function(response){null==response?this.ServiceResultError=this.HandleFriendlyNoResponseFailure():this.ServiceResultError=response.resultErrors,window.location.hash="/ServiceError"}}),angular.module("mainApp.login.controllers.LoginController",["ngRoute","mainApp.appCommon.directives.ngEnterDirective","mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.TimestampIntervalUtility","mainApp.core.utilities.ServiceErrorUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.NavUtility","mainApp.login.services.LoginService","mainApp.core.services.HelpService","mainApp.core.services.FeatureFlagService","mainApp.login.modals.TenantSelectionModal","mainApp.core.services.ResourceStringsService","mainApp.config.services.ConfigService","mainApp.core.controllers.MainViewController"]).controller("LoginController",function($scope,$http,$rootScope,$compile,ResourceUtility,TimestampIntervalUtility,NavUtility,ServiceErrorUtility,BrowserStorageUtility,HelpService,LoginService,ResourceStringsService,ConfigService,TenantSelectionModal,FeatureFlagService){function getFeatureFlags(){FeatureFlagService.GetAllFlags().then(function(){constructMainView()})}function constructMainView(){$http.get("./app/core/views/MainView.html").success(function(html){var scope=$rootScope.$new();scope.isLoggedInWithTempPassword=$scope.isLoggedInWithTempPassword,scope.isPasswordOlderThanNinetyDays=$scope.isPasswordOlderThanNinetyDays,$compile($("#mainView").html(html))(scope)})}$("body").addClass("login-body"),$("[autofocus]").focus(),$scope.copyrightString=ResourceUtility.getString("LOGIN_COPYRIGHT",[(new Date).getFullYear()]),$scope.ResourceUtility=ResourceUtility,$scope.username="",$scope.password="",$scope.loginMessage=null,$scope.loginErrorMessage=null,$scope.showLoginError=!1,$scope.showSuccessMessage=!1,$scope.successMessage="",$scope.loginInProgess=!1,$scope.showLoginForm=!0,$scope.showForgotPassword=!1,$scope.forgotPasswordUsername="",$scope.forgotPasswordErrorMessage="",$scope.loginClick=function(){$scope.showLoginError=!1,$scope.loginMessage=ResourceUtility.getString("LOGIN_LOGGING_IN_MESSAGE"),$scope.loginInProgess||($scope.usernameInvalid=""===$scope.username,$scope.passwordInvalid=""===$scope.password,$scope.usernameInvalid||$scope.passwordInvalid||($scope.loginInProgess=!0,LoginService.Login($scope.username,$scope.password).then(function(result){$scope.loginInProgess=!1,$scope.loginMessage=null,null!=result&&result.Success===!0?($rootScope.$broadcast("LoggedIn"),$scope.isLoggedInWithTempPassword=result.Result.MustChangePassword,$scope.isPasswordOlderThanNinetyDays=TimestampIntervalUtility.isTimestampFartherThanNinetyDaysAgo(result.Result.PasswordLastModified),$scope.handleTenantSelection(result.Result.Tenants)):$scope.showLoginHeaderMessage(result.errorMessage)})))},$scope.handleTenantSelection=function(tenantList){if(null==tenantList||0===tenantList.length)return void $scope.showLoginHeaderMessage(ResourceUtility.getString("NO_TENANT_MESSAGE"));if(1==tenantList.length)$scope.getSessionDocument(tenantList[0]);else{var tenantSelectionCallback=function(selectedTenant){$scope.getSessionDocument(selectedTenant)};TenantSelectionModal.show(tenantList,tenantSelectionCallback)}},$scope.getSessionDocument=function(tenant){LoginService.GetSessionDocument(tenant).then(function(data){null!=data&&data.Success===!0?$scope.getLocaleSpecificResourceStrings(data.Result.User.Locale):$scope.showLoginHeaderMessage(ResourceUtility.getString("LOGIN_UNKNOWN_ERROR"))})},$scope.getLocaleSpecificResourceStrings=function(locale){ResourceStringsService.GetInternalResourceStringsForLocale(locale).then(function(result){$scope.getWidgetConfigDoc()})},$scope.getWidgetConfigDoc=function(){ConfigService.GetWidgetConfigDocument().then(function(){$("body").removeClass("login-body"),$rootScope.$broadcast("ShowFooterEvent",!0),getFeatureFlags()})},$scope.showLoginHeaderMessage=function(message){null!=message&&(message.indexOf("Global Auth")>-1&&(message=ResourceUtility.getString("LOGIN_GLOBAL_AUTH_ERROR")),$scope.loginErrorMessage=message,$scope.showLoginError=!0)},$scope.forgotPasswordClick=function($event){null!=$event&&$event.preventDefault(),$scope.showLoginForm=!1,$scope.showForgotPassword=!0},$scope.cancelForgotPasswordClick=function($event){null!=$event&&$event.preventDefault(),$scope.showLoginForm=!0,$scope.showForgotPasswordError=!1},$scope.forgotPasswordOkClick=function(){$scope.resetPasswordSuccess=!1,$scope.showForgotPasswordError=!1,$scope.forgotPasswordUsernameInvalid=""===$scope.forgotPasswordUsername,$scope.forgotPasswordUsernameInvalid||LoginService.ResetPassword($scope.forgotPasswordUsername).then(function(result){null!=result&&(result.Success===!0?($scope.showForgotPassword=!1,$scope.resetPasswordSuccess=!0):($scope.showForgotPasswordError=!0,"LEDP_18018"==result.Error.errorCode?($scope.forgotPasswordUsernameInvalid=!0,$scope.forgotPasswordErrorMessage=ResourceUtility.getString("RESET_PASSWORD_USERNAME_INVALID")):($scope.forgotPasswordUsernameInvalid=!1,$scope.forgotPasswordErrorMessage=ResourceUtility.getString("RESET_PASSWORD_FAIL"))))})},$scope.privacyPolicyClick=function($event){null!=$event&&$event.preventDefault(),HelpService.OpenPrivacyPolicy()}}),angular.module("mainApp.login.controllers.UpdatePasswordController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.utilities.StringUtility","mainApp.core.utilities.NavUtility","mainApp.core.utilities.PasswordUtility","mainApp.login.services.LoginService"]).controller("UpdatePasswordController",function($scope,$rootScope,ResourceUtility,BrowserStorageUtility,PasswordUtility,StringUtility,NavUtility,LoginService){function validatePassword(){return $("#validateAlertError, #changePasswordSuccessAlert").fadeOut(),$scope.oldPasswordInputError=StringUtility.IsEmptyString($scope.oldPassword)?"error":"",$scope.newPasswordInputError=StringUtility.IsEmptyString($scope.newPassword)?"error":"",$scope.confirmPasswordInputError=StringUtility.IsEmptyString($scope.confirmPassword)?"error":"",""===$scope.oldPassword?($scope.validateErrorMessage=ResourceUtility.getString("LOGIN_PASSWORD_EMPTY_OLDPASSWORD"),$scope.oldPasswordInputError="error",!1):"error"!==$scope.oldPasswordInputError&&"error"!==$scope.newPasswordInputError&&"error"!==$scope.confirmPasswordInputError&&($scope.newPassword==$scope.oldPassword?($scope.validateErrorMessage=ResourceUtility.getString("LOGIN_PASSWORD_UPDATE_ERROR"),$scope.newPasswordInputError="error",$scope.confirmPasswordInputError="error",!1):$scope.newPassword!==$scope.confirmPassword?($scope.validateErrorMessage=ResourceUtility.getString("LOGIN_PASSWORD_MATCH_ERROR"),$scope.newPasswordInputError="error",$scope.confirmPasswordInputError="error",!1):!!PasswordUtility.validPassword($scope.newPassword).Valid||($scope.newPasswordInputError="error",$scope.validateErrorMessage=ResourceUtility.getString("CHANGE_PASSWORD_HELP"),!1))}function clearChangePasswordField(){$scope.oldPassword="",$scope.newPassword="",$scope.confirmPassword=""}$scope.ResourceUtility=ResourceUtility,$scope.oldPassword=null,$scope.newPassword=null,$scope.confirmPassword=null,$scope.oldPasswordInputError="",$scope.newPasswordInputError="",$scope.confirmPasswordInputError="",$scope.showPasswordError=!1,$scope.validateErrorMessage=ResourceUtility.getString("CHANGE_PASSWORD_HELP"),$scope.saveInProgess=!1,$("#validateAlertError, #changePasswordSuccessAlert").hide(),$scope.isPasswordOlderThanNinetyDays?($scope.showPasswordError=!0,$scope.validateErrorMessage=ResourceUtility.getString("NINTY_DAY_OLD_PASSWORD")):$scope.isLoggedInWithTempPassword&&($scope.showPasswordError=!0,$scope.validateErrorMessage=ResourceUtility.getString("MUST_CHANGE_TEMP_PASSWORD")),$scope.cancelClick=function($event){null!=$event&&$event.preventDefault(),$scope.isLoggedInWithTempPassword||$scope.isPasswordOlderThanNinetyDays?clearChangePasswordField():$rootScope.$broadcast(NavUtility.MODEL_LIST_NAV_EVENT)},$scope.closeErrorClick=function($event){null!=$event&&$event.preventDefault(),$scope.showPasswordError=!1},$scope.updatePasswordClick=function(){if(!$scope.saveInProgess){$scope.showPasswordError=!1;var isValid=validatePassword();isValid?($scope.saveInProgess=!0,LoginService.ChangePassword($scope.oldPassword,$scope.newPassword,$scope.confirmPassword).then(function(result){$scope.saveInProgess=!1,result.Success?($("#changePasswordSuccessAlert").fadeIn(),$rootScope.$broadcast(NavUtility.UPDATE_PASSWORD_NAV_EVENT,{Success:!0})):(401==result.Status?$scope.validateErrorMessage=ResourceUtility.getString("CHANGE_PASSWORD_BAD_CREDS"):$scope.validateErrorMessage=ResourceUtility.getString("CHANGE_PASSWORD_ERROR"),$scope.showPasswordError=!0)})):$scope.showPasswordError=!0}}}).controller("UpdatePasswordSuccessController",function($scope,ResourceUtility,LoginService){$scope.ResourceUtility=ResourceUtility,$scope.clickRelogin=function(){LoginService.Logout()}}),angular.module("mainApp.login.modals.TenantSelectionModal",["mainApp.appCommon.utilities.UnderscoreUtility"]).service("TenantSelectionModal",function($compile,$http,$rootScope,_){this.show=function(tenantList,successCallback){$http.get("./app/login/views/TenantSelectionView.html").success(function(html){var scope=$rootScope.$new();scope.tenantList=_.sortBy(tenantList,"Indentifier"),scope.successCallback=successCallback;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}).controller("TenantSelectionController",function($scope,ResourceUtility){$scope.ResourceUtility=ResourceUtility,$scope.handleTenantSelected=function(){if(null!=this.select_value){var tenant=_.find($scope.tenantList,{Identifier:this.select_value});$scope.successCallback(tenant),$("#modalContainer").modal("hide")}}}),angular.module("mainApp.login.services.LoginService",["mainApp.core.utilities.ServiceErrorUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.core.services.SessionService"]).service("LoginService",function($http,$q,$location,BrowserStorageUtility,ServiceErrorUtility,ResourceUtility,StringUtility,SessionService){this.Login=function(username,password){var deferred=$q.defer(),passwordHash=CryptoJS.SHA256(password);return $http({method:"POST",url:"/pls/login",data:JSON.stringify({Username:username,Password:passwordHash.toString()})}).then(function(response){var result=response.data;null!=result&&""!==result&&(BrowserStorageUtility.setTokenDocument(result.Uniqueness+"."+result.Randomness),result.Result.UserName=username,BrowserStorageUtility.setLoginDocument(result.Result)),deferred.resolve(result)},function(response){var result={Success:!1,errorMessage:ResourceUtility.getString("LOGIN_UNKNOWN_ERROR")};"LEDP_18001"==response.data.errorCode&&(result.errorMessage=ResourceUtility.getString("DEFAULT_LOGIN_ERROR_TEXT")),deferred.resolve(result)}),deferred.promise},this.GetSessionDocument=function(tenant){if(null==tenant)return null;var deferred=$q.defer();return $http({method:"POST",url:"/pls/attach",data:angular.toJson(tenant)}).success(function(data,status,headers,config){var result=!1;null!=data&&data.Success===!0&&(BrowserStorageUtility.setSessionDocument(data.Result),data.Result.User.Tenant=tenant,result=data,BrowserStorageUtility.setClientSession(data.Result.User,function(){deferred.resolve(result)})),null===result.Result.User.AccessLevel&&(status=401,SessionService.HandleResponseErrors(data,status),deferred.resolve(result))}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),deferred.resolve(data)}),deferred.promise},this.ResetPassword=function(username){if(null==username)return null;var deferred=$q.defer();return $http({method:"PUT",url:"/pls/forgotpassword/",data:{Username:username,Product:"Lead Prioritization",HostPort:this.getHostPort()},headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1};data===!0||"true"===data?result.Success=!0:SessionService.HandleResponseErrors(data,status),deferred.resolve(result)}).error(function(data,status,headers,config){var result={Success:!1,Error:data};deferred.resolve(result)}),deferred.promise},this.Logout=function(){var deferred=$q.defer();return $http({method:"GET",data:"",url:"/pls/logout",headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){null!=data&&data.Success===!0?(BrowserStorageUtility.clear(!1),ResourceUtility.clearResourceStrings(),window.location=window.location.protocol+"//"+window.location.host):SessionService.HandleResponseErrors(data,status),deferred.resolve(data)}).error(function(data,status,headers,config){deferred.resolve(data)}),deferred.promise},this.ChangePassword=function(oldPassword,newPassword,confirmNewPassword){var deferred=$q.defer();if(StringUtility.IsEmptyString(oldPassword)||StringUtility.IsEmptyString(newPassword)||StringUtility.IsEmptyString(confirmNewPassword))return deferred.resolve(null),deferred.promise;var creds={OldPassword:CryptoJS.SHA256(oldPassword).toString(),NewPassword:CryptoJS.SHA256(newPassword).toString()},username=BrowserStorageUtility.getLoginDocument().UserName;return $http({method:"PUT",url:"/pls/users/"+username+"/creds",data:creds,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!0,Status:status};data.Success||(result.Success=!1),deferred.resolve(result)}).error(function(data,status,headers,config){var result={Success:!1,Status:status};deferred.resolve(result)}),deferred.promise},this.getHostPort=function(){var host=$location.host(),protocal=$location.protocol(),port=$location.port();return 80==port?protocal+"://"+host:protocal+"://"+host+":"+port}}),angular.module("mainApp.models.controllers.ActivateModelController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.models.services.ModelService","mainApp.models.modals.AddSegmentModal"]).controller("ActivateModelController",function($scope,BrowserStorageUtility,ResourceUtility,ModelService,AddSegmentModal){function sortByPriority(a,b){return a.Priority<b.Priority?-1:a.Priority>b.Priority?1:0}function loadSegments(){ModelService.GetAllSegments($scope.models).then(function(result){if($scope.loading=!1,$scope.saving=!1,null!=result&&result.success===!0){for(var i=0;i<result.resultObj.length;i++)result.resultObj[i].NewModelId=result.resultObj[i].ModelId;$scope.segments=result.resultObj.sort(sortByPriority)}else $scope.showError=!0,$scope.errorMessage=ResourceUtility.getString("ACTIVATE_MODEL_GET_SEGMENTS_ERROR")})}function updateSegment(segment,successCallback,failCallback){successCallback&&successCallback()}$scope.ResourceUtility=ResourceUtility,null!=BrowserStorageUtility.getClientSession()&&($scope.loading=!0,$scope.segments=[],$scope.showError=!1,$scope.errorMessage="",$scope.saving=!1,$scope.allowAddAndDelete=!1,$scope.closeErrorClick=function($event){null!=$event&&$event.preventDefault(),$scope.showError=!1},$scope.models=[{Id:"FAKE_MODEL",DisplayName:"Select"}],ModelService.GetAllModels(!0).then(function(result){null!=result&&result.success===!0&&($scope.models=$scope.models.concat(result.resultObj)),loadSegments()}),$scope.saveSegmentsClicked=function(){$scope.saving||($scope.saving=!0,ModelService.UpdateSegments($scope.segments).then(function(result){null!=result&&result.success===!0||(result.success===!1?($scope.showError=!0,$scope.errorMessage=result.resultErrors):($scope.showError=!0,$scope.errorMessage=ResourceUtility.getString("ACTIVATE_MODEL_UPDATE_SEGMENTS_ERROR"))),loadSegments()}))},$scope.addNewSegmentClicked=function(){AddSegmentModal.show($scope.segments,$scope.models,function(segment){null!=segment&&(null==segment.ModelId&&(segment.ModelId="FAKE_MODEL"),segment.NewModelId=segment.ModelId,$scope.segments.push(segment))})},$scope.deleteSegmentClicked=function(segment){null!=segment&&ModelService.DeleteSegment(segment.Name).then(function(result){if(null!=result&&result.success===!0){for(var i=0;i<$scope.segments.length;i++)if(segment.Name==$scope.segments[i].Name){$scope.segments.splice(i,1);break}}else $scope.showError=!0,$scope.errorMessage=ResourceUtility.getString("ACTIVATE_MODEL_DELETE_SEGMENT_ERROR",[segment.Name])})},$scope.modelChanged=function(segment){if(segment.ModelId!=segment.NewModelId){for(var model=null,i=0;i<$scope.models.length;i++)if(segment.NewModelId==$scope.models[i].Id){model=$scope.models[i];break}if(null!=model){var backupSegment=$.extend(!0,{},segment),secondSegment=null,backupSecondSegment=null;if("FAKE_MODEL"==segment.NewModelId)segment.ModelId=null,segment.ModelName=null;else{segment.ModelId=model.Id,segment.ModelName=model.DisplayName;for(var x=0;x<$scope.segments.length;x++)if(segment.Name!=$scope.segments[x].Name&&$scope.segments[x].ModelId==model.Id){secondSegment=$scope.segments[x];break}null!=secondSegment&&(backupSecondSegment=$.extend(!0,{},secondSegment),secondSegment.ModelId=null,secondSegment.ModelName=null,secondSegment.NewModelId="FAKE_MODEL")}secondSegment?updateSegment(secondSegment,function(){updateSegment(segment,null,function(){$.extend(!0,segment,backupSegment)})},function(){$.extend(!0,secondSegment,backupSecondSegment),$.extend(!0,segment,backupSegment)}):updateSegment(segment,null,function(){$.extend(!0,segment,backupSegment)})}}},$scope.showDecreasePriority=function(segment){if(null==segment)return!1;if("LATTICE_DEFAULT_SEGMENT"==segment.Name)return!1;if(segment.Priority>=$scope.segments.length-1)return!1;for(var i=0;i<$scope.segments.length;i++){var toCheck=$scope.segments[i];if(segment.Name!=toCheck.Name&&segment.Priority<toCheck.Priority)return!0}return!1},$scope.showIncreasePriority=function(segment){if(null==segment)return!1;if("LATTICE_DEFAULT_SEGMENT"==segment.Name)return!1;for(var i=0;i<$scope.segments.length;i++){var toCheck=$scope.segments[i];if(segment.Name!=toCheck.Name&&segment.Priority>toCheck.Priority)return!0}return!1},$scope.decreasePriorityClicked=function($event,segment){if(null!=$event&&$event.preventDefault(),null!=segment){for(var nextLowest=null,i=0;i<$scope.segments.length;i++)if(segment.Name==$scope.segments[i].Name){var next=i+1;nextLowest=$scope.segments[next];break}var currentPriority=segment.Priority;nextLowest&&(segment.Priority=nextLowest.Priority,nextLowest.Priority=currentPriority,$scope.segments=$scope.segments.sort(sortByPriority),updateSegment(segment,function(){
updateSegment(nextLowest,function(){$scope.segments=$scope.segments.sort(sortByPriority)},function(){segment.Priority=currentPriority,$scope.segments=$scope.segments.sort(sortByPriority)})},function(){nextLowest.Priority=segment.Priority,segment.Priority=currentPriority,$scope.segments=$scope.segments.sort(sortByPriority)}))}},$scope.increasePriorityClicked=function($event,segment){if(null!=$event&&$event.preventDefault(),null!=segment){for(var nextHighest=null,i=0;i<$scope.segments.length;i++)if(segment.Name==$scope.segments[i].Name){var previous=i-1;nextHighest=$scope.segments[previous];break}var currentPriority=segment.Priority;nextHighest&&(segment.Priority=nextHighest.Priority,nextHighest.Priority=currentPriority,$scope.segments=$scope.segments.sort(sortByPriority),updateSegment(segment,function(){updateSegment(nextHighest,function(){$scope.segments=$scope.segments.sort(sortByPriority)},function(){segment.Priority=currentPriority,$scope.segments=$scope.segments.sort(sortByPriority)})},function(){nextHighest.Priority=segment.Priority,segment.Priority=currentPriority,$scope.segments=$scope.segments.sort(sortByPriority)}))}})}),angular.module("mainApp.models.controllers.AdminInfoController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.WidgetConfigUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.appCommon.services.TopPredictorService","mainApp.core.services.WidgetService","mainApp.core.utilities.NavUtility","mainApp.models.services.ModelService","mainApp.core.services.FeatureFlagService"]).controller("AdminInfoController",function($scope,$rootScope,$http,ResourceUtility,WidgetService,WidgetConfigUtility,WidgetFrameworkService,NavUtility,ModelService,FeatureFlagService){$scope.ResourceUtility=ResourceUtility;var widgetConfig=WidgetService.GetApplicationWidgetConfig();if(null!=widgetConfig){var screenWidgetConfig=WidgetConfigUtility.GetWidgetConfig(widgetConfig,"adminInfoScreenWidget");if(null!=screenWidgetConfig){var data=$scope.data;$scope.ModelId=data.ModelId,$scope.TenantId=data.TenantId,$scope.ModelHealthScore=data.ModelDetails.RocScore,$scope.TemplateVersion=data.ModelDetails.TemplateVersion,$scope.modelUploaded=data.ModelDetails.Uploaded,$scope.displayName=data.ModelDetails.DisplayName,$scope.onBackClicked=function(){var model={Id:data.ModelId,DisplayName:data.ModelDetails.DisplayName,CreatedDate:data.ModelDetails.ConstructionTime,Status:data.ModelDetails.Status};$rootScope.$broadcast(NavUtility.MODEL_DETAIL_NAV_EVENT,model)};var flags=FeatureFlagService.Flags(),showAlertsTab=FeatureFlagService.FlagIsEnabled(flags.ADMIN_ALERTS_TAB);if(showAlertsTab){$scope.loading=!0;var suppressedCategories=data.SuppressedCategories;ModelService.GetModelAlertsByModelId(data.ModelId).then(function(result){$scope.loading=!1,null!=result&&result.success===!0?(data.ModelAlerts=result.resultObj,data.SuppressedCategories=suppressedCategories):null!=result&&result.success===!1&&(data.ModelAlerts=result.resultObj,data.SuppressedCategories=null);var contentContainer=$("#adminInfoContainer");WidgetFrameworkService.CreateWidget({element:contentContainer,widgetConfig:screenWidgetConfig,metadata:null,data:data,parentData:null})})}else{for(var screenWidgetConfigNoAlertsTab=angular.copy(screenWidgetConfig),i=0;i<screenWidgetConfigNoAlertsTab.Widgets.length;i++){var widget=screenWidgetConfigNoAlertsTab.Widgets[i];if(null!=widget.Tabs){for(var tabs=[],j=0;j<widget.Tabs.length;j++){var tab=widget.Tabs[j];if("adminInfoAlertsTab"!==tab.ID){var tabCopy=angular.copy(tab);tabs.push(tabCopy)}}widget.Tabs=tabs}}var contentContainer=$("#adminInfoContainer");WidgetFrameworkService.CreateWidget({element:contentContainer,widgetConfig:screenWidgetConfigNoAlertsTab,metadata:null,data:data,parentData:null})}}}}),angular.module("mainApp.models.controllers.ModelCreationHistoryController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.RightsUtility","mainApp.appCommon.utilities.WidgetConfigUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.core.services.WidgetService","mainApp.models.services.ModelService"]).controller("ModelCreationHistoryController",function($scope,BrowserStorageUtility,ResourceUtility,RightsUtility,WidgetService,WidgetConfigUtility,WidgetFrameworkService,ModelService){$scope.ResourceUtility=ResourceUtility,$scope.loading=!0;var clientSession=BrowserStorageUtility.getClientSession();if(null!=clientSession){var widgetConfig=WidgetService.GetApplicationWidgetConfig();if(null!=widgetConfig){var screenWidgetConfig=WidgetConfigUtility.GetWidgetConfig(widgetConfig,"modelListCreationHistoryWidget");null!=screenWidgetConfig&&($scope.showNoModels=!1,ModelService.GetAllModels(!1).then(function(result){if($scope.loading=!1,null!=result&&result.success===!0){var modelList=result.resultObj,contentContainer=$("#modelCreationHistoryContainer");WidgetFrameworkService.CreateWidget({element:contentContainer,widgetConfig:screenWidgetConfig,metadata:null,data:modelList,parentData:modelList})}else"NO TENANT FOUND"===result.resultErrors&&($scope.showNoModels=!0)}))}}}),angular.module("mainApp.models.controllers.ModelDetailController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.utilities.WidgetConfigUtility","mainApp.core.utilities.NavUtility","mainApp.core.utilities.RightsUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.core.services.WidgetService","mainApp.appCommon.widgets.ModelDetailsWidget","mainApp.models.controllers.ModelDetailController","mainApp.models.services.ModelService","mainApp.appCommon.services.TopPredictorService","mainApp.appCommon.services.ThresholdExplorerService"]).controller("ModelDetailController",function($scope,$rootScope,_,ResourceUtility,RightsUtility,BrowserStorageUtility,WidgetConfigUtility,NavUtility,WidgetFrameworkService,WidgetService,ModelService,TopPredictorService,ThresholdExplorerService){function filterHighScoresInBottomLeads(bottomLeads){if(null===bottomLeads)return bottomLeads;var toReturn=_.reject(bottomLeads,function(bottomLead){return bottomLead.Score>10});return toReturn}function filterLowScoresInTopLeads(topLeads){if(null===topLeads)return topLeads;var toReturn=_.reject(topLeads,function(topLeads){return topLeads.Score<90});return toReturn}$scope.ResourceUtility=ResourceUtility;var modelId=$scope.data.Id;$scope.displayName=$scope.data.DisplayName;var widgetConfig=WidgetService.GetApplicationWidgetConfig();if(null!=widgetConfig){var screenWidgetConfig=WidgetConfigUtility.GetWidgetConfig(widgetConfig,"modelDetailsScreenWidget");null!=screenWidgetConfig&&ModelService.GetModelById(modelId).then(function(result){if(null!=result&&result.success===!0){var model=result.resultObj;model.ModelId=modelId,model.ChartData=TopPredictorService.FormatDataForTopPredictorChart(model),model.InternalAttributes=TopPredictorService.GetNumberOfAttributesByCategory(model.ChartData.children,!1,model),model.ExternalAttributes=TopPredictorService.GetNumberOfAttributesByCategory(model.ChartData.children,!0,model);var topLeads=ModelService.FormatLeadSampleData(model.TopSample);model.TopSample=filterLowScoresInTopLeads(topLeads);var bottomLeads=ModelService.FormatLeadSampleData(model.BottomSample);model.BottomSample=filterHighScoresInBottomLeads(bottomLeads),model.TotalAttributeValues=model.InternalAttributes.totalAttributeValues+model.ExternalAttributes.totalAttributeValues,thresholdData=ThresholdExplorerService.PrepareData(model),model.ThresholdChartData=thresholdData.ChartData,model.ThresholdDecileData=thresholdData.DecileData,model.ThresholdLiftData=thresholdData.LiftData,model.SuppressedCategories=TopPredictorService.GetSuppressedCategories(model);var contentContainer=$("#modelDetailContainer");WidgetFrameworkService.CreateWidget({element:contentContainer,widgetConfig:screenWidgetConfig,metadata:null,data:model,parentData:model})}})}}),angular.module("mainApp.models.controllers.ModelListController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.WidgetConfigUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.core.services.WidgetService","mainApp.appCommon.widgets.ModelListTileWidget","mainApp.models.services.ModelService"]).controller("ModelListController",function($scope,ResourceUtility,WidgetConfigUtility,WidgetFrameworkService,WidgetService,ModelService){$scope.ResourceUtility=ResourceUtility,$scope.loading=!0;var widgetConfig=WidgetService.GetApplicationWidgetConfig();if(null!=widgetConfig){var screenWidgetConfig=WidgetConfigUtility.GetWidgetConfig(widgetConfig,"modelListScreenWidget");null!=screenWidgetConfig&&($scope.showNoModels=!1,ModelService.GetAllModels(!0).then(function(result){if($scope.loading=!1,null!=result&&result.success===!0){var modelList=result.resultObj;if(null==modelList||0===modelList.length)$scope.showNoModels=!0;else{var contentContainer=$("#modelListContainer");WidgetFrameworkService.CreateWidget({element:contentContainer,widgetConfig:screenWidgetConfig,metadata:null,data:modelList,parentData:modelList})}}else"NO TENANT FOUND"===result.resultErrors&&($scope.showNoModels=!0)}))}}),angular.module("mainApp.models.modals.AddSegmentModal",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.models.services.ModelService"]).service("AddSegmentService",function(StringUtility){this.GetLowestPriorityAvailable=function(segments){if(null==segments||0===segments.length)return 1;for(var lowestPriority=null,i=0;i<segments.length;i++)null==lowestPriority?lowestPriority=segments[i].Priority+1:segments[i].Priority<=lowestPriority&&(lowestPriority=segments[i].Priority+1);return lowestPriority},this.ValidateSegmentName=function(name,segments){if(StringUtility.IsEmptyString(name))return!1;if(null==segments||0===segments.length)return!0;for(var i=0;i<segments.length;i++){var segmentName=segments[i].Name.trim();if(segmentName.toLowerCase()==name.toLowerCase())return!1}return!0}}).service("AddSegmentModal",function($compile,$rootScope,$http){this.show=function(segments,models,successCallback){$http.get("./app/models/views/AddSegmentView.html").success(function(html){var scope=$rootScope.$new();scope.segments=segments,scope.models=models,scope.successCallback=successCallback;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}).controller("AddSegmentController",function($scope,$rootScope,ResourceUtility,ModelService,AddSegmentService){function addSegment(){ModelService.AddSegment($scope.newSegment).then(function(result){$scope.saveInProgress=!1,result&&result.success===!0?($("#modalContainer").modal("hide"),$scope.successCallback&&$scope.successCallback($scope.newSegment)):($scope.addSegmentErrorMessage=result.resultErrors,$scope.showAddSegmentError=!0)})}$scope.ResourceUtility=ResourceUtility,$scope.saveInProgress=!1,$scope.showAddSegmentError=!1,$scope.addSegmentErrorMessage="";var segments=$scope.segments;$scope.filteredModels=$scope.models;for(var hasEmptyModel=!1,i=0;i<$scope.models.length;i++)if("FAKE_MODEL"==$scope.models[i].Id){hasEmptyModel=!0;break}if(!hasEmptyModel){var emptyModel={Id:"FAKE_MODEL",DisplayName:"Select"};$scope.models.unshift(emptyModel)}$scope.newSegment={Name:null,Priority:AddSegmentService.GetLowestPriorityAvailable(segments),ModelId:null,ModelName:null},$scope.addSegmentClick=function(){$scope.addSegmentErrorMessage="",$scope.showAddSegmentError=!1;var isValid=AddSegmentService.ValidateSegmentName($scope.newSegment.Name,segments);if(isValid){$scope.saveInProgress=!0;var modelId=$(".js-model-select").val(),secondSegment=null;if("FAKE_MODEL"!=modelId){$scope.newSegment.ModelId=modelId,$scope.newSegment.ModelName=$(".js-model-select option:selected").text();for(var i=0;i<segments.length;i++)if(segments[i].ModelId==modelId){secondSegment=$scope.segments[i];break}}null!=secondSegment?(secondSegment.ModelId="FAKE_MODEL",secondSegment.ModelName="",ModelService.UpdateSegment(secondSegment).then(function(result){null!=result&&result.success===!0?addSegment():($scope.saveInProgress=!1,$scope.showAddSegmentError=!0,$scope.addSegmentErrorMessage=ResourceUtility.getString("ACTIVATE_MODEL_UPDATE_SEGMENT_ERROR",[secondSegment.Name]))})):addSegment()}else $scope.addSegmentErrorMessage=ResourceUtility.getString("ACTIVATE_MODEL_ADD_SEGMENT_NAME_ERROR"),$scope.showAddSegmentError=!0},$scope.cancelClick=function(){$("#modalContainer").modal("hide")}}),angular.module("mainApp.models.modals.DeleteModelModal",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.models.services.ModelService","mainApp.core.utilities.NavUtility"]).service("DeleteModelModal",function($compile,$rootScope,$http,ResourceUtility,ModelService){this.show=function(modelId){$http.get("./app/models/views/DeleteModelConfirmView.html").success(function(html){var scope=$rootScope.$new();scope.modelId=modelId;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope),$("#deleteModelError").hide();var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}).controller("DeleteModelController",function($scope,$rootScope,ResourceUtility,NavUtility,ModelService){function updateAsDeletedModel(modelId){$("#deleteModelError").hide(),ModelService.updateAsDeletedModel(modelId).then(function(result){null!=result&&result.success===!0?($("#modalContainer").modal("hide"),$rootScope.$broadcast(NavUtility.MODEL_LIST_NAV_EVENT)):($scope.deleteModelErrorMessage=result.ResultErrors,$("#deleteModelError").fadeIn())})}$scope.ResourceUtility=ResourceUtility,$scope.deleteModelClick=function($event){null!=$event&&$event.preventDefault(),updateAsDeletedModel($scope.modelId)},$scope.cancelClick=function(){$("#modalContainer").modal("hide")}}),angular.module("mainApp.models.modals.ImportModelModal",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.models.services.ModelService","mainApp.core.utilities.NavUtility"]).directive("jsonUploader",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.jsonUploader),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]).controller("jsonUploaderCtrl",["$scope","$rootScope","ModelService","ResourceUtility",function($scope,$rootScope,ModelService,ResourceUtility){$scope.showImportError=!1,$scope.importErrorMsg="",$scope.importing=!1,$scope.showImportSuccess=!1,$scope.ResourceUtility=ResourceUtility;var reader=new FileReader;reader.onload=function(){$scope.$apply(function(){ModelService.uploadRawModelJSON(reader.result).then(function(result){result.Success?$scope.showImportSuccess=!0:($scope.showImportError=!0,$scope.importErrorMsg=ResourceUtility.getString("VALIDATION_ERROR_GENERAL"),console.error(result.ResultErrors)),$scope.importing=!1})})},$scope.uploadFile=function(){$scope.showImportError=!1,$scope.importErrorMsg="",$scope.importing=!0,reader.readAsText($scope.jsonFile)},$scope.okClicked=function(){$("#modalContainer").modal("hide"),$rootScope.$broadcast("ModelCreationHistoryNavEvent")}}]).service("ImportModelModal",function($compile,$rootScope,$http,NavUtility){this.show=function(){$http.get("./app/models/views/ImportModelModalView.html").success(function(html){var scope=$rootScope.$new(),modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty(),$rootScope.$broadcast(NavUtility.MODEL_CREATION_HISTORY_NAV_EVENT)})})}}).controller("ImportModelModalController",function($scope,$rootScope,ResourceUtility,NavUtility,ModelService){$scope.ResourceUtility=ResourceUtility}),angular.module("mainApp.models.modals.StaleModelModal",["mainApp.appCommon.utilities.ResourceUtility"]).service("StaleModelModal",function($compile,$rootScope,$http){this.show=function(modelId){$http.get("./app/models/views/StaleModelConfirmView.html").success(function(html){var scope=$rootScope.$new();scope.modelId=modelId;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}).controller("StaleModelController",function($scope,ResourceUtility){$scope.ResourceUtility=ResourceUtility,$scope.confirmClick=function(){$("#modalContainer").modal("hide")}}),angular.module("mainApp.models.services.ModelService",["mainApp.core.utilities.ServiceErrorUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.appCommon.utilities.StringUtility","mainApp.appCommon.utilities.DateTimeFormatUtility","mainApp.core.services.SessionService","mainApp.appCommon.services.ModelSummaryValidationService"]).service("ModelService",function($http,$q,_,ServiceErrorUtility,ResourceUtility,StringUtility,DateTimeFormatUtility,SessionService,ModelSummaryValidationService){this.GetAllModels=function(isValidOnly){var result,request,deferred=$q.defer();return request={method:"GET",url:"/pls/modelsummaries/",headers:{"Content-Type":"application/json"}},isValidOnly===!1&&(request.url+="?selection=all"),$http(request).success(function(data,status,headers,config){null==data?(result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)):(result={success:!0,resultObj:null,resultErrors:null},data=_.sortBy(data,"ConstructionTime").reverse(),result.resultObj=_.map(data,function(rawObj){return{Id:rawObj.Id,DisplayName:null==rawObj.DisplayName?rawObj.Name:rawObj.DisplayName,CreatedDate:DateTimeFormatUtility.FormatShortDate(rawObj.ConstructionTime),Status:rawObj.Status,Incomplete:rawObj.Incomplete}})),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result=403==status?{success:!0,resultObj:null,resultErrors:null}:{success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}),deferred.promise},this.updateAsDeletedModel=function(modelId){var result,deferred=$q.defer();return $http({method:"PUT",url:"/pls/modelsummaries/"+modelId,headers:{"Content-Type":"application/json"},data:angular.toJson({Status:"UpdateAsDeleted"})}).success(function(data,status,headers,config){data===!0||"true"===data?(result={success:!0,resultObj:{},resultErrors:null},deferred.resolve(result)):result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={Success:!1,ResultErrors:ResourceUtility.getString("MODEL_DELETE_SERVICE_ERROR")},"LEDP_18003"==data.errorCode&&(result.ResultErrors=ResourceUtility.getString("MODEL_DELETE_ACCESS_DENIED")),"LEDP_18021"==data.errorCode&&(result.ResultErrors=ResourceUtility.getString("MODEL_DELETE_ACTIVE_MODEL_ERROR")),deferred.resolve(result)}),deferred.promise},this.undoDeletedModel=function(modelId){var result,deferred=$q.defer();return $http({method:"PUT",url:"/pls/modelsummaries/"+modelId,headers:{"Content-Type":"application/json"},data:angular.toJson({Status:"UpdateAsInactive"})}).success(function(data,status,headers,config){data===!0||"true"===data?(result={success:!0,resultObj:{},resultErrors:null},deferred.resolve(result)):result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={Success:!1,ResultErrors:ResourceUtility.getString("MODEL_LIST_UNDO_DELETE_SERVICE_ERROR")},"LEDP_18003"==data.errorCode&&(result.ResultErrors=ResourceUtility.getString("MODEL_LIST_UNTO_DELETE_ACCESS_DENIED")),deferred.resolve(result)}),deferred.promise},this.GetModelById=function(modelId){var result,deferred=$q.defer();return $http({method:"GET",url:"/pls/modelsummaries/"+modelId,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){if(null==data)result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result);else{result={success:!0,resultObj:{},resultErrors:null};var modelSummary="";StringUtility.IsEmptyString(data.Details.Payload)||(modelSummary=JSON.parse(data.Details.Payload)),modelSummary.ModelDetails.Status=data.Status,modelSummary.ModelDetails.DisplayName=data.DisplayName,modelSummary.ModelDetails.Uploaded=data.Uploaded,result.resultObj=modelSummary}deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}),deferred.promise},this.ChangeModelDisplayName=function(modelId,displayName){var result,deferred=$q.defer();return $http({method:"PUT",url:"/pls/modelsummaries/"+modelId,data:{DisplayName:displayName},headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){null==data?(result={Success:!1,ResultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)):result={Success:!0,ResultErrors:null},deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={Success:!1,ResultErrors:ResourceUtility.getString("MODEL_TILE_EDIT_SERVICE_ERROR")},"LEDP_18003"==data.errorCode&&(result.ResultErrors=ResourceUtility.getString("CHANGE_MODEL_NAME_ACCESS_DENIED")),"LEDP_18014"==data.errorCode&&(result.ResultErrors=ResourceUtility.getString("CHANGE_MODEL_NAME_CONFLICT")),deferred.resolve(result)}),deferred.promise},this.FormatLeadSampleData=function(sampleLeads){if(null==sampleLeads)return null;for(var toReturn=[],i=0;i<sampleLeads.length;i++){var lead=sampleLeads[i],leadToDisplay={Company:lead.Company,Contact:lead.FirstName+" "+lead.LastName,Converted:lead.Converted,Score:lead.Score};toReturn.push(leadToDisplay)}return toReturn},this.validateModelName=function(name){var result={valid:!1,errMsg:null};return""===name.replace(/ /g,"")?(result.errMsg=ResourceUtility.getString("MODEL_TILE_EDIT_TITLE_EMPTY_ERROR"),result):name.length>50?(result.errMsg=ResourceUtility.getString("MODEL_TILE_EDIT_TITLE_LONG_ERROR"),result):(result.valid=!0,result)},this.uploadRawModelJSON=function(json){var deferred=$q.defer(),data={Tenant:{Identifier:"FAKE_TENANT",DisplayName:"Fake Tenant"},RawFile:json},result={Success:!1,ResultErrors:""},errors=ModelSummaryValidationService.ValidateModelSummary(JSON.parse(json));return errors.length>0?(result.ResultErrors=ResourceUtility.getString("MODEL_IMPORT_ERROR_TITLE")+" "+errors.join(", ")+".",deferred.resolve(result),deferred.promise):($http({method:"POST",url:"/pls/modelsummaries?raw=true",data:data,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){result=null==data?{Success:!1,ResultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")}:{Success:!0,ResultErrors:null},deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("MODEL_IMPORT_GENERAL_ERROR")};deferred.resolve(result)}),deferred.promise)},this.GetAllSegments=function(modelList){var result,deferred=$q.defer();return $http({method:"GET",url:"/pls/segments/",headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){if(null==data)result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result);else{result={success:!0,resultObj:{},resultErrors:null};var modelDict={};if(null!=modelList&&modelList.length>0)for(var i=0;i<modelList.length;i++)modelDict[modelList[i].Id]=modelList[i].DisplayName;var segmentList=data;if(null!=segmentList&&segmentList.length>0&&Object.keys(modelDict).length>0)for(var x=0;x<segmentList.length;x++){var segment=segmentList[x];StringUtility.IsEmptyString(segment.ModelId)?segment.ModelId="FAKE_MODEL":segment.ModelName=modelDict[segment.ModelId]}result.resultObj=segmentList}deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}),deferred.promise},this.AddSegment=function(segment){var result,deferred=$q.defer();return null==segment||StringUtility.IsEmptyString(segment.Name)?null:("FAKE_MODEL"==segment.ModelId&&(segment.ModelId=null),$http({method:"POST",url:"/pls/segments/",headers:{"Content-Type":"application/json"},data:segment}).success(function(data,status,headers,config){null==data?(result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)):(result={success:data.Success,resultObj:{},resultErrors:null},result.success===!1&&(result.resultErrors=ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR"))),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}),deferred.promise)},this.DeleteSegment=function(segmentName){var result,deferred=$q.defer();return StringUtility.IsEmptyString(segmentName)?(deferred.resolve(result),deferred.promise):($http({method:"DELETE",url:"/pls/segments/"+segmentName,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){null==data?(result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)):(result={success:data.Success,resultObj:{},resultErrors:null},result.success===!1&&(result.resultErrors=ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR"))),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}),deferred.promise)},this.UpdateSegments=function(segments){var result,deferred=$q.defer();if(null==segments)return deferred.resolve(result),deferred.promise;for(var i=0;i<segments.length;i++)"FAKE_MODEL"==segments[i].ModelId&&(segments[i].ModelId="");return $http({method:"POST",url:"/pls/segments/list",headers:{"Content-Type":"application/json"},data:segments}).success(function(data,status,headers,config){null==data?(result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)):(result={success:data.Success,resultObj:{},resultErrors:null},result.success===!1&&(result.resultErrors=data.Errors[0])),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}),deferred.promise},this.UpdateSegment=function(segment){var result,deferred=$q.defer();return null==segment?(deferred.resolve(result),deferred.promise):("FAKE_MODEL"==segment.ModelId&&(segment.ModelId=null),$http({method:"PUT",url:"/pls/segments/"+segment.Name,headers:{"Content-Type":"application/json"},data:segment}).success(function(data,status,headers,config){null==data?(result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)):(result={success:data.Success,resultObj:{},resultErrors:null},result.success===!1&&(result.resultErrors=ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR"))),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}),deferred.promise)},this.GetModelAlertsByModelId=function(modelId){var result,deferred=$q.defer();return $http({method:"GET",url:"/pls/modelsummaries/alerts/"+modelId,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){null==data?(result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)):result={success:!0,resultObj:data,resultErrors:null},deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status),result={success:!1,resultObj:null,resultErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")},deferred.resolve(result)}),deferred.promise}}),angular.module("mainApp.setup.controllers.CredentialsController",["mainApp.appCommon.directives.ngQtipDirective","mainApp.appCommon.directives.helperMarkDirective","mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.utilities.StringUtility","mainApp.core.utilities.NavUtility","mainApp.config.services.ConfigService","mainApp.setup.services.TenantDeploymentService","mainApp.core.controllers.SalesforceCredentialController"]).service("CredentialsService",function(StringUtility){this.ValidateCredentials=function(type,credentials){if(StringUtility.IsEmptyString(type)||null==credentials)return!1;var isValid=!1;switch(type){case"sfdc":isValid=!StringUtility.IsEmptyString(credentials.UserName)&&!StringUtility.IsEmptyString(credentials.Password);break;case"eloqua":isValid=!StringUtility.IsEmptyString(credentials.UserName)&&!StringUtility.IsEmptyString(credentials.Password)&&!StringUtility.IsEmptyString(credentials.Company);break;case"marketo":isValid=!StringUtility.IsEmptyString(credentials.UserName)&&!StringUtility.IsEmptyString(credentials.Password)&&!StringUtility.IsEmptyString(credentials.Url)}return isValid}}).controller("CredentialsController",function($scope,$rootScope,ResourceUtility,BrowserStorageUtility,NavUtility,ConfigService,TenantDeploymentService,CredentialsService){function Credentials(url,securitytoken,orgid,password,username,company){this.Url=url||null,this.SecurityToken=securitytoken||null,this.OrgId=orgid||null,this.Password=password||null,this.UserName=username||null,this.Company=company||null}function getSFDCCredentials(){ConfigService.GetCurrentCredentials("sfdc",!0).then(function(result){if(null!=result&&result.success===!0){var returned=result.resultObj;$scope.crmProductionCredentials=new Credentials(null,returned.SecurityToken,null,returned.Password,returned.UserName,null),$scope.crmProductionComplete=!0}else $scope.crmProductionCredentials=new Credentials;ConfigService.GetCurrentCredentials("sfdc",!1).then(function(result){if(null!=result&&result.success===!0){var returned=result.resultObj;$scope.crmSandboxCredentials=new Credentials(null,returned.SecurityToken,null,returned.Password,returned.UserName,null),$scope.crmSandboxComplete=!0}else $scope.crmSandboxCredentials=new Credentials})})}function importSfdcData(isProduction){isProduction?$scope.crmProductionSaveInProgress=!0:$scope.crmSandboxSaveInProgress=!0,TenantDeploymentService.ImportSfdcData().then(function(result){result.Success===!0?$rootScope.$broadcast(NavUtility.DEPLOYMENT_WIZARD_NAV_EVENT):isProduction?($scope.crmProductionSaveInProgress=!1,$scope.crmProductionError=result.ResultErrors):($scope.crmSandboxSaveInProgress=!1,
$scope.crmSandboxError=result.ResultErrors)})}$scope.ResourceUtility=ResourceUtility,$scope.loading=!0,$scope.showError=!1,$scope.errorMessage="";var editText=ResourceUtility.getString("BUTTON_EDIT_LABEL"),importText=ResourceUtility.getString("BUTTON_IMPORT_LABEL"),saveAndImportText=ResourceUtility.getString("SETUP_CREDENTIALS_SAVE_IMPORT_BUTTON");$scope.sfdcGuideName=ResourceUtility.getString("SETUP_CREDENTIALS_SF_CONFIGURATION_GUIDE_LABEL"),$scope.logoLeftAlign=!0,$scope.crmProductionComplete=!1,$scope.crmProductionError="",$scope.crmProductionSaveInProgress=!1,$scope.crmProductionSaveButtonText=saveAndImportText,$scope.crmProductionEditButtonText=editText,$scope.crmProductionImportButtonText=importText,$scope.crmSandboxComplete=!1,$scope.crmSandboxError="",$scope.crmSandboxSaveInProgress=!1,$scope.crmSandboxSaveButtonText=saveAndImportText,$scope.crmSandboxEditButtonText=editText,$scope.crmSandboxImportButtonText=importText,ConfigService.GetCurrentTopology().then(function(result){if($scope.loading=!1,result.success===!0)if("string"==typeof result.resultObj&&"marketo"===result.resultObj.toLowerCase()&&($scope.isMarketo=!0),"string"==typeof result.resultObj&&"eloqua"===result.resultObj.toLowerCase()&&($scope.isEloqua=!0),$scope.isMarketo||$scope.isEloqua){var mapType=$scope.isMarketo?"marketo":"eloqua";ConfigService.GetCurrentCredentials(mapType).then(function(result){if(null!=result&&result.success===!0){var returned=result.resultObj;$scope.mapCredentials=new Credentials(returned.Url,returned.SecurityToken,returned.OrgId,returned.Password,returned.UserName,returned.Company),$scope.mapComplete=!0}else $scope.mapCredentials=new Credentials;getSFDCCredentials()})}else getSFDCCredentials();else $scope.showError=!0,$scope.errorMessage=result.resultErrors,getSFDCCredentials()}),$scope.crmProductionSaveAndImportClicked=function(){if($scope.crmProductionError="",CredentialsService.ValidateCredentials("sfdc",$scope.crmProductionCredentials)){if($scope.crmProductionSaveInProgress)return;$scope.crmProductionSaveInProgress=!0,ConfigService.ValidateApiCredentials("sfdc",$scope.crmProductionCredentials,!0).then(function(result){null==result?($scope.crmProductionSaveInProgress=!1,$scope.crmProductionError=ResourceUtility.getString("SYSTEM_ERROR")):result.success===!0?($scope.crmProductionComplete=!0,$scope.crmProductionImportClicked()):($scope.crmProductionSaveInProgress=!1,$scope.crmProductionError=result.resultErrors)})}else $scope.crmProductionError=ResourceUtility.getString("SYSTEM_SETUP_REQUIRED_FIELDS_ERROR")},$scope.crmSandboxSaveAndImportClicked=function(){if($scope.crmSandboxError="",CredentialsService.ValidateCredentials("sfdc",$scope.crmSandboxCredentials)){if($scope.crmSandboxSaveInProgress)return;$scope.crmSandboxSaveInProgress=!0,ConfigService.ValidateApiCredentials("sfdc",$scope.crmSandboxCredentials,!1).then(function(result){null==result?($scope.crmSandboxSaveInProgress=!1,$scope.crmSandboxError=ResourceUtility.getString("SYSTEM_ERROR")):result.success===!0?($scope.crmSandboxComplete=!0,$scope.crmSandboxImportClicked()):($scope.crmSandboxSaveInProgress=!1,$scope.crmSandboxError=result.resultErrors)})}else $scope.crmSandboxError=ResourceUtility.getString("SYSTEM_SETUP_REQUIRED_FIELDS_ERROR")},$scope.crmProductionImportClicked=function(){importSfdcData(!0)},$scope.crmSandboxImportClicked=function(){importSfdcData(!1)}}).directive("credentials",function(){return{templateUrl:"app/setup/views/CredentialsView.html"}}),angular.module("mainApp.setup.controllers.DeploymentWizardController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.NavUtility","mainApp.setup.utilities.SetupUtility","mainApp.setup.controllers.CredentialsController","mainApp.setup.controllers.ImportAndEnrichDataController","mainApp.setup.controllers.ManageFieldsController","mainApp.setup.services.TenantDeploymentService","mainApp.setup.services.MetadataService"]).controller("DeploymentWizardController",function($scope,$rootScope,ResourceUtility,BrowserStorageUtility,SetupUtility,TenantDeploymentService){function Tab(title,active,disabled){var tab={};return tab.title=title,tab.active=active,tab.disabled=disabled,tab}$scope.ResourceUtility=ResourceUtility,null!=BrowserStorageUtility.getClientSession()&&($scope.importTab=new Tab(ResourceUtility.getString("SETUP_DEPLOYMENT_WIZARD_NAV_IMPORT_AND_ENRICH_DATA"),(!1),(!0)),$scope.buildTab=new Tab(ResourceUtility.getString("SETUP_DEPLOYMENT_WIZARD_NAV_BUILD_MODEL"),(!1),(!0)),$scope.publishTab=new Tab(ResourceUtility.getString("SETUP_DEPLOYMENT_WIZARD_NAV_PUBLISH_SCORES"),(!1),(!0)),$scope.tabs=[$scope.importTab,$scope.buildTab,$scope.publishTab],$scope.loading=!0,TenantDeploymentService.GetTenantDeployment().then(function(result){$scope.loading=!1,result.Success?($scope.deployment=result.ResultObj,null==$scope.deployment||$scope.deployment.Step===SetupUtility.STEP_ENTER_CREDENTIALS?($scope.importTab.active=!0,$scope.importTab.disabled=!1,$scope.showEnterCredentials=!0):$scope.deployment.Step!==SetupUtility.STEP_IMPORT_DATA&&$scope.deployment.Step!==SetupUtility.STEP_ENRICH_DATA&&$scope.deployment.Step!==SetupUtility.STEP_VALIDATE_METADATA||($scope.importTab.active=!0,$scope.importTab.disabled=!1,$scope.showImportAndEnrichData=!0)):$scope.getDeploymentError=result.ResultErrors}),$scope.tabClicked=function($event,tab){if(null!=$event&&$event.preventDefault(),!tab.disabled){for(var i=0;i<$scope.tabs.length;i++)$scope.tabs[i].active=!1;tab.active=!0}})}),angular.module("mainApp.setup.controllers.ImportAndEnrichDataController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.DateTimeFormatUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.NavUtility","mainApp.core.services.SessionService","mainApp.core.services.FeatureFlagService","mainApp.setup.utilities.SetupUtility","mainApp.setup.controllers.CancelDeploymentStepModel","mainApp.setup.controllers.ClearDeploymentModel","mainApp.setup.services.TenantDeploymentService"]).controller("ImportAndEnrichDataController",function($scope,$rootScope,$http,$filter,$timeout,ResourceUtility,DateTimeFormatUtility,BrowserStorageUtility,NavUtility,SessionService,FeatureFlagService,SetupUtility,CancelDeploymentStepModel,ClearDeploymentModel,TenantDeploymentService){function initImportDataArea(){var deployment=$scope.deployment;deployment.Step===SetupUtility.STEP_IMPORT_DATA?deployment.Status===SetupUtility.STATUS_IN_PROGRESS?($scope.showImportProgress=!0,startGetObjectsTimer(deployment.Step,deployment.Status)):deployment.Status===SetupUtility.STATUS_SUCCESS?handleImportComplete():deployment.Status===SetupUtility.STATUS_FAIL&&($scope.showImportError=!0,getObjects(deployment.Step,deployment.Status,!1)):handleImportComplete()}function handleImportComplete(){$scope.showImportComplete=!0,TenantDeploymentService.GetImportSfdcDataCompleteTime().then(function(result){if(result.Success===!0)try{$scope.importCompleteTime=DateTimeFormatUtility.FormatDateTime(result.ResultObj,"mm/dd/yy hh:MM:ss TT")}catch(e){$scope.importCompleteTime=ResourceUtility.getString("SETUP_FORMAT_DATE_ERROR")}else $scope.getImportCompleteTimeError=result.ResultErrors;initEnrichDataArea()})}function initEnrichDataArea(){var deployment=$scope.deployment;deployment.Step===SetupUtility.STEP_IMPORT_DATA?($scope.showEnrichProgress=!0,startGetObjectsTimer(SetupUtility.STEP_ENRICH_DATA,SetupUtility.STATUS_IN_PROGRESS)):deployment.Step===SetupUtility.STEP_ENRICH_DATA?deployment.Status===SetupUtility.STATUS_IN_PROGRESS?($scope.showEnrichProgress=!0,startGetObjectsTimer(deployment.Step,deployment.Status)):deployment.Status===SetupUtility.STATUS_SUCCESS?handleEnrichComplete():deployment.Status===SetupUtility.STATUS_FAIL&&($scope.showEnrichError=!0,getDataCompleted()):handleEnrichComplete()}function handleEnrichComplete(){$scope.showEnrichComplete=!0,TenantDeploymentService.GetEnrichDataCompleteTime().then(function(result){if(result.Success===!0)try{$scope.enrichCompleteTime=DateTimeFormatUtility.FormatDateTime(result.ResultObj,"mm/dd/yy hh:MM:ss TT")}catch(e){$scope.enrichCompleteTime=ResourceUtility.getString("SETUP_FORMAT_DATE_ERROR")}else $scope.getEnrichCompleteTimeError=result.ResultErrors;initValidationDataArea()})}function initValidationDataArea(){var deployment=$scope.deployment;deployment.Step===SetupUtility.STEP_VALIDATE_METADATA&&(deployment.Status===SetupUtility.STATUS_SUCCESS?$scope.showValidationComplete=!0:deployment.Status===SetupUtility.STATUS_WARNING?($scope.showValidationError=!0,$scope.missingData=!0):deployment.Status===SetupUtility.STATUS_FAIL&&($scope.showValidationError=!0,$scope.missingData=!1)),getDataCompleted()}function startGetObjectsTimer(step,status){clearTimer(step),getObjects(step,status,!1);var id=window.setInterval(function(){getObjects(step,status,!0)},5e3);setTimer(step,id)}function getObjects(step,status,inTimer){needGetObjects(step,inTimer)&&TenantDeploymentService.GetObjects(step,status).then(function(result){if(result.Success===!0){if(result.ResultObj.LaunchStatus===SetupUtility.STATUS_SUCCESS)return clearTimer(step),$scope.gettingObjects=!1,void $rootScope.$broadcast(NavUtility.DEPLOYMENT_WIZARD_NAV_EVENT);null!=result.ResultObj?step===SetupUtility.STEP_ENRICH_DATA?$scope.enrichProgress=getEnrichProgress(result.ResultObj.Jobs):($scope.tables=getTables(result.ResultObj.Jobs),$scope.getObjectsError=null):inTimer&&clearTimer(step)}else inTimer&&clearTimer(step),step===SetupUtility.STEP_ENRICH_DATA?$scope.enrichProgress=result.ResultErrors:($scope.getObjectsError=result.ResultErrors,$scope.tables=null);inTimer?$scope.gettingObjects=!1:getDataCompleted()})}function needGetObjects(step,inTimer){if(!pageExists())return inTimer&&(clearTimer(step),$scope.gettingObjects=!1),!1;if(inTimer){if($scope.gettingObjects===!0)return!1;$scope.gettingObjects=!0}return!0}function getDataCompleted(){if($scope.loading){$scope.loading=!1;var flags=FeatureFlagService.Flags();FeatureFlagService.FlagIsEnabled(flags.ADMIN_PAGE)&&($scope.showClearDeploymentLink=!0,$scope.disableClearDeploymentLink=$scope.deployment.Status===SetupUtility.STATUS_IN_PROGRESS)}}function getTables(jobs){if(null==jobs||0===jobs.length)return null;for(var tables=[],i=0;i<jobs.length;i++){var table={name:jobs[i].TableName,info:""};jobs[i].Status===SetupUtility.STATUS_SUCCESS?table.info=$filter("number")(jobs[i].ExtractedRows):jobs[i].Status===SetupUtility.STATUS_IN_PROCESS&&jobs[i].ExtractedRows>0&&(table.info=$filter("number")(jobs[i].ExtractedRows),jobs[i].TotalRows>0&&(table.info+=$scope.ofText+$filter("number")(jobs[i].TotalRows))),tables.push(table)}return tables}function getEnrichProgress(jobs){if(null==jobs||0===jobs.length)return ResourceUtility.getString("SETUP_ENRICH_DATA_DEFAULT_PROGRESS_LABEL");var job=jobs[jobs.length-1];if(job.ExtractedRows>0&&job.TotalRows>0){var extractRows=$filter("number")(job.ExtractedRows),totalRows=$filter("number")(job.TotalRows);return extractRows+$scope.ofText+totalRows+" "+$scope.leadsText}return ResourceUtility.getString("SETUP_ENRICH_DATA_DEFAULT_PROGRESS_LABEL")}function runQuery(link){if(!link.hasClass("disabled")){link.addClass("disabled");var step=link.attr("step");updateStatusLabelInProgress(step,ResourceUtility.getString("SETUP_RUN_QUERY_PROGRESS_LABEL")),TenantDeploymentService.RunQuery(step).then(function(result){result.Success===!0?startGetQueryStatusTimer(link,result.ResultObj):(link.removeClass("disabled"),updateStatusLabelFail(step,result.ResultErrors))})}}function startGetQueryStatusTimer(link,queryHandle){var step=link.attr("step");clearTimer(step);var id=window.setInterval(function(){getQueryStatus(link,queryHandle)},5e3);setTimer(step,id)}function getQueryStatus(link,queryHandle){var step=link.attr("step");needGetQueryStatus(step)&&TenantDeploymentService.GetQueryStatus(queryHandle).then(function(result){if(result.Success===!0){var obj=result.ResultObj;3===obj.Status?(clearTimer(step),$http.get(link.attr("url")+"/"+queryHandle).then(function(response){link.removeClass("disabled"),step===SetupUtility.STEP_IMPORT_DATA?$scope.importInfo=null:step===SetupUtility.STEP_ENRICH_DATA&&($scope.enrichInfo=null);var file=new Blob([response.data],{type:link.attr("filetype")});saveAs(file,link.attr("filename"))},function(response){SessionService.HandleResponseErrors(response.data,response.status),link.removeClass("disabled"),updateStatusLabelFail(step,ResourceUtility.getString("SETUP_DOWNLOAD_QUERY_DATA_ERROR",[link.attr("filename")]))})):obj.Status>3&&(clearTimer(step),link.removeClass("disabled"),updateStatusLabelFail(step,ResourceUtility.getString("SETUP_RUN_QUERY_ERROR")))}else clearTimer(step),link.removeClass("disabled"),updateStatusLabelFail(step,result.ResultErrors);$scope.gettingQueryStatus=!1})}function needGetQueryStatus(step){return pageExists()?$scope.gettingQueryStatus!==!0&&($scope.gettingQueryStatus=!0,!0):(clearTimer(step),$scope.gettingQueryStatus=!1,!1)}function pageExists(){return $("#importAndEnrichData").length>0}function clearTimer(step){step===SetupUtility.STEP_IMPORT_DATA?null!=$scope.importTimerId&&(window.clearInterval($scope.importTimerId),$scope.importTimerId=null):step===SetupUtility.STEP_ENRICH_DATA&&null!=$scope.enrichTimerId&&(window.clearInterval($scope.enrichTimerId),$scope.enrichTimerId=null)}function setTimer(step,id){step===SetupUtility.STEP_IMPORT_DATA?$scope.importTimerId=id:step===SetupUtility.STEP_ENRICH_DATA&&($scope.enrichTimerId=id)}function updateStatusLabelInProgress(step,message){updateStatusLabel(step,SetupUtility.STATUS_IN_PROGRESS,message)}function updateStatusLabelSuccess(step,message){updateStatusLabel(step,SetupUtility.STATUS_SUCCESS,message)}function updateStatusLabelFail(step,message){updateStatusLabel(step,SetupUtility.STATUS_FAIL,message)}function updateStatusLabel(step,status,message){step===SetupUtility.STEP_IMPORT_DATA?($scope.importStatus=status,$scope.importInfo=message,status===SetupUtility.STATUS_SUCCESS&&$timeout(function(){$scope.importInfo=null},5e3)):step===SetupUtility.STEP_ENRICH_DATA?($scope.enrichStatus=status,$scope.enrichInfo=message,status===SetupUtility.STATUS_SUCCESS&&$timeout(function(){$scope.enrichInfo=null},5e3)):step===SetupUtility.STEP_VALIDATE_METADATA&&($scope.validationStatus=status,$scope.validationInfo=message,status===SetupUtility.STATUS_SUCCESS&&$timeout(function(){$scope.validationInfo=null},5e3))}$scope.ResourceUtility=ResourceUtility,$scope.SetupUtility=SetupUtility,null!=BrowserStorageUtility.getClientSession()&&($scope.loading=!0,initImportDataArea(),$scope.ofText=ResourceUtility.getString("SETUP_CONJUNCTION_OF"),$scope.leadsText=ResourceUtility.getString("SETUP_LEADS"),$scope.retryImportDataClicked=function($event){null!=$event&&$event.preventDefault(),$scope.loading=!0,TenantDeploymentService.ImportSfdcData().then(function(result){result.Success===!0?$rootScope.$broadcast(NavUtility.DEPLOYMENT_WIZARD_NAV_EVENT):(updateStatusLabelFail(SetupUtility.STEP_IMPORT_DATA,result.ResultErrors),$scope.loading=!1)})},$scope.retryEnrichDataClicked=function($event){null!=$event&&$event.preventDefault(),$scope.loading=!0,TenantDeploymentService.EnrichData().then(function(result){result.Success===!0?$rootScope.$broadcast(NavUtility.DEPLOYMENT_WIZARD_NAV_EVENT):(updateStatusLabelFail(SetupUtility.STEP_ENRICH_DATA,result.ResultErrors),$scope.loading=!1)})},$scope.retryValidationDataClicked=function($event){null!=$event&&$event.preventDefault(),$scope.loading=!0,TenantDeploymentService.ValidateMetadata().then(function(result){result.Success===!0?$rootScope.$broadcast(NavUtility.DEPLOYMENT_WIZARD_NAV_EVENT):(updateStatusLabelFail(SetupUtility.VALIDATE_METADATA,result.ResultErrors),$scope.loading=!1)})},$scope.cancelClicked=function($event){null!=$event&&$event.preventDefault();var link=$($event.currentTarget);link.hasClass("disabled")||CancelDeploymentStepModel.show($scope,link)},$scope.cancelStep=function(link){link.addClass("disabled");var step=link.attr("step");updateStatusLabelInProgress(step,ResourceUtility.getString("SETUP_CANCEL_PROGRESS_LABEL")),TenantDeploymentService.CancelLaunch().then(function(result){result.Success===!0?updateStatusLabelSuccess(step,ResourceUtility.getString("SETUP_CANCEL_SUBMITTED_LABEL")):updateStatusLabelFail(step,result.ResultErrors),link.removeClass("disabled")})},$scope.downloadLinkClicked=function($event){null!=$event&&$event.preventDefault(),runQuery($($event.currentTarget))},$scope.finishDeploymentBtnClicked=function($event){null!=$event&&$event.preventDefault(),$rootScope.$broadcast(NavUtility.MODEL_LIST_NAV_EVENT)},$scope.clearDeploymentLinkClicked=function($event){null!=$event&&$event.preventDefault(),$scope.disableClearDeploymentLink||ClearDeploymentModel.show()})}).directive("importAndEnrichData",function(){return{scope:{deployment:"="},templateUrl:"app/setup/views/ImportAndEnrichDataView.html"}}),angular.module("mainApp.setup.controllers.LeadEnrichmentController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.NavUtility","mainApp.core.services.SessionService","mainApp.setup.controllers.LeadEnrichmentAttributesDetailsModel","mainApp.setup.controllers.SaveAttributesModel","mainApp.setup.services.LeadEnrichmentService"]).controller("LeadEnrichmentController",function($scope,$rootScope,$http,_,ResourceUtility,BrowserStorageUtility,NavUtility,SessionService,LeadEnrichmentAttributesDetailsModel,SaveAttributesModel,LeadEnrichmentService){function load(showSavingConfirmation){initialize(),LeadEnrichmentService.GetAvariableAttributes().then(function(avariableAttributesData){return avariableAttributesData.Success?void LeadEnrichmentService.GetAttributes().then(function(savedAttributesData){return savedAttributesData.Success?void LeadEnrichmentService.GetPremiumAttributesLimitation().then(function(premiumAttributesLimitationData){if(!premiumAttributesLimitationData.Success)return void handleLoadError(premiumAttributesLimitationData);for(var availableAttributes=[],selectedAttributes=[],savedAttributes=savedAttributesData.ResultObj,allAvariableAttributes=avariableAttributesData.ResultObj,i=0;i<allAvariableAttributes.length;i++){var attr=allAvariableAttributes[i];null!=getAttribute(savedAttributes,attr.FieldName)?selectedAttributes.push(attr):availableAttributes.push(attr)}if($scope.allAvariableAttributes=sortAttributes(allAvariableAttributes),$scope.availableAttributes=sortAttributes(availableAttributes),$scope.selectedAttributes=sortAttributes(selectedAttributes),$scope.premiumAttributesLimitation=premiumAttributesLimitationData.ResultObj,showSavingConfirmation){$scope.showAttributesDetails=!0;var title=ResourceUtility.getString("LEAD_ENRICHMENT_SETUP_SAVED_ATTRIBUTES_TITLE");LeadEnrichmentAttributesDetailsModel.show($scope,title,$scope.selectedAttributes)}$scope.loading=!1}):void handleLoadError(savedAttributesData)}):void handleLoadError(avariableAttributesData)})}function initialize(){$scope.loading=!0,$scope.showLoadingError=!1,$scope.saveInProgress=!1,$scope.showSaveAttributesError=!1,$scope.showAttributesDetails=!1,$scope.showAttributesExcessAlert=!1,$scope.attributesToAdd=[],$scope.ctrlAttributesToAdd=[],$scope.attributesToRemove=[],$scope.ctrlAttributesToRemove=[],$scope.selectedAttributes=[],$scope.leadEnrichment=$("#leadEnrichment"),$scope.attributeHover=$("#leadEnrichmentAttributeHover")}function handleLoadError(data){$scope.loadingError=data.ResultErrors,$scope.showLoadingError=!0,$scope.loading=!1}function documentMouseUp(){$scope.selectionStartItem=null,$(document).unbind("mouseup",documentMouseUp)}function removeAttributes(attributes,attributesToRemove){for(var removedAttributes=[],i=0;i<attributesToRemove.length;i++){var attrToRemove=getAttribute(attributes,attributesToRemove[i]);null!=attrToRemove&&removedAttributes.push(attrToRemove)}for(var remainingAttributes=[],j=0;j<attributes.length;j++){var attr=attributes[j];_.indexOf(attributesToRemove,attr.FieldName)===-1&&remainingAttributes.push(attr)}return{removedAttributes:removedAttributes,remainingAttributes:remainingAttributes}}function getAttribute(attributes,fieldName){return _.findWhere(attributes,{FieldName:fieldName})}function sortAttributes(attributes){return _.sortBy(attributes,"DisplayName")}function getFieldName(attributeItem){return attributeItem.attr("fn")}function showAttributeHover(target,$event){$scope.attributeHoverTimeout=setTimeout(function(){var offset=target.offset();if(!(offset.top<=0)){var container=$scope.leadEnrichment,top=offset.top+target.height()+container.scrollTop()-container.position().top+10;if(!(top<=0)){var hover=$scope.attributeHover;hover[0].style.opacity=0,hover.removeClass("hide"),hover.css("top",top);var left=$event.pageX+container.scrollLeft()-parseInt(hover.width()/3),minLeft=offset.left+20;left<minLeft&&(left=minLeft),hover.css("left",left),hover[0].style.opacity=1}}},400)}function hideAttributeHover(){$scope.attributeHoverTimeout&&clearTimeout($scope.attributeHoverTimeout),$scope.attributeHover.addClass("hide")}function verifyLimitiation(attributes){var source="HGData",limit=$scope.premiumAttributesLimitation,hgDataAttrs=_.filter(attributes,function(attr){return attr.DataSource.indexOf(source)>-1});return!(hgDataAttrs.length>limit)||($scope.attributesExcessAlert=ResourceUtility.getString("LEAD_ENRICHMENT_LIMITATION_EXCESS_ATTRIBUTES_ALERT",[hgDataAttrs.length,limit]),$scope.showAttributesExcessAlert=!0,!1)}$scope.ResourceUtility=ResourceUtility,$scope.validateFields=!0,null!=BrowserStorageUtility.getClientSession()&&(load(!1),$scope.showAllAttributes=function($event){null!=$event&&$event.preventDefault(),$scope.showAttributesDetails=!0;var title=ResourceUtility.getString("LEAD_ENRICHMENT_SETUP_ALL_ATTRIBUTES_TITLE");LeadEnrichmentAttributesDetailsModel.show($scope,title,$scope.allAvariableAttributes)},$scope.selectedAttributesLabelMouseLeave=function($event){hideAttributeHover()},$scope.addAttributeButtonClicked=function($event){if(null!=$event&&$event.preventDefault(),!$("#addLeadEnrichmentAttribute").hasClass("disabled")&&$scope.attributesToAdd.length>0){var obj=removeAttributes($scope.availableAttributes,$scope.attributesToAdd);$scope.availableAttributes=sortAttributes(obj.remainingAttributes),$scope.selectedAttributes=sortAttributes($scope.selectedAttributes.concat(obj.removedAttributes)),$scope.attributesToAdd=[],$scope.ctrlAttributesToAdd=[]}},$scope.removeAttributeButtonClicked=function($event){if(null!=$event&&$event.preventDefault(),$scope.attributesToRemove.length>0){$scope.showAttributesExcessAlert=!1,$("#leadEnrichmentAttributeHover").addClass("hide");var obj=removeAttributes($scope.selectedAttributes,$scope.attributesToRemove);$scope.availableAttributes=sortAttributes($scope.availableAttributes.concat(obj.removedAttributes)),$scope.selectedAttributes=sortAttributes(obj.remainingAttributes),$scope.attributesToRemove=[],$scope.ctrlAttributesToRemove=[]}},$scope.attributeItemMouseDown=function($event,isAvailableAttribute){if(3!==$event.which){null!=$event&&$event.preventDefault();var currentItem=$($event.currentTarget),fieldName=getFieldName(currentItem);if(currentItem.addClass("selected"),$event.ctrlKey){var attributes=(currentItem.index(),isAvailableAttribute?$scope.attributesToAdd:$scope.attributesToRemove);attributes.indexOf(fieldName)===-1&&attributes.push(fieldName);var ctrlAttributes=isAvailableAttribute?$scope.ctrlAttributesToAdd:$scope.ctrlAttributesToRemove;if(0===ctrlAttributes.length)for(var i=0;i<attributes.length;i++)ctrlAttributes.push(attributes[i]);else ctrlAttributes.indexOf(fieldName)===-1&&ctrlAttributes.push(fieldName)}else currentItem.siblings().removeClass("selected"),isAvailableAttribute?($scope.attributesToAdd=[fieldName],$scope.ctrlAttributesToAdd=[]):($scope.attributesToRemove=[fieldName],$scope.ctrlAttributesToRemove=[]);null==$scope.selectionStartItem&&($scope.selectionStartItem=currentItem,$(document).mouseup(documentMouseUp))}},$scope.attributeItemMouseEnter=function($event,isAvailableAttribute){null!=$event&&$event.preventDefault();var currentItem=$($event.currentTarget);if(null!=$scope.selectionStartItem){var list=currentItem.parent();if(list.attr("id")===$scope.selectionStartItem.parent().attr("id")){var startIndex=$scope.selectionStartItem.index(),endIndex=currentItem.index();if(startIndex>endIndex){var temp=endIndex;endIndex=startIndex,startIndex=temp}var selectedItems=[],allItems=list.find("li"),ctrlAttributes=isAvailableAttribute?$scope.ctrlAttributesToAdd:$scope.ctrlAttributesToRemove;allItems.each(function(index){var item=$(this);if(index>=startIndex&&index<=endIndex)selectedItems.push(getFieldName(item)),item.addClass("selected");else{var fieldName=getFieldName(item);ctrlAttributes.indexOf(fieldName)>-1?(selectedItems.push(fieldName),item.addClass("selected")):item.removeClass("selected")}}),isAvailableAttribute?$scope.attributesToAdd=selectedItems:$scope.attributesToRemove=selectedItems}}else{var attributes=isAvailableAttribute?$scope.availableAttributes:$scope.selectedAttributes,attr=getAttribute(attributes,getFieldName(currentItem));null!=attr&&null!=attr.Description&&attr.Description.length>0&&($scope.tooltip=attr.Description,showAttributeHover(currentItem,$event))}},$scope.attributeItemMouseLeave=function($event){null!=$event&&$event.preventDefault(),hideAttributeHover()},$scope.saveAttributesButtonClicked=function($event){null!=$event&&$event.preventDefault(),$scope.showSaveAttributesError=!1;for(var attributes=[],i=0;i<$scope.selectedAttributes.length;i++){var attribute=$scope.selectedAttributes[i];attributes[i]={FieldName:attribute.FieldName,DataSource:attribute.DataSource}}verifyLimitiation(attributes)&&SaveAttributesModel.show($scope,attributes)},$scope.saveAttributes=function(attributes){$scope.saveInProgress=!0,LeadEnrichmentService.SaveAttributes(attributes).then(function(data){data.Success?($scope.saveInProgress=!1,load(!0)):($scope.saveAttributessErrorMessage=data.ResultErrors,$scope.showSaveAttributesError=!0,$scope.saveInProgress=!1)})},$scope.setAttributesDetails=function(value){$scope.showAttributesDetails=value})}),angular.module("mainApp.setup.controllers.ManageFieldsController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.RightsUtility","mainApp.core.utilities.NavUtility","mainApp.appCommon.utilities.WidgetConfigUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.core.services.WidgetService"]).controller("ManageFieldsController",function($scope,$timeout,ResourceUtility,BrowserStorageUtility,RightsUtility,NavUtility,WidgetConfigUtility,WidgetFrameworkService,WidgetService){if($scope.ResourceUtility=ResourceUtility,null!=BrowserStorageUtility.getClientSession()){var widgetConfig=WidgetService.GetApplicationWidgetConfig();if(null!=widgetConfig){var screenWidgetConfig=WidgetConfigUtility.GetWidgetConfig(widgetConfig,"manageFieldsScreenWidget");if(null!=screenWidgetConfig){var contentContainer=$("#manageFieldsContainer");WidgetFrameworkService.CreateWidget({element:contentContainer,widgetConfig:screenWidgetConfig,metadata:null,data:null,parentData:null})}}}}).directive("manageFields",function(){return{templateUrl:"app/setup/views/ManageFieldsView.html"}}),angular.module("mainApp.setup.controllers.SetupController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.RightsUtility","mainApp.core.utilities.NavUtility","mainApp.appCommon.utilities.WidgetConfigUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.core.services.WidgetService","mainApp.setup.controllers.ManageFieldsController","mainApp.setup.services.MetadataService"]).controller("SetupController",function($scope,$http,$rootScope,$compile,ResourceUtility,BrowserStorageUtility,RightsUtility,NavUtility,WidgetConfigUtility,WidgetFrameworkService,WidgetService){$scope.ResourceUtility=ResourceUtility,null==BrowserStorageUtility.getClientSession()}),angular.module("mainApp.setup.controllers.CancelDeploymentStepModel",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.setup.utilities.SetupUtility"]).service("CancelDeploymentStepModel",function($compile,$rootScope,$http,ResourceUtility){this.show=function($parentScope,link){$http.get("./app/setup/views/CancelDeploymentStepConfirmView.html").success(function(html){var scope=$rootScope.$new();scope.parentScope=$parentScope,scope.link=link;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}).controller("CancelDeploymentStepController",function($scope,$rootScope,ResourceUtility,SetupUtility){$scope.ResourceUtility=ResourceUtility;var step=$scope.link.attr("step");step===SetupUtility.STEP_IMPORT_DATA?$scope.confirmContent=ResourceUtility.getString("SETUP_CANCEL_IMPORT_SFDC_DATA_LABEL"):step===SetupUtility.STEP_ENRICH_DATA&&($scope.confirmContent=ResourceUtility.getString("SETUP_CANCEL_ENRICH_DATA_LABEL")),$scope.yesClicked=function($event){null!=$event&&$event.preventDefault(),$scope.parentScope.cancelStep($scope.link),$("#modalContainer").modal("hide")},$scope.noClicked=function(){$("#modalContainer").modal("hide")}}),angular.module("mainApp.setup.controllers.ClearDeploymentModel",["mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.NavUtility","mainApp.setup.services.TenantDeploymentService"]).service("ClearDeploymentModel",function($compile,$rootScope,$http){this.show=function(){$http.get("./app/setup/views/ClearDeploymentConfirmView.html").success(function(html){var modalElement=$("#modalContainer"),scope=$rootScope.$new();$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}).controller("ClearDeploymentController",function($scope,$rootScope,ResourceUtility,NavUtility,TenantDeploymentService){$scope.ResourceUtility=ResourceUtility,$scope.clearInProgress=!1,$scope.yesClicked=function($event){null!=$event&&$event.preventDefault(),$scope.clearInProgress||($scope.clearInProgress=!0,$scope.showClearError=!1,TenantDeploymentService.DeleteTenantDeployment().then(function(result){result.Success===!0?($("#modalContainer").modal("hide"),$rootScope.$broadcast(NavUtility.DEPLOYMENT_WIZARD_NAV_EVENT)):($rootScope.clearErrorMessage=result.ResultErrors,$scope.showClearError=!0),$scope.clearInProgress=!1}))},$scope.noClicked=function(){$("#modalContainer").modal("hide")}}),angular.module("mainApp.setup.controllers.DiscardEditFieldsModel",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.setup.utilities.SetupUtility"]).service("DiscardEditFieldsModel",function($compile,$rootScope,$http,ResourceUtility){this.show=function($manageFieldsScope){$http.get("./app/setup/views/DiscardEditFieldsView.html").success(function(html){var scope=$rootScope.$new();scope.manageFieldsScope=$manageFieldsScope;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}).controller("DiscardEditFieldsController",function($scope,$rootScope,ResourceUtility,SetupUtility,ModelService){$scope.ResourceUtility=ResourceUtility,$scope.yesClicked=function($event){null!=$event&&$event.preventDefault(),$scope.manageFieldsScope.discardChanges(),$("#modalContainer").modal("hide")},$scope.noClicked=function(){$("#modalContainer").modal("hide")}}),angular.module("mainApp.setup.modals.EditFieldModel",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.setup.utilities.SetupUtility","mainApp.setup.services.MetadataService"]).service("EditFieldModel",function($compile,$rootScope,$http){
this.show=function(fieldToBeEdited,$manageFieldsScope){$http.get("./app/setup/views/EditFieldView.html").success(function(html){var scope=$manageFieldsScope.$new();scope.field=angular.copy(fieldToBeEdited),scope.manageFieldsScope=$manageFieldsScope;var contentContainer=$("#fieldDetails");$compile(contentContainer.html(html))(scope)})}}).controller("EditFieldController",function($scope,ResourceUtility,BrowserStorageUtility,StringUtility,SetupUtility,MetadataService){$scope.manageFieldsScope.showFieldDetails=!0,$scope.ResourceUtility=ResourceUtility,$scope.saveInProgress=!1,$scope.approvedUsagesToSelect=$scope.$parent.ApprovedUsageOptions,$scope.categoriesToSelect=$scope.$parent.CategoryOptions,$scope.fundamentalTypesToSelect=$scope.$parent.FundamentalTypeOptions,$scope.statisticalTypesToSelect=$scope.$parent.StatisticalTypeOptions,$scope.categoryEditable=$scope.$parent.categoryEditable($scope.field),$scope.saveClicked=function($event){null!=$event&&$event.preventDefault(),$scope.saveInProgress||($scope.saveInProgress=!0,$scope.showEditFieldError=!1,MetadataService.UpdateField($scope.field).then(function(result){result.Success?($scope.saveInProgress=!1,$scope.manageFieldsScope.showFieldDetails=!1,$scope.$emit(SetupUtility.LOAD_FIELDS_EVENT)):($scope.editFieldErrorMessage=result.ResultErrors,$scope.showEditFieldError=!0,$scope.saveInProgress=!1)}))},$scope.cancelClicked=function($event){null!=$event&&$event.preventDefault(),$scope.saveInProgress||($scope.showEditFieldError=!1,$scope.manageFieldsScope.showFieldDetails=!1)}}),angular.module("mainApp.setup.controllers.LeadEnrichmentAttributesDetailsModel",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.NavUtility","mainApp.core.services.SessionService","mainApp.setup.services.LeadEnrichmentService"]).service("LeadEnrichmentAttributesDetailsModel",function($compile,$rootScope,$http){this.show=function($parentScope,title,attributes){$http.get("./app/setup/views/LeadEnrichmentAttributesDetailsView.html").success(function(html){var scope=$parentScope.$new();scope.title=title,scope.originalAttributes=attributes,scope.hasAttributes=null!=attributes&&attributes.length>0;var contentContainer=$("#leadEnrichmentAttributesDetails");$compile(contentContainer.html(html))(scope)})}}).controller("LeadEnrichmentAttributesDetailsController",function($scope,$rootScope,$http,_,ResourceUtility,BrowserStorageUtility,NavUtility,SessionService,ConfigService,LeadEnrichmentService){function generateAttributes(templateType){for(var attributes=[$scope.originalAttributes.length],i=0;i<$scope.originalAttributes.length;i++){var attribute={},originalAttribute=$scope.originalAttributes[i];attribute.name=originalAttribute.DisplayName,attribute.dataSource=originalAttribute.DataSource,attribute.fieldName="Lattice_"+originalAttribute.FieldNameInTarget,attribute.fieldType=convertFieldType(templateType,originalAttribute.FieldType),attributes[i]=attribute}$scope.attributes=attributes}function convertFieldType(templateType,fieldType){var dataType=fieldType;if(null!=dataType){var dataTypeUpperCase=dataType.toUpperCase();null!=templateType&&"MKTO"===templateType.toUpperCase()?dataTypeUpperCase.indexOf("NVARCHAR")>-1?dataType=dataType.replace(/NVARCHAR/i,"String"):dataTypeUpperCase.indexOf("VARCHAR")>-1?dataType=dataType.replace(/VARCHAR/i,"String"):dataTypeUpperCase.indexOf("FLOAT")>-1?dataType="Float":"INT"===dataTypeUpperCase&&(dataType="Integer"):dataTypeUpperCase.indexOf("NVARCHAR")>-1?dataType=dataType.replace(/NVARCHAR/i,"Text"):dataTypeUpperCase.indexOf("VARCHAR")>-1?dataType=dataType.replace(/VARCHAR/i,"Text"):(dataTypeUpperCase.indexOf("FLOAT")>-1||"INT"===dataTypeUpperCase)&&(dataType="Number")}return dataType}if($scope.ResourceUtility=ResourceUtility,$scope.hasAttributes){var templateType=$("#leadEnrichmentAttributesDetails").attr("templatetype");null!=templateType&&""!==templateType?generateAttributes(templateType):($scope.loading=!0,LeadEnrichmentService.GetTemplateType().then(function(result){result.Success===!0?($("#leadEnrichmentAttributesDetails").attr("templatetype",result.ResultObj),generateAttributes(result.ResultObj)):($scope.showLoadingError=!0,$scope.loadingError=result.ResultErrors),$scope.loading=!1}))}$scope.backButtonClicked=function($event){null!=$event&&$event.preventDefault(),$scope.attributes=null,$scope.originalAttributes=null,$scope.$parent.setAttributesDetails(!1)}}),angular.module("mainApp.setup.controllers.SaveAttributesModel",["mainApp.appCommon.utilities.ResourceUtility","mainApp.setup.services.LeadEnrichmentService"]).service("SaveAttributesModel",function($compile,$http){this.show=function($parentScope,attributes){$http.get("./app/setup/views/SaveAttributesConfirmView.html").success(function(html){var scope=$parentScope.$new();scope.attributes=attributes,scope.validateFields=scope.$parent.validateFields;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}).controller("SaveAttributesController",function($scope,_,ResourceUtility,LeadEnrichmentService){$scope.ResourceUtility=ResourceUtility,$scope.yesClicked=function($event){null!=$event&&$event.preventDefault(),$scope.errorMessage=null,$scope.tables=null,$scope.validateFields?($scope.verifyInProgress=!0,LeadEnrichmentService.VerifyAttributes($scope.attributes).then(function(data){if(data.Success){var resultTables=data.ResultObj;if(0===resultTables.length)$scope.$parent.saveAttributes($scope.attributes),$("#modalContainer").modal("hide");else{for(var tables=[resultTables.length],i=0;i<resultTables.length;i++){for(var resultTable=resultTables[i],invalidFields=[],j=0;j<resultTable.invalidFields.length;j++){var attr=_.findWhere($scope.$parent.selectedAttributes,{FieldName:resultTable.invalidFields[j]});null!=attr&&invalidFields.push("Lattice_"+attr.FieldNameInTarget)}tables[i]={tableName:resultTable.tableName,invalidFields:invalidFields}}$scope.tables=tables,$scope.verifyInProgress=!1}}else $scope.errorMessage=data.ResultErrors,$scope.verifyInProgress=!1})):($scope.$parent.saveAttributes($scope.attributes),$("#modalContainer").modal("hide"))},$scope.noClicked=function(){$("#modalContainer").modal("hide")}}),angular.module("mainApp.setup.services.LeadEnrichmentService",["mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.RightsUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.core.services.SessionService"]).service("LeadEnrichmentService",function($http,$q,BrowserStorageUtility,RightsUtility,ResourceUtility,SessionService){this.GetAvariableAttributes=function(){var deferred=$q.defer();return $http({method:"GET",url:"/pls/leadenrichment/avariableattributes?"+(new Date).getTime(),headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};null!=data?(result.Success=!0,result.ResultObj=data):result.ResultErrors=ResourceUtility.getString("LEAD_ENRICHMENT_GET_AVAILABLE_ATTRIBUTES_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("LEAD_ENRICHMENT_GET_AVAILABLE_ATTRIBUTES_ERROR")};deferred.resolve(result)}),deferred.promise},this.GetAttributes=function(){var deferred=$q.defer();return $http({method:"GET",url:"/pls/leadenrichment/attributes?"+(new Date).getTime(),headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};null!=data?(result.Success=!0,result.ResultObj=data):result.ResultErrors=ResourceUtility.getString("LEAD_ENRICHMENT_GET_SELECTED_ATTRIBUTES_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("LEAD_ENRICHMENT_GET_SELECTED_ATTRIBUTES_ERROR")};deferred.resolve(result)}),deferred.promise},this.VerifyAttributes=function(attributes){var deferred=$q.defer();return $http({method:"POST",url:"/pls/leadenrichment/verifyattributes",headers:{"Content-Type":"application/json"},data:attributes}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};if(null!=data){result.Success=!0;var tables=[];for(var table in data){var obj={tableName:table,invalidFields:data[table]};tables.push(obj)}result.ResultObj=tables}else result.ResultErrors=ResourceUtility.getString("LEAD_ENRICHMENT_VERIFY_ATTRIBUTES_ERROR");deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("LEAD_ENRICHMENT_VERIFY_ATTRIBUTES_ERROR")};deferred.resolve(result)}),deferred.promise},this.SaveAttributes=function(attributes){var deferred=$q.defer();return $http({method:"PUT",url:"/pls/leadenrichment/attributes",headers:{"Content-Type":"application/json"},data:attributes}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data===!0||"true"===data?result.Success=!0:result.ResultErrors=ResourceUtility.getString("LEAD_ENRICHMENT_SAVE_SELECTED_ATTRIBUTES_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("LEAD_ENRICHMENT_SAVE_SELECTED_ATTRIBUTES_ERROR")};deferred.resolve(result)}),deferred.promise},this.GetTemplateType=function(){var deferred=$q.defer();return $http({method:"GET",url:"/pls/leadenrichment/templatetype?"+(new Date).getTime(),headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};null!=data?(result.Success=!0,result.ResultObj=data):result.ResultErrors=ResourceUtility.getString("LEAD_ENRICHMENT_GET_TEMPLATE_TYPE_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("LEAD_ENRICHMENT_GET_TEMPLATE_TYPE_ERROR")};deferred.resolve(result)}),deferred.promise},this.GetPremiumAttributesLimitation=function(){var deferred=$q.defer();return $http({method:"GET",url:"/pls/leadenrichment/premiumattributeslimitation?"+(new Date).getTime(),headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};null!=data?(result.Success=!0,result.ResultObj=data):result.ResultErrors=ResourceUtility.getString("LEAD_ENRICHMENT_GET_PREMIUM_ATTRIBUTES_LIMITATION_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("LEAD_ENRICHMENT_GET_PREMIUM_ATTRIBUTES_LIMITATION_ERROR")};deferred.resolve(result)}),deferred.promise}}),angular.module("mainApp.setup.services.MetadataService",["mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.RightsUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.core.services.SessionService"]).service("MetadataService",function($http,$q,_,BrowserStorageUtility,RightsUtility,ResourceUtility,SessionService){this.GetOptions=function(){var deferred=$q.defer();return $http({method:"GET",url:"/pls/vdbmetadata/options?"+(new Date).getTime(),headers:{"Content-Type":"application/json"}}).success(function(data){var result={Success:!0,ResultObj:data,ResultErrors:null};deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GET_OPTIONS_ERROR")};deferred.resolve(result)}),deferred.promise},this.GetFields=function(){var deferred=$q.defer();return $http({method:"GET",url:"/pls/vdbmetadata/fields?"+(new Date).getTime(),headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};null!=data?(result.Success=!0,result.ResultObj=data):result.ResultErrors=ResourceUtility.getString("SETUP_MANAGE_FIELDS_GET_FIELDS_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GET_FIELDS_ERROR")};deferred.resolve(result)}),deferred.promise},this.UpdateField=function(field){var deferred=$q.defer();return $http({method:"PUT",url:"/pls/vdbmetadata/fields/"+field.ColumnName,headers:{"Content-Type":"application/json"},data:field}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data===!0||"true"===data?result.Success=!0:result.ResultErrors=ResourceUtility.getString("SETUP_MANAGE_FIELDS_UPDATE_FIELD_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_MANAGE_FIELDS_UPDATE_FIELD_ERROR")};deferred.resolve(result)}),deferred.promise},this.UpdateFields=function(fields){var deferred=$q.defer();return $http({method:"PUT",url:"/pls/vdbmetadata/fields",headers:{"Content-Type":"application/json"},data:fields}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data===!0||"true"===data?result.Success=!0:result.ResultErrors=ResourceUtility.getString("SETUP_MANAGE_FIELDS_UPDATE_FIELDS_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_MANAGE_FIELDS_UPDATE_FIELD_ERROR")};deferred.resolve(result)}),deferred.promise},this.IsBuildModelGroupRunning=function(){var deferred=$q.defer(),groupName="CreateAnalyticPlay";return $http({method:"GET",url:"/pls/vdbmetadata/runninggroups/"+groupName+"?"+(new Date).getTime(),headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data===!0||"true"===data?(result.Success=!0,result.ResultObj=!0):data===!1||"false"===data?(result.Success=!0,result.ResultObj=!1):result.ResultErrors=ResourceUtility.getString("SETUP_MANAGE_FIELDS_GET_BUILD_MODEL_GROUP_RUNNING_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_MANAGE_FIELDS_GET_BUILD_MODEL_GROUP_RUNNING_ERROR")};deferred.resolve(result)}),deferred.promise},this.BuildModel=function(){var deferred=$q.defer(),groupName="CreateAnalyticPlay";return $http({method:"POST",url:"/pls/vdbmetadata/executegroup/"+groupName,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data===!0||"true"===data?result.Success=!0:result.ResultErrors=ResourceUtility.getString("SETUP_MANAGE_FIELDS_BUILD_MODEL_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_MANAGE_FIELDS_BUILD_MODEL_ERROR")};deferred.resolve(result)}),deferred.promise}}),angular.module("mainApp.setup.services.TenantDeploymentService",["mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.RightsUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.core.services.SessionService"]).service("TenantDeploymentService",function($http,$q,BrowserStorageUtility,RightsUtility,ResourceUtility,SessionService){function getStepSuccessTime(step){var deferred=$q.defer();return $http({method:"GET",url:"/pls/tenantdeployments/successtime?step="+step,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_GET_COMPLETED_TIME_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_GET_COMPLETED_TIME_ERROR")};deferred.resolve(result)}),deferred.promise}this.GetTenantDeployment=function(){var deferred=$q.defer();return $http({method:"GET",url:"/pls/tenantdeployments/deployment?"+(new Date).getTime(),headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_GET_TENANT_DEPLOYMENT_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_GET_TENANT_DEPLOYMENT_ERROR")};deferred.resolve(result)}),deferred.promise},this.DeleteTenantDeployment=function(){var deferred=$q.defer();return $http({method:"DELETE",url:"/pls/tenantdeployments/deployment?"+(new Date).getTime(),headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_CLEAR_TENANT_DEPLOYMENT_CONFIRM_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_CLEAR_TENANT_DEPLOYMENT_CONFIRM_ERROR")};deferred.resolve(result)}),deferred.promise},this.ImportSfdcData=function(){var deferred=$q.defer();return $http({method:"POST",url:"/pls/tenantdeployments/importsfdcdata",headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_IMPORT_DATA_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_IMPORT_DATA_ERROR")};deferred.resolve(result)}),deferred.promise},this.GetImportSfdcDataCompleteTime=function(){return getStepSuccessTime("IMPORT_SFDC_DATA")},this.GetEnrichDataCompleteTime=function(){return getStepSuccessTime("ENRICH_DATA")},this.EnrichData=function(){var deferred=$q.defer();return $http({method:"POST",url:"/pls/tenantdeployments/enrichdata",headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_ENRICH_DATA_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_ENRICH_DATA_ERROR")};deferred.resolve(result)}),deferred.promise},this.ValidateMetadata=function(){var deferred=$q.defer();return $http({method:"POST",url:"/pls/tenantdeployments/validatemetadata",headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_VALIDATE_METADATA_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_VALIDATE_METADATA_ERROR")};deferred.resolve(result)}),deferred.promise},this.CancelLaunch=function(){var deferred=$q.defer();return $http({method:"POST",url:"/pls/tenantdeployments/cancellaunch",headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_CANCEL_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_CANCEL_ERROR")};deferred.resolve(result)}),deferred.promise},this.GetObjects=function(step,status){var deferred=$q.defer();return $http({method:"GET",url:"/pls/tenantdeployments/objects?step="+step+"&status="+status,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_GET_OBJECTS_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_GET_OBJECTS_ERROR")};deferred.resolve(result)}),deferred.promise},this.RunQuery=function(step){var deferred=$q.defer();return $http({method:"POST",url:"/pls/tenantdeployments/runquery?step="+step,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_RUN_QUERY_START_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_RUN_QUERY_START_ERROR")};deferred.resolve(result)}),deferred.promise},this.GetQueryStatus=function(queryHandle){var deferred=$q.defer();return $http({method:"GET",url:"/pls/tenantdeployments/querystatus/"+queryHandle,headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=data.Result):result.ResultErrors=ResourceUtility.getString("SETUP_GET_QUERY_STATUS_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){var result={Success:!1,ResultErrors:ResourceUtility.getString("SETUP_GET_QUERY_STATUS_ERROR")};deferred.resolve(result)}),deferred.promise}}),angular.module("mainApp.setup.utilities.SetupUtility",[]).service("SetupUtility",function(){this.LOAD_FIELDS_EVENT="LoadFieldsEvent",this.STEP_ENTER_CREDENTIALS="ENTER_CREDENTIALS",this.STEP_IMPORT_DATA="IMPORT_SFDC_DATA",this.STEP_ENRICH_DATA="ENRICH_DATA",this.STEP_VALIDATE_METADATA="VALIDATE_METADATA",this.STATUS_IN_PROGRESS="IN_PROGRESS",this.STATUS_SUCCESS="SUCCESS",this.STATUS_FAIL="FAIL",this.STATUS_WARNING="WARNING"}),angular.module("mainApp.userManagement.controllers.UserManagementController",["mainApp.appCommon.utilities.ResourceUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.RightsUtility","mainApp.appCommon.utilities.WidgetConfigUtility","mainApp.appCommon.services.WidgetFrameworkService","mainApp.core.services.WidgetService","mainApp.userManagement.services.UserManagementService"]).controller("UserManagementController",function($scope,BrowserStorageUtility,ResourceUtility,RightsUtility,WidgetService,WidgetConfigUtility,WidgetFrameworkService,UserManagementService){if($scope.ResourceUtility=ResourceUtility,$scope.loading=!0,null!=BrowserStorageUtility.getClientSession()){$("#userManagementError").hide(),$scope.errorMessage=ResourceUtility.getString("USER_MANAGEMENT_GET_USERS_ERROR");var widgetConfig=WidgetService.GetApplicationWidgetConfig();if(null!=widgetConfig){var screenWidgetConfig=WidgetConfigUtility.GetWidgetConfig(widgetConfig,"userManagementScreenWidget");if(null!=screenWidgetConfig){var contentContainer=$("#userManagementContainer");UserManagementService.GetUsers().then(function(result){$scope.loading=!1,result.Success&&WidgetFrameworkService.CreateWidget({element:contentContainer,widgetConfig:screenWidgetConfig,metadata:null,data:result.ResultObj,parentData:null})})}}}});var app=angular.module("mainApp.userManagement.modals.AddUserModal",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.PasswordUtility","mainApp.core.utilities.RightsUtility","mainApp.core.utilities.NavUtility","mainApp.userManagement.services.UserManagementService"]);app.service("AddUserModal",function($compile,$rootScope,$http){this.show=function(emails){$http.get("./app/userManagement/views/AddUserView.html").success(function(html){var scope=$rootScope.$new();scope.emails=emails;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}),app.controller("AddUserController",function($scope,$rootScope,_,ResourceUtility,BrowserStorageUtility,StringUtility,PasswordUtility,NavUtility,RightsUtility,UserManagementService){function isLatticeEmail(email){var domain="lattice-engines.com";return email.substring(email.length-domain.length)===domain}function validateNewUser(){if($scope.form.$error.required)return $scope.addUserErrorMessage=ResourceUtility.getString("ADD_USER_REQUIERD"),!1;if($scope.form.$error.email)return $scope.addUserErrorMessage=ResourceUtility.getString("ADD_USER_INVALID_EMAIL"),!1;if(_.contains($scope.emails,$scope.user.Email))return $scope.addUserErrorMessage=ResourceUtility.getString("ADD_USER_CONFLICT_EMAIL"),!1;var targetLevel=RightsUtility.getAccessLevel($scope.user.AccessLevel);return 0===targetLevel.ordinal&&isLatticeEmail($scope.user.Email)&&(targetLevel=RightsUtility.accessLevel.INTERNAL_USER,$scope.user.AccessLevel=targetLevel.name),targetLevel.ordinal>=2&&!isLatticeEmail($scope.user.Email)?($scope.addUserErrorMessage=ResourceUtility.getString("ADD_USER_EXTERNAL_EMAIL_INTERNAL_ROLE"),!1):!(targetLevel.ordinal<2&&isLatticeEmail($scope.user.Email))||($scope.addUserErrorMessage=ResourceUtility.getString("ADD_USER_INTERNAL_EMAIL_EXTERNAL_ROLE"),!1)}$scope.ResourceUtility=ResourceUtility,$scope.levelsToSelect=[RightsUtility.accessLevel.EXTERNAL_USER.name];var currentLevel=RightsUtility.getAccessLevel(BrowserStorageUtility.getClientSession().AccessLevel);currentLevel&&4==currentLevel.ordinal?$scope.levelsToSelect=_.union($scope.levelsToSelect,[RightsUtility.accessLevel.INTERNAL_ADMIN.name,RightsUtility.accessLevel.SUPER_ADMIN.name]):currentLevel&&3==currentLevel.ordinal&&($scope.levelsToSelect=_.union($scope.levelsToSelect,[RightsUtility.accessLevel.INTERNAL_ADMIN.name])),$scope.saveInProgress=!1,$scope.addUserErrorMessage="",$scope.showAddUserError=!1,$scope.user={AccessLevel:RightsUtility.accessLevel.EXTERNAL_USER.name},$scope.addUserClick=function($event){if(null!=$event&&$event.preventDefault(),!$scope.saveInProgress)return $scope.saveInProgress=!0,$scope.showAddUserError=!1,$scope.showAddUserSuccess=!1,validateNewUser()?void UserManagementService.AddUser($scope.user).then(function(result){if(result.Success){$scope.showAddUserSuccess=!0;var levelString=ResourceUtility.getString("ACCESS_LEVEL_"+result.ResultObj.AccessLevel);$scope.addUserSuccessMessage=ResourceUtility.getString("ADD_USER_SUCCESS",[result.ResultObj.Username,levelString]),$scope.saveInProgress=!1,$scope.showExistingUser=!1,$event.target.blur()}else null!=result.ResultObj.ConflictingUser?($scope.existingUser=result.ResultObj.ConflictingUser,$scope.showExistingUser=!0):(result.ResultErrors===ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")?$scope.addUserErrorMessage=ResourceUtility.getString("ADD_USER_GENERAL_ERROR"):$scope.addUserErrorMessage=result.ResultErrors,$scope.showAddUserSuccess=!1,$scope.showAddUserError=!0,$scope.saveInProgress=!1,$scope.showExistingUser=!1,$event.target.blur())}):($scope.saveInProgress=!1,$scope.showAddUserError=!0,void $event.target.blur())},$scope.cancelClick=function(){$("#modalContainer").modal("hide")},$scope.refreshClick=function(){$("#modalContainer").modal("hide"),$rootScope.$broadcast(NavUtility.USER_MANAGEMENT_NAV_EVENT)},$scope.yesClick=function($event){null!=$event&&$event.preventDefault(),$scope.showExistingUser=!1,$scope.user.FirstName=$scope.existingUser.FirstName,$scope.user.LastName=$scope.existingUser.LastName,$scope.user.Email=$scope.existingUser.Email,$scope.user.Username=$scope.existingUser.Username,UserManagementService.AssignAccessLevel($scope.user.Username,$scope.user.AccessLevel).then(function(result){result.Success?($scope.showAddUserSuccess=!0,$scope.addUserSuccessMessage=ResourceUtility.getString("ADD_EXSITING_USER_SUCCESS",[$scope.user.Username,ResourceUtility.getString("ACCESS_LEVEL_"+$scope.user.AccessLevel)])):($scope.addUserErrorMessage=ResourceUtility.getString("ADD_USER_GENERAL_ERROR"),$scope.showAddUserSuccess=!1,$scope.showAddUserError=!0),$scope.saveInProgress=!1,$event.target.blur()})},$scope.noClick=function(){$scope.saveInProgress=!1,$scope.showExistingUser=!1}});var app=angular.module("mainApp.userManagement.modals.DeleteUserModal",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.PasswordUtility","mainApp.core.utilities.RightsUtility","mainApp.core.utilities.NavUtility","mainApp.userManagement.services.UserManagementService"]);app.service("DeleteUserModal",function($compile,$rootScope,$http){this.show=function(userToBeDeleted){$http.get("./app/userManagement/views/DeleteUserView.html").success(function(html){var scope=$rootScope.$new();scope.user=userToBeDeleted;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}),app.controller("DeleteUserController",function($scope,$rootScope,_,ResourceUtility,BrowserStorageUtility,StringUtility,PasswordUtility,NavUtility,RightsUtility,UserManagementService){$scope.ResourceUtility=ResourceUtility,$scope.deleteInProgress=!1,$scope.deleteLoadingMsg=ResourceUtility.getString("DELETE_USER_WAIT",[$scope.user.Username]),$scope.noClick=function(){$("#modalContainer").modal("hide")},$scope.yesClick=function(){$scope.deleteInProgress||($scope.deleteInProgress=!0,UserManagementService.DeleteUser($scope.user).then(function(result){result.Success?($rootScope.$broadcast(NavUtility.USER_MANAGEMENT_NAV_EVENT),$("#modalContainer").modal("hide")):alert(result.Errors[0]),$scope.deleteInProgress=!1}))},$scope.cancelClick=function(){$("#modalContainer").modal("hide")}});var app=angular.module("mainApp.userManagement.modals.EditUserModal",["mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.StringUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.PasswordUtility","mainApp.core.utilities.RightsUtility","mainApp.core.utilities.NavUtility","mainApp.userManagement.services.UserManagementService"]);app.service("EditUserModal",function($compile,$rootScope,$http){
this.show=function(userToBeEdited){$http.get("./app/userManagement/views/EditUserView.html").success(function(html){var scope=$rootScope.$new();scope.user=userToBeEdited;var modalElement=$("#modalContainer");$compile(modalElement.html(html))(scope);var options={backdrop:"static"};modalElement.modal(options),modalElement.modal("show"),modalElement.on("hidden.bs.modal",function(evt){modalElement.empty()})})}}),app.controller("EditUserController",function($scope,$rootScope,_,ResourceUtility,BrowserStorageUtility,StringUtility,PasswordUtility,NavUtility,RightsUtility,UserManagementService){$scope.ResourceUtility=ResourceUtility,$scope.user=$scope.$parent.user;var currentLevel=RightsUtility.getAccessLevel(BrowserStorageUtility.getClientSession().AccessLevel),userLevel=RightsUtility.getAccessLevel($scope.user.AccessLevel);userLevel.ordinal<=1?$scope.levelsToSelect=[RightsUtility.accessLevel.EXTERNAL_USER.name]:3==currentLevel.ordinal?$scope.levelsToSelect=[RightsUtility.accessLevel.INTERNAL_USER.name,RightsUtility.accessLevel.INTERNAL_ADMIN.name]:4==currentLevel.ordinal&&($scope.levelsToSelect=[RightsUtility.accessLevel.INTERNAL_USER.name,RightsUtility.accessLevel.INTERNAL_ADMIN.name,RightsUtility.accessLevel.SUPER_ADMIN.name]),$scope.saveInProgress=!1,$scope.editUserErrorMessage="",$scope.showEditUserError=!1,$scope.targetLevel={AccessLevel:userLevel.name},$scope.editUserClick=function($event){null!=$event&&$event.preventDefault(),$scope.saveInProgress||($scope.saveInProgress=!0,$scope.showEditUserError=!1,$scope.showEditUserSuccess=!1,UserManagementService.AssignAccessLevel($scope.user.Username,$scope.targetLevel.AccessLevel).then(function(result){result.Success?($scope.showEditUserSuccess=!0,$scope.editUserSuccessMessage=ResourceUtility.getString("EDIT_USER_SUCCESS",[result.ResultObj.Username,ResourceUtility.getString("ACCESS_LEVEL_"+result.ResultObj.AccessLevel)]),$scope.saveInProgress=!1,$event.target.blur()):(result.ResultErrors===ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")?$scope.editUserErrorMessage=ResourceUtility.getString("EDIT_USER_GENERAL_ERROR"):$scope.editUserErrorMessage=result.ResultErrors,$scope.showEditUserSuccess=!1,$scope.showEditUserError=!0,$scope.saveInProgress=!1,$event.target.blur())}))},$scope.cancelClick=function(){$("#modalContainer").modal("hide")},$scope.refreshClick=function(){$("#modalContainer").modal("hide"),$rootScope.$broadcast(NavUtility.USER_MANAGEMENT_NAV_EVENT)}});var app=angular.module("mainApp.userManagement.services.UserManagementService",["mainApp.core.utilities.BrowserStorageUtility","mainApp.core.utilities.RightsUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.UnderscoreUtility","mainApp.core.services.SessionService"]);app.service("UserManagementService",function($http,$q,_,BrowserStorageUtility,ResourceUtility,RightsUtility,SessionService){this.AssignAccessLevel=function(username,accessLevel){var deferred=$q.defer(),result={Success:!1,ResultObj:null,ResultErrors:null};return $http({method:"PUT",url:"/pls/users/"+JSON.stringify(username),data:{AccessLevel:accessLevel},headers:{"Content-Type":"application/json"}}).success(function(data){result.Success=data.Success,result.ResultObj={Username:username,AccessLevel:accessLevel},deferred.resolve(result)}).error(function(data,status){SessionService.HandleResponseErrors(data,status),result.ResultErrors=ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR"),deferred.resolve(result)}),deferred.promise},this.GetUsers=function(){var deferred=$q.defer();return $http({method:"GET",url:"/pls/users?"+(new Date).getTime()}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:null,ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj=_.sortBy(data.Result,"Username")):result.ResultErrors=ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR"),deferred.resolve(result)}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ReportErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")};deferred.resolve(result)}),deferred.promise},this.AddUser=function(newUser){var deferred=$q.defer(),user={Username:newUser.Email,FirstName:newUser.FirstName,LastName:newUser.LastName,Email:newUser.Email,AccessLevel:newUser.AccessLevel},creds={Username:user.Username,Password:"WillBeResetImmediately"},registration={User:user,Credentials:creds};return $http({method:"POST",url:"/pls/users",headers:{"Content-Type":"application/json"},data:registration}).success(function(data,status,headers,config){var result={Success:!1,ResultObj:{},ResultErrors:null};data.Success?(result.Success=!0,result.ResultObj={Username:user.Username,AccessLevel:user.AccessLevel,Password:data.Result.Password},deferred.resolve(result)):(result.ResultErrors=ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR"),data.Result.hasOwnProperty("ConflictingUser")&&(result.ResultObj.ConflictingUser=data.Result.ConflictingUser,result.ResultErrors=ResourceUtility.getString("ADD_USER_CONFLICT_EMAIL")),deferred.resolve(result))}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ReportErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")};deferred.resolve(result)}),deferred.promise},this.DeleteUser=function(user){var deferred=$q.defer(),result={Success:!1,ResultObj:{},ResultErrors:null};return $http({method:"DELETE",url:"/pls/users/"+JSON.stringify(user.Username),headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){data.Success?(result.Success=!0,deferred.resolve(result)):(result.ResultErrors=ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR"),_.some(data.Errors,function(err){return err.indexOf("email conflicts")>-1})&&(result.ResultObj.ConflictingUser=data.Result.ConflictingUser,result.ResultErrors=ResourceUtility.getString("ADD_USER_CONFLICT_EMAIL")),deferred.resolve(result))}).error(function(data,status,headers,config){SessionService.HandleResponseErrors(data,status);var result={Success:!1,ReportErrors:ResourceUtility.getString("UNEXPECTED_SERVICE_ERROR")};deferred.resolve(result)}),deferred.promise}});var mainApp=angular.module("mainApp",["ui.bootstrap","mainApp.core.utilities.BrowserStorageUtility","mainApp.appCommon.utilities.ResourceUtility","mainApp.appCommon.utilities.TimestampIntervalUtility","mainApp.core.services.ResourceStringsService","mainApp.core.services.HelpService","mainApp.login.services.LoginService","mainApp.config.services.ConfigService","mainApp.login.controllers.LoginController","mainApp.core.controllers.MainViewController","mainApp.appCommon.modals.SimpleModal"]).config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache"}]).controller("MainController",function($scope,$http,$rootScope,$compile,$interval,$modal,$timeout,BrowserStorageUtility,ResourceUtility,TimestampIntervalUtility,ResourceStringsService,HelpService,LoginService,ConfigService,SimpleModal){function startObservingUserActivtyThroughMouseAndKeyboard(){$(this).mousemove(function(e){warningModalInstance||refreshSessionLastActiveTimeStamp()}),$(this).keypress(function(e){warningModalInstance||refreshSessionLastActiveTimeStamp()})}function startCheckingIfSessionIsInactive(){refreshSessionLastActiveTimeStamp(),inactivityCheckingId=setInterval(checkIfSessionIsInactiveEveryInterval,TIME_INTERVAL_BETWEEN_INACTIVITY_CHECKS)}function checkIfSessionIsInactiveEveryInterval(){Date.now()-BrowserStorageUtility.getSessionLastActiveTimestamp()>=TIME_INTERVAL_INACTIVITY_BEFORE_WARNING&&(warningModalInstance||(cancelCheckingIfSessionIsInactiveAndSetIdToNull(),openWarningModal()),$timeout(callWhenWarningModalExpires,TIME_INTERVAL_WARNING_BEFORE_LOGOUT))}function mustUserChangePassword(loginDocument){return loginDocument.MustChangePassword||TimestampIntervalUtility.isTimestampFartherThanNinetyDaysAgo(loginDocument.PasswordLastModified)}function refreshSessionLastActiveTimeStamp(){BrowserStorageUtility.setSessionLastActiveTimestamp(Date.now())}function hasSessionTimedOut(){return Date.now()-BrowserStorageUtility.getSessionLastActiveTimestamp()>=TIME_INTERVAL_INACTIVITY_BEFORE_WARNING+TIME_INTERVAL_WARNING_BEFORE_LOGOUT}function openWarningModal(){warningModalInstance=$modal.open({animation:!0,backdrop:!1,scope:$scope,templateUrl:"app/core/views/WarningModal.html"}),$scope.refreshSession=function(){closeWarningModalAndSetInstanceToNull(),startCheckingIfSessionIsInactive()}}function cancelCheckingIfSessionIsInactiveAndSetIdToNull(){clearInterval(inactivityCheckingId),inactivityCheckingId=null}function stopObservingUserInteractionBasedOnMouseAndKeyboard(){$(this).off("mousemove"),$(this).off("keypress")}function callWhenWarningModalExpires(){hasSessionTimedOut()?($scope.sessionExpired=!0,hideTenantSelectionModal(),stopObservingUserInteractionBasedOnMouseAndKeyboard(),LoginService.Logout()):(warningModalInstance&&closeWarningModalAndSetInstanceToNull(),inactivityCheckingId||startCheckingIfSessionIsInactive())}function hideTenantSelectionModal(){$("#modalContainer").modal("hide")}function closeWarningModalAndSetInstanceToNull(){warningModalInstance.close(),warningModalInstance=null}function createMandatoryChangePasswordViewForLocale(locale){ResourceStringsService.GetInternalResourceStringsForLocale(locale).then(function(result){$http.get("./app/core/views/MainView.html").success(function(html){var scope=$rootScope.$new();scope.isLoggedInWithTempPassword=$scope.isLoggedInWithTempPassword,scope.isPasswordOlderThanNinetyDays=$scope.isPasswordOlderThanNinetyDays,$compile($("#mainView").html(html))(scope)})})}$scope.showFooter=!0,$scope.sessionExpired=!1;var TIME_INTERVAL_BETWEEN_INACTIVITY_CHECKS=3e4,TIME_INTERVAL_INACTIVITY_BEFORE_WARNING=87e4,TIME_INTERVAL_WARNING_BEFORE_LOGOUT=3e4,inactivityCheckingId=null,warningModalInstance=null;ResourceStringsService.GetExternalResourceStringsForLocale().then(function(result){var previousSession=BrowserStorageUtility.getClientSession(),loginDocument=BrowserStorageUtility.getLoginDocument();loginDocument&&mustUserChangePassword(loginDocument)?($scope.isLoggedInWithTempPassword=loginDocument.MustChangePassword,$scope.isPasswordOlderThanNinetyDays=TimestampIntervalUtility.isTimestampFartherThanNinetyDaysAgo(loginDocument.PasswordLastModified),createMandatoryChangePasswordViewForLocale(previousSession.Locale)):null==previousSession||hasSessionTimedOut()?($scope.showFooter=!1,$http.get("./app/login/views/LoginView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainView").html(html))(scope)})):$scope.refreshPreviousSession(previousSession.Tenant)}),$scope.$on("LoggedIn",function(){startObservingUserActivtyThroughMouseAndKeyboard(),startCheckingIfSessionIsInactive()}),$scope.refreshPreviousSession=function(tenant){LoginService.GetSessionDocument(tenant).then(function(data,status){data&&data.Success===!0&&($scope.getLocaleSpecificResourceStrings(data.Result.User.Locale),startObservingUserActivtyThroughMouseAndKeyboard(),startCheckingIfSessionIsInactive())},function(data,status){})},$scope.$on("ShowFooterEvent",function(event,data){$scope.showFooter=data,$scope.showFooter===!0&&($scope.copyrightString=ResourceUtility.getString("FOOTER_COPYRIGHT",[(new Date).getFullYear()]),$scope.privacyPolicyString=ResourceUtility.getString("HEADER_PRIVACY_POLICY"))}),$scope.getLocaleSpecificResourceStrings=function(locale){ResourceStringsService.GetInternalResourceStringsForLocale(locale).then(function(result){$scope.copyrightString=ResourceUtility.getString("FOOTER_COPYRIGHT",[(new Date).getFullYear()]),$scope.privacyPolicyString=ResourceUtility.getString("HEADER_PRIVACY_POLICY"),$scope.getWidgetConfigDoc()})},$scope.getWidgetConfigDoc=function(){ConfigService.GetWidgetConfigDocument().then(function(result){$http.get("./app/core/views/MainView.html").success(function(html){var scope=$rootScope.$new();$compile($("#mainView").html(html))(scope)})})}});mainApp.factory("authInterceptor",function($rootScope,$q,$window,BrowserStorageUtility){return{request:function(config){if(config.headers=config.headers||{},BrowserStorageUtility.getTokenDocument()){config.headers.Authorization=BrowserStorageUtility.getTokenDocument();var ClientSession=BrowserStorageUtility.getClientSession();ClientSession&&ClientSession.Tenant&&(config.headers.TenantId=ClientSession.Tenant.Identifier)}return config},response:function(response){return 401===response.status,response||$q.when(response)}}}),mainApp.config(function($httpProvider){$httpProvider.interceptors.push("authInterceptor")});