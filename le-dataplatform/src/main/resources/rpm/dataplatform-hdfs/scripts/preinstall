#!/bin/bash

echo 'check env var STACK_NAME'
echo $STACK_NAME

RPMFILE=`ls /tmp/le-dataplatform-hdfs-rpm-*.rpm`
VERSION=`echo $RPMFILE | cut -d \- -f 5`
SNAPSHOT=`echo $RPMFILE | cut -d \- -f 6`

if [[ $SNAPSHOT = SNAPSHOT* ]]
    then
        VERSION=$VERSION-"SNAPSHOT"
fi

rm -rf /tmp/app/dataplatform
rm -rf /tmp/app/playmaker
rm -rf /tmp/datascientist

if [ ! -z "$STACK_NAME" -a "$STACK_NAME" != " " ]; then
    VERSION=${STACK_NAME}/${VERSION}
fi

hdfs dfs -rm -f -r /app/$VERSION/dataflowapi || true
hdfs dfs -rm -f -r /app/$VERSION/dataplatform || true
hdfs dfs -rm -f -r /app/$VERSION/db || true
hdfs dfs -rm -f -r /app/$VERSION/camille || true
hdfs dfs -rm -f -r /app/$VERSION/eai || true
hdfs dfs -rm -f -r /app/$VERSION/playmaker || true
hdfs dfs -rm -f -r /app/$VERSION/security || true
hdfs dfs -rm -f -r /app/$VERSION/workflow || true
hdfs dfs -rm -f -r /app/$VERSION/workflowapi || true
hdfs dfs -rm -f -r /app/$VERSION/propdata || true
hdfs dfs -rm -f -r /app/$VERSION/proxy || true
hdfs dfs -rm -f -r /app/$VERSION/monitor || true
hdfs dfs -rm -f -r /datascientist

hdfs dfs -mkdir -p /app/$VERSION/dataflowapi/lib
hdfs dfs -mkdir -p /app/$VERSION/dataplatform
hdfs dfs -mkdir -p /app/$VERSION/dataplatform/lib
hdfs dfs -mkdir -p /app/$VERSION/db
hdfs dfs -mkdir -p /app/$VERSION/camille
hdfs dfs -mkdir -p /app/$VERSION/eai/lib
hdfs dfs -mkdir -p /app/$VERSION/playmaker
hdfs dfs -mkdir -p /app/$VERSION/security
hdfs dfs -mkdir -p /app/$VERSION/workflow
hdfs dfs -mkdir -p /app/$VERSION/workflowapi/lib
hdfs dfs -mkdir -p /app/$VERSION/propdata
hdfs dfs -mkdir -p /app/$VERSION/propdata/lib
hdfs dfs -mkdir -p /app/$VERSION/proxy
hdfs dfs -mkdir -p /app/$VERSION/monitor
hdfs dfs -mkdir -p /datascientist
