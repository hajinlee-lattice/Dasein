USE `PLS_MultiTenant`;

DELIMITER //
CREATE PROCEDURE `UpdatePLSTables`()
BEGIN
    DROP TABLE if EXISTS `METADATA_ATTRIBUTE_SET`;
    CREATE TABLE `METADATA_ATTRIBUTE_SET` (
	    `PID` bigint not null auto_increment,
	    `NAME` VARCHAR(255) NOT NULL,
	    `DISPLAY_NAME` varchar(255) NOT NULL,
	    `DESCRIPTION` varchar(255),
	    `ATTRIBUTES` longblob NULL,
	    `FK_TENANT_ID` bigint(20) NOT NULL,
	    `CREATED`  datetime NOT NULL,
	    `UPDATED` datetime NOT NULL,
	    `CREATED_BY` VARCHAR(255) DEFAULT NULL,
	    `UPDATED_BY` VARCHAR(255) DEFAULT NULL,
	    PRIMARY KEY (`PID`)
	) ENGINE=InnoDB;
    ALTER TABLE `METADATA_ATTRIBUTE_SET` ADD CONSTRAINT `FK_METADATAATTRIBUTESET_FKTENANTID_TENANT`
        FOREIGN KEY (`FK_TENANT_ID`) REFERENCES `TENANT` (`TENANT_PID`) ON DELETE CASCADE;
    ALTER TABLE `METADATA_ATTRIBUTE_SET` ADD CONSTRAINT `UK8ve4s3goubtlf0hqku9ud5ulg` UNIQUE (`NAME`, `FK_TENANT_ID`);
    ALTER TABLE `ATLAS_EXPORT`
        ADD COLUMN `ATTRIBUTE_SET_NAME` VARCHAR(255);
    ALTER TABLE `RATING_ENGINE`
        ADD COLUMN `TEAM_ID` VARCHAR(255);
END;
//
DELIMITER ;
CALL `UpdatePLSTables`();
