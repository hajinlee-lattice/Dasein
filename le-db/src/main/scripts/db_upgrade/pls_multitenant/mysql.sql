
USE `PLS_MultiTenant`;

CREATE PROCEDURE `CreateDCPUploadTable`()
  BEGIN
    CREATE TABLE `DCP_UPLOAD`
      (
         `PID`           BIGINT NOT NULL auto_increment,
         `CREATED`       DATETIME NOT NULL,
         `SOURCE_ID`     VARCHAR(255) NOT NULL,
         `STATUS`        INTEGER,
         `UPDATED`       DATETIME NOT NULL,
         `UPLOAD_CONFIG` JSON,
         `FK_TENANT_ID`  BIGINT NOT NULL,
         PRIMARY KEY (`PID`)
      )
    engine=InnoDB;

    CREATE INDEX IX_SOURCE_ID ON `DCP_UPLOAD` (`SOURCE_ID`);

    ALTER TABLE `DCP_UPLOAD`
      ADD CONSTRAINT `FK_DCPUPLOAD_FKTENANTID_TENANT` FOREIGN KEY (`FK_TENANT_ID`)
      REFERENCES `TENANT` (`TENANT_PID`) ON DELETE CASCADE;
  END;

CREATE PROCEDURE `UpdateImportMessageTable`()
  BEGIN
      ALTER TABLE `ATLAS_S3_IMPORT_MESSAGE`
        ADD COLUMN `MESSAGE_TYPE` VARCHAR(25),
        CHANGE COLUMN `FEED_TYPE` `FEED_TYPE` VARCHAR(255) NULL,
        CHANGE COLUMN `KEY` `KEY` VARCHAR(500) NOT NULL;
  END;

DELIMITER;