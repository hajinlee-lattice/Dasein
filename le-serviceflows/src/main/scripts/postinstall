#!/bin/sh
echo "examine environment vars"
HADOOP_CONF_DIR=/usr/hdp/current/hadoop-client/conf

echo $HADOOP_CONF_DIR

JARFILE=`ls /tmp/le-swlib-*-shaded.jar`
VERSION=`echo $JARFILE | cut -d \- -f 3`
SNAPSHOT=`echo $JARFILE | cut -d \- -f 4`

if test $SNAPSHOT = "SNAPSHOT"
    then
        VERSION=$VERSION-"SNAPSHOT"
fi

echo $VERSION

java -cp $JARFILE:$HADOOP_CONF_DIR com.latticeengines.swlib.SwlibTool \
    -o install \
    -m dataflowapi \
    -g com.latticeengines \
    -a le-serviceflows-prospectdiscovery \
    -v $VERSION \
    -i com.latticeengines.prospectdiscovery.Initializer \
    -f /tmp/le-serviceflows-prospectdiscovery-*-shaded.jar

java -cp $JARFILE:$HADOOP_CONF_DIR com.latticeengines.swlib.SwlibTool \
    -o install \
    -m propdata \
    -g com.latticeengines \
    -a le-serviceflows \
    -v $VERSION \
    -i com.latticeengines.propdata.Initializer \
    -f /tmp/le-serviceflows-propdata-*-shaded.jar

java -cp $JARFILE:$HADOOP_CONF_DIR com.latticeengines.swlib.SwlibTool \
    -o install \
    -m dataflowapi \
    -g com.latticeengines \
    -a le-serviceflows-leadprioritization \
    -v $VERSION \
    -i com.latticeengines.leadprioritization.Initializer \
    -f /tmp/le-serviceflows-leadprioritization-*-shaded.jar


